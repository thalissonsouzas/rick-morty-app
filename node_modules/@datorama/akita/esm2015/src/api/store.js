/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import { BehaviorSubject, ReplaySubject } from 'rxjs';
import { distinctUntilChanged, map } from 'rxjs/operators';
import { AkitaError, AkitaImmutabilityError, assertDecorator } from '../internal/error';
import { commit, isTransactionInProcess } from '../internal/transaction.internal';
import { isFunction, isPlainObject } from '../internal/utils';
import { deepFreeze } from '../internal/deep-freeze';
import { configKey } from './store-config';
import { __globalState } from '../internal/global-state';
import { getAkitaConfig } from './config';
/** @type {?} */
let __DEV__ = true;
/** @type {?} */
const isNotBrowser = typeof window === 'undefined';
/** @type {?} */
export const __stores__ = {};
/** @enum {number} */
const Actions = {
    NEW_STORE: 0,
    DELETE_STORE: 1,
    NEW_STATE: 2,
};
export { Actions };
/** @type {?} */
export const rootDispatcher = new ReplaySubject();
/**
 * @param {?} storeName
 * @param {?=} initialState
 * @return {?}
 */
function nextState(storeName, initialState = false) {
    return {
        type: 2 /* NEW_STATE */,
        payload: {
            name: storeName,
            initialState
        }
    };
}
/**
 * Enable production mode to disable objectFreeze
 * @return {?}
 */
export function enableAkitaProdMode() {
    __DEV__ = false;
}
/**
 * @return {?}
 */
export function isDev() {
    return __DEV__;
}
/**
 * The Root Store that every sub store needs to inherit and
 * invoke `super` with the initial state.
 * @template S
 */
export class Store {
    /**
     *
     * Initial the store with the state
     * @param {?} initialState
     * @param {?=} options
     */
    constructor(initialState, options = {}) {
        this.options = options;
        /**
         * Whether we are inside transaction *
         */
        this.inTransaction = false;
        this._isPristine = true;
        this.destroy = this.ngOnDestroy;
        __globalState.setAction({ type: '@@INIT' });
        __stores__[this.storeName] = this;
        this.setState(() => initialState);
        rootDispatcher.next({
            type: 0 /* NEW_STORE */,
            payload: { store: this }
        });
        isDev() && assertDecorator(this.storeName, this.constructor.name);
        if (this.isRessetable()) {
            this._initialState = initialState;
        }
    }
    /**
     * @param {?=} loading
     * @return {?}
     */
    setLoading(loading = false) {
        if (loading !== ((/** @type {?} */ (this._value()))).loading) {
            isDev() && __globalState.setAction({ type: 'Set Loading' });
            this.setState(s => ((/** @type {?} */ (Object.assign({}, ((/** @type {?} */ (s))), { loading })))));
        }
    }
    /**
     * Update the store's error state.
     * @template T
     * @param {?} error
     * @return {?}
     */
    setError(error) {
        if (error !== ((/** @type {?} */ (this._value()))).error) {
            isDev() && __globalState.setAction({ type: 'Set Error' });
            this.setState(s => ((/** @type {?} */ (Object.assign({}, ((/** @type {?} */ (s))), { error })))));
        }
    }
    /**
     * Select a slice from the store
     *
     * \@example
     * this.store.select(state => state.entities)
     *
     * @template R
     * @param {?} project
     * @return {?}
     */
    _select(project) {
        return this.store$.pipe(map(project), distinctUntilChanged());
    }
    /**
     * @return {?}
     */
    _value() {
        return this.storeValue;
    }
    /**
     * @return {?}
     */
    get config() {
        return this.constructor[configKey];
    }
    /**
     * @return {?}
     */
    get storeName() {
        return this.options.storeName || (this.config && this.config['storeName']);
    }
    /**
     * @return {?}
     */
    get idKey() {
        /**
         * backward compatibility
         * @type {?}
         */
        const newIdKey = this.config && this.config.idKey;
        if (!newIdKey) {
            return this.options.idKey || 'id';
        }
        return newIdKey;
    }
    /**
     * @return {?}
     */
    get isPristine() {
        return this._isPristine;
    }
    /**
     * `setState()` is the only way to update a store; It receives a callback function,
     * which gets the current state, and returns a new immutable state,
     * which will be the new value of the store.
     * @param {?} newStateFn
     * @param {?=} _rootDispatcher
     * @return {?}
     */
    setState(newStateFn, _rootDispatcher = true) {
        /** @type {?} */
        const prevState = this._value();
        this.storeValue = __DEV__ ? deepFreeze(newStateFn(this._value())) : newStateFn(this._value());
        if (prevState === this.storeValue) {
            throw new AkitaImmutabilityError(this.storeName);
        }
        if (!this.store) {
            this.store = new BehaviorSubject(this.storeValue);
            rootDispatcher.next(nextState(this.storeName, true));
            return;
        }
        if (isTransactionInProcess()) {
            this.handleTransaction();
            return;
        }
        this.dispatch(this.storeValue, _rootDispatcher);
    }
    /**
     * Resets the store to it's initial state and set the store to a pristine state.
     * @return {?}
     */
    reset() {
        if (this.isRessetable()) {
            __globalState.setAction({ type: 'Reset Store' });
            this.setState(() => Object.assign({}, this._initialState));
            this.setPristine();
        }
        else {
            throw new AkitaError(`You need to enable the reset functionality`);
        }
    }
    /**
     * @param {?} newStateOrId
     * @param {?=} newState
     * @return {?}
     */
    update(newStateOrId, newState) {
        __globalState.setAction({ type: 'Update Store' });
        this.setState(state => {
            /** @type {?} */
            let value = isFunction(newStateOrId) ? newStateOrId(state) : newStateOrId;
            /** @type {?} */
            let merged = Object.assign({}, state, value);
            return isPlainObject(state) ? merged : new ((/** @type {?} */ (state))).constructor(merged);
        });
        this.setDirty();
    }
    /**
     * Sets the store to a pristine state.
     * @return {?}
     */
    setPristine() {
        this._isPristine = true;
    }
    /**
     * Sets the store to a dirty state, indicating that it is not pristine.
     * @return {?}
     */
    setDirty() {
        this._isPristine = false;
    }
    /**
     * @param {?} state
     * @param {?=} _rootDispatcher
     * @return {?}
     */
    dispatch(state, _rootDispatcher = true) {
        this.store.next(state);
        if (_rootDispatcher) {
            rootDispatcher.next(nextState(this.storeName));
            isDev() && __globalState.setAction({ type: 'Set State' });
        }
    }
    /**
     * @return {?}
     */
    get store$() {
        return this.store.asObservable();
    }
    /**
     * When the transaction ends dispatch the final value once
     * @return {?}
     */
    watchTransaction() {
        commit().subscribe(() => {
            this.inTransaction = false;
            if (isDev() && !__globalState.skipTransactionMsg) {
                __globalState.setAction({ type: '@Transaction' });
            }
            this.dispatch(this._value());
            __globalState.currentT = [];
            __globalState.skipTransactionMsg = false;
        });
    }
    /**
     * @return {?}
     */
    isRessetable() {
        return this.config.resettable || getAkitaConfig().resettable;
    }
    /**
     * Listen to the transaction stream
     * @return {?}
     */
    handleTransaction() {
        if (!this.inTransaction) {
            this.watchTransaction();
            this.inTransaction = true;
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (isNotBrowser)
            return;
        if (!((/** @type {?} */ (window))).hmrEnabled && this === __stores__[this.storeName]) {
            delete __stores__[this.storeName];
            rootDispatcher.next({
                type: 1 /* DELETE_STORE */,
                payload: { storeName: this.storeName }
            });
        }
    }
}
if (false) {
    /**
     * Manage the store with BehaviorSubject
     * @type {?}
     */
    Store.prototype.store;
    /**
     * The current state value
     * @type {?}
     */
    Store.prototype.storeValue;
    /**
     * Whether we are inside transaction *
     * @type {?}
     */
    Store.prototype.inTransaction;
    /** @type {?} */
    Store.prototype._isPristine;
    /** @type {?} */
    Store.prototype._initialState;
    /** @type {?} */
    Store.prototype.destroy;
    /** @type {?} */
    Store.prototype.options;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RvcmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZGF0b3JhbWEvYWtpdGEvIiwic291cmNlcyI6WyJzcmMvYXBpL3N0b3JlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFDQSxPQUFPLEVBQUUsZUFBZSxFQUFjLGFBQWEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNsRSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0QsT0FBTyxFQUFFLFVBQVUsRUFBRSxzQkFBc0IsRUFBRSxlQUFlLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUN4RixPQUFPLEVBQUUsTUFBTSxFQUFFLHNCQUFzQixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFDbEYsT0FBTyxFQUFFLFVBQVUsRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUM5RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDckQsT0FBTyxFQUFFLFNBQVMsRUFBc0IsTUFBTSxnQkFBZ0IsQ0FBQztBQUMvRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDekQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLFVBQVUsQ0FBQzs7SUFFdEMsT0FBTyxHQUFHLElBQUk7O01BQ1osWUFBWSxHQUFHLE9BQU8sTUFBTSxLQUFLLFdBQVc7O0FBRWxELE1BQU0sT0FBTyxVQUFVLEdBQXdDLEVBQUU7OztJQUcvRCxZQUFTO0lBQ1QsZUFBWTtJQUNaLFlBQVM7Ozs7QUFRWCxNQUFNLE9BQU8sY0FBYyxHQUFHLElBQUksYUFBYSxFQUFVOzs7Ozs7QUFFekQsU0FBUyxTQUFTLENBQUMsU0FBUyxFQUFFLFlBQVksR0FBRyxLQUFLO0lBQ2hELE9BQU87UUFDTCxJQUFJLG1CQUFtQjtRQUN2QixPQUFPLEVBQUU7WUFDUCxJQUFJLEVBQUUsU0FBUztZQUNmLFlBQVk7U0FDYjtLQUNGLENBQUM7QUFDSixDQUFDOzs7OztBQUtE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LENBQUM7WUFDeEIsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUM7U0FDM0I7SUFDSCxDQUFDOzs7O0lBRUQsV0FBVztRQUNULElBQUksWUFBWTtZQUFFLE9BQU87UUFDekIsSUFBSSxDQUFDLENBQUMsbUJBQUEsTUFBTSxFQUFPLENBQUMsQ0FBQyxVQUFVLElBQUksSUFBSSxLQUFLLFVBQVUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUU7WUFDdEUsT0FBTyxVQUFVLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ2xDLGNBQWMsQ0FBQyxJQUFJLENBQUM7Z0JBQ2xCLElBQUksc0JBQXNCO2dCQUMxQixPQUFPLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxDQUFDLFNBQVMsRUFBRTthQUN2QyxDQUFDLENBQUM7U0FDSjtJQUNILENBQUM7Q0FDRjs7Ozs7O0lBck5DLHNCQUE0Qzs7Ozs7SUFHNUMsMkJBQXNCOzs7OztJQUd0Qiw4QkFBOEI7O0lBRTlCLDRCQUEyQjs7SUFFM0IsOEJBQWtDOztJQXNKbEMsd0JBQTJCOztJQWhKRCx3QkFBNEQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIYXNoTWFwLCBJRCB9IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlLCBSZXBsYXlTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkaXN0aW5jdFVudGlsQ2hhbmdlZCwgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgQWtpdGFFcnJvciwgQWtpdGFJbW11dGFiaWxpdHlFcnJvciwgYXNzZXJ0RGVjb3JhdG9yIH0gZnJvbSAnLi4vaW50ZXJuYWwvZXJyb3InO1xuaW1wb3J0IHsgY29tbWl0LCBpc1RyYW5zYWN0aW9uSW5Qcm9jZXNzIH0gZnJvbSAnLi4vaW50ZXJuYWwvdHJhbnNhY3Rpb24uaW50ZXJuYWwnO1xuaW1wb3J0IHsgaXNGdW5jdGlvbiwgaXNQbGFpbk9iamVjdCB9IGZyb20gJy4uL2ludGVybmFsL3V0aWxzJztcbmltcG9ydCB7IGRlZXBGcmVlemUgfSBmcm9tICcuLi9pbnRlcm5hbC9kZWVwLWZyZWV6ZSc7XG5pbXBvcnQgeyBjb25maWdLZXksIFN0b3JlQ29uZmlnT3B0aW9ucyB9IGZyb20gJy4vc3RvcmUtY29uZmlnJztcbmltcG9ydCB7IF9fZ2xvYmFsU3RhdGUgfSBmcm9tICcuLi9pbnRlcm5hbC9nbG9iYWwtc3RhdGUnO1xuaW1wb3J0IHsgZ2V0QWtpdGFDb25maWcgfSBmcm9tICcuL2NvbmZpZyc7XG5cbmxldCBfX0RFVl9fID0gdHJ1ZTtcbmNvbnN0IGlzTm90QnJvd3NlciA9IHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnO1xuXG5leHBvcnQgY29uc3QgX19zdG9yZXNfXzogeyBbc3RvcmVOYW1lOiBzdHJpbmddOiBTdG9yZTxhbnk+IH0gPSB7fTtcblxuZXhwb3J0IGNvbnN0IGVudW0gQWN0aW9ucyB7XG4gIE5FV19TVE9SRSxcbiAgREVMRVRFX1NUT1JFLFxuICBORVdfU1RBVEVcbn1cblxuZXhwb3J0IHR5cGUgQWN0aW9uID0ge1xuICB0eXBlOiBBY3Rpb25zO1xuICBwYXlsb2FkOiBIYXNoTWFwPGFueT47XG59O1xuXG5leHBvcnQgY29uc3Qgcm9vdERpc3BhdGNoZXIgPSBuZXcgUmVwbGF5U3ViamVjdDxBY3Rpb24+KCk7XG5cbmZ1bmN0aW9uIG5leHRTdGF0ZShzdG9yZU5hbWUsIGluaXRpYWxTdGF0ZSA9IGZhbHNlKSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogQWN0aW9ucy5ORVdfU1RBVEUsXG4gICAgcGF5bG9hZDoge1xuICAgICAgbmFtZTogc3RvcmVOYW1lLFxuICAgICAgaW5pdGlhbFN0YXRlXG4gICAgfVxuICB9O1xufVxuXG4vKipcbiAqIEVuYWJsZSBwcm9kdWN0aW9uIG1vZGUgdG8gZGlzYWJsZSBvYmplY3RGcmVlemVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGVuYWJsZUFraXRhUHJvZE1vZGUoKSB7XG4gIF9fREVWX18gPSBmYWxzZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzRGV2KCkge1xuICByZXR1cm4gX19ERVZfXztcbn1cblxuLyoqXG4gKiBUaGUgUm9vdCBTdG9yZSB0aGF0IGV2ZXJ5IHN1YiBzdG9yZSBuZWVkcyB0byBpbmhlcml0IGFuZFxuICogaW52b2tlIGBzdXBlcmAgd2l0aCB0aGUgaW5pdGlhbCBzdGF0ZS5cbiAqL1xuZXhwb3J0IGNsYXNzIFN0b3JlPFM+IHtcbiAgLyoqIE1hbmFnZSB0aGUgc3RvcmUgd2l0aCBCZWhhdmlvclN1YmplY3QgKi9cbiAgcHJpdmF0ZSBzdG9yZTogQmVoYXZpb3JTdWJqZWN0PFJlYWRvbmx5PFM+PjtcblxuICAvKiogVGhlIGN1cnJlbnQgc3RhdGUgdmFsdWUgKi9cbiAgcHJpdmF0ZSBzdG9yZVZhbHVlOiBTO1xuXG4gIC8qKiBXaGV0aGVyIHdlIGFyZSBpbnNpZGUgdHJhbnNhY3Rpb24gKiovXG4gIHByaXZhdGUgaW5UcmFuc2FjdGlvbiA9IGZhbHNlO1xuXG4gIHByaXZhdGUgX2lzUHJpc3RpbmUgPSB0cnVlO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgX2luaXRpYWxTdGF0ZTogUztcblxuICAvKipcbiAgICpcbiAgICogSW5pdGlhbCB0aGUgc3RvcmUgd2l0aCB0aGUgc3RhdGVcbiAgICovXG4gIGNvbnN0cnVjdG9yKGluaXRpYWxTdGF0ZSwgcHJpdmF0ZSBvcHRpb25zOiB7IGlkS2V5Pzogc3RyaW5nOyBzdG9yZU5hbWU/OiBzdHJpbmcgfSA9IHt9KSB7XG4gICAgX19nbG9iYWxTdGF0ZS5zZXRBY3Rpb24oeyB0eXBlOiAnQEBJTklUJyB9KTtcbiAgICBfX3N0b3Jlc19fW3RoaXMuc3RvcmVOYW1lXSA9IHRoaXM7XG4gICAgdGhpcy5zZXRTdGF0ZSgoKSA9PiBpbml0aWFsU3RhdGUpO1xuICAgIHJvb3REaXNwYXRjaGVyLm5leHQoe1xuICAgICAgdHlwZTogQWN0aW9ucy5ORVdfU1RPUkUsXG4gICAgICBwYXlsb2FkOiB7IHN0b3JlOiB0aGlzIH1cbiAgICB9KTtcbiAgICBpc0RldigpICYmIGFzc2VydERlY29yYXRvcih0aGlzLnN0b3JlTmFtZSwgdGhpcy5jb25zdHJ1Y3Rvci5uYW1lKTtcbiAgICBpZiAodGhpcy5pc1Jlc3NldGFibGUoKSkge1xuICAgICAgdGhpcy5faW5pdGlhbFN0YXRlID0gaW5pdGlhbFN0YXRlO1xuICAgIH1cbiAgfVxuXG4gIHNldExvYWRpbmcobG9hZGluZyA9IGZhbHNlKSB7XG4gICAgaWYgKGxvYWRpbmcgIT09ICh0aGlzLl92YWx1ZSgpIGFzIFMgJiB7IGxvYWRpbmc6IGJvb2xlYW4gfSkubG9hZGluZykge1xuICAgICAgaXNEZXYoKSAmJiBfX2dsb2JhbFN0YXRlLnNldEFjdGlvbih7IHR5cGU6ICdTZXQgTG9hZGluZycgfSk7XG4gICAgICB0aGlzLnNldFN0YXRlKHMgPT4gKHsgLi4uKHMgYXMgb2JqZWN0KSwgbG9hZGluZyB9IGFzIGFueSkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIHN0b3JlJ3MgZXJyb3Igc3RhdGUuXG4gICAqL1xuICBzZXRFcnJvcjxUPihlcnJvcjogVCkge1xuICAgIGlmIChlcnJvciAhPT0gKHRoaXMuX3ZhbHVlKCkgYXMgUyAmIHsgZXJyb3I6IGFueSB9KS5lcnJvcikge1xuICAgICAgaXNEZXYoKSAmJiBfX2dsb2JhbFN0YXRlLnNldEFjdGlvbih7IHR5cGU6ICdTZXQgRXJyb3InIH0pO1xuICAgICAgdGhpcy5zZXRTdGF0ZShzID0+ICh7IC4uLihzIGFzIG9iamVjdCksIGVycm9yIH0gYXMgYW55KSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNlbGVjdCBhIHNsaWNlIGZyb20gdGhlIHN0b3JlXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIHRoaXMuc3RvcmUuc2VsZWN0KHN0YXRlID0+IHN0YXRlLmVudGl0aWVzKVxuICAgKlxuICAgKi9cbiAgX3NlbGVjdDxSPihwcm9qZWN0OiAoc3RvcmU6IFMpID0+IFIpOiBPYnNlcnZhYmxlPFI+IHtcbiAgICByZXR1cm4gdGhpcy5zdG9yZSQucGlwZShcbiAgICAgIG1hcChwcm9qZWN0KSxcbiAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKClcbiAgICApO1xuICB9XG5cbiAgX3ZhbHVlKCk6IFMge1xuICAgIHJldHVybiB0aGlzLnN0b3JlVmFsdWU7XG4gIH1cblxuICBnZXQgY29uZmlnKCk6IFN0b3JlQ29uZmlnT3B0aW9ucyB7XG4gICAgcmV0dXJuIHRoaXMuY29uc3RydWN0b3JbY29uZmlnS2V5XTtcbiAgfVxuXG4gIGdldCBzdG9yZU5hbWUoKSB7XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5zdG9yZU5hbWUgfHwgKHRoaXMuY29uZmlnICYmIHRoaXMuY29uZmlnWydzdG9yZU5hbWUnXSk7XG4gIH1cblxuICBnZXQgaWRLZXkoKSB7XG4gICAgLyoqIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgKi9cbiAgICBjb25zdCBuZXdJZEtleSA9IHRoaXMuY29uZmlnICYmIHRoaXMuY29uZmlnLmlkS2V5O1xuICAgIGlmICghbmV3SWRLZXkpIHtcbiAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMuaWRLZXkgfHwgJ2lkJztcbiAgICB9XG4gICAgcmV0dXJuIG5ld0lkS2V5O1xuICB9XG5cbiAgZ2V0IGlzUHJpc3RpbmUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2lzUHJpc3RpbmU7XG4gIH1cblxuICAvKipcbiAgICogYHNldFN0YXRlKClgIGlzIHRoZSBvbmx5IHdheSB0byB1cGRhdGUgYSBzdG9yZTsgSXQgcmVjZWl2ZXMgYSBjYWxsYmFjayBmdW5jdGlvbixcbiAgICogd2hpY2ggZ2V0cyB0aGUgY3VycmVudCBzdGF0ZSwgYW5kIHJldHVybnMgYSBuZXcgaW1tdXRhYmxlIHN0YXRlLFxuICAgKiB3aGljaCB3aWxsIGJlIHRoZSBuZXcgdmFsdWUgb2YgdGhlIHN0b3JlLlxuICAgKi9cbiAgc2V0U3RhdGUobmV3U3RhdGVGbjogKHN0YXRlOiBSZWFkb25seTxTPikgPT4gUywgX3Jvb3REaXNwYXRjaGVyID0gdHJ1ZSkge1xuICAgIGNvbnN0IHByZXZTdGF0ZSA9IHRoaXMuX3ZhbHVlKCk7XG4gICAgdGhpcy5zdG9yZVZhbHVlID0gX19ERVZfXyA/IGRlZXBGcmVlemUobmV3U3RhdGVGbih0aGlzLl92YWx1ZSgpKSkgOiBuZXdTdGF0ZUZuKHRoaXMuX3ZhbHVlKCkpO1xuXG4gICAgaWYgKHByZXZTdGF0ZSA9PT0gdGhpcy5zdG9yZVZhbHVlKSB7XG4gICAgICB0aHJvdyBuZXcgQWtpdGFJbW11dGFiaWxpdHlFcnJvcih0aGlzLnN0b3JlTmFtZSk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLnN0b3JlKSB7XG4gICAgICB0aGlzLnN0b3JlID0gbmV3IEJlaGF2aW9yU3ViamVjdCh0aGlzLnN0b3JlVmFsdWUpO1xuICAgICAgcm9vdERpc3BhdGNoZXIubmV4dChuZXh0U3RhdGUodGhpcy5zdG9yZU5hbWUsIHRydWUpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoaXNUcmFuc2FjdGlvbkluUHJvY2VzcygpKSB7XG4gICAgICB0aGlzLmhhbmRsZVRyYW5zYWN0aW9uKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5kaXNwYXRjaCh0aGlzLnN0b3JlVmFsdWUsIF9yb290RGlzcGF0Y2hlcik7XG4gIH1cblxuICAvKipcbiAgICogUmVzZXRzIHRoZSBzdG9yZSB0byBpdCdzIGluaXRpYWwgc3RhdGUgYW5kIHNldCB0aGUgc3RvcmUgdG8gYSBwcmlzdGluZSBzdGF0ZS5cbiAgICovXG4gIHJlc2V0KCkge1xuICAgIGlmICh0aGlzLmlzUmVzc2V0YWJsZSgpKSB7XG4gICAgICBfX2dsb2JhbFN0YXRlLnNldEFjdGlvbih7IHR5cGU6ICdSZXNldCBTdG9yZScgfSk7XG4gICAgICB0aGlzLnNldFN0YXRlKCgpID0+IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuX2luaXRpYWxTdGF0ZSkpO1xuICAgICAgdGhpcy5zZXRQcmlzdGluZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgQWtpdGFFcnJvcihgWW91IG5lZWQgdG8gZW5hYmxlIHRoZSByZXNldCBmdW5jdGlvbmFsaXR5YCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFRoaXMgbWV0aG9kIGlzIGEgc2hvcnRjdXQgZm9yIGBzZXRTdGF0ZSgpYC5cbiAgICogSXQgY2FuIGJlIHVzZWZ1bCB3aGVuIHlvdSB3YW50IHRvIHBhc3MgdGhlIHdob2xlIHN0YXRlIG9iamVjdCBpbnN0ZWFkIG9mIG1lcmdpbmcgYSBwYXJ0aWFsIHN0YXRlLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiB0aGlzLnN0b3JlLnVwZGF0ZShuZXdTdGF0ZSlcbiAgICovXG4gIHVwZGF0ZShuZXdTdGF0ZTogKHN0YXRlOiBSZWFkb25seTxTPikgPT4gUGFydGlhbDxTPik7XG4gIHVwZGF0ZShuZXdTdGF0ZTogUGFydGlhbDxTPik7XG4gIHVwZGF0ZShpZDogSUQgfCBJRFtdIHwgbnVsbCwgbmV3U3RhdGU6IFBhcnRpYWw8Uz4pO1xuICB1cGRhdGUobmV3U3RhdGVPcklkOiBQYXJ0aWFsPFM+IHwgSUQgfCBJRFtdIHwgbnVsbCB8ICgoc3RhdGU6IFJlYWRvbmx5PFM+KSA9PiBQYXJ0aWFsPFM+KSwgbmV3U3RhdGU/OiBQYXJ0aWFsPFM+KSB7XG4gICAgX19nbG9iYWxTdGF0ZS5zZXRBY3Rpb24oeyB0eXBlOiAnVXBkYXRlIFN0b3JlJyB9KTtcbiAgICB0aGlzLnNldFN0YXRlKHN0YXRlID0+IHtcbiAgICAgIGxldCB2YWx1ZSA9IGlzRnVuY3Rpb24obmV3U3RhdGVPcklkKSA/IG5ld1N0YXRlT3JJZChzdGF0ZSkgOiBuZXdTdGF0ZU9ySWQ7XG4gICAgICBsZXQgbWVyZ2VkID0gT2JqZWN0LmFzc2lnbih7fSwgc3RhdGUsIHZhbHVlKTtcbiAgICAgIHJldHVybiBpc1BsYWluT2JqZWN0KHN0YXRlKSA/IG1lcmdlZCA6IG5ldyAoc3RhdGUgYXMgYW55KS5jb25zdHJ1Y3RvcihtZXJnZWQpO1xuICAgIH0pO1xuICAgIHRoaXMuc2V0RGlydHkoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBzdG9yZSB0byBhIHByaXN0aW5lIHN0YXRlLlxuICAgKi9cbiAgc2V0UHJpc3RpbmUoKSB7XG4gICAgdGhpcy5faXNQcmlzdGluZSA9IHRydWU7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgc3RvcmUgdG8gYSBkaXJ0eSBzdGF0ZSwgaW5kaWNhdGluZyB0aGF0IGl0IGlzIG5vdCBwcmlzdGluZS5cbiAgICovXG4gIHNldERpcnR5KCkge1xuICAgIHRoaXMuX2lzUHJpc3RpbmUgPSBmYWxzZTtcbiAgfVxuXG4gIGRlc3Ryb3kgPSB0aGlzLm5nT25EZXN0cm95O1xuXG4gIHByaXZhdGUgZGlzcGF0Y2goc3RhdGU6IFMsIF9yb290RGlzcGF0Y2hlciA9IHRydWUpIHtcbiAgICB0aGlzLnN0b3JlLm5leHQoc3RhdGUpO1xuICAgIGlmIChfcm9vdERpc3BhdGNoZXIpIHtcbiAgICAgIHJvb3REaXNwYXRjaGVyLm5leHQobmV4dFN0YXRlKHRoaXMuc3RvcmVOYW1lKSk7XG4gICAgICBpc0RldigpICYmIF9fZ2xvYmFsU3RhdGUuc2V0QWN0aW9uKHsgdHlwZTogJ1NldCBTdGF0ZScgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXQgc3RvcmUkKCkge1xuICAgIHJldHVybiB0aGlzLnN0b3JlLmFzT2JzZXJ2YWJsZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZW4gdGhlIHRyYW5zYWN0aW9uIGVuZHMgZGlzcGF0Y2ggdGhlIGZpbmFsIHZhbHVlIG9uY2VcbiAgICovXG4gIHByaXZhdGUgd2F0Y2hUcmFuc2FjdGlvbigpIHtcbiAgICBjb21taXQoKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgdGhpcy5pblRyYW5zYWN0aW9uID0gZmFsc2U7XG4gICAgICBpZiAoaXNEZXYoKSAmJiAhX19nbG9iYWxTdGF0ZS5za2lwVHJhbnNhY3Rpb25Nc2cpIHtcbiAgICAgICAgX19nbG9iYWxTdGF0ZS5zZXRBY3Rpb24oeyB0eXBlOiAnQFRyYW5zYWN0aW9uJyB9KTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZGlzcGF0Y2godGhpcy5fdmFsdWUoKSk7XG4gICAgICBfX2dsb2JhbFN0YXRlLmN1cnJlbnRUID0gW107XG4gICAgICBfX2dsb2JhbFN0YXRlLnNraXBUcmFuc2FjdGlvbk1zZyA9IGZhbHNlO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBpc1Jlc3NldGFibGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLnJlc2V0dGFibGUgfHwgZ2V0QWtpdGFDb25maWcoKS5yZXNldHRhYmxlO1xuICB9XG5cbiAgLyoqXG4gICAqIExpc3RlbiB0byB0aGUgdHJhbnNhY3Rpb24gc3RyZWFtXG4gICAqL1xuICBwcml2YXRlIGhhbmRsZVRyYW5zYWN0aW9uKCkge1xuICAgIGlmICghdGhpcy5pblRyYW5zYWN0aW9uKSB7XG4gICAgICB0aGlzLndhdGNoVHJhbnNhY3Rpb24oKTtcbiAgICAgIHRoaXMuaW5UcmFuc2FjdGlvbiA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKGlzTm90QnJvd3NlcikgcmV0dXJuO1xuICAgIGlmICghKHdpbmRvdyBhcyBhbnkpLmhtckVuYWJsZWQgJiYgdGhpcyA9PT0gX19zdG9yZXNfX1t0aGlzLnN0b3JlTmFtZV0pIHtcbiAgICAgIGRlbGV0ZSBfX3N0b3Jlc19fW3RoaXMuc3RvcmVOYW1lXTtcbiAgICAgIHJvb3REaXNwYXRjaGVyLm5leHQoe1xuICAgICAgICB0eXBlOiBBY3Rpb25zLkRFTEVURV9TVE9SRSxcbiAgICAgICAgcGF5bG9hZDogeyBzdG9yZU5hbWU6IHRoaXMuc3RvcmVOYW1lIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufVxuIl19