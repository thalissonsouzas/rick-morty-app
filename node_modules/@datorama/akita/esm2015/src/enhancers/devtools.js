/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import { __stores__, rootDispatcher } from '../api/store';
import { __globalState } from '../internal/global-state';
import { isDefined } from '../internal/utils';
/** @type {?} */
let rootDispatcherSub;
/** @type {?} */
let devtoolsSub;
/**
 * @param {?=} ngZoneOrOptions
 * @param {?=} options
 * @return {?}
 */
export function akitaDevtools(ngZoneOrOptions, options = {}) {
    if (!((/** @type {?} */ (window))).__REDUX_DEVTOOLS_EXTENSION__) {
        return;
    }
    rootDispatcherSub && rootDispatcherSub.unsubscribe();
    devtoolsSub && devtoolsSub();
    /** @type {?} */
    const isAngular = ngZoneOrOptions && ngZoneOrOptions['run'];
    if (!isAngular) {
        ngZoneOrOptions = ngZoneOrOptions || {};
        ((/** @type {?} */ (ngZoneOrOptions))).run = cb => cb();
        options = (/** @type {?} */ (ngZoneOrOptions));
    }
    /** @type {?} */
    const defaultOptions = { name: 'Akita' };
    /** @type {?} */
    const merged = Object.assign({}, defaultOptions, options);
    /** @type {?} */
    const devTools = ((/** @type {?} */ (window))).__REDUX_DEVTOOLS_EXTENSION__.connect(merged);
    /** @type {?} */
    let appState = {};
    rootDispatcherSub = rootDispatcher.subscribe(action => {
        if (action.type === 1 /* DELETE_STORE */) {
            /** @type {?} */
            const storeName = action.payload.storeName;
            delete appState[storeName];
            devTools.send({ type: `[${storeName}] - Delete Store` }, appState);
        }
        if (action.type === 2 /* NEW_STATE */) {
            if (__globalState.skipAction) {
                __globalState.setSkipAction(false);
                return;
            }
            appState = Object.assign({}, appState, { [action.payload.name]: __stores__[action.payload.name]._value() });
            const { type, entityId } = __globalState.currentAction;
            /** @type {?} */
            const storeName = capitalize(action.payload.name);
            /** @type {?} */
            let msg = isDefined(entityId) ? `[${storeName}] - ${type} (ids: ${entityId})` : `[${storeName}] - ${type}`;
            if (options.logTrace) {
                console.group(msg);
                console.trace();
                console.groupEnd();
            }
            devTools.send({ type: msg, transaction: __globalState.currentT.map(t => t.type) }, appState);
        }
    });
    devtoolsSub = devTools.subscribe(message => {
        if (message.type === 'ACTION') {
            const [storeName] = message.payload.split('.');
            if (__stores__[storeName]) {
                ((/** @type {?} */ (ngZoneOrOptions))).run(() => {
                    /** @type {?} */
                    const funcCall = message.payload.replace(storeName, `this['${storeName}']`);
                    try {
                        new Function(`${funcCall}`).call(__stores__);
                    }
                    catch (e) {
                        console.warn('Unknown Method ☹️');
                    }
                });
            }
        }
        if (message.type === 'DISPATCH') {
            /** @type {?} */
            const payloadType = message.payload.type;
            if (payloadType === 'COMMIT') {
                devTools.init(appState);
                return;
            }
            if (message.state) {
                /** @type {?} */
                const rootState = JSON.parse(message.state);
                for (let i = 0, keys = Object.keys(rootState); i < keys.length; i++) {
                    /** @type {?} */
                    const storeName = keys[i];
                    if (__stores__[storeName]) {
                        ((/** @type {?} */ (ngZoneOrOptions))).run(() => {
                            __stores__[storeName].setState(() => rootState[storeName], false);
                        });
                    }
                }
            }
        }
    });
}
/**
 * @param {?} string
 * @return {?}
 */
function capitalize(string) {
    return string && string.charAt(0).toUpperCase() + string.slice(1);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV2dG9vbHMuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZGF0b3JhbWEvYWtpdGEvIiwic291cmNlcyI6WyJzcmMvZW5oYW5jZXJzL2RldnRvb2xzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFXLGNBQWMsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUNuRSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDekQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLG1CQUFtQixDQUFDOztJQVkxQyxpQkFBaUI7O0lBQUUsV0FBVzs7Ozs7O0FBTWxDLE1BQU0sVUFBVSxhQUFhLENBQUMsZUFBdUQsRUFBRSxVQUFvQyxFQUFFO0lBQzNILElBQUksQ0FBQyxDQUFDLG1CQUFBLE1BQU0sRUFBTyxDQUFDLENBQUMsNEJBQTRCLEVBQUU7UUFDakQsT0FBTztLQUNSO0lBRUQsaUJBQWlCLElBQUksaUJBQWlCLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDckQsV0FBVyxJQUFJLFdBQVcsRUFBRSxDQUFDOztVQUV2QixTQUFTLEdBQUcsZUFBZSxJQUFJLGVBQWUsQ0FBQyxLQUFLLENBQUM7SUFFM0QsSUFBSSxDQUFDLFNBQVMsRUFBRTtRQUNkLGVBQWUsR0FBRyxlQUFlLElBQUksRUFBRSxDQUFDO1FBQ3hDLENBQUMsbUJBQUEsZUFBZSxFQUFPLENBQUMsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUMxQyxPQUFPLEdBQUcsbUJBQUEsZUFBZSxFQUE0QixDQUFDO0tBQ3ZEOztVQUVLLGNBQWMsR0FBZ0QsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFOztVQUMvRSxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsY0FBYyxFQUFFLE9BQU8sQ0FBQzs7VUFFbkQsUUFBUSxHQUFHLENBQUMsbUJBQUEsTUFBTSxFQUFPLENBQUMsQ0FBQyw0QkFBNEIs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QUFDO2dCQUN4QixPQUFPO2FBQ1I7WUFFRCxJQUFJLE9BQU8sQ0FBQyxLQUFLLEVBQUU7O3NCQUNYLFNBQVMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUM7Z0JBQzNDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFOzswQkFDN0QsU0FBUyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7b0JBQ3pCLElBQUksVUFBVSxDQUFDLFNBQVMsQ0FBQyxFQUFFO3dCQUN6QixDQUFDLG1CQUFBLGVBQWUsRUFBYyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRTs0QkFDdkMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7d0JBQ3BFLENBQUMsQ0FBQyxDQUFDO3FCQUNKO2lCQUNGO2FBQ0Y7U0FDRjtJQUNILENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQzs7Ozs7QUFFRCxTQUFTLFVBQVUsQ0FBQyxNQUFNO0lBQ3hCLE9BQU8sTUFBTSxJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNwRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgX19zdG9yZXNfXywgQWN0aW9ucywgcm9vdERpc3BhdGNoZXIgfSBmcm9tICcuLi9hcGkvc3RvcmUnO1xuaW1wb3J0IHsgX19nbG9iYWxTdGF0ZSB9IGZyb20gJy4uL2ludGVybmFsL2dsb2JhbC1zdGF0ZSc7XG5pbXBvcnQgeyBpc0RlZmluZWQgfSBmcm9tICcuLi9pbnRlcm5hbC91dGlscyc7XG5cbmV4cG9ydCB0eXBlIERldnRvb2xzT3B0aW9ucyA9IHtcbiAgLyoqICBtYXhpbXVtIGFsbG93ZWQgYWN0aW9ucyB0byBiZSBzdG9yZWQgaW4gdGhlIGhpc3RvcnkgdHJlZSAqL1xuICBtYXhBZ2U6IG51bWJlcjtcbiAgbGF0ZW5jeTogbnVtYmVyO1xuICBhY3Rpb25zQmxhY2tsaXN0OiBzdHJpbmdbXTtcbiAgYWN0aW9uc1doaXRlbGlzdDogc3RyaW5nW107XG4gIHNob3VsZENhdGNoRXJyb3JzOiBib29sZWFuO1xuICBsb2dUcmFjZTogYm9vbGVhbjtcbiAgcHJlZGljYXRlOiAoc3RhdGU6IGFueSwgYWN0aW9uOiBhbnkpID0+IGJvb2xlYW47XG59O1xubGV0IHJvb3REaXNwYXRjaGVyU3ViLCBkZXZ0b29sc1N1YjtcblxuZXhwb3J0IHR5cGUgTmdab25lTGlrZSA9IHsgcnVuOiBhbnkgfTtcblxuZXhwb3J0IGZ1bmN0aW9uIGFraXRhRGV2dG9vbHMobmdab25lOiBOZ1pvbmVMaWtlLCBvcHRpb25zPzogUGFydGlhbDxEZXZ0b29sc09wdGlvbnM+KTtcbmV4cG9ydCBmdW5jdGlvbiBha2l0YURldnRvb2xzKG9wdGlvbnM/OiBQYXJ0aWFsPERldnRvb2xzT3B0aW9ucz4pO1xuZXhwb3J0IGZ1bmN0aW9uIGFraXRhRGV2dG9vbHMobmdab25lT3JPcHRpb25zPzogTmdab25lTGlrZSB8IFBhcnRpYWw8RGV2dG9vbHNPcHRpb25zPiwgb3B0aW9uczogUGFydGlhbDxEZXZ0b29sc09wdGlvbnM+ID0ge30pIHtcbiAgaWYgKCEod2luZG93IGFzIGFueSkuX19SRURVWF9ERVZUT09MU19FWFRFTlNJT05fXykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHJvb3REaXNwYXRjaGVyU3ViICYmIHJvb3REaXNwYXRjaGVyU3ViLnVuc3Vic2NyaWJlKCk7XG4gIGRldnRvb2xzU3ViICYmIGRldnRvb2xzU3ViKCk7XG5cbiAgY29uc3QgaXNBbmd1bGFyID0gbmdab25lT3JPcHRpb25zICYmIG5nWm9uZU9yT3B0aW9uc1sncnVuJ107XG5cbiAgaWYgKCFpc0FuZ3VsYXIpIHtcbiAgICBuZ1pvbmVPck9wdGlvbnMgPSBuZ1pvbmVPck9wdGlvbnMgfHwge307XG4gICAgKG5nWm9uZU9yT3B0aW9ucyBhcyBhbnkpLnJ1biA9IGNiID0+IGNiKCk7XG4gICAgb3B0aW9ucyA9IG5nWm9uZU9yT3B0aW9ucyBhcyBQYXJ0aWFsPERldnRvb2xzT3B0aW9ucz47XG4gIH1cblxuICBjb25zdCBkZWZhdWx0T3B0aW9uczogUGFydGlhbDxEZXZ0b29sc09wdGlvbnM+ICYgeyBuYW1lOiBzdHJpbmcgfSA9IHsgbmFtZTogJ0FraXRhJyB9O1xuICBjb25zdCBtZXJnZWQgPSBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7XG5cbiAgY29uc3QgZGV2VG9vbHMgPSAod2luZG93IGFzIGFueSkuX19SRURVWF9ERVZUT09MU19FWFRFTlNJT05fXy5jb25uZWN0KG1lcmdlZCk7XG4gIGxldCBhcHBTdGF0ZSA9IHt9O1xuXG4gIHJvb3REaXNwYXRjaGVyU3ViID0gcm9vdERpc3BhdGNoZXIuc3Vic2NyaWJlKGFjdGlvbiA9PiB7XG4gICAgaWYgKGFjdGlvbi50eXBlID09PSBBY3Rpb25zLkRFTEVURV9TVE9SRSkge1xuICAgICAgY29uc3Qgc3RvcmVOYW1lID0gYWN0aW9uLnBheWxvYWQuc3RvcmVOYW1lO1xuICAgICAgZGVsZXRlIGFwcFN0YXRlW3N0b3JlTmFtZV07XG4gICAgICBkZXZUb29scy5zZW5kKHsgdHlwZTogYFske3N0b3JlTmFtZX1dIC0gRGVsZXRlIFN0b3JlYCB9LCBhcHBTdGF0ZSk7XG4gICAgfVxuXG4gICAgaWYgKGFjdGlvbi50eXBlID09PSBBY3Rpb25zLk5FV19TVEFURSkge1xuICAgICAgaWYgKF9fZ2xvYmFsU3RhdGUuc2tpcEFjdGlvbikge1xuICAgICAgICBfX2dsb2JhbFN0YXRlLnNldFNraXBBY3Rpb24oZmFsc2UpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGFwcFN0YXRlID0ge1xuICAgICAgICAuLi5hcHBTdGF0ZSxcbiAgICAgICAgW2FjdGlvbi5wYXlsb2FkLm5hbWVdOiBfX3N0b3Jlc19fW2FjdGlvbi5wYXlsb2FkLm5hbWVdLl92YWx1ZSgpXG4gICAgICB9O1xuXG4gICAgICBjb25zdCB7IHR5cGUsIGVudGl0eUlkIH0gPSBfX2dsb2JhbFN0YXRlLmN1cnJlbnRBY3Rpb247XG4gICAgICBjb25zdCBzdG9yZU5hbWUgPSBjYXBpdGFsaXplKGFjdGlvbi5wYXlsb2FkLm5hbWUpO1xuICAgICAgbGV0IG1zZyA9IGlzRGVmaW5lZChlbnRpdHlJZCkgPyBgWyR7c3RvcmVOYW1lfV0gLSAke3R5cGV9IChpZHM6ICR7ZW50aXR5SWR9KWAgOiBgWyR7c3RvcmVOYW1lfV0gLSAke3R5cGV9YDtcblxuICAgICAgaWYgKG9wdGlvbnMubG9nVHJhY2UpIHtcbiAgICAgICAgY29uc29sZS5ncm91cChtc2cpO1xuICAgICAgICBjb25zb2xlLnRyYWNlKCk7XG4gICAgICAgIGNvbnNvbGUuZ3JvdXBFbmQoKTtcbiAgICAgIH1cblxuICAgICAgZGV2VG9vbHMuc2VuZCh7IHR5cGU6IG1zZywgdHJhbnNhY3Rpb246IF9fZ2xvYmFsU3RhdGUuY3VycmVudFQubWFwKHQgPT4gdC50eXBlKSB9LCBhcHBTdGF0ZSk7XG4gICAgfVxuICB9KTtcblxuICBkZXZ0b29sc1N1YiA9IGRldlRvb2xzLnN1YnNjcmliZShtZXNzYWdlID0+IHtcbiAgICBpZiAobWVzc2FnZS50eXBlID09PSAnQUNUSU9OJykge1xuICAgICAgY29uc3QgW3N0b3JlTmFtZV0gPSBtZXNzYWdlLnBheWxvYWQuc3BsaXQoJy4nKTtcblxuICAgICAgaWYgKF9fc3RvcmVzX19bc3RvcmVOYW1lXSkge1xuICAgICAgICAobmdab25lT3JPcHRpb25zIGFzIE5nWm9uZUxpa2UpLnJ1bigoKSA9PiB7XG4gICAgICAgICAgY29uc3QgZnVuY0NhbGwgPSBtZXNzYWdlLnBheWxvYWQucmVwbGFjZShzdG9yZU5hbWUsIGB0aGlzWycke3N0b3JlTmFtZX0nXWApO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBuZXcgRnVuY3Rpb24oYCR7ZnVuY0NhbGx9YCkuY2FsbChfX3N0b3Jlc19fKTtcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ1Vua25vd24gTWV0aG9kIOKYue+4jycpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG1lc3NhZ2UudHlwZSA9PT0gJ0RJU1BBVENIJykge1xuICAgICAgY29uc3QgcGF5bG9hZFR5cGUgPSBtZXNzYWdlLnBheWxvYWQudHlwZTtcblxuICAgICAgaWYgKHBheWxvYWRUeXBlID09PSAnQ09NTUlUJykge1xuICAgICAgICBkZXZUb29scy5pbml0KGFwcFN0YXRlKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAobWVzc2FnZS5zdGF0ZSkge1xuICAgICAgICBjb25zdCByb290U3RhdGUgPSBKU09OLnBhcnNlKG1lc3NhZ2Uuc3RhdGUpO1xuICAgICAgICBmb3IgKGxldCBpID0gMCwga2V5cyA9IE9iamVjdC5rZXlzKHJvb3RTdGF0ZSk7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgY29uc3Qgc3RvcmVOYW1lID0ga2V5c1tpXTtcbiAgICAgICAgICBpZiAoX19zdG9yZXNfX1tzdG9yZU5hbWVdKSB7XG4gICAgICAgICAgICAobmdab25lT3JPcHRpb25zIGFzIE5nWm9uZUxpa2UpLnJ1bigoKSA9PiB7XG4gICAgICAgICAgICAgIF9fc3RvcmVzX19bc3RvcmVOYW1lXS5zZXRTdGF0ZSgoKSA9PiByb290U3RhdGVbc3RvcmVOYW1lXSwgZmFsc2UpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gY2FwaXRhbGl6ZShzdHJpbmcpIHtcbiAgcmV0dXJuIHN0cmluZyAmJiBzdHJpbmcuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBzdHJpbmcuc2xpY2UoMSk7XG59XG4iXX0=