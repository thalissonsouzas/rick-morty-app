/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import { Observable } from 'rxjs';
/**
 * @param {?} object
 * @return {?}
 */
function serialize(object) {
    return JSON.stringify(object, function (key, value) {
        if (typeof value === 'function') {
            return value.toString();
        }
        return value;
    });
}
/**
 * @return {?}
 */
function createWorker() {
    /** @type {?} */
    var blob = new Blob([
        "self.onmessage = function(e) {\n\n      function deserialize(str) {\n        return JSON.parse(str || '', function(key, value) {\n          if (value &&\n            typeof value === \"string\" &&\n            value.substr(0, 8) == \"function\") {\n            var startBody = value.indexOf('{') + 1;\n            var endBody = value.lastIndexOf('}');\n            var startArgs = value.indexOf('(') + 1;\n            var endArgs = value.indexOf(')');\n            return new Function(value.substring(startArgs, endArgs), value.substring(startBody, endBody));\n          }\n          return value;\n        });\n      }\n\n      var deserialized = deserialize(e.data);\n      var mapped = deserialized.data.map(function(d) {\n        return deserialized.factory(d);\n      });\n\n      self.postMessage(mapped);\n    }"
    ], {
        type: 'text/javascript'
    });
    /** @type {?} */
    var url = URL.createObjectURL(blob);
    return new Worker(url);
}
/**
 * \@example
 *   const mockTodos = Array.from({length: 10000}, (_, x) => ({id: x}));
 *
 *   of(mockTodos).pipe(mapInWorker<Todo>(createTodo))
 *   .subscribe(res => console.log(res));
 * @template T
 * @param {?} factoryFn
 * @return {?}
 */
export function mapInWorker(factoryFn) {
    return function (source) {
        return new Observable(function (observer) {
            /** @type {?} */
            var worker = createWorker();
            worker.onmessage = function (e) {
                observer.next(e.data);
                observer.complete();
                worker.terminate();
            };
            worker.onerror = function (err) {
                observer.error(err);
                observer.complete();
                worker.terminate();
            };
            return source.subscribe(function (value) {
                /** @type {?} */
                var input = {
                    factory: factoryFn,
                    data: value
                };
                /** @type {?} */
                var serialized = serialize(input);
                worker.postMessage(serialized);
            });
        });
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29ya2VyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGRhdG9yYW1hL2FraXRhLyIsInNvdXJjZXMiOlsic3JjL2FwaS93b3JrZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxNQUFNLENBQUM7Ozs7O0FBRWxDLFNBQVMsU0FBUyxDQUFDLE1BQU07SUFDdkIsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxVQUFTLEdBQUcsRUFBRSxLQUFLO1FBQy9DLElBQUksT0FBTyxLQUFLLEtBQUssVUFBVSxFQUFFO1lBQy9CLE9BQU8sS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1NBQ3pCO1FBQ0QsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7Ozs7QUFFRCxTQUFTLFlBQVk7O1FBQ2IsSUFBSSxHQUFHLElBQUksSUFBSSxDQUNuQjtRQUNFLG96QkF1QkE7S0FDRCxFQUNEO1FBQ0UsSUFBSSxFQUFFLGlCQUFpQjtLQUN4QixDQUNGOztRQUVLLEdBQUcsR0FBRyxHQUFHLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQztJQUNyQyxPQUFPLElBQUksTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ3pCLENBQUM7Ozs7Ozs7Ozs7O0FBU0QsTUFBTSxVQUFVLFdBQVcsQ0FBSSxTQUFtQjtJQUNoRCxPQUFPLFVBQVMsTUFBTTtRQUNwQixPQUFPLElBQUksVUFBVSxDQUFDLFVBQUEsUUFBUTs7Z0JBQ3RCLE1BQU0sR0FBRyxZQUFZLEVBQUU7WUFFN0IsTUFBTSxDQUFDLFNBQVMsR0FBRyxVQUFTLENBQUM7Z0JBQzNCLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUN0QixRQUFRLENBQUMsUUFBUSxFQUFFLENBQUM7Z0JBQ3BCLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUNyQixDQUFDLENBQUM7WUFFRixNQUFNLENBQUMsT0FBTyxHQUFHLFVBQVMsR0FBRztnQkFDM0IsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDcEIsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO2dCQUNwQixNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDckIsQ0FBQyxDQUFDO1lBRUYsT0FBTyxNQUFNLENBQUMsU0FBUyxDQUFDLFVBQUEsS0FBSzs7b0JBQ3JCLEtBQUssR0FBRztvQkFDWixPQUFPLEVBQUUsU0FBUztvQkFDbEIsSUFBSSxFQUFFLEtBQUs7aUJBQ1o7O29CQUNLLFVBQVUsR0FBRyxTQUFTLENBQUMsS0FBSyxDQUFDO2dCQUVuQyxNQUFNLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ2pDLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUM7QUFDSixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuXG5mdW5jdGlvbiBzZXJpYWxpemUob2JqZWN0KSB7XG4gIHJldHVybiBKU09OLnN0cmluZ2lmeShvYmplY3QsIGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICByZXR1cm4gdmFsdWUudG9TdHJpbmcoKTtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlV29ya2VyKCkge1xuICBjb25zdCBibG9iID0gbmV3IEJsb2IoXG4gICAgW1xuICAgICAgYHNlbGYub25tZXNzYWdlID0gZnVuY3Rpb24oZSkge1xuXG4gICAgICBmdW5jdGlvbiBkZXNlcmlhbGl6ZShzdHIpIHtcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2Uoc3RyIHx8ICcnLCBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICAgICAgICAgaWYgKHZhbHVlICYmXG4gICAgICAgICAgICB0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIgJiZcbiAgICAgICAgICAgIHZhbHVlLnN1YnN0cigwLCA4KSA9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgIHZhciBzdGFydEJvZHkgPSB2YWx1ZS5pbmRleE9mKCd7JykgKyAxO1xuICAgICAgICAgICAgdmFyIGVuZEJvZHkgPSB2YWx1ZS5sYXN0SW5kZXhPZignfScpO1xuICAgICAgICAgICAgdmFyIHN0YXJ0QXJncyA9IHZhbHVlLmluZGV4T2YoJygnKSArIDE7XG4gICAgICAgICAgICB2YXIgZW5kQXJncyA9IHZhbHVlLmluZGV4T2YoJyknKTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgRnVuY3Rpb24odmFsdWUuc3Vic3RyaW5nKHN0YXJ0QXJncywgZW5kQXJncyksIHZhbHVlLnN1YnN0cmluZyhzdGFydEJvZHksIGVuZEJvZHkpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgdmFyIGRlc2VyaWFsaXplZCA9IGRlc2VyaWFsaXplKGUuZGF0YSk7XG4gICAgICB2YXIgbWFwcGVkID0gZGVzZXJpYWxpemVkLmRhdGEubWFwKGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgcmV0dXJuIGRlc2VyaWFsaXplZC5mYWN0b3J5KGQpO1xuICAgICAgfSk7XG5cbiAgICAgIHNlbGYucG9zdE1lc3NhZ2UobWFwcGVkKTtcbiAgICB9YFxuICAgIF0sXG4gICAge1xuICAgICAgdHlwZTogJ3RleHQvamF2YXNjcmlwdCdcbiAgICB9XG4gICk7XG5cbiAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgcmV0dXJuIG5ldyBXb3JrZXIodXJsKTtcbn1cblxuLyoqXG4gKiAgQGV4YW1wbGVcbiAqICAgY29uc3QgbW9ja1RvZG9zID0gQXJyYXkuZnJvbSh7bGVuZ3RoOiAxMDAwMH0sIChfLCB4KSA9PiAoe2lkOiB4fSkpO1xuICpcbiAqICAgb2YobW9ja1RvZG9zKS5waXBlKG1hcEluV29ya2VyPFRvZG8+KGNyZWF0ZVRvZG8pKVxuICogICAuc3Vic2NyaWJlKHJlcyA9PiBjb25zb2xlLmxvZyhyZXMpKTtcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1hcEluV29ya2VyPFQ+KGZhY3RvcnlGbjogRnVuY3Rpb24pIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKHNvdXJjZSk6IE9ic2VydmFibGU8VFtdPiB7XG4gICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKG9ic2VydmVyID0+IHtcbiAgICAgIGNvbnN0IHdvcmtlciA9IGNyZWF0ZVdvcmtlcigpO1xuXG4gICAgICB3b3JrZXIub25tZXNzYWdlID0gZnVuY3Rpb24oZSkge1xuICAgICAgICBvYnNlcnZlci5uZXh0KGUuZGF0YSk7XG4gICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgIHdvcmtlci50ZXJtaW5hdGUoKTtcbiAgICAgIH07XG5cbiAgICAgIHdvcmtlci5vbmVycm9yID0gZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgIG9ic2VydmVyLmVycm9yKGVycik7XG4gICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgIHdvcmtlci50ZXJtaW5hdGUoKTtcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiBzb3VyY2Uuc3Vic2NyaWJlKHZhbHVlID0+IHtcbiAgICAgICAgY29uc3QgaW5wdXQgPSB7XG4gICAgICAgICAgZmFjdG9yeTogZmFjdG9yeUZuLFxuICAgICAgICAgIGRhdGE6IHZhbHVlXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHNlcmlhbGl6ZWQgPSBzZXJpYWxpemUoaW5wdXQpO1xuXG4gICAgICAgIHdvcmtlci5wb3N0TWVzc2FnZShzZXJpYWxpemVkKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xufVxuIl19