/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { __stores__, rootDispatcher } from '../api/store';
import { __globalState } from '../internal/global-state';
import { isDefined } from '../internal/utils';
/** @type {?} */
var rootDispatcherSub;
/** @type {?} */
var devtoolsSub;
/**
 * @param {?=} ngZoneOrOptions
 * @param {?=} options
 * @return {?}
 */
export function akitaDevtools(ngZoneOrOptions, options) {
    if (options === void 0) { options = {}; }
    if (!((/** @type {?} */ (window))).__REDUX_DEVTOOLS_EXTENSION__) {
        return;
    }
    rootDispatcherSub && rootDispatcherSub.unsubscribe();
    devtoolsSub && devtoolsSub();
    /** @type {?} */
    var isAngular = ngZoneOrOptions && ngZoneOrOptions['run'];
    if (!isAngular) {
        ngZoneOrOptions = ngZoneOrOptions || {};
        ((/** @type {?} */ (ngZoneOrOptions))).run = function (cb) { return cb(); };
        options = (/** @type {?} */ (ngZoneOrOptions));
    }
    /** @type {?} */
    var defaultOptions = { name: 'Akita' };
    /** @type {?} */
    var merged = Object.assign({}, defaultOptions, options);
    /** @type {?} */
    var devTools = ((/** @type {?} */ (window))).__REDUX_DEVTOOLS_EXTENSION__.connect(merged);
    /** @type {?} */
    var appState = {};
    rootDispatcherSub = rootDispatcher.subscribe(function (action) {
        var _a;
        if (action.type === 1 /* DELETE_STORE */) {
            /** @type {?} */
            var storeName = action.payload.storeName;
            delete appState[storeName];
            devTools.send({ type: "[" + storeName + "] - Delete Store" }, appState);
        }
        if (action.type === 2 /* NEW_STATE */) {
            if (__globalState.skipAction) {
                __globalState.setSkipAction(false);
                return;
            }
            appState = tslib_1.__assign({}, appState, (_a = {}, _a[action.payload.name] = __stores__[action.payload.name]._value(), _a));
            var _b = __globalState.currentAction, type = _b.type, entityId = _b.entityId;
            /** @type {?} */
            var storeName = capitalize(action.payload.name);
            /** @type {?} */
            var msg = isDefined(entityId) ? "[" + storeName + "] - " + type + " (ids: " + entityId + ")" : "[" + storeName + "] - " + type;
            if (options.logTrace) {
                console.group(msg);
                console.trace();
                console.groupEnd();
            }
            devTools.send({ type: msg, transaction: __globalState.currentT.map(function (t) { return t.type; }) }, appState);
        }
    });
    devtoolsSub = devTools.subscribe(function (message) {
        if (message.type === 'ACTION') {
            var _a = tslib_1.__read(message.payload.split('.'), 1), storeName_1 = _a[0];
            if (__stores__[storeName_1]) {
                ((/** @type {?} */ (ngZoneOrOptions))).run(function () {
                    /** @type {?} */
                    var funcCall = message.payload.replace(storeName_1, "this['" + storeName_1 + "']");
                    try {
                        new Function("" + funcCall).call(__stores__);
                    }
                    catch (e) {
                        console.warn('Unknown Method ☹️');
                    }
                });
            }
        }
        if (message.type === 'DISPATCH') {
            /** @type {?} */
            var payloadType = message.payload.type;
            if (payloadType === 'COMMIT') {
                devTools.init(appState);
                return;
            }
            if (message.state) {
                /** @type {?} */
                var rootState_1 = JSON.parse(message.state);
                var _loop_1 = function (i, keys) {
                    /** @type {?} */
                    var storeName = keys[i];
                    if (__stores__[storeName]) {
                        ((/** @type {?} */ (ngZoneOrOptions))).run(function () {
                            __stores__[storeName].setState(function () { return rootState_1[storeName]; }, false);
                        });
                    }
                };
                for (var i = 0, keys = Object.keys(rootState_1); i < keys.length; i++) {
                    _loop_1(i, keys);
                }
            }
        }
    });
}
/**
 * @param {?} string
 * @return {?}
 */
function capitalize(string) {
    return string && string.charAt(0).toUpperCase() + string.slice(1);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV2dG9vbHMuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZGF0b3JhbWEvYWtpdGEvIiwic291cmNlcyI6WyJzcmMvZW5oYW5jZXJzL2RldnRvb2xzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBVyxjQUFjLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDbkUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3pELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQzs7SUFZMUMsaUJBQWlCOztJQUFFLFdBQVc7Ozs7OztBQU1sQyxNQUFNLFVBQVUsYUFBYSxDQUFDLGVBQXVELEVBQUUsT0FBc0M7SUFBdEMsd0JBQUEsRUFBQSxZQUFzQztJQUMzSCxJQUFJLENBQUMsQ0FBQyxtQkFBQSxNQUFNLEVBQU8sQ0FBQyxDQUFDLDRCQUE0QixFQUFFO1FBQ2pELE9BQU87S0FDUjtJQUVELGlCQUFpQixJQUFJLGlCQUFpQixDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3JELFdBQVcsSUFBSSxXQUFXLEVBQUUsQ0FBQzs7UUFFdkIsU0FBUyxHQUFHLGVBQWUsSUFBSSxlQUFlLENBQUMsS0FBSyxDQUFDO0lBRTNELElBQUksQ0FBQyxTQUFTLEVBQUU7UUFDZCxlQUFlLEdBQUcsZUFBZSxJQUFJLEVBQUUsQ0FBQztRQUN4QyxDQUFDLG1CQUFBLGVBQWUsRUFBTyxDQUFDLENBQUMsR0FBRyxHQUFHLFVBQUEsRUFBRSxJQUFJLE9BQUEsRUFBRSxFQUFFLEVBQUosQ0FBSSxDQUFDO1FBQzFDLE9BQU8sR0FBRyxtQkFBQSxlQUFlLEVBQTRCLENBQUM7S0FDdkQ7O1FBRUssY0FBYyxHQUFnRCxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUU7O1FBQy9FLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxjQUFjLEVBQUUsT0FBTyxDQUFDOztRQUVuRCxRQUFRLEdBQUcsQ0FBQyxtQkFB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QUFFOztvQkFDWCxXQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDO3dDQUNsQyxDQUFDLEVBQU0sSUFBSTs7d0JBQ1osU0FBUyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7b0JBQ3pCLElBQUksVUFBVSxDQUFDLFNBQVMsQ0FBQyxFQUFFO3dCQUN6QixDQUFDLG1CQUFBLGVBQWUsRUFBYyxDQUFDLENBQUMsR0FBRyxDQUFDOzRCQUNsQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsUUFBUSxDQUFDLGNBQU0sT0FBQSxXQUFTLENBQUMsU0FBUyxDQUFDLEVBQXBCLENBQW9CLEVBQUUsS0FBSyxDQUFDLENBQUM7d0JBQ3BFLENBQUMsQ0FBQyxDQUFDO3FCQUNKO2dCQUNILENBQUM7Z0JBUEQsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsSUFBSSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsV0FBUyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFOzRCQUExRCxDQUFDLEVBQU0sSUFBSTtpQkFPbkI7YUFDRjtTQUNGO0lBQ0gsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDOzs7OztBQUVELFNBQVMsVUFBVSxDQUFDLE1BQU07SUFDeEIsT0FBTyxNQUFNLElBQUksTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3BFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBfX3N0b3Jlc19fLCBBY3Rpb25zLCByb290RGlzcGF0Y2hlciB9IGZyb20gJy4uL2FwaS9zdG9yZSc7XG5pbXBvcnQgeyBfX2dsb2JhbFN0YXRlIH0gZnJvbSAnLi4vaW50ZXJuYWwvZ2xvYmFsLXN0YXRlJztcbmltcG9ydCB7IGlzRGVmaW5lZCB9IGZyb20gJy4uL2ludGVybmFsL3V0aWxzJztcblxuZXhwb3J0IHR5cGUgRGV2dG9vbHNPcHRpb25zID0ge1xuICAvKiogIG1heGltdW0gYWxsb3dlZCBhY3Rpb25zIHRvIGJlIHN0b3JlZCBpbiB0aGUgaGlzdG9yeSB0cmVlICovXG4gIG1heEFnZTogbnVtYmVyO1xuICBsYXRlbmN5OiBudW1iZXI7XG4gIGFjdGlvbnNCbGFja2xpc3Q6IHN0cmluZ1tdO1xuICBhY3Rpb25zV2hpdGVsaXN0OiBzdHJpbmdbXTtcbiAgc2hvdWxkQ2F0Y2hFcnJvcnM6IGJvb2xlYW47XG4gIGxvZ1RyYWNlOiBib29sZWFuO1xuICBwcmVkaWNhdGU6IChzdGF0ZTogYW55LCBhY3Rpb246IGFueSkgPT4gYm9vbGVhbjtcbn07XG5sZXQgcm9vdERpc3BhdGNoZXJTdWIsIGRldnRvb2xzU3ViO1xuXG5leHBvcnQgdHlwZSBOZ1pvbmVMaWtlID0geyBydW46IGFueSB9O1xuXG5leHBvcnQgZnVuY3Rpb24gYWtpdGFEZXZ0b29scyhuZ1pvbmU6IE5nWm9uZUxpa2UsIG9wdGlvbnM/OiBQYXJ0aWFsPERldnRvb2xzT3B0aW9ucz4pO1xuZXhwb3J0IGZ1bmN0aW9uIGFraXRhRGV2dG9vbHMob3B0aW9ucz86IFBhcnRpYWw8RGV2dG9vbHNPcHRpb25zPik7XG5leHBvcnQgZnVuY3Rpb24gYWtpdGFEZXZ0b29scyhuZ1pvbmVPck9wdGlvbnM/OiBOZ1pvbmVMaWtlIHwgUGFydGlhbDxEZXZ0b29sc09wdGlvbnM+LCBvcHRpb25zOiBQYXJ0aWFsPERldnRvb2xzT3B0aW9ucz4gPSB7fSkge1xuICBpZiAoISh3aW5kb3cgYXMgYW55KS5fX1JFRFVYX0RFVlRPT0xTX0VYVEVOU0lPTl9fKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgcm9vdERpc3BhdGNoZXJTdWIgJiYgcm9vdERpc3BhdGNoZXJTdWIudW5zdWJzY3JpYmUoKTtcbiAgZGV2dG9vbHNTdWIgJiYgZGV2dG9vbHNTdWIoKTtcblxuICBjb25zdCBpc0FuZ3VsYXIgPSBuZ1pvbmVPck9wdGlvbnMgJiYgbmdab25lT3JPcHRpb25zWydydW4nXTtcblxuICBpZiAoIWlzQW5ndWxhcikge1xuICAgIG5nWm9uZU9yT3B0aW9ucyA9IG5nWm9uZU9yT3B0aW9ucyB8fCB7fTtcbiAgICAobmdab25lT3JPcHRpb25zIGFzIGFueSkucnVuID0gY2IgPT4gY2IoKTtcbiAgICBvcHRpb25zID0gbmdab25lT3JPcHRpb25zIGFzIFBhcnRpYWw8RGV2dG9vbHNPcHRpb25zPjtcbiAgfVxuXG4gIGNvbnN0IGRlZmF1bHRPcHRpb25zOiBQYXJ0aWFsPERldnRvb2xzT3B0aW9ucz4gJiB7IG5hbWU6IHN0cmluZyB9ID0geyBuYW1lOiAnQWtpdGEnIH07XG4gIGNvbnN0IG1lcmdlZCA9IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcblxuICBjb25zdCBkZXZUb29scyA9ICh3aW5kb3cgYXMgYW55KS5fX1JFRFVYX0RFVlRPT0xTX0VYVEVOU0lPTl9fLmNvbm5lY3QobWVyZ2VkKTtcbiAgbGV0IGFwcFN0YXRlID0ge307XG5cbiAgcm9vdERpc3BhdGNoZXJTdWIgPSByb290RGlzcGF0Y2hlci5zdWJzY3JpYmUoYWN0aW9uID0+IHtcbiAgICBpZiAoYWN0aW9uLnR5cGUgPT09IEFjdGlvbnMuREVMRVRFX1NUT1JFKSB7XG4gICAgICBjb25zdCBzdG9yZU5hbWUgPSBhY3Rpb24ucGF5bG9hZC5zdG9yZU5hbWU7XG4gICAgICBkZWxldGUgYXBwU3RhdGVbc3RvcmVOYW1lXTtcbiAgICAgIGRldlRvb2xzLnNlbmQoeyB0eXBlOiBgWyR7c3RvcmVOYW1lfV0gLSBEZWxldGUgU3RvcmVgIH0sIGFwcFN0YXRlKTtcbiAgICB9XG5cbiAgICBpZiAoYWN0aW9uLnR5cGUgPT09IEFjdGlvbnMuTkVXX1NUQVRFKSB7XG4gICAgICBpZiAoX19nbG9iYWxTdGF0ZS5za2lwQWN0aW9uKSB7XG4gICAgICAgIF9fZ2xvYmFsU3RhdGUuc2V0U2tpcEFjdGlvbihmYWxzZSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgYXBwU3RhdGUgPSB7XG4gICAgICAgIC4uLmFwcFN0YXRlLFxuICAgICAgICBbYWN0aW9uLnBheWxvYWQubmFtZV06IF9fc3RvcmVzX19bYWN0aW9uLnBheWxvYWQubmFtZV0uX3ZhbHVlKClcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHsgdHlwZSwgZW50aXR5SWQgfSA9IF9fZ2xvYmFsU3RhdGUuY3VycmVudEFjdGlvbjtcbiAgICAgIGNvbnN0IHN0b3JlTmFtZSA9IGNhcGl0YWxpemUoYWN0aW9uLnBheWxvYWQubmFtZSk7XG4gICAgICBsZXQgbXNnID0gaXNEZWZpbmVkKGVudGl0eUlkKSA/IGBbJHtzdG9yZU5hbWV9XSAtICR7dHlwZX0gKGlkczogJHtlbnRpdHlJZH0pYCA6IGBbJHtzdG9yZU5hbWV9XSAtICR7dHlwZX1gO1xuXG4gICAgICBpZiAob3B0aW9ucy5sb2dUcmFjZSkge1xuICAgICAgICBjb25zb2xlLmdyb3VwKG1zZyk7XG4gICAgICAgIGNvbnNvbGUudHJhY2UoKTtcbiAgICAgICAgY29uc29sZS5ncm91cEVuZCgpO1xuICAgICAgfVxuXG4gICAgICBkZXZUb29scy5zZW5kKHsgdHlwZTogbXNnLCB0cmFuc2FjdGlvbjogX19nbG9iYWxTdGF0ZS5jdXJyZW50VC5tYXAodCA9PiB0LnR5cGUpIH0sIGFwcFN0YXRlKTtcbiAgICB9XG4gIH0pO1xuXG4gIGRldnRvb2xzU3ViID0gZGV2VG9vbHMuc3Vic2NyaWJlKG1lc3NhZ2UgPT4ge1xuICAgIGlmIChtZXNzYWdlLnR5cGUgPT09ICdBQ1RJT04nKSB7XG4gICAgICBjb25zdCBbc3RvcmVOYW1lXSA9IG1lc3NhZ2UucGF5bG9hZC5zcGxpdCgnLicpO1xuXG4gICAgICBpZiAoX19zdG9yZXNfX1tzdG9yZU5hbWVdKSB7XG4gICAgICAgIChuZ1pvbmVPck9wdGlvbnMgYXMgTmdab25lTGlrZSkucnVuKCgpID0+IHtcbiAgICAgICAgICBjb25zdCBmdW5jQ2FsbCA9IG1lc3NhZ2UucGF5bG9hZC5yZXBsYWNlKHN0b3JlTmFtZSwgYHRoaXNbJyR7c3RvcmVOYW1lfSddYCk7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG5ldyBGdW5jdGlvbihgJHtmdW5jQ2FsbH1gKS5jYWxsKF9fc3RvcmVzX18pO1xuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignVW5rbm93biBNZXRob2Qg4pi577iPJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAobWVzc2FnZS50eXBlID09PSAnRElTUEFUQ0gnKSB7XG4gICAgICBjb25zdCBwYXlsb2FkVHlwZSA9IG1lc3NhZ2UucGF5bG9hZC50eXBlO1xuXG4gICAgICBpZiAocGF5bG9hZFR5cGUgPT09ICdDT01NSVQnKSB7XG4gICAgICAgIGRldlRvb2xzLmluaXQoYXBwU3RhdGUpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChtZXNzYWdlLnN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHJvb3RTdGF0ZSA9IEpTT04ucGFyc2UobWVzc2FnZS5zdGF0ZSk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwLCBrZXlzID0gT2JqZWN0LmtleXMocm9vdFN0YXRlKTsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBjb25zdCBzdG9yZU5hbWUgPSBrZXlzW2ldO1xuICAgICAgICAgIGlmIChfX3N0b3Jlc19fW3N0b3JlTmFtZV0pIHtcbiAgICAgICAgICAgIChuZ1pvbmVPck9wdGlvbnMgYXMgTmdab25lTGlrZSkucnVuKCgpID0+IHtcbiAgICAgICAgICAgICAgX19zdG9yZXNfX1tzdG9yZU5hbWVdLnNldFN0YXRlKCgpID0+IHJvb3RTdGF0ZVtzdG9yZU5hbWVdLCBmYWxzZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBjYXBpdGFsaXplKHN0cmluZykge1xuICByZXR1cm4gc3RyaW5nICYmIHN0cmluZy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHN0cmluZy5zbGljZSgxKTtcbn1cbiJdfQ==