{"version":3,"file":"datorama-akita.js.map","sources":["ng://@datorama/akita/src/internal/utils.ts","ng://@datorama/akita/src/internal/error.ts","ng://@datorama/akita/src/internal/crud.ts","ng://@datorama/akita/src/internal/global-state.ts","ng://@datorama/akita/src/internal/transaction.internal.ts","ng://@datorama/akita/src/internal/deep-freeze.ts","ng://@datorama/akita/src/api/store-config.ts","ng://@datorama/akita/src/api/config.ts","ng://@datorama/akita/src/api/store.ts","ng://@datorama/akita/src/api/entity-store.ts","ng://@datorama/akita/src/internal/sort.ts","ng://@datorama/akita/src/api/memoize.ts","ng://@datorama/akita/src/api/query-config.ts","ng://@datorama/akita/src/api/query.ts","ng://@datorama/akita/src/api/query-entity.ts","ng://@datorama/akita/src/api/transaction.ts","ng://@datorama/akita/src/api/arrays.ts","ng://@datorama/akita/src/api/operators.ts","ng://@datorama/akita/src/internal/action.ts","ng://@datorama/akita/src/api/worker.ts","ng://@datorama/akita/src/api/snapshot-manager.ts","ng://@datorama/akita/src/plugins/plugin.ts","ng://@datorama/akita/src/plugins/paginator/paginator-plugin.ts","ng://@datorama/akita/src/plugins/persist-form/persist-ng-form-plugin.ts","ng://@datorama/akita/src/enhancers/persist-state.ts","ng://@datorama/akita/src/enhancers/devtools.ts","ng://@datorama/akita/src/plugins/entity-collection-plugin.ts","ng://@datorama/akita/src/plugins/state-history/state-history-plugin.ts","ng://@datorama/akita/src/plugins/state-history/entity-state-history-plugin.ts","ng://@datorama/akita/src/plugins/dirty-check/dirty-check-plugin.ts","ng://@datorama/akita/src/plugins/dirty-check/entity-dirty-check-plugin.ts","ng://@datorama/akita/src/api/store-utils.ts"],"sourcesContent":["import { Observable } from 'rxjs';\nimport { ActiveState, EntityState, HashMap, ID } from '../api/types';\n\n/** Wraps the provided value in an array, unless the provided _value is an array. */\nexport function coerceArray<T>(value: T | T[]): T[] {\n  return Array.isArray(value) ? value : [value];\n}\n\n/** Check if a value is an object */\nexport function isObject(value: any) {\n  return Object.prototype.toString.call(value) === '[object Object]';\n}\n\nexport function isPlainObject(value) {\n  return toBoolean(value) && value.constructor.name === 'Object';\n}\n\nexport function isFunction(value): value is Function {\n  return typeof value === 'function';\n}\n\nexport function toBoolean(value: any): boolean {\n  return value != null && `${value}` !== 'false';\n}\n\nexport function isUndefined(value) {\n  return value === undefined;\n}\n\nexport function isNil(v) {\n  return v === null || v === undefined;\n}\n\n/**\n * Check if entity exists\n */\nexport function entityExists<E>(id: ID, entities: HashMap<E>) {\n  return entities.hasOwnProperty(id);\n}\n\n/**\n * Observable that emits empty value and complete\n */\nexport function noop<T>(): Observable<T> {\n  return new Observable(observer => {\n    observer.next();\n    observer.complete();\n  });\n}\n\nexport function isObservable(value) {\n  return toBoolean(value) && isFunction(value.subscribe);\n}\n\nexport function isString(val: string | any): val is string {\n  return typeof val === 'string';\n}\n\nexport function isNumber(value) {\n  return typeof value === 'number';\n}\n\nexport function isDefined(val) {\n  return val !== null && typeof val !== 'undefined';\n}\n\n/**\n * Check if the active entity exist\n */\nexport function resetActive<E>(state: EntityState<E>) {\n  return isActiveState(state) && entityExists((state as ActiveState).active, state.entities) === false;\n}\n\n/**\n * Check if the store supports active entity\n */\nexport function isActiveState<E>(state: EntityState<E>) {\n  return (state as ActiveState).hasOwnProperty('active');\n}\n\n/**\n * setValue(state, 'todos.ui', { filter: {}})\n */\nexport const setValue = (obj: any, prop: string, val: any) => {\n  const split = prop.split('.');\n\n  if (split.length === 1) return val;\n\n  obj = { ...obj };\n\n  const lastIndex = split.length - 2;\n  const removeStoreName = prop.split('.').slice(1);\n\n  removeStoreName.reduce((acc, part, index) => {\n    if (index === lastIndex) {\n      acc[part] = val;\n    } else {\n      acc[part] = { ...acc[part] };\n    }\n\n    return acc && acc[part];\n  }, obj);\n\n  return obj;\n};\n\n/**\n * getValue(state, 'todos.ui')\n */\nexport const getValue = (obj: any, prop: string) => {\n  /** return the whole state  */\n  if (prop.split('.').length === 1) {\n    return obj;\n  }\n  const removeStoreName = prop\n    .split('.')\n    .slice(1)\n    .join('.');\n  return removeStoreName.split('.').reduce((acc: any, part: string) => acc && acc[part], obj);\n};\n","import { entityExists, isObject, toBoolean } from './utils';\nimport { EntityState, ID } from '../api/types';\n\nexport class AkitaError extends Error {\n  constructor(message: string) {\n    super(message);\n  }\n}\n\nexport class AkitaImmutabilityError extends AkitaError {\n  constructor(storeName) {\n    super(`The new state should be immutable. Make sure to return a new immutable state. \\n store: \\n ${storeName}`);\n  }\n}\n\nexport class AkitaEntityNotExistsError extends AkitaError {\n  constructor(id) {\n    super(`Entity ${id} does not exists`);\n  }\n}\n\nexport class AkitaNoActiveError extends AkitaError {\n  constructor() {\n    super(`Active is null/undefined`);\n  }\n}\n\nexport class AkitaInvalidEntityState extends AkitaError {\n  constructor() {\n    super(`Entity state is invalid`);\n  }\n}\n\nexport class AkitaUpdateIdKeyError extends AkitaError {\n  constructor() {\n    super(`Updating entity id is not permitted when updating many entities`);\n  }\n}\n\nexport function assertEntityExists(id: ID, entities) {\n  if (!entityExists(id, entities)) {\n    throw new AkitaEntityNotExistsError(id);\n  }\n}\n\nexport function assertActive(store) {\n  if (!toBoolean(store.active)) {\n    throw new AkitaNoActiveError();\n  }\n}\n\nexport function assertEntityState(state: EntityState<any>) {\n  const assertEntities = isObject(state);\n\n  if (!assertEntities) {\n    throw new AkitaInvalidEntityState();\n  }\n}\n\nexport function assertDecorator(name: string, className: string) {\n  if (!name) {\n    console.error(`@StoreConfig({ name }) is missing in ${className}`);\n  }\n}\n","import { Entities, EntityState, HashMap, ID, Newable, AddOptions } from '../api/types';\nimport { AkitaUpdateIdKeyError, assertEntityExists, assertEntityState } from './error';\nimport { entityExists, isFunction, isPlainObject, resetActive } from './utils';\n\nexport class CRUD {\n  _set<S, E>(state: S, entities: E[] | HashMap<E> | Entities<E>, entityClass: Newable<E> | undefined, idKey): S {\n    let ids, normalized;\n\n    if ((entities as Entities<E>).ids && (entities as Entities<E>).entities) {\n      ids = (entities as Entities<E>).ids;\n      normalized = (entities as Entities<E>).entities;\n    } else {\n      const isArray = Array.isArray(entities);\n      normalized = entities;\n\n      if (isArray) {\n        normalized = this.keyBy(entities as E[], entityClass, idKey) as E[];\n      } else {\n        assertEntityState(entities);\n      }\n\n      ids = isArray ? (entities as E[]).map(entity => entity[idKey]) : Object.keys(normalized as HashMap<E>).map(id => entities[id][idKey]);\n    }\n\n    const newState = {\n      ...(state as any),\n      entities: normalized,\n      ids,\n      loading: false\n    };\n\n    if (resetActive(newState)) {\n      newState.active = null;\n    }\n\n    return newState;\n  }\n\n  _replaceEntity<T extends EntityState>(state: T, id: ID, entity): T {\n    return {\n      ...(state as any),\n      entities: {\n        ...state.entities,\n        [id]: entity\n      }\n    };\n  }\n\n  _add<S extends EntityState, E>(state: S, entities: E[], idKey, options: AddOptions = {}): S {\n    let addedEntities = {};\n    let addedIds = [];\n\n    for (let i = 0; i < entities.length; i++) {\n      const entity = entities[i];\n      const entityId = entity[idKey];\n\n      if (!entityExists(entityId, state.entities)) {\n        addedEntities[entityId] = entity;\n        if (options.prepend) addedIds.unshift(entityId);\n        else addedIds.push(entityId);\n      }\n    }\n\n    return {\n      ...(state as any),\n      entities: {\n        ...state.entities,\n        ...addedEntities\n      },\n      ids: options.prepend ? [...addedIds, ...state.ids] : [...state.ids, ...addedIds]\n    };\n  }\n\n  _update<T extends EntityState>(state: T, ids: ID[], newStateOrFn: object | ((e: Readonly<any>) => object), idKey: string): T {\n    const updatedEntities = {};\n\n    let isUpdatingIdKey = false;\n    let idToUpdate: ID;\n\n    for (let i = 0; i < ids.length; i++) {\n      const id = ids[i];\n      idToUpdate = id;\n      assertEntityExists(id, state.entities);\n\n      const oldEntity = state.entities[id];\n      const newState = isFunction(newStateOrFn) ? newStateOrFn(oldEntity) : newStateOrFn;\n\n      if (newState.hasOwnProperty(idKey) && newState[idKey] !== oldEntity[idKey]) {\n        if (ids.length > 1) {\n          throw new AkitaUpdateIdKeyError();\n        }\n        isUpdatingIdKey = true;\n        idToUpdate = newState[idKey];\n      }\n\n      let newEntity;\n\n      const merged = {\n        ...oldEntity,\n        ...newState\n      };\n\n      if (isPlainObject(oldEntity)) {\n        newEntity = merged;\n      } else {\n        /**\n         * In case that new state is class of it's own, there's\n         * a possibility that it will be different than the old\n         * class.\n         * For example, Old state is an instance of animal class\n         * and new state is instance of person class.\n         * To avoid run over new person class with the old animal\n         * class we check if the new state is a class of it's own.\n         * If so, use it. Otherwise, use the old state class\n         */\n        if (isPlainObject(newState)) {\n          newEntity = new oldEntity.constructor(merged);\n        } else {\n          newEntity = new (newState as any).constructor(merged);\n        }\n      }\n\n      updatedEntities[idToUpdate] = newEntity;\n    }\n\n    let updatedIds = state.ids;\n    let stateEntities = state.entities;\n    if (isUpdatingIdKey) {\n      const [id] = ids;\n      const { [id]: deletedEntity, ...rest } = state.entities;\n      stateEntities = rest;\n      updatedIds = state.ids.map(current => (current === id ? idToUpdate : current));\n    }\n\n    return {\n      ...(state as any),\n      entities: {\n        ...stateEntities,\n        ...updatedEntities\n      },\n      ids: updatedIds\n    };\n  }\n\n  _remove<T extends EntityState>(state: T, ids: ID[] | null): T {\n    if (!ids) return this._removeAll(state);\n\n    const removed = ids.reduce((acc, id) => {\n      const { [id]: entity, ...rest } = acc;\n      return rest;\n    }, state.entities);\n    const newState = {\n      ...(state as any),\n      entities: removed,\n      ids: state.ids.filter(current => ids.indexOf(current) === -1)\n    };\n\n    if (resetActive(newState)) {\n      newState.active = null;\n    }\n\n    return newState;\n  }\n\n  private _removeAll<T extends EntityState>(state: T): T {\n    const newState = {\n      ...(state as any),\n      entities: {},\n      ids: [],\n      active: null\n    };\n\n    return newState;\n  }\n\n  private keyBy(entities: any[], entityClass?: Newable<any>, id = 'id') {\n    const acc = {};\n\n    for (let i = 0, len = entities.length; i < len; i++) {\n      const entity = entities[i];\n      acc[entity[id]] = entityClass ? new entityClass(entity) : entity;\n    }\n\n    return acc;\n  }\n}\n\nexport const _crud = new CRUD();\n","import { Subject } from 'rxjs';\n\nexport type Action = {\n  type: string;\n  entityId?: any[] | any;\n  payload?: any;\n};\n\nexport class AkitaGlobals {\n  private customAction;\n  currentAction: Action;\n  skipAction = false;\n  skipTransactionMsg = false;\n  currentT = [];\n  activeTransactions = 0;\n  batchTransaction: Subject<boolean>;\n\n  setAction(_action: Action) {\n    if (this.customAction) {\n      this.currentAction = this.customAction;\n      this.customAction = null;\n      this.skipTransactionMsg = false;\n    } else {\n      if (this.activeTransactions === 0) {\n        this.currentAction = _action;\n      }\n    }\n\n    if (this.activeTransactions > 0) {\n      this.currentT.push(_action);\n    }\n  }\n\n  setCustomAction(action: Action, skipTransactionMsg = false) {\n    this.currentAction = this.customAction = action;\n    this.skipTransactionMsg = skipTransactionMsg;\n  }\n\n  setSkipAction(skip = true) {\n    this.skipAction = skip;\n  }\n}\n\nexport const __globalState = new AkitaGlobals();\n","import { __globalState } from './global-state';\nimport { Observable, Subject, of } from 'rxjs';\n\n/**\n * Start a new transaction batch\n */\nexport function startBatch() {\n  if (!isTransactionInProcess()) {\n    __globalState.batchTransaction = new Subject();\n  }\n  __globalState.activeTransactions++;\n}\n\n/**\n * End the transaction\n */\nexport function endBatch() {\n  if (--__globalState.activeTransactions === 0) {\n    __globalState.batchTransaction.next(true);\n    __globalState.batchTransaction.complete();\n  }\n}\n\n/**\n * Whether we're inside batch\n */\nexport function isTransactionInProcess() {\n  return __globalState.activeTransactions > 0;\n}\n\n/**\n */\nexport function commit(): Observable<boolean> {\n  return __globalState.batchTransaction ? __globalState.batchTransaction.asObservable() : of(true);\n}\n","export function deepFreeze(o) {\n  Object.freeze(o);\n\n  var oIsFunction = typeof o === 'function';\n  var hasOwnProp = Object.prototype.hasOwnProperty;\n\n  Object.getOwnPropertyNames(o).forEach(function(prop) {\n    if (\n      hasOwnProp.call(o, prop) &&\n      (oIsFunction ? prop !== 'caller' && prop !== 'callee' && prop !== 'arguments' : true) &&\n      o[prop] !== null &&\n      (typeof o[prop] === 'object' || typeof o[prop] === 'function') &&\n      !Object.isFrozen(o[prop])\n    ) {\n      deepFreeze(o[prop]);\n    }\n  });\n\n  return o;\n}\n","export type StoreConfigOptions = {\n  name: string;\n  resettable?: boolean;\n  idKey?: string;\n};\n\nexport const configKey = 'akitaConfig';\n\nexport function StoreConfig(metadata: StoreConfigOptions) {\n  return function(constructor: Function) {\n    constructor[configKey] = { idKey: 'id' };\n\n    for (let i = 0, keys = Object.keys(metadata); i < keys.length; i++) {\n      const key = keys[i];\n      /* name is preserved read only key */\n      if (key === 'name') {\n        constructor[configKey]['storeName'] = metadata[key];\n      } else {\n        constructor[configKey][key] = metadata[key];\n      }\n    }\n  };\n}\n","export interface AkitaConfig {\n  /**\n   * Whether to allowed the reset() stores functionality\n   */\n  resettable?: boolean;\n}\n\nlet CONFIG: AkitaConfig = {\n  resettable: false\n};\n\nexport function akitaConfig(config: AkitaConfig) {\n  CONFIG = { ...CONFIG, ...config };\n}\n\nexport function getAkitaConfig() {\n  return CONFIG;\n}\n","import { HashMap, ID } from './types';\nimport { BehaviorSubject, Observable, ReplaySubject } from 'rxjs';\nimport { distinctUntilChanged, map } from 'rxjs/operators';\nimport { AkitaError, AkitaImmutabilityError, assertDecorator } from '../internal/error';\nimport { commit, isTransactionInProcess } from '../internal/transaction.internal';\nimport { isFunction, isPlainObject } from '../internal/utils';\nimport { deepFreeze } from '../internal/deep-freeze';\nimport { configKey, StoreConfigOptions } from './store-config';\nimport { __globalState } from '../internal/global-state';\nimport { getAkitaConfig } from './config';\n\nlet __DEV__ = true;\nconst isNotBrowser = typeof window === 'undefined';\n\nexport const __stores__: { [storeName: string]: Store<any> } = {};\n\nexport const enum Actions {\n  NEW_STORE,\n  DELETE_STORE,\n  NEW_STATE\n}\n\nexport type Action = {\n  type: Actions;\n  payload: HashMap<any>;\n};\n\nexport const rootDispatcher = new ReplaySubject<Action>();\n\nfunction nextState(storeName, initialState = false) {\n  return {\n    type: Actions.NEW_STATE,\n    payload: {\n      name: storeName,\n      initialState\n    }\n  };\n}\n\n/**\n * Enable production mode to disable objectFreeze\n */\nexport function enableAkitaProdMode() {\n  __DEV__ = false;\n}\n\nexport function isDev() {\n  return __DEV__;\n}\n\n/**\n * The Root Store that every sub store needs to inherit and\n * invoke `super` with the initial state.\n */\nexport class Store<S> {\n  /** Manage the store with BehaviorSubject */\n  private store: BehaviorSubject<Readonly<S>>;\n\n  /** The current state value */\n  private storeValue: S;\n\n  /** Whether we are inside transaction **/\n  private inTransaction = false;\n\n  private _isPristine = true;\n\n  private readonly _initialState: S;\n\n  /**\n   *\n   * Initial the store with the state\n   */\n  constructor(initialState, private options: { idKey?: string; storeName?: string } = {}) {\n    __globalState.setAction({ type: '@@INIT' });\n    __stores__[this.storeName] = this;\n    this.setState(() => initialState);\n    rootDispatcher.next({\n      type: Actions.NEW_STORE,\n      payload: { store: this }\n    });\n    isDev() && assertDecorator(this.storeName, this.constructor.name);\n    if (this.isRessetable()) {\n      this._initialState = initialState;\n    }\n  }\n\n  setLoading(loading = false) {\n    if (loading !== (this._value() as S & { loading: boolean }).loading) {\n      isDev() && __globalState.setAction({ type: 'Set Loading' });\n      this.setState(s => ({ ...(s as object), loading } as any));\n    }\n  }\n\n  /**\n   * Update the store's error state.\n   */\n  setError<T>(error: T) {\n    if (error !== (this._value() as S & { error: any }).error) {\n      isDev() && __globalState.setAction({ type: 'Set Error' });\n      this.setState(s => ({ ...(s as object), error } as any));\n    }\n  }\n\n  /**\n   * Select a slice from the store\n   *\n   * @example\n   * this.store.select(state => state.entities)\n   *\n   */\n  _select<R>(project: (store: S) => R): Observable<R> {\n    return this.store$.pipe(\n      map(project),\n      distinctUntilChanged()\n    );\n  }\n\n  _value(): S {\n    return this.storeValue;\n  }\n\n  get config(): StoreConfigOptions {\n    return this.constructor[configKey];\n  }\n\n  get storeName() {\n    return this.options.storeName || (this.config && this.config['storeName']);\n  }\n\n  get idKey() {\n    /** backward compatibility */\n    const newIdKey = this.config && this.config.idKey;\n    if (!newIdKey) {\n      return this.options.idKey || 'id';\n    }\n    return newIdKey;\n  }\n\n  get isPristine() {\n    return this._isPristine;\n  }\n\n  /**\n   * `setState()` is the only way to update a store; It receives a callback function,\n   * which gets the current state, and returns a new immutable state,\n   * which will be the new value of the store.\n   */\n  setState(newStateFn: (state: Readonly<S>) => S, _rootDispatcher = true) {\n    const prevState = this._value();\n    this.storeValue = __DEV__ ? deepFreeze(newStateFn(this._value())) : newStateFn(this._value());\n\n    if (prevState === this.storeValue) {\n      throw new AkitaImmutabilityError(this.storeName);\n    }\n\n    if (!this.store) {\n      this.store = new BehaviorSubject(this.storeValue);\n      rootDispatcher.next(nextState(this.storeName, true));\n      return;\n    }\n\n    if (isTransactionInProcess()) {\n      this.handleTransaction();\n      return;\n    }\n\n    this.dispatch(this.storeValue, _rootDispatcher);\n  }\n\n  /**\n   * Resets the store to it's initial state and set the store to a pristine state.\n   */\n  reset() {\n    if (this.isRessetable()) {\n      __globalState.setAction({ type: 'Reset Store' });\n      this.setState(() => Object.assign({}, this._initialState));\n      this.setPristine();\n    } else {\n      throw new AkitaError(`You need to enable the reset functionality`);\n    }\n  }\n\n  /**\n   * This method is a shortcut for `setState()`.\n   * It can be useful when you want to pass the whole state object instead of merging a partial state.\n   *\n   * @example\n   * this.store.update(newState)\n   */\n  update(newState: (state: Readonly<S>) => Partial<S>);\n  update(newState: Partial<S>);\n  update(id: ID | ID[] | null, newState: Partial<S>);\n  update(newStateOrId: Partial<S> | ID | ID[] | null | ((state: Readonly<S>) => Partial<S>), newState?: Partial<S>) {\n    __globalState.setAction({ type: 'Update Store' });\n    this.setState(state => {\n      let value = isFunction(newStateOrId) ? newStateOrId(state) : newStateOrId;\n      let merged = Object.assign({}, state, value);\n      return isPlainObject(state) ? merged : new (state as any).constructor(merged);\n    });\n    this.setDirty();\n  }\n\n  /**\n   * Sets the store to a pristine state.\n   */\n  setPristine() {\n    this._isPristine = true;\n  }\n\n  /**\n   * Sets the store to a dirty state, indicating that it is not pristine.\n   */\n  setDirty() {\n    this._isPristine = false;\n  }\n\n  destroy = this.ngOnDestroy;\n\n  private dispatch(state: S, _rootDispatcher = true) {\n    this.store.next(state);\n    if (_rootDispatcher) {\n      rootDispatcher.next(nextState(this.storeName));\n      isDev() && __globalState.setAction({ type: 'Set State' });\n    }\n  }\n\n  private get store$() {\n    return this.store.asObservable();\n  }\n\n  /**\n   * When the transaction ends dispatch the final value once\n   */\n  private watchTransaction() {\n    commit().subscribe(() => {\n      this.inTransaction = false;\n      if (isDev() && !__globalState.skipTransactionMsg) {\n        __globalState.setAction({ type: '@Transaction' });\n      }\n      this.dispatch(this._value());\n      __globalState.currentT = [];\n      __globalState.skipTransactionMsg = false;\n    });\n  }\n\n  private isRessetable() {\n    return this.config.resettable || getAkitaConfig().resettable;\n  }\n\n  /**\n   * Listen to the transaction stream\n   */\n  private handleTransaction() {\n    if (!this.inTransaction) {\n      this.watchTransaction();\n      this.inTransaction = true;\n    }\n  }\n\n  ngOnDestroy() {\n    if (isNotBrowser) return;\n    if (!(window as any).hmrEnabled && this === __stores__[this.storeName]) {\n      delete __stores__[this.storeName];\n      rootDispatcher.next({\n        type: Actions.DELETE_STORE,\n        payload: { storeName: this.storeName }\n      });\n    }\n  }\n}\n","import { _crud } from '../internal/crud';\nimport { AkitaImmutabilityError, assertActive } from '../internal/error';\nimport { Action, __globalState } from '../internal/global-state';\nimport { coerceArray, entityExists, isFunction, isNil, isObject, isUndefined, toBoolean } from '../internal/utils';\nimport { isDev, Store } from './store';\nimport { ActiveState, Entities, EntityState, HashMap, ID, Newable, AddOptions, SetActiveOptions } from './types';\n\n/**\n * The Root Store that every sub store needs to inherit and\n * invoke `super` with the initial state.\n */\nexport class EntityStore<S extends EntityState<E>, E, ActiveEntity = ID> extends Store<S> {\n  /**\n   *\n   * Initiate the store with the state\n   */\n  constructor(initialState = {}, options: { idKey?: string; storeName?: string } = {}) {\n    super({ ...getInitialEntitiesState(), ...initialState }, options);\n  }\n\n  get entities() {\n    return this._value().entities;\n  }\n\n  /**\n   *\n   * Replace current collection with provided collection\n   *\n   * @example\n   * this.store.set([Entity, Entity]);\n   * this.store.set({1: Entity, 2: Entity});\n   * this.store.set([{id: 1}, {id: 2}], { entityClass: Product });\n   *\n   */\n  set(entities: E[] | HashMap<E> | Entities<E>, options: { entityClass?: Newable<E> | undefined } = {}) {\n    isDev() && __globalState.setAction({ type: 'Set Entities' });\n    this.setState(state => _crud._set(state, isNil(entities) ? [] : entities, options.entityClass, this.idKey));\n    this.setDirty();\n  }\n\n  /**\n   * Create or replace an entity in the store.\n   *\n   * @example\n   * this.store.createOrReplace(3, Entity);\n   *\n   */\n  createOrReplace(id: ID, entity: E) {\n    if (!entityExists(id, this._value().entities)) {\n      this.addWhenNotExists(id, entity);\n    } else {\n      isDev() && __globalState.setAction({ type: 'Create or Replace Entity', entityId: [id] });\n      this.setState(state => _crud._replaceEntity(state, id, entity));\n    }\n  }\n\n  /**\n   *\n   * Insert or Update\n   */\n  upsert(id: ID, entityOrFn: Partial<E> | ((entity: Readonly<E>) => Partial<E>)) {\n    if (!entityExists(id, this._value().entities)) {\n      const resolve = isFunction(entityOrFn) ? (entityOrFn as Function)({}) : entityOrFn;\n      this.addWhenNotExists(id, resolve);\n    } else {\n      this.update(id, entityOrFn as any);\n    }\n  }\n\n  /**\n   * Add an entity or entities to the store.\n   *\n   * @example\n   * this.store.add([Entity, Entity]);\n   * this.store.add(Entity);\n   * this.store.add(Entity, { prepend: true });\n   */\n  add(entities: E[] | E, options?: AddOptions) {\n    const toArray = coerceArray(entities);\n\n    if (toArray.length === 0) return;\n    /**  If we pass entities that already exist, we should ignore them */\n    const allExists = toArray.every(entity => this._value().ids.indexOf(entity[this.idKey]) > -1);\n    if (allExists) return;\n\n    isDev() && __globalState.setAction({ type: 'Add Entity' });\n    this.setState(state => _crud._add<S, E>(state, toArray, this.idKey, options));\n  }\n\n  /**\n   *\n   * Update an entity or entities in the store.\n   *\n   * @example\n   * this.store.update(3, {\n   *   name: 'New Name'\n   * });\n   *\n   *  this.store.update(3, entity => {\n   *    return {\n   *      config: {\n   *        ...entity.filter,\n   *        date\n   *      }\n   *    }\n   *  });\n   *\n   * this.store.update([1,2,3], {\n   *   name: 'New Name'\n   * });\n   *\n   * this.store.update(e => e.name === 'value', {\n   *   name: 'New Name'\n   * });\n   *\n   * this.store.update(null, {\n   *   name: 'New Name'\n   * });\n   *\n   */\n  update(id: ID | ID[] | null, newStateFn: ((entity: Readonly<E>) => Partial<E>));\n  update(id: ID | ID[] | null, newState: Partial<E>);\n  update(id: ID | ID[] | null, newState: Partial<S>);\n  update(newState: (state: Readonly<S>) => Partial<S>);\n  update(predicate: ((entity: Readonly<E>) => boolean), newStateFn: ((entity: Readonly<E>) => Partial<E>));\n  update(predicate: ((entity: Readonly<E>) => boolean), newState: Partial<E>);\n  update(predicate: ((entity: Readonly<E>) => boolean), newState: Partial<S>);\n  update(newState: Partial<S>);\n  update(\n    idsOrFn: ID | ID[] | null | Partial<S> | ((state: Readonly<S>) => Partial<S>) | ((entity: Readonly<E>) => boolean),\n    newStateOrFn?: ((entity: Readonly<E>) => Partial<E>) | Partial<E> | Partial<S>\n  ) {\n    let ids: ID[] = [];\n    const storeIds = this._value().ids;\n\n    if (isFunction(idsOrFn)) {\n      for (let i = 0, len = storeIds.length; i < len; i++) {\n        const id = storeIds[i];\n        const entity = this._value().entities[id];\n        if (entity && (idsOrFn as Function)(entity)) {\n          ids.push(id);\n        }\n      }\n    } else {\n      ids = toBoolean(idsOrFn) ? coerceArray(idsOrFn) : storeIds;\n    }\n\n    if (ids.length === 0) return;\n    isDev() && __globalState.setAction({ type: 'Update Entity', entityId: ids });\n\n    this.setState(state => {\n      return _crud._update(state, ids, newStateOrFn, this.idKey);\n    });\n  }\n\n  /**\n   * An alias to update all.\n   */\n  updateAll(state: Partial<E>) {\n    if (this._value().ids.length === 0) return;\n    this.update(null, state);\n  }\n\n  /**\n   * Update the root state (data which is external to the entities).\n   *\n   * @example\n   * this.store.updateRoot({\n   *   metadata: 'new metadata\n   * });\n   *\n   *  this.store.updateRoot(state => {\n   *    return {\n   *      metadata: {\n   *        ...state.metadata,\n   *        key: 'new value'\n   *      }\n   *    }\n   *  });\n   */\n  updateRoot(newStateFn: ((state: Readonly<S>) => Partial<S>) | Partial<S>, action?: Action) {\n    const newState = isFunction(newStateFn) ? newStateFn(this._value()) : newStateFn;\n\n    if (newState === this._value()) {\n      throw new AkitaImmutabilityError(this.storeName);\n    }\n\n    isDev() && __globalState.setAction(action || { type: 'Update Root' });\n\n    this.setState(state => {\n      return {\n        ...(state as any),\n        ...(newState as any)\n      };\n    });\n  }\n\n  /**\n   *\n   * Remove one or more entities from the store:\n   *\n   * @example\n   * this.store.remove(5);\n   * this.store.remove([1,2,3]);\n   * this.store.remove(entity => entity.id === 1);\n   * this.store.remove();\n   */\n  remove(id?: ID | ID[]);\n  remove(predicate: (entity: Readonly<E>) => boolean);\n  remove(idsOrFn?: ID | ID[] | ((entity: Readonly<E>) => boolean)) {\n    const storeIds = this._value().ids;\n\n    if (storeIds.length === 0) return;\n    const idPassed = toBoolean(idsOrFn);\n    if (!idPassed) this.setPristine();\n\n    let ids: ID[] = [];\n    if (isFunction(idsOrFn)) {\n      for (let i = 0, len = storeIds.length; i < len; i++) {\n        const id = storeIds[i];\n        const entity = this._value().entities[id];\n        if (entity && idsOrFn(entity)) {\n          ids.push(id);\n        }\n      }\n    } else {\n      ids = idPassed ? coerceArray(idsOrFn) : null;\n    }\n\n    if (ids && ids.length === 0) return;\n    isDev() && __globalState.setAction({ type: 'Remove Entity', entityId: ids });\n\n    this.setState(state => {\n      return _crud._remove(state, ids);\n    });\n  }\n\n  /**\n   *\n   * Update the active entity.\n   *\n   * @example\n   * this.store.updateActive(active => {\n   *   return {\n   *     config: {\n   *      ..active.config,\n   *      date\n   *     }\n   *   }\n   * })\n   */\n  updateActive(newStateFn: ((entity: Readonly<E>) => Partial<E>) | Partial<E>) {\n    assertActive(this._value());\n    isDev() && __globalState.setAction({ type: 'Update Active Entity', entityId: this._value().active });\n    this.setState(state => {\n      const activeId = state.active as ID;\n      const newState = isFunction(newStateFn) ? newStateFn(state.entities[activeId]) : newStateFn;\n      if (newState === state) {\n        throw new AkitaImmutabilityError(this.storeName);\n      }\n      return _crud._update(state, [activeId], newState, this.idKey);\n    });\n  }\n\n  /**\n   * Set the given entity as active.\n   */\n  setActive(idOrOptions: ActiveEntity | SetActiveOptions | null) {\n    let activeId: ActiveEntity;\n\n    if (isObject(idOrOptions)) {\n      if (isNil(this._value().active)) return;\n      (idOrOptions as SetActiveOptions) = Object.assign({ wrap: true }, idOrOptions);\n      const ids = this._value().ids;\n      const currentIdIndex = ids.indexOf(this._value().active);\n      if ((idOrOptions as SetActiveOptions).prev) {\n        const isFirst = currentIdIndex === 0;\n        if (isFirst && !(idOrOptions as SetActiveOptions).wrap) return;\n        activeId = isFirst ? ids[ids.length - 1] : (ids[currentIdIndex - 1] as any);\n      } else if ((idOrOptions as SetActiveOptions).next) {\n        const isLast = ids.length === currentIdIndex + 1;\n        if (isLast && !(idOrOptions as SetActiveOptions).wrap) return;\n        activeId = isLast ? ids[0] : (ids[currentIdIndex + 1] as any);\n      }\n    } else {\n      if (idOrOptions === this._value().active) return;\n      activeId = idOrOptions as ActiveEntity;\n    }\n\n    isDev() && __globalState.setAction({ type: 'Set Active Entity', entityId: activeId });\n    this.setState(state => {\n      return {\n        ...(state as any),\n        active: activeId\n      };\n    });\n  }\n\n  private addWhenNotExists(id: ID, entity: E) {\n    if (!entity[this.idKey]) {\n      entity[this.idKey] = id;\n    }\n    this.add(entity);\n  }\n}\n\nexport const getInitialEntitiesState = () =>\n  ({\n    entities: {},\n    ids: [],\n    loading: true,\n    error: null\n  } as EntityState);\n\nexport const getInitialActiveState = () =>\n  ({\n    active: null\n  } as ActiveState);\n","export enum Order {\n  ASC = 'asc',\n  DESC = 'desc'\n}\n\nexport function compareValues(key, order: Order = Order.ASC) {\n  return function(a, b) {\n    if (!a.hasOwnProperty(key) || !b.hasOwnProperty(key)) {\n      return 0;\n    }\n\n    const varA = typeof a[key] === 'string' ? a[key].toUpperCase() : a[key];\n    const varB = typeof b[key] === 'string' ? b[key].toUpperCase() : b[key];\n\n    let comparison = 0;\n    if (varA > varB) {\n      comparison = 1;\n    } else if (varA < varB) {\n      comparison = -1;\n    }\n    return order == Order.DESC ? comparison * -1 : comparison;\n  };\n}\n","export function memoizeOne(fn: Function) {\n  let lastArgs;\n  let changed = false;\n  let firstInit = true;\n  let lastResult;\n\n  return function(...args) {\n    if (lastArgs) {\n      /** If entities nor ids doesn't change return the last value */\n      changed = lastArgs[1] !== args[1] || lastArgs[0] !== args[0];\n    }\n\n    if (firstInit || (changed && !firstInit)) {\n      lastResult = fn.apply(this, args);\n    }\n\n    firstInit = false;\n    lastArgs = args;\n    return lastResult;\n  };\n}\n","import { Order } from '../internal/sort';\n\nexport type SortBy<E, S = any> = ((a: E, b: E, state?: S) => number) | keyof E;\n\nexport interface SortByOptions<E> {\n  sortBy?: SortBy<E>;\n  sortByOrder?: Order;\n}\n\nexport interface QueryConfigOptions<E = any> extends SortByOptions<E> {}\n\nexport const queryConfigKey = 'akitaQueryConfig';\n\nexport function QueryConfig<E>(metadata: QueryConfigOptions<E>) {\n  return function(constructor: Function) {\n    constructor[queryConfigKey] = {};\n    for (let i = 0, keys = Object.keys(metadata); i < keys.length; i++) {\n      const key = keys[i];\n      constructor[queryConfigKey][key] = metadata[key];\n    }\n  };\n}\n","import { Store } from './store';\nimport { Observable } from 'rxjs';\nimport { take } from 'rxjs/operators';\nimport { queryConfigKey, QueryConfigOptions } from './query-config';\n\nexport class Query<S> {\n  /** Use only for internal plugins like Pagination - don't use this property **/\n  __store__: Store<S>;\n\n  constructor(protected store: Store<S>) {\n    this.__store__ = store;\n  }\n\n  /**\n   * Select a slice from the store.\n   *\n   * @example\n   * this.query.select()\n   * this.query.select(state => state.entities)\n   */\n  select<R>(project?: (store: S) => R): Observable<R>;\n  select(): Observable<S>;\n  select<R>(project?: (store: S) => R): Observable<R | S> {\n    let state = project ? project : state => state;\n    return this.store._select(state);\n  }\n\n  /**\n   * Select once and complete.\n   */\n  selectOnce<R>(project: (store: S) => R): Observable<R> {\n    return this.select(project).pipe(take(1));\n  }\n\n  /**\n   * Select the store's loading state.\n   */\n  selectLoading() {\n    return this.select(state => (state as S & { loading: boolean }).loading);\n  }\n\n  /**\n   * Select the store's error state.\n   */\n  selectError() {\n    return this.select(state => (state as S & { error: any }).error);\n  }\n\n  /**\n   * Get the raw value of the store.\n   */\n  getSnapshot(): S {\n    return this.store._value();\n  }\n\n  /**\n   *  Returns whether the state of the store is pristine (the set() method hasn't been explicitly called\n   *  since the store creation, or the last time setPristine()was called).\n   */\n  get isPristine() {\n    return this.store.isPristine;\n  }\n\n  /**\n   * Returns whether the state of the store is dirty (the set() method\n   * or the setDirty() method has been explicitly called since the store creation,\n   * or the last time setPristine() was called).\n   */\n  get isDirty() {\n    return !this.store.isPristine;\n  }\n\n  get config(): QueryConfigOptions {\n    return this.constructor[queryConfigKey];\n  }\n}\n","import { combineLatest, Observable } from 'rxjs';\nimport { auditTime, map, switchMap, withLatestFrom } from 'rxjs/operators';\n\nimport { compareValues, Order } from '../internal/sort';\nimport { entityExists, isFunction, isUndefined, toBoolean } from '../internal/utils';\nimport { EntityStore } from './entity-store';\nimport { memoizeOne } from './memoize';\nimport { Query } from './query';\nimport { SortBy, SortByOptions } from './query-config';\nimport { ActiveState, EntityState, HashMap, ID } from './types';\n\nexport interface SelectOptions<E> extends SortByOptions<E> {\n  asObject?: boolean;\n  filterBy?: ((entity: E, index?: number) => boolean) | ((entity: E, index?: number) => boolean)[] | undefined;\n  limitTo?: number;\n}\n\n/**\n *  An abstraction for querying the entities from the store\n */\nexport class QueryEntity<S extends EntityState, E, ActiveEntity = ID> extends Query<S> {\n  protected store: EntityStore<S, E, ActiveEntity>;\n  private memoized;\n\n  /** Use only for internal plugins like Pagination - don't use this property **/\n  __store__;\n\n  constructor(store: EntityStore<S, E, ActiveEntity>) {\n    super(store);\n    this.__store__ = store;\n  }\n\n  /**\n   * Select the entire store's entity collection.\n   *\n   * @example\n   * this.store.selectAll();\n   */\n  selectAll(options: { asObject: true; filterBy?: SelectOptions<E>['filterBy']; limitTo?: number; sortBy?: undefined; sortByOrder?: undefined }): Observable<HashMap<E>>;\n  selectAll(options: { filterBy: SelectOptions<E>['filterBy']; limitTo?: number; sortBy?: SortBy<E>; sortByOrder?: Order }): Observable<E[]>;\n  selectAll(options: { asObject: true; limitTo?: number; sortBy?: undefined; sortByOrder?: undefined }): Observable<HashMap<E>>;\n  selectAll(options: { limitTo?: number; sortBy?: SortBy<E>; sortByOrder?: Order }): Observable<E[]>;\n  selectAll(options: { asObject: false; filterBy?: SelectOptions<E>['filterBy']; limitTo?: number; sortBy?: SortBy<E>; sortByOrder?: Order }): Observable<E[]>;\n  selectAll(): Observable<E[]>;\n  selectAll(\n    options: SelectOptions<E> = {\n      asObject: false\n    }\n  ): Observable<E[] | HashMap<E>> {\n    const selectState$ = this.select(state => state);\n    const selectEntities$ = this.select(state => state.entities);\n\n    this.sortByOptions(options);\n\n    return selectEntities$.pipe(\n      withLatestFrom(selectState$, (entities: HashMap<E>, state: S) => {\n        const { ids } = state;\n        if (options.asObject) {\n          return toMap(ids, entities, options);\n        } else {\n          if (!options.filterBy && !options.sortBy) {\n            if (!this.memoized) {\n              this.memoized = memoizeOne(toArray);\n            }\n            return this.memoized(state, options);\n          }\n\n          return toArray(state, options);\n        }\n      })\n    );\n  }\n\n  /**\n   * Get the entire store's entity collection.\n   *\n   * @example\n   * this.store.getAll();\n   */\n  getAll(options: { asObject: true; filterBy?: SelectOptions<E>['filterBy']; limitTo?: number; sortBy?: undefined; sortByOrder?: undefined }): HashMap<E>;\n  getAll(options: { filterBy: SelectOptions<E>['filterBy']; limitTo?: number; sortBy?: SortBy<E>; sortByOrder?: Order }): E[];\n  getAll(options: { asObject: true; limitTo?: number; sortBy?: undefined; sortByOrder?: undefined }): HashMap<E>;\n  getAll(options: { limitTo?: number; sortBy?: SortBy<E>; sortByOrder?: Order }): E[];\n  getAll(options: { asObject: false; filterBy?: SelectOptions<E>['filterBy']; limitTo?: number; sortBy?: SortBy<E>; sortByOrder?: Order }): E[];\n  getAll(): E[];\n  getAll(options: SelectOptions<E> = { asObject: false, filterBy: undefined, limitTo: undefined }): E[] | HashMap<E> {\n    const state = this.getSnapshot();\n\n    if (options.asObject) {\n      return toMap(state.ids, state.entities, options, true);\n    }\n\n    this.sortByOptions(options);\n\n    return toArray(state, options);\n  }\n\n  /**\n   * Select multiple entities from the store.\n   *\n   * @example\n   * this.store.selectMany([1,2]);\n   */\n  selectMany(ids: ActiveEntity[], options: { filterUndefined?: boolean } = {}): Observable<E[]> {\n    const filterUndefined = isUndefined(options.filterUndefined) ? true : options.filterUndefined;\n    const entities = ids.map(id => this.selectEntity(id));\n\n    return combineLatest(entities).pipe(\n      map(entities => {\n        return filterUndefined ? entities.filter(val => !isUndefined(val)) : entities;\n      }),\n      auditTime(0)\n    );\n  }\n\n  /**\n   * Select an entity or a slice of an entity.\n   *\n   * @example\n   * this.pagesStore.selectEntity(1)\n   * this.pagesStore.selectEntity(1, entity => entity.config.date)\n   *\n   */\n  selectEntity<R>(id: ActiveEntity): Observable<E>;\n  selectEntity<R>(id: ActiveEntity, project: (entity: E) => R): Observable<R>;\n  selectEntity<R>(id: ActiveEntity, project?: (entity: E) => R): Observable<R | E> {\n    if (!project) {\n      return this._byId(id);\n    }\n\n    return this.select(state => {\n      if (this.hasEntity(id)) {\n        return project(this.getEntity(id));\n      }\n\n      return undefined;\n    });\n  }\n\n  /**\n   * Get an entity by id\n   *\n   * @example\n   * this.store.getEntity(1);\n   */\n  getEntity(id: ActiveEntity): E {\n    return this.getSnapshot().entities[id as any];\n  }\n\n  /**\n   * Select the active entity's id.\n   */\n  selectActiveId(): Observable<ActiveEntity> {\n    return this.select(state => (state as S & ActiveState<ActiveEntity>).active);\n  }\n\n  /**\n   * Get the active id\n   */\n  getActiveId(): ActiveEntity {\n    return (this.getSnapshot() as S & ActiveState<ActiveEntity>).active;\n  }\n\n  /**\n   * Select the active entity.\n   */\n  selectActive<R>(): Observable<E>;\n  selectActive<R>(project: (entity: E) => R): Observable<R>;\n  selectActive<R>(project?: (entity: E) => R): Observable<R | E> {\n    return this.selectActiveId().pipe(switchMap(activeId => this.selectEntity(activeId, project)));\n  }\n\n  /**\n   * Get the active entity.\n   */\n  getActive(): E {\n    const activeId: ActiveEntity = this.getActiveId();\n    return toBoolean(activeId) ? this.getEntity(activeId) : undefined;\n  }\n\n  /**\n   * Select the store's entity collection length.\n   */\n  selectCount(predicate?: (entity: E, index: number) => boolean): Observable<number> {\n    if (isFunction(predicate)) {\n      return this.selectAll({\n        filterBy: predicate\n      }).pipe(map(entities => entities.length));\n    }\n\n    return this.select(store => store.ids.length);\n  }\n\n  /**\n   * Get the store's entity collection length.\n   */\n  getCount(predicate?: (entity: E, index: number) => boolean): number {\n    if (isFunction(predicate)) {\n      return this.getAll().filter(predicate).length;\n    }\n    return this.getSnapshot().ids.length;\n  }\n\n  /**\n   * Returns whether entity exists.\n   */\n  hasEntity(id: ActiveEntity): boolean;\n  hasEntity(id: ActiveEntity[]): boolean;\n  hasEntity(project: (entity: E) => boolean): boolean;\n  hasEntity(projectOrIds: ActiveEntity | ActiveEntity[] | ((entity: E) => boolean)): boolean {\n    if (isFunction(projectOrIds)) {\n      return this.getAll().some(projectOrIds);\n    }\n\n    if (Array.isArray(projectOrIds)) {\n      return projectOrIds.every(id => (id as any) in this.store.entities);\n    }\n\n    return (projectOrIds as any) in this.store.entities;\n  }\n\n  /**\n   * Returns whether entity store has an active entity.\n   */\n  hasActive(): boolean {\n    return this.getSnapshot().active != null;\n  }\n\n  isEmpty() {\n    return this.getSnapshot().ids.length === 0;\n  }\n\n  private _byId(id: ActiveEntity): Observable<E> {\n    return this.select(state => this.getEntity(id));\n  }\n\n  private sortByOptions(options) {\n    options.sortBy = options.sortBy || (this.config && (this.config.sortBy as SortBy<E>));\n    options.sortByOrder = options.sortByOrder || (this.config && this.config.sortByOrder);\n  }\n\n  ngOnDestroy() {\n    this.memoized = null;\n  }\n}\n\nfunction toArray<E, S extends EntityState>(state: S, options: SelectOptions<E>): E[] {\n  let arr = [];\n  const { ids, entities } = state;\n  const { filterBy, limitTo, sortBy, sortByOrder } = options;\n\n  for (let i = 0; i < ids.length; i++) {\n    const id = ids[i];\n\n    if (!entityExists(id, entities)) {\n      continue;\n    }\n\n    if (!filterBy) {\n      arr.push(entities[id]);\n      continue;\n    }\n\n    if (Array.isArray(filterBy)) {\n      const allPass = filterBy.every(fn => fn(entities[id], i));\n      if (allPass) {\n        arr.push(entities[id]);\n      }\n    } else {\n      if (filterBy(entities[id], i)) {\n        arr.push(entities[id]);\n      }\n    }\n  }\n\n  if (sortBy) {\n    let _sortBy: any = isFunction(sortBy) ? sortBy : compareValues(sortBy, sortByOrder);\n    arr = arr.sort((a, b) => _sortBy(a, b, state));\n  }\n  const length = Math.min(limitTo || arr.length, arr.length);\n\n  return length === arr.length ? arr : arr.slice(0, length);\n}\n\nfunction toMap<E>(ids: any[], entities: HashMap<E>, options: SelectOptions<E>, get = false): HashMap<E> {\n  const map = {};\n  const { filterBy, limitTo } = options;\n\n  if (get && !filterBy && !limitTo) {\n    return entities;\n  }\n\n  const length = Math.min(limitTo || ids.length, ids.length);\n\n  if (filterBy && isUndefined(limitTo) === false) {\n    let count = 0;\n    for (let i = 0, length = ids.length; i < length; i++) {\n      if (count === limitTo) break;\n      const id = ids[i];\n      if (!entityExists(id, entities)) {\n        continue;\n      }\n      if (Array.isArray(filterBy)) {\n        const allPass = filterBy.every(fn => fn(entities[id], i));\n        if (allPass) {\n          map[id] = entities[id];\n          count++;\n        }\n      } else {\n        if (filterBy(entities[id], i)) {\n          map[id] = entities[id];\n          count++;\n        }\n      }\n    }\n  } else {\n    for (let i = 0; i < length; i++) {\n      const id = ids[i];\n\n      if (!entityExists(id, entities)) {\n        continue;\n      }\n\n      if (!filterBy) {\n        map[id] = entities[id];\n        continue;\n      }\n\n      if (Array.isArray(filterBy)) {\n        const allPass = filterBy.every(fn => fn(entities[id], i));\n        if (allPass) {\n          map[id] = entities[id];\n        }\n      } else {\n        if (filterBy(entities[id], i)) {\n          map[id] = entities[id];\n        }\n      }\n    }\n  }\n\n  return map;\n}\n","import { endBatch, startBatch } from '../internal/transaction.internal';\n\n/**\n *  A logical transaction.\n *  Use this transaction to optimize the dispatch of all the stores.\n *  The following code will update the store, BUT  emits only once\n *\n *  @example\n *  applyTransaction(() => {\n *    this.todosStore.add(new Todo(1, title));\n *    this.todosStore.add(new Todo(2, title));\n *  });\n *\n */\nexport function applyTransaction<T>(action: () => T, thisArg = undefined): T {\n  startBatch();\n  try {\n    return action.apply(thisArg);\n  } finally {\n    endBatch();\n  }\n}\n\n/**\n *  A logical transaction.\n *  Use this transaction to optimize the dispatch of all the stores.\n *\n *  The following code will update the store, BUT  emits only once.\n *\n *  @example\n *  @transaction\n *  addTodos() {\n *    this.todosStore.add(new Todo(1, title));\n *    this.todosStore.add(new Todo(2, title));\n *  }\n *\n *\n */\nexport function transaction() {\n  return function(target: any, propertyKey: string, descriptor: PropertyDescriptor) {\n    const originalMethod = descriptor.value;\n\n    descriptor.value = function(...args) {\n      return applyTransaction(() => {\n        return originalMethod.apply(this, args);\n      }, this);\n    };\n\n    return descriptor;\n  };\n}\n","import { isObject } from '../internal/utils';\n\n// https://github.com/georapbox/immutable-arrays\n\n/**\n * Adds one or more elements to the end of an array by returning\n * a new array instead of mutating the original one.\n *\n * @example\n * const originalArray = ['a', 'b', 'c', 'd', 'e'];\n * const resultArray = push(originalArray, 'f', 'g');\n * // -> originalArray ['a', 'b', 'c', 'd', 'e']\n * // -> resultArray ['a', 'b', 'c', 'd', 'e', 'f', 'g']\n */\nexport function push<T>(array: T[], ...elementN: T[]): T[] {\n  return [...array, ...elementN];\n}\n\n/**\n * Deletes an element from an array by its index in the array.\n *\n * @example\n * const originalArray = ['a', 'b', 'c', 'd', 'e'];\n * const resultArray = remove(originalArray, 2);\n * // -> originalArray ['a', 'b', 'c', 'd', 'e']\n * // -> resultArray ['a', 'b', 'd', 'e']\n */\nexport function remove<T>(array: T[], index: number): T[] {\n  return index >= 0 ? [...array.slice(0, index), ...array.slice(index + 1)] : [...array];\n}\n\n/**\n * Removes the last element from an array by returning\n * a new array instead of mutating the original one.\n *\n * @example\n * const originalArray = ['a', 'b', 'c', 'd', 'e'];\n * const resultArray = pop(originalArray);\n * // -> originalArray ['a', 'b', 'c', 'd', 'e']\n * // -> resultArray ['a', 'b', 'c', 'd']\n */\nexport function pop<T>(array: T[]): T[] {\n  return array.slice(0, -1);\n}\n\n/**\n * Adds one or more elements to the beginning of an array.\n *\n * @example\n * const originalArray = ['a', 'b', 'c', 'd', 'e'];\n * const resultArray = unshift(originalArray, 'f', 'g');\n * // -> originalArray ['a', 'b', 'c', 'd', 'e']\n * // -> resultArray ['f', 'g', 'a', 'b', 'c', 'd', 'e']\n */\nexport function unshift<T>(array: T[], ...elementN: T[]): T[] {\n  return [...elementN, ...array];\n}\n\n/**\n * Sorts the elements of an array (not in place) and returns a sorted array.\n *\n * @example\n * const numberArray = [20, 3, 4, 10, -3, 1, 0, 5];\n * const stringArray = ['Blue', 'Humpback', 'Beluga'];\n *\n * const resultArray = sort(numberArray, (a, b) => a - b);\n * // -> numberArray [20, 3, 4, 10, -3, 1, 0, 5]\n * // -> resultArray [-3, 0, 1, 3, 4, 5, 10, 20]\n *\n * const resultArray = sort(numberArray, (a, b) => b - a);\n * // -> numberArray [20, 3, 4, 10, -3, 1, 0, 5]\n * // -> resultArray [20, 10, 5, 4, 3, 1, 0, -3]\n *\n * const resultArray = sort(stringArray);\n * // -> stringArray ['Blue', 'Humpback', 'Beluga']\n * // -> resultArray ['Beluga', 'Blue', 'Humpback']\n *\n * const resultArray = sort(stringArray, (a, b) => a.toLowerCase() < b.toLowerCase());\n * // -> stringArray ['Blue', 'Humpback', 'Beluga']\n * // -> resultArray ['Humpback', 'Blue', 'Beluga']\n */\nexport function sort<T>(array: T[], compareFunction?: (a: T, b: T) => number): T[] {\n  return [...array].sort(compareFunction);\n}\n\n/**\n * Reverses an array (not in place).\n * The first array element becomes the last, and the last array element becomes the first.\n *\n * @example\n * const originalArray = ['a', 'b', 'c', 'd', 'e'];\n * const resultArray = reverse(originalArray);\n * // -> originalArray ['a', 'b', 'c', 'd', 'e']\n * // -> resultArray ['e', 'd', 'c', 'b', 'a']\n */\nexport function reverse<T>(array: T[]): T[] {\n  return [...array].reverse();\n}\n\n/**\n * Swap items in the array\n *\n * @example\n * const originalArray = ['a', 'b', 'c', 'd', 'e'];\n * const resultArray = swap(originalArray, 1, 4);\n * // -> originalArray ['a', 'b', 'c', 'd', 'e']\n * // -> resultArray ['a', 'e', 'c', 'd', 'b']\n */\nexport function swap<T>(array: T[], firstIndex: number, secondIndex: number): T[] {\n  const results = array.slice();\n  const firstItem = array[firstIndex];\n  results[firstIndex] = array[secondIndex];\n  results[secondIndex] = firstItem;\n\n  return results;\n}\n\n/**\n * Update item in the array\n *\n * @example\n * const originalArray = ['a', 'b', 'c', 'd', 'e'];\n * const resultArray = update(originalArray, 1, 'newItem');\n * // -> resultArray ['a', 'newItem', 'c', 'd', 'b']\n *\n * const originalArray = [{title: 1}, {title: 2}];\n * const resultArray = update(originalArray, originalArray[0], {title: 3});\n * // -> resultArray  [{title: 3}, {title: 2}];\n */\nexport function update<T>(array: T[], indexOrItem: number | object, updated: T): T[] {\n  return array.map((current, idx) => {\n    if (typeof indexOrItem === 'number' && idx === indexOrItem) {\n      return updated;\n    }\n\n    if (isObject(indexOrItem) && (indexOrItem as any) === current) {\n      return {\n        ...(indexOrItem as object),\n        ...(updated as any)\n      };\n    }\n\n    return current;\n  });\n}\n\n/**\n * Removes existing elements and/or adds new elements to an array.\n *\n * @example\n * const originalArray = ['a', 'b', 'c', 'd', 'e'];\n * const resultArray = splice(originalArray, 0);\n * // -> originalArray ['a', 'b', 'c', 'd', 'e']\n * // -> resultArray []\n *\n * const originalArray = ['a', 'b', 'c', 'd', 'e'];\n * const resultArray = splice(originalArray, 0, 1);\n * // -> originalArray ['a', 'b', 'c', 'd', 'e']\n * // -> resultArray ['b', 'c', 'd', 'e']\n *\n * const originalArray = ['a', 'b', 'c', 'd', 'e'];\n * const resultArray = splice(originalArray, 0, 3);\n * // -> originalArray ['a', 'b', 'c', 'd', 'e']\n * // -> resultArray ['d', 'e']\n *\n * const originalArray = ['a', 'b', 'c', 'd', 'e'];\n * const resultArray = splice(originalArray, 0, originalArray.length);\n * // -> originalArray ['a', 'b', 'c', 'd', 'e']\n * // -> resultArray []\n *\n * const originalArray = ['a', 'b', 'c', 'd', 'e'];\n * const resultArray = splice(originalArray, 0, -3);\n * // -> originalArray ['a', 'b', 'c', 'd', 'e']\n * // -> resultArray ['a', 'b', 'c', 'd', 'e']\n *\n * const originalArray = ['a', 'b', 'c', 'd', 'e'];\n * const resultArray = splice(originalArray, 0, 0, 'lorem', 'ipsum');\n * // -> originalArray ['a', 'b', 'c', 'd', 'e']\n * // -> resultArray ['lorem', 'ipsum', 'a', 'b', 'c', 'd', 'e']\n *\n * const originalArray = ['a', 'b', 'c', 'd', 'e'];\n * const resultArray = splice(originalArray, originalArray.length, 0, 'lorem', 'ipsum');\n * // -> originalArray ['a', 'b', 'c', 'd', 'e']\n * // -> resultArray ['a', 'b', 'c', 'd', 'e', 'lorem', 'ipsum']\n *\n * const originalArray = ['a', 'b', 'c', 'd', 'e'];\n * const resultArray = splice(originalArray, 0, 2, 'lorem', 'ipsum');\n * // -> originalArray ['a', 'b', 'c', 'd', 'e']\n * // -> resultArray ['lorem', 'ipsum', 'c', 'd', 'e']\n *\n * const originalArray = ['a', 'b', 'c', 'd', 'e'];\n * const resultArray = splice(originalArray, originalArray.length - 2, 2, 'lorem', 'ipsum');\n * // -> originalArray ['a', 'b', 'c', 'd', 'e']\n * // -> resultArray ['a', 'b', 'c', 'lorem', 'ipsum']\n */\nexport function splice<T>(array: T[], start = array.length, deleteCount = array.length - start, ...elementN: T[]): T[] {\n  return [...array.slice(0, start), ...elementN, ...array.slice(start + (deleteCount < 0 ? 0 : deleteCount))];\n}\n\nexport function toggle<T>(arr: T[], item: T) {\n  return arr.indexOf(item) > -1 ? arr.filter(current => item !== current) : push(arr, item);\n}\n","/** Checks if value is null or undefined */\nimport { Observable } from 'rxjs';\nimport { filter } from 'rxjs/operators';\n\nexport const filterNil = <T>(source: Observable<T>) => source.pipe(filter(value => value !== null && typeof value !== 'undefined'));\n","import { Action, __globalState } from './global-state';\n\nexport function applyAction<T>(func: () => T, action: Action, thisArg = undefined): T {\n  __globalState.setCustomAction(action, true);\n  return func.apply(thisArg);\n}\n\nexport function action(action: Action, skipTransactionMsg = true) {\n  return function(target: any, propertyKey: string, descriptor: PropertyDescriptor) {\n    const originalMethod = descriptor.value;\n    descriptor.value = function(...args) {\n      __globalState.setCustomAction(action, skipTransactionMsg);\n      return originalMethod.apply(this, args);\n    };\n\n    return descriptor;\n  };\n}\n","import { Observable } from 'rxjs';\n\nfunction serialize(object) {\n  return JSON.stringify(object, function(key, value) {\n    if (typeof value === 'function') {\n      return value.toString();\n    }\n    return value;\n  });\n}\n\nfunction createWorker() {\n  const blob = new Blob(\n    [\n      `self.onmessage = function(e) {\n\n      function deserialize(str) {\n        return JSON.parse(str || '', function(key, value) {\n          if (value &&\n            typeof value === \"string\" &&\n            value.substr(0, 8) == \"function\") {\n            var startBody = value.indexOf('{') + 1;\n            var endBody = value.lastIndexOf('}');\n            var startArgs = value.indexOf('(') + 1;\n            var endArgs = value.indexOf(')');\n            return new Function(value.substring(startArgs, endArgs), value.substring(startBody, endBody));\n          }\n          return value;\n        });\n      }\n\n      var deserialized = deserialize(e.data);\n      var mapped = deserialized.data.map(function(d) {\n        return deserialized.factory(d);\n      });\n\n      self.postMessage(mapped);\n    }`\n    ],\n    {\n      type: 'text/javascript'\n    }\n  );\n\n  const url = URL.createObjectURL(blob);\n  return new Worker(url);\n}\n\n/**\n *  @example\n *   const mockTodos = Array.from({length: 10000}, (_, x) => ({id: x}));\n *\n *   of(mockTodos).pipe(mapInWorker<Todo>(createTodo))\n *   .subscribe(res => console.log(res));\n */\nexport function mapInWorker<T>(factoryFn: Function) {\n  return function(source): Observable<T[]> {\n    return new Observable(observer => {\n      const worker = createWorker();\n\n      worker.onmessage = function(e) {\n        observer.next(e.data);\n        observer.complete();\n        worker.terminate();\n      };\n\n      worker.onerror = function(err) {\n        observer.error(err);\n        observer.complete();\n        worker.terminate();\n      };\n\n      return source.subscribe(value => {\n        const input = {\n          factory: factoryFn,\n          data: value\n        };\n        const serialized = serialize(input);\n\n        worker.postMessage(serialized);\n      });\n    });\n  };\n}\n","import { __stores__ } from './store';\nimport { isString } from '../internal/utils';\n\nexport class SnapshotManager {\n  /**\n   * Get a snapshot of the whole state or a specific stores\n   * Use it ONLY for things like saving the state in the server\n   */\n  getStoresSnapshot(stores: string[] = []) {\n    let acc = {};\n    const hasInclude = stores.length > 0;\n    const keys = hasInclude ? stores : Object.keys(__stores__);\n    for (let i = 0; i < keys.length; i++) {\n      let storeName = keys[i];\n      acc[storeName] = __stores__[storeName]._value();\n    }\n\n    return acc;\n  }\n\n  /**\n   * Set snapshot we get from the server\n   */\n  setStoresSnapshot(stores: { [storeName: string]: any } | string) {\n    let normalizedStores = stores;\n    if (isString(stores)) {\n      normalizedStores = JSON.parse(normalizedStores as string);\n    }\n\n    for (let i = 0, keys = Object.keys(normalizedStores); i < keys.length; i++) {\n      const storeName = keys[i];\n      if (__stores__[storeName]) {\n        __stores__[storeName].setState(() => normalizedStores[storeName]);\n      }\n    }\n  }\n}\n\nexport const snapshotManager = new SnapshotManager();\n","import { QueryEntity } from '../api/query-entity';\nimport { Query } from '../api/query';\nimport { Observable } from 'rxjs';\nimport { filterNil } from '../api/operators';\nimport { toBoolean } from '../internal/utils';\nimport { ID } from '../api/types';\nimport { getAkitaConfig } from '../api/config';\n\nexport type Queries<E, S> = Query<S> | QueryEntity<S, E>;\n\nexport abstract class AkitaPlugin<E = any, S = any> {\n  protected constructor(protected query: Queries<E, S>, config?: { resetFn?: Function }) {\n    if (config && config.resetFn) {\n      if (getAkitaConfig().resettable) {\n        this.onReset(config.resetFn);\n      }\n    }\n  }\n\n  /** This method is responsible for getting access to the query. */\n  protected getQuery(): Queries<E, S> {\n    return this.query;\n  }\n\n  /** This method is responsible for getting access to the store. */\n  protected getStore() {\n    return this.getQuery().__store__;\n  }\n\n  /** This method is responsible for cleaning. */\n  public abstract destroy();\n\n  /** This method is responsible tells whether the plugin is entityBased or not.  */\n  protected isEntityBased(entityId: ID) {\n    return toBoolean(entityId);\n  }\n\n  /** This method is responsible for selecting the source; it can be the whole store or one entity. */\n  protected selectSource(entityId: ID): Observable<S | E> {\n    if (this.isEntityBased(entityId)) {\n      return (this.getQuery() as QueryEntity<S, E>).selectEntity(entityId).pipe(filterNil);\n    }\n\n    return (this.getQuery() as Query<S>).select(state => state);\n  }\n\n  protected getSource(entityId: ID): S | E {\n    if (this.isEntityBased(entityId)) {\n      return (this.getQuery() as QueryEntity<S, E>).getEntity(entityId);\n    }\n\n    return this.getQuery().getSnapshot();\n  }\n\n  /** This method is responsible for updating the store or one entity; it can be the whole store or one entity. */\n  protected updateStore(newState, entityId?) {\n    if (this.isEntityBased(entityId)) {\n      this.getStore().update(entityId, newState);\n    } else {\n      this.getStore().setState(state => ({ ...state, ...newState }));\n    }\n  }\n\n  /**\n   * Function to invoke upon reset\n   */\n  private onReset(fn: Function) {\n    const original = this.getStore().reset;\n    this.getStore().reset = (...params) => {\n      /** It should run after the plugin destroy method */\n      setTimeout(() => {\n        original.apply(this.getStore(), params);\n        fn();\n      });\n    };\n  }\n}\n","import { QueryEntity } from '../../api/query-entity';\nimport { delay, map, switchMap, take } from 'rxjs/operators';\nimport { BehaviorSubject, from, Observable, Subscription } from 'rxjs';\nimport { isObservable, isUndefined } from '../../internal/utils';\nimport { ID } from '../../api/types';\nimport { AkitaPlugin } from '../plugin';\nimport { applyTransaction } from '../../api/transaction';\nimport { action, applyAction } from '../../internal/action';\n\nexport interface PaginationResponse<E> {\n  currentPage: number;\n  perPage: number;\n  lastPage: number;\n  data: E[];\n  total?: number;\n  from?: number;\n  to?: number;\n  pageControls?: number[];\n}\n\nexport type PaginatorConfig = {\n  pagesControls?: boolean;\n  range?: boolean;\n  startWith?: number;\n  cacheTimeout?: Observable<number>;\n};\n\nconst paginatorDefaults: PaginatorConfig = {\n  pagesControls: false,\n  range: false,\n  startWith: 1,\n  cacheTimeout: undefined\n};\n\nexport class PaginatorPlugin<E> extends AkitaPlugin<E> {\n  /** Save current filters, sorting, etc. in cache */\n  metadata = new Map();\n\n  private page: BehaviorSubject<number>;\n  private pages = new Map<number, { ids: ID[] }>();\n  private readonly clearCacheSubscription: Subscription;\n\n  private pagination: PaginationResponse<E> = {\n    currentPage: 1,\n    perPage: 0,\n    total: 0,\n    lastPage: 0,\n    data: []\n  };\n\n  /**\n   * When the user navigates to a different page and return\n   * we don't want to call `clearCache` on first time.\n   */\n  private initial = false;\n\n  constructor(protected query: QueryEntity<any, E>, public config: PaginatorConfig = {}) {\n    super(query, {\n      resetFn: () => {\n        this.initial = false;\n        this.destroy({ clearCache: true, currentPage: 1 });\n      }\n    });\n    this.config = Object.assign(paginatorDefaults, config);\n    const { startWith, cacheTimeout } = this.config;\n    this.page = new BehaviorSubject(startWith);\n    if (isObservable(cacheTimeout)) {\n      this.clearCacheSubscription = cacheTimeout.subscribe(_ => this.clearCache());\n    }\n  }\n\n  /**\n   * Proxy to the query loading\n   */\n  isLoading$ = this.query.selectLoading().pipe(delay(0));\n\n  /**\n   * Listen to page changes\n   */\n  get pageChanges() {\n    return this.page.asObservable();\n  }\n\n  /**\n   * Get the current page number\n   */\n  get currentPage() {\n    return this.pagination.currentPage;\n  }\n\n  /**\n   * Check if current page is the first one\n   */\n  get isFirst() {\n    return this.currentPage === 1;\n  }\n\n  /**\n   * Check if current page is the last one\n   */\n  get isLast() {\n    return this.currentPage === this.pagination.lastPage;\n  }\n\n  /**\n   * Whether to generate an array of pages for *ngFor\n   * [1, 2, 3, 4]\n   */\n  withControls() {\n    this.config.pagesControls = true;\n    return this;\n  }\n\n  /**\n   * Whether to generate the `from` and `to` keys\n   * [1, 2, 3, 4]\n   */\n  withRange() {\n    this.config.range = true;\n    return this;\n  }\n\n  /**\n   * Set the loading state\n   */\n  setLoading(value = true) {\n    this.getStore().setLoading(value);\n  }\n\n  /**\n   * Update the pagination object and add the page\n   */\n  @action({ type: '@Pagination - New Page' }, true)\n  update(response: PaginationResponse<E>) {\n    this.pagination = response;\n    this.addPage(response.data);\n  }\n\n  /**\n   *\n   * Set the ids and add the page to store\n   */\n  addPage(data: E[]) {\n    this.pages.set(this.currentPage, { ids: data.map(entity => entity[this.getStore().idKey]) });\n    this.getStore().add(data);\n  }\n\n  /**\n   * Clear the cache.\n   */\n  clearCache() {\n    if (!this.initial) {\n      applyAction(\n        () => {\n          this.getStore().remove();\n        },\n        { type: '@Pagination - Clear Cache' }\n      );\n      this.pages = new Map();\n      this.metadata = new Map();\n    }\n    this.initial = false;\n  }\n\n  clearPage(page: number) {\n    this.pages.delete(page);\n  }\n\n  /**\n   * Clear the cache timeout and optionally the pages\n   */\n  destroy({ clearCache, currentPage }: { clearCache?: boolean; currentPage?: number } = {}) {\n    if (this.clearCacheSubscription) {\n      this.clearCacheSubscription.unsubscribe();\n    }\n    if (clearCache) {\n      this.clearCache();\n    }\n    if (!isUndefined(currentPage)) {\n      this.setPage(currentPage);\n    }\n    this.initial = true;\n  }\n\n  /**\n   * Whether the provided page is active\n   */\n  isPageActive(page: number) {\n    return this.currentPage === page;\n  }\n\n  /**\n   * Set the current page\n   */\n  setPage(page: number) {\n    if (page !== this.currentPage || !this.hasPage(page)) {\n      this.page.next((this.pagination.currentPage = page));\n    }\n  }\n\n  /**\n   * Increment current page\n   */\n  nextPage() {\n    if (this.currentPage !== this.pagination.lastPage) {\n      this.setPage(this.pagination.currentPage + 1);\n    }\n  }\n\n  /**\n   * Decrement current page\n   */\n  prevPage() {\n    if (this.pagination.currentPage > 1) {\n      this.setPage(this.pagination.currentPage - 1);\n    }\n  }\n\n  /**\n   * Set current page to last\n   */\n  setLastPage() {\n    this.setPage(this.pagination.lastPage);\n  }\n\n  /**\n   * Set current page to first\n   */\n  setFirstPage() {\n    this.setPage(1);\n  }\n\n  /**\n   * Check if page exists in cache\n   */\n  hasPage(page: number) {\n    return this.pages.has(page);\n  }\n\n  /**\n   * Get the current page if it's in cache, otherwise invoke the request\n   */\n  getPage(req: () => Observable<PaginationResponse<E>>) {\n    const page = this.pagination.currentPage;\n    if (this.hasPage(page)) {\n      return this.selectPage(page);\n    } else {\n      this.setLoading(true);\n      return from(req()).pipe(\n        switchMap((config: PaginationResponse<E>) => {\n          applyTransaction(() => {\n            this.setLoading(false);\n            this.update(config);\n          });\n          return this.selectPage(page);\n        })\n      );\n    }\n  }\n\n  getQuery(): QueryEntity<any, E> {\n    return this.query;\n  }\n\n  private getFrom() {\n    if (this.isFirst) {\n      return 1;\n    }\n    return (this.currentPage - 1) * this.pagination.perPage + 1;\n  }\n\n  private getTo() {\n    return this.currentPage * this.pagination.perPage;\n  }\n\n  /**\n   * Select the page\n   */\n  private selectPage(page: number): Observable<PaginationResponse<E>> {\n    return this.query.selectAll({ asObject: true }).pipe(\n      take(1),\n      map(entities => {\n        let response: PaginationResponse<E> = {\n          ...this.pagination,\n          data: this.pages.get(page).ids.map(id => entities[id])\n        };\n\n        const { range, pagesControls } = this.config;\n\n        /** If no total - calc it */\n        if (isNaN(this.pagination.total)) {\n          if (response.lastPage === 1) {\n            response.total = response.data ? response.data.length : 0;\n          } else {\n            response.total = response.perPage * response.lastPage;\n          }\n          this.pagination.total = response.total;\n        }\n\n        if (range) {\n          response.from = this.getFrom();\n          response.to = this.getTo();\n        }\n\n        if (pagesControls) {\n          response.pageControls = generatePages(this.pagination.total, this.pagination.perPage);\n        }\n\n        return response;\n      })\n    );\n  }\n}\n\n/**\n * Generate an array so we can ngFor them to navigate between pages\n */\nfunction generatePages(total: number, perPage: number) {\n  const len = Math.ceil(total / perPage);\n  let arr = [];\n  for (let i = 0; i < len; i++) {\n    arr.push(i + 1);\n  }\n  return arr;\n}\n\n/** backward compatibility */\nexport const Paginator = PaginatorPlugin;\n","import { AkitaPlugin } from '../plugin';\nimport { Query } from '../../api/query';\nimport { Observable, Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\nimport { __globalState } from '../../internal/global-state';\nimport { getValue, isString, setValue, toBoolean } from '../../internal/utils';\n\nexport type FormGroupLike = {\n  patchValue: Function;\n  setValue: Function;\n  value: any;\n  get: Function;\n  valueChanges: Observable<any>;\n  controls: any;\n};\n\nexport type AkitaFormProp<T> = {\n  [key: string]: T;\n};\n\nexport type PersistFormParams = {\n  debounceTime?: number;\n  formKey?: string;\n  emitEvent?: boolean;\n  arrControlFactory?: ArrayControlFactory;\n};\n\nexport type ArrayControlFactory = (value: any) => any; // Todo: Return  AbstractControl interface\n\nexport class PersistNgFormPlugin<T = any> extends AkitaPlugin {\n  formChanges: Subscription;\n  private isRootKeys: boolean;\n  private form: FormGroupLike;\n  private isKeyBased: boolean;\n  private initialValue;\n  private builder;\n\n  constructor(protected query: Query<any>, private factoryFnOrPath?: Function | string, private params: PersistFormParams = {}) {\n    super(query);\n    this.params = { ...{ debounceTime: 300, formKey: 'akitaForm', emitEvent: false, arrControlFactory: v => this.builder.control(v) }, ...params };\n    this.isRootKeys = toBoolean(factoryFnOrPath) === false;\n    this.isKeyBased = isString(factoryFnOrPath) || this.isRootKeys;\n  }\n\n  setForm(form: FormGroupLike, builder?) {\n    this.form = form;\n    this.builder = builder;\n    this.activate();\n    return this;\n  }\n\n  reset(initialState?: T) {\n    let value;\n    if (initialState) {\n      value = initialState;\n    } else {\n      value = this.isKeyBased ? this.initialValue : (this as any).factoryFnOrPath();\n    }\n\n    if (this.isKeyBased) {\n      Object.keys(this.initialValue).forEach(stateKey => {\n        const value = this.initialValue[stateKey];\n        if (Array.isArray(value) && this.builder) {\n          const formArray = this.form.controls[stateKey];\n          this.cleanArray(formArray);\n          value.forEach((v, i) => {\n            this.form.get(stateKey).insert(i, (this.params.arrControlFactory as Function)(v));\n          });\n        }\n      });\n    }\n    this.form.patchValue(value, { emitEvent: this.params.emitEvent });\n\n    const storeValue = this.isKeyBased ? setValue(this.getQuery().getSnapshot(), `${this.getStore().storeName}.${this.factoryFnOrPath}`, value) : { [this.params.formKey]: value };\n    this.updateStore(storeValue);\n  }\n\n  private cleanArray(control) {\n    while (control.length !== 0) {\n      control.removeAt(0);\n    }\n  }\n\n  private resolveInitialValue(formValue, root) {\n    if (!formValue) return;\n    return Object.keys(formValue).reduce((acc, stateKey) => {\n      const value = root[stateKey];\n      if (Array.isArray(value) && this.builder) {\n        const factory = this.params.arrControlFactory;\n        this.cleanArray(this.form.get(stateKey));\n        value.forEach((v, i) => {\n          this.form.get(stateKey).insert(i, (factory as Function)(v));\n        });\n      }\n      acc[stateKey] = root[stateKey];\n      return acc;\n    }, {});\n  }\n\n  private activate() {\n    let path;\n\n    if (this.isKeyBased) {\n      if (this.isRootKeys) {\n        this.initialValue = this.resolveInitialValue(this.form.value, this.getQuery().getSnapshot());\n        this.form.patchValue(this.initialValue, { emitEvent: this.params.emitEvent });\n      } else {\n        path = `${this.getStore().storeName}.${this.factoryFnOrPath}`;\n        const root = getValue(this.getQuery().getSnapshot(), path);\n        this.initialValue = this.resolveInitialValue(root, root);\n        this.form.patchValue(this.initialValue, { emitEvent: this.params.emitEvent });\n      }\n    } else {\n      if (!(this.getQuery().getSnapshot() as AkitaFormProp<T>)[this.params.formKey]) {\n        __globalState.setAction({ type: '@PersistNgFormPlugin activate' });\n        this.updateStore({ [this.params.formKey]: (this as any).factoryFnOrPath() });\n      }\n\n      const value = this.getQuery().getSnapshot()[this.params.formKey];\n      this.form.patchValue(value);\n    }\n\n    this.formChanges = this.form.valueChanges.pipe(debounceTime(this.params.debounceTime)).subscribe(value => {\n      __globalState.setAction({ type: '@PersistForm - Update' });\n      let newState;\n      if (this.isKeyBased) {\n        if (this.isRootKeys) {\n          newState = state => ({ ...state, ...value });\n        } else {\n          newState = state => setValue(state, path, value);\n        }\n      } else {\n        newState = () => ({ [this.params.formKey]: value });\n      }\n      this.updateStore(newState(this.getQuery().getSnapshot()));\n    });\n  }\n\n  destroy() {\n    this.formChanges && this.formChanges.unsubscribe();\n    this.form = null;\n    this.builder = null;\n  }\n}\n","import { AkitaError } from '../internal/error';\nimport { __stores__, Actions, rootDispatcher } from '../api/store';\nimport { skip, filter } from 'rxjs/operators';\nimport { getValue, setValue } from '../internal/utils';\nimport { __globalState } from '../internal/global-state';\n\nconst notBs = typeof localStorage === 'undefined';\n\nexport interface PersistStateParams {\n  /** The storage key */\n  key: string;\n  /** Storage strategy to use. This defaults to LocalStorage but you can pass SessionStorage or anything that implements the StorageEngine API. */\n  storage: Storage;\n  /** Custom deserializer. Defaults to JSON.parse */\n  deserialize: Function;\n  /** Custom serializer, defaults to JSON.stringify */\n  serialize: Function;\n  /**\n   * By default the whole state is saved to storage, use this param to include only the stores you need.\n   * Pay attention that you can't use both include and exclude\n   */\n  include: string[];\n  /**\n   *  By default the whole state is saved to storage, use this param to exclude stores that you don't need.\n   *  Pay attention that you can't use both include and exclude\n   */\n  exclude: string[];\n}\n\nexport function persistState(params?: Partial<PersistStateParams>) {\n  if (notBs) return;\n\n  const defaults: PersistStateParams = {\n    key: 'AkitaStores',\n    storage: localStorage,\n    deserialize: JSON.parse,\n    serialize: JSON.stringify,\n    include: [],\n    exclude: []\n  };\n  const { storage, deserialize, serialize, include, exclude, key } = Object.assign({}, defaults, params);\n\n  const hasInclude = include.length > 0;\n  const hasExclude = exclude.length > 0;\n  let includeStores;\n\n  if (hasInclude && hasExclude) {\n    throw new AkitaError(\"You can't use both include and exclude\");\n  }\n\n  if (hasInclude) {\n    includeStores = include.reduce((acc, path) => {\n      const storeName = path.split('.')[0];\n      acc[storeName] = path;\n      return acc;\n    }, {});\n  }\n\n  const storageState = deserialize(storage.getItem(key) || '{}');\n\n  let stores = {};\n  let acc = {};\n\n  function save() {\n    storage.setItem(key, serialize(Object.assign({}, storageState, acc)));\n  }\n\n  function subscribe(storeName, path) {\n    stores[storeName] = __stores__[storeName]\n      ._select(state => getValue(state, path))\n      .pipe(skip(1))\n      .subscribe(data => {\n        acc[storeName] = data;\n        save();\n      });\n  }\n\n  function setInitial(storeName, store, path) {\n    if (storageState[storeName]) {\n      __globalState.setAction({ type: '@PersistState' });\n      store.setState(state => {\n        return setValue(state, path, storageState[storeName]);\n      });\n      if (store.setDirty) {\n        store.setDirty();\n      }\n    }\n  }\n\n  const subscription = rootDispatcher.pipe(filter(action => action.type === Actions.NEW_STORE)).subscribe(action => {\n    let currentStoreName = action.payload.store.storeName;\n\n    if (hasExclude && exclude.includes(currentStoreName)) {\n      return;\n    }\n\n    if (hasInclude) {\n      const path = includeStores[currentStoreName];\n      if (!path) {\n        return;\n      }\n      setInitial(currentStoreName, action.payload.store, path);\n      subscribe(currentStoreName, path);\n    } else {\n      setInitial(currentStoreName, action.payload.store, currentStoreName);\n      subscribe(currentStoreName, currentStoreName);\n    }\n  });\n\n  return {\n    destroy() {\n      subscription.unsubscribe();\n      for (let i = 0, keys = Object.keys(stores); i < keys.length; i++) {\n        const storeName = keys[i];\n        stores[storeName].unsubscribe();\n      }\n      stores = {};\n    },\n    clear() {\n      storage.clear();\n    },\n    clearStore(storeName: string) {\n      const storageState = deserialize(storage.getItem(key) || '{}');\n\n      if (storageState[storeName]) {\n        delete storageState[storeName];\n        storage.setItem(key, serialize(storageState));\n      }\n    }\n  };\n}\n","import { __stores__, Actions, rootDispatcher } from '../api/store';\nimport { __globalState } from '../internal/global-state';\nimport { isDefined } from '../internal/utils';\n\nexport type DevtoolsOptions = {\n  /**  maximum allowed actions to be stored in the history tree */\n  maxAge: number;\n  latency: number;\n  actionsBlacklist: string[];\n  actionsWhitelist: string[];\n  shouldCatchErrors: boolean;\n  logTrace: boolean;\n  predicate: (state: any, action: any) => boolean;\n};\nlet rootDispatcherSub, devtoolsSub;\n\nexport type NgZoneLike = { run: any };\n\nexport function akitaDevtools(ngZone: NgZoneLike, options?: Partial<DevtoolsOptions>);\nexport function akitaDevtools(options?: Partial<DevtoolsOptions>);\nexport function akitaDevtools(ngZoneOrOptions?: NgZoneLike | Partial<DevtoolsOptions>, options: Partial<DevtoolsOptions> = {}) {\n  if (!(window as any).__REDUX_DEVTOOLS_EXTENSION__) {\n    return;\n  }\n\n  rootDispatcherSub && rootDispatcherSub.unsubscribe();\n  devtoolsSub && devtoolsSub();\n\n  const isAngular = ngZoneOrOptions && ngZoneOrOptions['run'];\n\n  if (!isAngular) {\n    ngZoneOrOptions = ngZoneOrOptions || {};\n    (ngZoneOrOptions as any).run = cb => cb();\n    options = ngZoneOrOptions as Partial<DevtoolsOptions>;\n  }\n\n  const defaultOptions: Partial<DevtoolsOptions> & { name: string } = { name: 'Akita' };\n  const merged = Object.assign({}, defaultOptions, options);\n\n  const devTools = (window as any).__REDUX_DEVTOOLS_EXTENSION__.connect(merged);\n  let appState = {};\n\n  rootDispatcherSub = rootDispatcher.subscribe(action => {\n    if (action.type === Actions.DELETE_STORE) {\n      const storeName = action.payload.storeName;\n      delete appState[storeName];\n      devTools.send({ type: `[${storeName}] - Delete Store` }, appState);\n    }\n\n    if (action.type === Actions.NEW_STATE) {\n      if (__globalState.skipAction) {\n        __globalState.setSkipAction(false);\n        return;\n      }\n\n      appState = {\n        ...appState,\n        [action.payload.name]: __stores__[action.payload.name]._value()\n      };\n\n      const { type, entityId } = __globalState.currentAction;\n      const storeName = capitalize(action.payload.name);\n      let msg = isDefined(entityId) ? `[${storeName}] - ${type} (ids: ${entityId})` : `[${storeName}] - ${type}`;\n\n      if (options.logTrace) {\n        console.group(msg);\n        console.trace();\n        console.groupEnd();\n      }\n\n      devTools.send({ type: msg, transaction: __globalState.currentT.map(t => t.type) }, appState);\n    }\n  });\n\n  devtoolsSub = devTools.subscribe(message => {\n    if (message.type === 'ACTION') {\n      const [storeName] = message.payload.split('.');\n\n      if (__stores__[storeName]) {\n        (ngZoneOrOptions as NgZoneLike).run(() => {\n          const funcCall = message.payload.replace(storeName, `this['${storeName}']`);\n          try {\n            new Function(`${funcCall}`).call(__stores__);\n          } catch (e) {\n            console.warn('Unknown Method â¹ï¸');\n          }\n        });\n      }\n    }\n\n    if (message.type === 'DISPATCH') {\n      const payloadType = message.payload.type;\n\n      if (payloadType === 'COMMIT') {\n        devTools.init(appState);\n        return;\n      }\n\n      if (message.state) {\n        const rootState = JSON.parse(message.state);\n        for (let i = 0, keys = Object.keys(rootState); i < keys.length; i++) {\n          const storeName = keys[i];\n          if (__stores__[storeName]) {\n            (ngZoneOrOptions as NgZoneLike).run(() => {\n              __stores__[storeName].setState(() => rootState[storeName], false);\n            });\n          }\n        }\n      }\n    }\n  });\n}\n\nfunction capitalize(string) {\n  return string && string.charAt(0).toUpperCase() + string.slice(1);\n}\n","import {coerceArray, isFunction, isUndefined, toBoolean} from '../internal/utils';\nimport {QueryEntity} from '../api/query-entity';\nimport {ID, IDS} from '../api/types';\nimport {Observable} from 'rxjs';\n\n/**\n * Each plugin that wants to add support for entities should extend this interface.\n */\nexport type EntityParam = ID;\n\nexport type EntityCollectionParams = ID | ID[];\n\nexport type RebaseActions<P = any> = { beforeRemove?: Function; beforeAdd?: Function; afterAdd?: (plugin: P) => any; };\n\nconst defaultActions: RebaseActions = {beforeRemove: plugin => plugin.destroy()};\n\nexport abstract class EntityCollectionPlugin<E, P> {\n  protected entities = new Map<ID, P>();\n\n  protected constructor(protected query: QueryEntity<any, E>, private entityIds: EntityCollectionParams) {}\n\n  /**\n   * Get the entity plugin instance.\n   */\n  protected getEntity(id: ID): P {\n    return this.entities.get(id);\n  }\n\n  /**\n   * Whether the entity plugin exist.\n   */\n  protected hasEntity(id: ID): boolean {\n    return this.entities.has(id);\n  }\n\n  /**\n   * Remove the entity plugin instance.\n   */\n  protected removeEntity(id: ID) {\n    return this.entities.delete(id);\n  }\n\n  /**\n   * Set the entity plugin instance.\n   */\n  protected createEntity(id: ID, plugin: P) {\n    return this.entities.set(id, plugin);\n  }\n\n  /**\n   * If the user passes `entityIds` we take them; otherwise, we take all.\n   */\n  protected getIds(): ID[] {\n    return isUndefined(this.entityIds) ? this.query.getSnapshot().ids : coerceArray(this.entityIds);\n  }\n\n  /**\n   * When you call one of the plugin methods, you can pass id/ids or undefined which means all.\n   */\n  protected resolvedIds(ids?): ID[] {\n    return isUndefined(ids) ? this.getIds() : coerceArray(ids);\n  }\n\n  /**\n   * Call this method when you want to activate the plugin on init or when you need to listen to add/remove of entities dynamically.\n   *\n   * For example in your plugin you may do the following:\n   *\n   * this.query.select(state => state.ids).pipe(skip(1)).subscribe(ids => this.activate(ids));\n   */\n  protected rebase(ids: ID[], actions: RebaseActions<P> = defaultActions) {\n    /**\n     *\n     * If the user passes `entityIds` & we have new ids check if we need to add/remove instances.\n     *\n     * This phase will be called only upon update.\n     */\n    if (toBoolean(ids)) {\n      /**\n       * Which means all\n       */\n      if (isUndefined(this.entityIds)) {\n        for (let i = 0, len = ids.length; i < len; i++) {\n          const entityId = ids[i];\n          if (this.hasEntity(entityId) === false) {\n            isFunction(actions.beforeAdd) && actions.beforeAdd(entityId);\n            const plugin = this.instantiatePlugin(entityId);\n            this.entities.set(entityId, plugin);\n            isFunction(actions.afterAdd) && actions.afterAdd(plugin);\n          }\n        }\n\n        this.entities.forEach((plugin, entityId) => {\n          if (ids.indexOf(entityId) === -1) {\n            isFunction(actions.beforeRemove) && actions.beforeRemove(plugin);\n            this.removeEntity(entityId);\n          }\n        });\n      } else {\n        /**\n         * Which means the user passes specific ids\n         */\n        const _ids = coerceArray(this.entityIds);\n        for (let i = 0, len = _ids.length; i < len; i++) {\n          const entityId = _ids[i];\n          /** The Entity in current ids and doesn't exist, add it. */\n          if (ids.indexOf(entityId) > -1 && this.hasEntity(entityId) === false) {\n            isFunction(actions.beforeAdd) && actions.beforeAdd(entityId);\n            const plugin = this.instantiatePlugin(entityId);\n            this.entities.set(entityId, plugin);\n            isFunction(actions.afterAdd) && actions.afterAdd(plugin);\n          } else {\n            this.entities.forEach((plugin, entityId) => {\n              /** The Entity not in current ids and exists, remove it. */\n              if (ids.indexOf(entityId) === -1 && this.hasEntity(entityId) === true) {\n                isFunction(actions.beforeRemove) && actions.beforeRemove(plugin);\n                this.removeEntity(entityId);\n              }\n            });\n          }\n        }\n      }\n    } else {\n      /**\n       * Otherwise, start with the provided ids or all.\n       */\n      this.getIds().forEach(id => {\n        if (!this.hasEntity(id)) this.createEntity(id, this.instantiatePlugin(id))\n      });\n    }\n  }\n\n  /**\n   * Listen for add/remove entities.\n   */\n  protected selectIds(): Observable<ID[]> {\n    return this.query.select(state => state.ids);\n  }\n\n  /**\n   * Base method for activation, you can override it if you need to.\n   */\n  protected activate(ids?: ID[]) {\n    this.rebase(ids);\n  }\n\n  /**\n   * This method is responsible for plugin instantiation.\n   *\n   * For example:\n   * return new StateHistory(this.query, this.params, id) as P;\n   */\n  protected abstract instantiatePlugin(id: ID): P;\n\n  /**\n   * This method is responsible for cleaning.\n   */\n  public abstract destroy(id?: ID);\n\n  /**\n   * Loop over each id and invoke the plugin method.\n   */\n  protected forEachId(ids: IDS, cb: (entity: P) => any) {\n    const _ids = this.resolvedIds(ids);\n\n    for (let i = 0, len = _ids.length; i < len; i++) {\n      const id = _ids[i];\n      if (this.hasEntity(id)) {\n        cb(this.getEntity(id));\n      }\n    }\n  }\n}\n","import { filter, pairwise } from 'rxjs/operators';\nimport { __globalState } from '../../internal/global-state';\nimport { toBoolean } from '../../internal/utils';\nimport { AkitaPlugin, Queries } from '../plugin';\nimport { EntityParam } from '../entity-collection-plugin';\n\nexport interface StateHistoryParams {\n  maxAge?: number;\n}\n\nexport class StateHistoryPlugin<E = any, S = any> extends AkitaPlugin<E, S> {\n  /** Allow skipping an update from outside */\n  private skip = false;\n\n  private history = {\n    past: [],\n    present: null,\n    future: []\n  };\n\n  /** Skip the update when redo/undo */\n  private skipUpdate = false;\n  private subscription;\n\n  constructor(protected query: Queries<E, S>, private params: StateHistoryParams = {}, private _entityId?: EntityParam) {\n    super(query, {\n      resetFn: () => this.clear()\n    });\n    params.maxAge = toBoolean(params.maxAge) ? params.maxAge : 10;\n    this.activate();\n  }\n\n  get hasPast() {\n    return this.history.past.length > 0;\n  }\n\n  get hasFuture() {\n    return this.history.future.length > 0;\n  }\n\n  activate() {\n    this.history.present = this.getSource(this._entityId);\n    this.subscription = this.selectSource(this._entityId)\n      .pipe(pairwise())\n      .subscribe(([past, present]) => {\n        if (this.skip) {\n          this.skip = false;\n          return;\n        }\n        if (!this.skipUpdate) {\n          if (this.history.past.length === this.params.maxAge) {\n            this.history.past = this.history.past.slice(1);\n          }\n          this.history.past = [...this.history.past, past];\n          this.history.present = present;\n        }\n      });\n  }\n\n  undo() {\n    if (this.history.past.length > 0) {\n      const { past, present, future } = this.history;\n      const previous = past[past.length - 1];\n      const newPast = past.slice(0, past.length - 1);\n\n      this.history.past = newPast;\n      this.history.present = previous;\n      this.history.future = [present, ...this.history.future];\n      this.update();\n    }\n  }\n\n  redo() {\n    if (this.history.future.length > 0) {\n      const { past, present, future } = this.history;\n      const next = this.history.future[0];\n      const newFuture = this.history.future.slice(1);\n      this.history.past = [...past, present];\n      this.history.present = next;\n      this.history.future = newFuture;\n      this.update('Redo');\n    }\n  }\n\n  jumpToPast(index: number) {\n    if (index < 0 || index >= this.history.past.length) return;\n\n    const { past, future } = this.history;\n    /**\n     *\n     * const past = [1, 2, 3, 4, 5];\n     *\n     * newPast = past.slice(0, 2) = [1, 2];\n     * present = past[index] = 3;\n     * [...past.slice(2 + 1), ...future] = [4, 5];\n     *\n     */\n    const newPast = past.slice(0, index);\n    const newFuture = [...past.slice(index + 1), ...future];\n    const newPresent = past[index];\n    this.history.past = newPast;\n    this.history.present = newPresent;\n    this.history.future = newFuture;\n    this.update();\n  }\n\n  jumpToFuture(index: number) {\n    if (index < 0 || index >= this.history.future.length) return;\n\n    const { past, future } = this.history;\n\n    const newPast = [...past, ...future.slice(0, index)];\n    const newPresent = future[index];\n    const newFuture = future.slice(index + 1);\n\n    this.history.past = newPast;\n    this.history.present = newPresent;\n    this.history.future = newFuture;\n    this.update('Redo');\n  }\n\n  clear() {\n    this.history = {\n      past: [],\n      present: null,\n      future: []\n    };\n  }\n\n  destroy(clearHistory = false) {\n    if (clearHistory) {\n      this.clear();\n    }\n    this.subscription.unsubscribe();\n  }\n\n  ignoreNext() {\n    this.skip = true;\n  }\n\n  private update(action = 'Undo') {\n    this.skipUpdate = true;\n    __globalState.setCustomAction({ type: `@StateHistory - ${action}` });\n    this.updateStore(this.history.present, this._entityId);\n    this.skipUpdate = false;\n  }\n}\n","import { ID, IDS } from '../../api/types';\nimport { QueryEntity } from '../../api/query-entity';\nimport { StateHistoryPlugin, StateHistoryParams } from './state-history-plugin';\nimport { toBoolean } from '../../internal/utils';\nimport { skip } from 'rxjs/operators';\nimport { EntityCollectionPlugin, EntityCollectionParams } from '../entity-collection-plugin';\n\nexport interface StateHistoryEntityParams extends StateHistoryParams {\n  entityIds?: EntityCollectionParams;\n}\n\nexport class EntityStateHistoryPlugin<E, P extends StateHistoryPlugin<E, any> = StateHistoryPlugin<E, any>> extends EntityCollectionPlugin<E, P> {\n  constructor(protected query: QueryEntity<any, E>, protected readonly params: StateHistoryEntityParams = {}) {\n    super(query, params.entityIds);\n    params.maxAge = toBoolean(params.maxAge) ? params.maxAge : 10;\n    this.activate();\n    this.selectIds()\n      .pipe(skip(1))\n      .subscribe(ids => this.activate(ids));\n  }\n\n  redo(ids?: IDS) {\n    this.forEachId(ids, e => e.redo());\n  }\n\n  undo(ids?: IDS) {\n    this.forEachId(ids, e => e.undo());\n  }\n\n  hasPast(id: ID) {\n    if (this.hasEntity(id)) {\n      return this.getEntity(id).hasPast;\n    }\n  }\n\n  hasFuture(id: ID) {\n    if (this.hasEntity(id)) {\n      return this.getEntity(id).hasFuture;\n    }\n  }\n\n  jumpToFuture(ids: IDS, index: number) {\n    this.forEachId(ids, e => e.jumpToFuture(index));\n  }\n\n  jumpToPast(ids: IDS, index: number) {\n    this.forEachId(ids, e => e.jumpToPast(index));\n  }\n\n  clear(ids?: IDS) {\n    this.forEachId(ids, e => e.clear());\n  }\n\n  destroy(ids?: IDS, clearHistory = false) {\n    this.forEachId(ids, e => e.destroy(clearHistory));\n  }\n\n  ignoreNext(ids?: IDS) {\n    this.forEachId(ids, e => e.ignoreNext());\n  }\n\n  protected instantiatePlugin(id: ID) {\n    return new StateHistoryPlugin<E, any>(this.query, this.params, id) as P;\n  }\n}\n","import { AkitaPlugin, Queries } from '../plugin';\nimport { QueryEntity } from '../../api/query-entity';\nimport { BehaviorSubject, Observable, Subject, Subscription, combineLatest } from 'rxjs';\nimport { distinctUntilChanged, map, skip } from 'rxjs/operators';\nimport { coerceArray, isFunction, isUndefined, toBoolean } from '../../internal/utils';\nimport { EntityParam } from '../entity-collection-plugin';\nimport { __globalState } from '../../internal/global-state';\nimport { Query } from '../../api/query';\n\ntype Head<StoreState = any, Entity = any> = StoreState | Partial<StoreState> | Entity;\n\nexport type DirtyCheckComparator<Entity> = (head: Entity, current: Entity) => boolean;\n\nexport type DirtyCheckParams<StoreState = any> = {\n  comparator?: DirtyCheckComparator<StoreState>;\n  watchProperty?: keyof StoreState | (keyof StoreState)[];\n};\n\nexport const dirtyCheckDefaultParams = {\n  comparator: (head, current) => JSON.stringify(head) !== JSON.stringify(current)\n};\n\nexport function getNestedPath(nestedObj, path: string) {\n  const pathAsArray: string[] = path.split('.');\n  return pathAsArray.reduce((obj, key) => (obj && obj[key] !== 'undefined' ? obj[key] : undefined), nestedObj);\n}\n\nexport type DirtyCheckResetParams<StoreState = any> = {\n  updateFn?: StoreState | ((head: StoreState, current: StoreState) => any);\n};\n\nexport class DirtyCheckPlugin<Entity = any, StoreState = any> extends AkitaPlugin<Entity, StoreState> {\n  private head: Head<StoreState, Entity>;\n  private dirty = new BehaviorSubject(false);\n  private subscription: Subscription;\n  private active = false;\n  private _reset = new Subject();\n\n  isDirty$: Observable<boolean> = this.dirty.asObservable().pipe(distinctUntilChanged());\n  reset$ = this._reset.asObservable();\n\n  constructor(protected query: Queries<Entity, StoreState>, private params?: DirtyCheckParams, private _entityId?: EntityParam) {\n    super(query);\n    this.params = { ...dirtyCheckDefaultParams, ...params };\n    if (this.params.watchProperty) {\n      let watchProp = coerceArray(this.params.watchProperty) as any[];\n      if (query instanceof QueryEntity && watchProp.includes('entities') && !watchProp.includes('ids')) {\n        watchProp.push('ids');\n      }\n      this.params.watchProperty = watchProp;\n    }\n  }\n\n  reset(params: DirtyCheckResetParams = {}) {\n    let currentValue = this.head;\n    if (isFunction(params.updateFn)) {\n      if (this.isEntityBased(this._entityId)) {\n        currentValue = params.updateFn(this.head, (this.getQuery() as QueryEntity<StoreState, Entity>).getEntity(this._entityId));\n      } else {\n        currentValue = params.updateFn(this.head, (this.getQuery() as Query<StoreState>).getSnapshot());\n      }\n    }\n    __globalState.setCustomAction({ type: `@DirtyCheck - Revert` });\n    this.updateStore(currentValue, this._entityId);\n    this._reset.next();\n  }\n\n  setHead() {\n    if (!this.active) {\n      this.activate();\n      this.active = true;\n    } else {\n      this.head = this._getHead();\n    }\n    this.updateDirtiness(false);\n    return this;\n  }\n\n  isDirty(): boolean {\n    return toBoolean(this.dirty.value);\n  }\n\n  hasHead() {\n    return toBoolean(this.getHead());\n  }\n\n  destroy() {\n    this.head = null;\n    this.subscription && this.subscription.unsubscribe();\n    this._reset && this._reset.complete();\n  }\n\n  isPathDirty(path: string) {\n    const head = this.getHead();\n    const current = (this.getQuery() as Query<StoreState>).getSnapshot();\n    const currentPathValue = getNestedPath(current, path);\n    const headPathValue = getNestedPath(head, path);\n\n    return this.params.comparator(currentPathValue, headPathValue);\n  }\n\n  protected getHead() {\n    return this.head;\n  }\n\n  private activate() {\n    this.head = this._getHead();\n    /** if we are tracking specific properties select only the relevant ones */\n    const source = this.params.watchProperty\n      ? (this.params.watchProperty as (keyof StoreState)[]).map(prop =>\n          this.query.select(state => state[prop]).pipe(\n            map(val => ({\n              val,\n              __akitaKey: prop\n            }))\n          )\n        )\n      : [this.selectSource(this._entityId)];\n    this.subscription = combineLatest(...source)\n      .pipe(skip(1))\n      .subscribe((currentState: any[]) => {\n        if (isUndefined(this.head)) return;\n        /** __akitaKey is used to determine if we are tracking a specific property or a store change */\n        const isChange = currentState.some(state => {\n          const head = state.__akitaKey ? this.head[state.__akitaKey as any] : this.head;\n          const compareTo = state.__akitaKey ? state.val : state;\n\n          return this.params.comparator(head, compareTo);\n        });\n\n        this.updateDirtiness(isChange);\n      });\n  }\n\n  private updateDirtiness(isDirty: boolean) {\n    this.dirty.next(isDirty);\n  }\n\n  private _getHead(): Head<StoreState, Entity> {\n    let head: Head<StoreState, Entity> = this.getSource(this._entityId);\n    if (this.params.watchProperty) {\n      head = this.getWatchedValues(head as StoreState);\n    }\n    return head;\n  }\n\n  private getWatchedValues(source: StoreState): Partial<StoreState> {\n    return (this.params.watchProperty as (keyof StoreState)[]).reduce(\n      (watched, prop) => {\n        watched[prop] = source[prop];\n        return watched;\n      },\n      {} as Partial<StoreState>\n    );\n  }\n}\n","import { HashMap, ID, IDS } from '../../api/types';\nimport {\n  DirtyCheckComparator,\n  dirtyCheckDefaultParams,\n  DirtyCheckPlugin,\n  DirtyCheckResetParams,\n  getNestedPath\n} from './dirty-check-plugin';\nimport { QueryEntity } from '../../api/query-entity';\nimport { EntityCollectionPlugin } from '../entity-collection-plugin';\nimport { map, skip } from 'rxjs/operators';\nimport { Observable } from 'rxjs';\n\nexport type DirtyCheckCollectionParams<E> = {\n  comparator?: DirtyCheckComparator<E>;\n  entityIds?: ID | ID[];\n};\n\nexport class EntityDirtyCheckPlugin<E, P extends DirtyCheckPlugin<E, any> = DirtyCheckPlugin<E, any>> extends EntityCollectionPlugin<E, P> {\n  /**\n   * @deprecated Use someDirty$ instead\n   */\n  isSomeDirty$: Observable<boolean> = this.query.select(state => state.entities).pipe(map((entities: any) => this.checkSomeDirty(entities)));\n\n  someDirty$ = this.isSomeDirty$;\n  someDirty = this.isSomeDirty;\n\n  constructor(protected query: QueryEntity<any, E>, private readonly params: DirtyCheckCollectionParams<E> = {}) {\n    super(query, params.entityIds);\n    this.params = { ...dirtyCheckDefaultParams, ...params };\n    this.activate();\n    this.selectIds()\n      .pipe(skip(1))\n      .subscribe(ids => {\n        this.rebase(ids, { afterAdd: plugin => plugin.setHead() });\n      });\n  }\n\n  setHead(ids?: IDS) {\n    this.forEachId(ids, e => e.setHead());\n    return this;\n  }\n\n  hasHead(id: ID): boolean {\n    if (this.entities.has(id)) {\n      const entity = this.getEntity(id);\n      return entity.hasHead();\n    }\n\n    return false;\n  }\n\n  reset(ids?: IDS, params: DirtyCheckResetParams = {}) {\n    this.forEachId(ids, e => e.reset(params));\n  }\n\n  isDirty(id: ID): Observable<boolean>;\n  isDirty(id: ID, asObservable: true): Observable<boolean>;\n  isDirty(id: ID, asObservable: false): boolean;\n  isDirty(id: ID, asObservable = true): Observable<boolean> | boolean {\n    if (this.entities.has(id)) {\n      const entity = this.getEntity(id);\n      return asObservable ? entity.isDirty$ : entity.isDirty();\n    }\n\n    return false;\n  }\n\n  /**\n   * @deprecated Use someDirty() instead\n   */\n  isSomeDirty(): boolean {\n    const entities = this.query.getAll({ asObject: true });\n    return this.checkSomeDirty(entities);\n  }\n\n  isPathDirty(id: ID, path: string) {\n    if (this.entities.has(id)) {\n      const head = (this.getEntity(id) as any).getHead();\n      const current = this.query.getEntity(id);\n      const currentPathValue = getNestedPath(current, path);\n      const headPathValue = getNestedPath(head, path);\n\n      return this.params.comparator(currentPathValue, headPathValue);\n    }\n\n    return null;\n  }\n\n  destroy(ids?: IDS) {\n    this.forEachId(ids, e => e.destroy());\n  }\n\n  protected instantiatePlugin(id: ID): P {\n    return new DirtyCheckPlugin(this.query, this.params, id) as P;\n  }\n\n  private checkSomeDirty(entities: HashMap<E>): boolean {\n    const entitiesIds = this.resolvedIds();\n    for (const id of entitiesIds) {\n      const dirty = this.params.comparator((this.getEntity(id) as any).getHead(), entities[id]);\n      if (dirty) {\n        return true;\n      }\n    }\n    return false;\n  }\n}\n","import { isNumber } from '../internal/utils';\nimport { __stores__ } from './store';\nimport { applyTransaction } from './transaction';\n\n/**\n * @example\n *\n * this.peopleStore.update(id, person => ({\n *   guests: increment(person.guests)\n * }));\n */\nexport function increment(value: number, params: { maxValue: number | undefined } = { maxValue: undefined }) {\n  if (isNumber(value) === false) return;\n  if (params.maxValue && value === params.maxValue) return value;\n  return value + 1;\n}\n\n/**\n * @example\n *\n * this.peopleStore.update(id, person => ({\n *   guests: decrement(person.guests)\n * }));\n */\nexport function decrement(value, params: { allowNegative: boolean } = { allowNegative: false }) {\n  if (isNumber(value) === false) return;\n  if (params.allowNegative === false && value === 0) {\n    return value;\n  }\n  return value - 1;\n}\n\n/**\n * Generate random guid\n */\nexport function guid() {\n  return 'xxxxxx4xyx'.replace(/[xy]/g, c => {\n    const r = (Math.random() * 16) | 0,\n      v = c == 'x' ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\nexport interface ResetStoresParams {\n  /**\n   *  By default the whole state is resetted, use this param to exclude stores that you don't want to reset.\n   */\n  exclude: string[];\n}\n\n/**\n *\n * @param options\n */\nexport function resetStores(options?: Partial<ResetStoresParams>) {\n  const defaults: ResetStoresParams = {\n    exclude: []\n  };\n\n  options = Object.assign({}, defaults, options);\n  const stores = Object.keys(__stores__);\n\n  applyTransaction(() => {\n    for (const store of stores) {\n      const s = __stores__[store];\n      if (!options.exclude) {\n        s.reset();\n      } else {\n        if (options.exclude.indexOf(s.storeName) === -1) {\n          s.reset();\n        }\n      }\n    }\n  });\n}\n"],"names":["skip","map","tslib_1.__decorate"],"mappings":"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"}
