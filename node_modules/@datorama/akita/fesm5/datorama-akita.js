import { __assign, __extends, __spread, __values, __decorate, __metadata, __read, __rest } from 'tslib';
import { Observable, Subject, of, BehaviorSubject, ReplaySubject, combineLatest, from } from 'rxjs';
import { distinctUntilChanged, map, take, auditTime, switchMap, withLatestFrom, filter, delay, debounceTime, skip, pairwise } from 'rxjs/operators';

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/**
 * Wraps the provided value in an array, unless the provided _value is an array.
 * @template T
 * @param {?} value
 * @return {?}
 */
function coerceArray(value) {
    return Array.isArray(value) ? value : [value];
}
/**
 * Check if a value is an object
 * @param {?} value
 * @return {?}
 */
function isObject(value) {
    return Object.prototype.toString.call(value) === '[object Object]';
}
/**
 * @param {?} value
 * @return {?}
 */
function isPlainObject(value) {
    return toBoolean(value) && value.constructor.name === 'Object';
}
/**
 * @param {?} value
 * @return {?}
 */
function isFunction(value) {
    return typeof value === 'function';
}
/**
 * @param {?} value
 * @return {?}
 */
function toBoolean(value) {
    return value != null && "" + value !== 'false';
}
/**
 * @param {?} value
 * @return {?}
 */
function isUndefined(value) {
    return value === undefined;
}
/**
 * @param {?} v
 * @return {?}
 */
function isNil(v) {
    return v === null || v === undefined;
}
/**
 * Check if entity exists
 * @template E
 * @param {?} id
 * @param {?} entities
 * @return {?}
 */
function entityExists(id, entities) {
    return entities.hasOwnProperty(id);
}
/**
 * Observable that emits empty value and complete
 * @template T
 * @return {?}
 */
function noop() {
    return new Observable(function (observer) {
        observer.next();
        observer.complete();
    });
}
/**
 * @param {?} value
 * @return {?}
 */
function isObservable(value) {
    return toBoolean(value) && isFunction(value.subscribe);
}
/**
 * @param {?} val
 * @return {?}
 */
function isString(val) {
    return typeof val === 'string';
}
/**
 * @param {?} value
 * @return {?}
 */
function isNumber(value) {
    return typeof value === 'number';
}
/**
 * @param {?} val
 * @return {?}
 */
function isDefined(val) {
    return val !== null && typeof val !== 'undefined';
}
/**
 * Check if the active entity exist
 * @template E
 * @param {?} state
 * @return {?}
 */
function resetActive(state) {
    return isActiveState(state) && entityExists(((/** @type {?} */ (state))).active, state.entities) === false;
}
/**
 * Check if the store supports active entity
 * @template E
 * @param {?} state
 * @return {?}
 */
function isActiveState(state) {
    return ((/** @type {?} */ (state))).hasOwnProperty('active');
}
/**
 * setValue(state, 'todos.ui', { filter: {}})
 * @type {?}
 */
var setValue = function (obj, prop, val) {
    /** @type {?} */
    var split = prop.split('.');
    if (split.length === 1)
        return val;
    obj = __assign({}, obj);
    /** @type {?} */
    var lastIndex = split.length - 2;
    /** @type {?} */
    var removeStoreName = prop.split('.').slice(1);
    removeStoreName.reduce(function (acc, part, index) {
        if (index === lastIndex) {
            acc[part] = val;
        }
        else {
            acc[part] = __assign({}, acc[part]);
        }
        return acc && acc[part];
    }, obj);
    return obj;
};
/**
 * getValue(state, 'todos.ui')
 * @type {?}
 */
var getValue = function (obj, prop) {
    /** return the whole state  */
    if (prop.split('.').length === 1) {
        return obj;
    }
    /** @type {?} */
    var removeStoreName = prop
        .split('.')
        .slice(1)
        .join('.');
    return removeStoreName.split('.').reduce(function (acc, part) { return acc && acc[part]; }, obj);
};

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
var AkitaError = /** @class */ (function (_super) {
    __extends(AkitaError, _super);
    function AkitaError(message) {
        return _super.call(this, message) || this;
    }
    return AkitaError;
}(Error));
var AkitaImmutabilityError = /** @class */ (function (_super) {
    __extends(AkitaImmutabilityError, _super);
    function AkitaImmutabilityError(storeName) {
        return _super.call(this, "The new state should be immutable. Make sure to return a new immutable state. \n store: \n " + storeName) || this;
    }
    return AkitaImmutabilityError;
}(AkitaError));
var AkitaEntityNotExistsError = /** @class */ (function (_super) {
    __extends(AkitaEntityNotExistsError, _super);
    function AkitaEntityNotExistsError(id) {
        return _super.call(this, "Entity " + id + " does not exists") || this;
    }
    return AkitaEntityNotExistsError;
}(AkitaError));
var AkitaNoActiveError = /** @class */ (function (_super) {
    __extends(AkitaNoActiveError, _super);
    function AkitaNoActiveError() {
        return _super.call(this, "Active is null/undefined") || this;
    }
    return AkitaNoActiveError;
}(AkitaError));
var AkitaInvalidEntityState = /** @class */ (function (_super) {
    __extends(AkitaInvalidEntityState, _super);
    function AkitaInvalidEntityState() {
        return _super.call(this, "Entity state is invalid") || this;
    }
    return AkitaInvalidEntityState;
}(AkitaError));
var AkitaUpdateIdKeyError = /** @class */ (function (_super) {
    __extends(AkitaUpdateIdKeyError, _super);
    function AkitaUpdateIdKeyError() {
        return _super.call(this, "Updating entity id is not permitted when updating many entities") || this;
    }
    return AkitaUpdateIdKeyError;
}(AkitaError));
/**
 * @param {?} id
 * @param {?} entities
 * @return {?}
 */
function assertEntityExists(id, entities) {
    if (!entityExists(id, entities)) {
        throw new AkitaEntityNotExistsError(id);
    }
}
/**
 * @param {?} store
 * @return {?}
 */
function assertActive(store) {
    if (!toBoolean(store.active)) {
        throw new AkitaNoActiveError();
    }
}
/**
 * @param {?} state
 * @return {?}
 */
function assertEntityState(state) {
    /** @type {?} */
    var assertEntities = isObject(state);
    if (!assertEntities) {
        throw new AkitaInvalidEntityState();
    }
}
/**
 * @param {?} name
 * @param {?} className
 * @return {?}
 */
function assertDecorator(name, className) {
    if (!name) {
        console.error("@StoreConfig({ name }) is missing in " + className);
    }
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
var CRUD = /** @class */ (function () {
    function CRUD() {
    }
    /**
     * @template S, E
     * @param {?} state
     * @param {?} entities
     * @param {?} entityClass
     * @param {?} idKey
     * @return {?}
     */
    CRUD.prototype._set = /**
     * @template S, E
     * @param {?} state
     * @param {?} entities
     * @param {?} entityClass
     * @param {?} idKey
     * @return {?}
     */
    function (state, entities, entityClass, idKey) {
        /** @type {?} */
        var ids;
        /** @type {?} */
        var normalized;
        if (((/** @type {?} */ (entities))).ids && ((/** @type {?} */ (entities))).entities) {
            ids = ((/** @type {?} */ (entities))).ids;
            normalized = ((/** @type {?} */ (entities))).entities;
        }
        else {
            /** @type {?} */
            var isArray = Array.isArray(entities);
            normalized = entities;
            if (isArray) {
                normalized = (/** @type {?} */ (this.keyBy((/** @type {?} */ (entities)), entityClass, idKey)));
            }
            else {
                assertEntityState(entities);
            }
            ids = isArray ? ((/** @type {?} */ (entities))).map(function (entity) { return entity[idKey]; }) : Object.keys((/** @type {?} */ (normalized))).map(function (id) { return entities[id][idKey]; });
        }
        /** @type {?} */
        var newState = __assign({}, ((/** @type {?} */ (state))), { entities: normalized, ids: ids, loading: false });
        if (resetActive(newState)) {
            newState.active = null;
        }
        return newState;
    };
    /**
     * @template T
     * @param {?} state
     * @param {?} id
     * @param {?} entity
     * @return {?}
     */
    CRUD.prototype._replaceEntity = /**
     * @template T
     * @param {?} state
     * @param {?} id
     * @param {?} entity
     * @return {?}
     */
    function (state, id, entity) {
        var _a;
        return __assign({}, ((/** @type {?} */ (state))), { entities: __assign({}, state.entities, (_a = {}, _a[id] = entity, _a)) });
    };
    /**
     * @template S, E
     * @param {?} state
     * @param {?} entities
     * @param {?} idKey
     * @param {?=} options
     * @return {?}
     */
    CRUD.prototype._add = /**
     * @template S, E
     * @param {?} state
     * @param {?} entities
     * @param {?} idKey
     * @param {?=} options
     * @return {?}
     */
    function (state, entities, idKey, options) {
        if (options === void 0) { options = {}; }
        /** @type {?} */
        var addedEntities = {};
        /** @type {?} */
        var addedIds = [];
        for (var i = 0; i < entities.length; i++) {
            /** @type {?} */
            var entity = entities[i];
            /** @type {?} */
            var entityId = entity[idKey];
            if (!entityExists(entityId, state.entities)) {
                addedEntities[entityId] = entity;
                if (options.prepend)
                    addedIds.unshift(entityId);
                else
                    addedIds.push(entityId);
            }
        }
        return __assign({}, ((/** @type {?} */ (state))), { entities: __assign({}, state.entities, addedEntities), ids: options.prepend ? __spread(addedIds, state.ids) : __spread(state.ids, addedIds) });
    };
    /**
     * @template T
     * @param {?} state
     * @param {?} ids
     * @param {?} newStateOrFn
     * @param {?} idKey
     * @return {?}
     */
    CRUD.prototype._update = /**
     * @template T
     * @param {?} state
     * @param {?} ids
     * @param {?} newStateOrFn
     * @param {?} idKey
     * @return {?}
     */
    function (state, ids, newStateOrFn, idKey) {
        /** @type {?} */
        var updatedEntities = {};
        /** @type {?} */
        var isUpdatingIdKey = false;
        /** @type {?} */
        var idToUpdate;
        for (var i = 0; i < ids.length; i++) {
            /** @type {?} */
            var id = ids[i];
            idToUpdate = id;
            assertEntityExists(id, state.entities);
            /** @type {?} */
            var oldEntity = state.entities[id];
            /** @type {?} */
            var newState = isFunction(newStateOrFn) ? newStateOrFn(oldEntity) : newStateOrFn;
            if (newState.hasOwnProperty(idKey) && newState[idKey] !== oldEntity[idKey]) {
                if (ids.length > 1) {
                    throw new AkitaUpdateIdKeyError();
                }
                isUpdatingIdKey = true;
                idToUpdate = newState[idKey];
            }
            /** @type {?} */
            var newEntity = void 0;
            /** @type {?} */
            var merged = __assign({}, oldEntity, newState);
            if (isPlainObject(oldEntity)) {
                newEntity = merged;
            }
            else {
                /**
                 * In case that new state is class of it's own, there's
                 * a possibility that it will be different than the old
                 * class.
                 * For example, Old state is an instance of animal class
                 * and new state is instance of person class.
                 * To avoid run over new person class with the old animal
                 * class we check if the new state is a class of it's own.
                 * If so, use it. Otherwise, use the old state class
                 */
                if (isPlainObject(newState)) {
                    newEntity = new oldEntity.constructor(merged);
                }
                else {
                    newEntity = new ((/** @type {?} */ (newState))).constructor(merged);
                }
            }
            updatedEntities[idToUpdate] = newEntity;
        }
        /** @type {?} */
        var updatedIds = state.ids;
        /** @type {?} */
        var stateEntities = state.entities;
        if (isUpdatingIdKey) {
            var _a = __read(ids, 1), id_1 = _a[0];
            var _b = state.entities, _c = id_1, deletedEntity = _b[_c], rest = __rest(_b, [typeof _c === "symbol" ? _c : _c + ""]);
            stateEntities = rest;
            updatedIds = state.ids.map(function (current) { return (current === id_1 ? idToUpdate : current); });
        }
        return __assign({}, ((/** @type {?} */ (state))), { entities: __assign({}, stateEntities, updatedEntities), ids: updatedIds });
    };
    /**
     * @template T
     * @param {?} state
     * @param {?} ids
     * @return {?}
     */
    CRUD.prototype._remove = /**
     * @template T
     * @param {?} state
     * @param {?} ids
     * @return {?}
     */
    function (state, ids) {
        if (!ids)
            return this._removeAll(state);
        /** @type {?} */
        var removed = ids.reduce(function (acc, id) {
            var _a = id, entity = acc[_a], rest = __rest(acc, [typeof _a === "symbol" ? _a : _a + ""]);
            return rest;
        }, state.entities);
        /** @type {?} */
        var newState = __assign({}, ((/** @type {?} */ (state))), { entities: removed, ids: state.ids.filter(function (current) { return ids.indexOf(current) === -1; }) });
        if (resetActive(newState)) {
            newState.active = null;
        }
        return newState;
    };
    /**
     * @template T
     * @param {?} state
     * @return {?}
     */
    CRUD.prototype._removeAll = /**
     * @template T
     * @param {?} state
     * @return {?}
     */
    function (state) {
        /** @type {?} */
        var newState = __assign({}, ((/** @type {?} */ (state))), { entities: {}, ids: [], active: null });
        return newState;
    };
    /**
     * @param {?} entities
     * @param {?=} entityClass
     * @param {?=} id
     * @return {?}
     */
    CRUD.prototype.keyBy = /**
     * @param {?} entities
     * @param {?=} entityClass
     * @param {?=} id
     * @return {?}
     */
    function (entities, entityClass, id) {
        if (id === void 0) { id = 'id'; }
        /** @type {?} */
        var acc = {};
        for (var i = 0, len = entities.length; i < len; i++) {
            /** @type {?} */
            var entity = entities[i];
            acc[entity[id]] = entityClass ? new entityClass(entity) : entity;
        }
        return acc;
    };
    return CRUD;
}());
/** @type {?} */
var _crud = new CRUD();

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
var AkitaGlobals = /** @class */ (function () {
    function AkitaGlobals() {
        this.skipAction = false;
        this.skipTransactionMsg = false;
        this.currentT = [];
        this.activeTransactions = 0;
    }
    /**
     * @param {?} _action
     * @return {?}
     */
    AkitaGlobals.prototype.setAction = /**
     * @param {?} _action
     * @return {?}
     */
    function (_action) {
        if (this.customAction) {
            this.currentAction = this.customAction;
            this.customAction = null;
            this.skipTransactionMsg = false;
        }
        else {
            if (this.activeTransactions === 0) {
                this.currentAction = _action;
            }
        }
        if (this.activeTransactions > 0) {
            this.currentT.push(_action);
        }
    };
    /**
     * @param {?} action
     * @param {?=} skipTransactionMsg
     * @return {?}
     */
    AkitaGlobals.prototype.setCustomAction = /**
     * @param {?} action
     * @param {?=} skipTransactionMsg
     * @return {?}
     */
    function (action, skipTransactionMsg) {
        if (skipTransactionMsg === void 0) { skipTransactionMsg = false; }
        this.currentAction = this.customAction = action;
        this.skipTransactionMsg = skipTransactionMsg;
    };
    /**
     * @param {?=} skip
     * @return {?}
     */
    AkitaGlobals.prototype.setSkipAction = /**
     * @param {?=} skip
     * @return {?}
     */
    function (skip$$1) {
        if (skip$$1 === void 0) { skip$$1 = true; }
        this.skipAction = skip$$1;
    };
    return AkitaGlobals;
}());
/** @type {?} */
var __globalState = new AkitaGlobals();

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/**
 * Start a new transaction batch
 * @return {?}
 */
function startBatch() {
    if (!isTransactionInProcess()) {
        __globalState.batchTransaction = new Subject();
    }
    __globalState.activeTransactions++;
}
/**
 * End the transaction
 * @return {?}
 */
function endBatch() {
    if (--__globalState.activeTransactions === 0) {
        __globalState.batchTransaction.next(true);
        __globalState.batchTransaction.complete();
    }
}
/**
 * Whether we're inside batch
 * @return {?}
 */
function isTransactionInProcess() {
    return __globalState.activeTransactions > 0;
}
/**
 *
 * @return {?}
 */
function commit() {
    return __globalState.batchTransaction ? __globalState.batchTransaction.asObservable() : of(true);
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/**
 * @param {?} o
 * @return {?}
 */
function deepFreeze(o) {
    Object.freeze(o);
    /** @type {?} */
    var oIsFunction = typeof o === 'function';
    /** @type {?} */
    var hasOwnProp = Object.prototype.hasOwnProperty;
    Object.getOwnPropertyNames(o).forEach(function (prop) {
        if (hasOwnProp.call(o, prop) &&
            (oIsFunction ? prop !== 'caller' && prop !== 'callee' && prop !== 'arguments' : true) &&
            o[prop] !== null &&
            (typeof o[prop] === 'object' || typeof o[prop] === 'function') &&
            !Object.isFrozen(o[prop])) {
            deepFreeze(o[prop]);
        }
    });
    return o;
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/** @type {?} */
var configKey = 'akitaConfig';
/**
 * @param {?} metadata
 * @return {?}
 */
function StoreConfig(metadata) {
    return function (constructor) {
        constructor[configKey] = { idKey: 'id' };
        for (var i = 0, keys = Object.keys(metadata); i < keys.length; i++) {
            /** @type {?} */
            var key = keys[i];
            /* name is preserved read only key */
            if (key === 'name') {
                constructor[configKey]['storeName'] = metadata[key];
            }
            else {
                constructor[configKey][key] = metadata[key];
            }
        }
    };
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/** @type {?} */
var CONFIG = {
    resettable: false
};
/**
 * @param {?} config
 * @return {?}
 */
function akitaConfig(config) {
    CONFIG = __assign({}, CONFIG, config);
}
/**
 * @return {?}
 */
function getAkitaConfig() {
    return CONFIG;
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/** @type {?} */
var __DEV__ = true;
/** @type {?} */
var isNotBrowser = typeof window === 'undefined';
/** @type {?} */
var __stores__ = {};
/** @type {?} */
var rootDispatcher = new ReplaySubject();
/**
 * @param {?} storeName
 * @param {?=} initialState
 * @return {?}
 */
function nextState(storeName, initialState) {
    if (initialState === void 0) { initialState = false; }
    return {
        type: 2 /* NEW_STATE */,
        payload: {
            name: storeName,
            initialState: initialState
        }
    };
}
/**
 * Enable production mode to disable objectFreeze
 * @return {?}
 */
function enableAkitaProdMode() {
    __DEV__ = false;
}
/**
 * @return {?}
 */
function isDev() {
    return __DEV__;
}
/**
 * The Root Store that every sub store needs to inherit and
 * invoke `super` with the initial state.
 * @template S
 */
var  /**
 * The Root Store that every sub store needs to inherit and
 * invoke `super` with the initial state.
 * @template S
 */
Store = /** @class */ (function () {
    /**
     *
     * Initial the store with the state
     */
    function Store(initialState, options) {
        if (options === void 0) { options = {}; }
        this.options = options;
        /**
         * Whether we are inside transaction *
         */
        this.inTransaction = false;
        this._isPristine = true;
        this.destroy = this.ngOnDestroy;
        __globalState.setAction({ type: '@@INIT' });
        __stores__[this.storeName] = this;
        this.setState(function () { return initialState; });
        rootDispatcher.next({
            type: 0 /* NEW_STORE */,
            payload: { store: this }
        });
        isDev() && assertDecorator(this.storeName, this.constructor.name);
        if (this.isRessetable()) {
            this._initialState = initialState;
        }
    }
    /**
     * @param {?=} loading
     * @return {?}
     */
    Store.prototype.setLoading = /**
     * @param {?=} loading
     * @return {?}
     */
    function (loading) {
        if (loading === void 0) { loading = false; }
        if (loading !== ((/** @type {?} */ (this._value()))).loading) {
            isDev() && __globalState.setAction({ type: 'Set Loading' });
            this.setState(function (s) { return ((/** @type {?} */ (__assign({}, ((/** @type {?} */ (s))), { loading: loading })))); });
        }
    };
    /**
     * Update the store's error state.
     */
    /**
     * Update the store's error state.
     * @template T
     * @param {?} error
     * @return {?}
     */
    Store.prototype.setError = /**
     * Update the store's error state.
     * @template T
     * @param {?} error
     * @return {?}
     */
    function (error) {
        if (error !== ((/** @type {?} */ (this._value()))).error) {
            isDev() && __globalState.setAction({ type: 'Set Error' });
            this.setState(function (s) { return ((/** @type {?} */ (__assign({}, ((/** @type {?} */ (s))), { error: error })))); });
        }
    };
    /**
     * Select a slice from the store
     *
     * @example
     * this.store.select(state => state.entities)
     *
     */
    /**
     * Select a slice from the store
     *
     * \@example
     * this.store.select(state => state.entities)
     *
     * @template R
     * @param {?} project
     * @return {?}
     */
    Store.prototype._select = /**
     * Select a slice from the store
     *
     * \@example
     * this.store.select(state => state.entities)
     *
     * @template R
     * @param {?} project
     * @return {?}
     */
    function (project) {
        return this.store$.pipe(map(project), distinctUntilChanged());
    };
    /**
     * @return {?}
     */
    Store.prototype._value = /**
     * @return {?}
     */
    function () {
        return this.storeValue;
    };
    Object.defineProperty(Store.prototype, "config", {
        get: /**
         * @return {?}
         */
        function () {
            return this.constructor[configKey];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Store.prototype, "storeName", {
        get: /**
         * @return {?}
         */
        function () {
            return this.options.storeName || (this.config && this.config['storeName']);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Store.prototype, "idKey", {
        get: /**
         * @return {?}
         */
        function () {
            /**
             * backward compatibility
             * @type {?}
             */
            var newIdKey = this.config && this.config.idKey;
            if (!newIdKey) {
                return this.options.idKey || 'id';
            }
            return newIdKey;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Store.prototype, "isPristine", {
        get: /**
         * @return {?}
         */
        function () {
            return this._isPristine;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * `setState()` is the only way to update a store; It receives a callback function,
     * which gets the current state, and returns a new immutable state,
     * which will be the new value of the store.
     */
    /**
     * `setState()` is the only way to update a store; It receives a callback function,
     * which gets the current state, and returns a new immutable state,
     * which will be the new value of the store.
     * @param {?} newStateFn
     * @param {?=} _rootDispatcher
     * @return {?}
     */
    Store.prototype.setState = /**
     * `setState()` is the only way to update a store; It receives a callback function,
     * which gets the current state, and returns a new immutable state,
     * which will be the new value of the store.
     * @param {?} newStateFn
     * @param {?=} _rootDispatcher
     * @return {?}
     */
    function (newStateFn, _rootDispatcher) {
        if (_rootDispatcher === void 0) { _rootDispatcher = true; }
        /** @type {?} */
        var prevState = this._value();
        this.storeValue = __DEV__ ? deepFreeze(newStateFn(this._value())) : newStateFn(this._value());
        if (prevState === this.storeValue) {
            throw new AkitaImmutabilityError(this.storeName);
        }
        if (!this.store) {
            this.store = new BehaviorSubject(this.storeValue);
            rootDispatcher.next(nextState(this.storeName, true));
            return;
        }
        if (isTransactionInProcess()) {
            this.handleTransaction();
            return;
        }
        this.dispatch(this.storeValue, _rootDispatcher);
    };
    /**
     * Resets the store to it's initial state and set the store to a pristine state.
     */
    /**
     * Resets the store to it's initial state and set the store to a pristine state.
     * @return {?}
     */
    Store.prototype.reset = /**
     * Resets the store to it's initial state and set the store to a pristine state.
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.isRessetable()) {
            __globalState.setAction({ type: 'Reset Store' });
            this.setState(function () { return Object.assign({}, _this._initialState); });
            this.setPristine();
        }
        else {
            throw new AkitaError("You need to enable the reset functionality");
        }
    };
    /**
     * @param {?} newStateOrId
     * @param {?=} newState
     * @return {?}
     */
    Store.prototype.update = /**
     * @param {?} newStateOrId
     * @param {?=} newState
     * @return {?}
     */
    function (newStateOrId, newState) {
        __globalState.setAction({ type: 'Update Store' });
        this.setState(function (state) {
            /** @type {?} */
            var value = isFunction(newStateOrId) ? newStateOrId(state) : newStateOrId;
            /** @type {?} */
            var merged = Object.assign({}, state, value);
            return isPlainObject(state) ? merged : new ((/** @type {?} */ (state))).constructor(merged);
        });
        this.setDirty();
    };
    /**
     * Sets the store to a pristine state.
     */
    /**
     * Sets the store to a pristine state.
     * @return {?}
     */
    Store.prototype.setPristine = /**
     * Sets the store to a pristine state.
     * @return {?}
     */
    function () {
        this._isPristine = true;
    };
    /**
     * Sets the store to a dirty state, indicating that it is not pristine.
     */
    /**
     * Sets the store to a dirty state, indicating that it is not pristine.
     * @return {?}
     */
    Store.prototype.setDirty = /**
     * Sets the store to a dirty state, indicating that it is not pristine.
     * @return {?}
     */
    function () {
        this._isPristine = false;
    };
    /**
     * @param {?} state
     * @param {?=} _rootDispatcher
     * @return {?}
     */
    Store.prototype.dispatch = /**
     * @param {?} state
     * @param {?=} _rootDispatcher
     * @return {?}
     */
    function (state, _rootDispatcher) {
        if (_rootDispatcher === void 0) { _rootDispatcher = true; }
        this.store.next(state);
        if (_rootDispatcher) {
            rootDispatcher.next(nextState(this.storeName));
            isDev() && __globalState.setAction({ type: 'Set State' });
        }
    };
    Object.defineProperty(Store.prototype, "store$", {
        get: /**
         * @return {?}
         */
        function () {
            return this.store.asObservable();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * When the transaction ends dispatch the final value once
     */
    /**
     * When the transaction ends dispatch the final value once
     * @return {?}
     */
    Store.prototype.watchTransaction = /**
     * When the transaction ends dispatch the final value once
     * @return {?}
     */
    function () {
        var _this = this;
        commit().subscribe(function () {
            _this.inTransaction = false;
            if (isDev() && !__globalState.skipTransactionMsg) {
                __globalState.setAction({ type: '@Transaction' });
            }
            _this.dispatch(_this._value());
            __globalState.currentT = [];
            __globalState.skipTransactionMsg = false;
        });
    };
    /**
     * @return {?}
     */
    Store.prototype.isRessetable = /**
     * @return {?}
     */
    function () {
        return this.config.resettable || getAkitaConfig().resettable;
    };
    /**
     * Listen to the transaction stream
     */
    /**
     * Listen to the transaction stream
     * @return {?}
     */
    Store.prototype.handleTransaction = /**
     * Listen to the transaction stream
     * @return {?}
     */
    function () {
        if (!this.inTransaction) {
            this.watchTransaction();
            this.inTransaction = true;
        }
    };
    /**
     * @return {?}
     */
    Store.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (isNotBrowser)
            return;
        if (!((/** @type {?} */ (window))).hmrEnabled && this === __stores__[this.storeName]) {
            delete __stores__[this.storeName];
            rootDispatcher.next({
                type: 1 /* DELETE_STORE */,
                payload: { storeName: this.storeName }
            });
        }
    };
    return Store;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/**
 * The Root Store that every sub store needs to inherit and
 * invoke `super` with the initial state.
 * @template S, E, ActiveEntity
 */
var  /**
 * The Root Store that every sub store needs to inherit and
 * invoke `super` with the initial state.
 * @template S, E, ActiveEntity
 */
EntityStore = /** @class */ (function (_super) {
    __extends(EntityStore, _super);
    /**
     *
     * Initiate the store with the state
     */
    function EntityStore(initialState, options) {
        if (initialState === void 0) { initialState = {}; }
        if (options === void 0) { options = {}; }
        return _super.call(this, __assign({}, getInitialEntitiesState(), initialState), options) || this;
    }
    Object.defineProperty(EntityStore.prototype, "entities", {
        get: /**
         * @return {?}
         */
        function () {
            return this._value().entities;
        },
        enumerable: true,
        configurable: true
    });
    /**
     *
     * Replace current collection with provided collection
     *
     * @example
     * this.store.set([Entity, Entity]);
     * this.store.set({1: Entity, 2: Entity});
     * this.store.set([{id: 1}, {id: 2}], { entityClass: Product });
     *
     */
    /**
     *
     * Replace current collection with provided collection
     *
     * \@example
     * this.store.set([Entity, Entity]);
     * this.store.set({1: Entity, 2: Entity});
     * this.store.set([{id: 1}, {id: 2}], { entityClass: Product });
     *
     * @param {?} entities
     * @param {?=} options
     * @return {?}
     */
    EntityStore.prototype.set = /**
     *
     * Replace current collection with provided collection
     *
     * \@example
     * this.store.set([Entity, Entity]);
     * this.store.set({1: Entity, 2: Entity});
     * this.store.set([{id: 1}, {id: 2}], { entityClass: Product });
     *
     * @param {?} entities
     * @param {?=} options
     * @return {?}
     */
    function (entities, options) {
        var _this = this;
        if (options === void 0) { options = {}; }
        isDev() && __globalState.setAction({ type: 'Set Entities' });
        this.setState(function (state) { return _crud._set(state, isNil(entities) ? [] : entities, options.entityClass, _this.idKey); });
        this.setDirty();
    };
    /**
     * Create or replace an entity in the store.
     *
     * @example
     * this.store.createOrReplace(3, Entity);
     *
     */
    /**
     * Create or replace an entity in the store.
     *
     * \@example
     * this.store.createOrReplace(3, Entity);
     *
     * @param {?} id
     * @param {?} entity
     * @return {?}
     */
    EntityStore.prototype.createOrReplace = /**
     * Create or replace an entity in the store.
     *
     * \@example
     * this.store.createOrReplace(3, Entity);
     *
     * @param {?} id
     * @param {?} entity
     * @return {?}
     */
    function (id, entity) {
        if (!entityExists(id, this._value().entities)) {
            this.addWhenNotExists(id, entity);
        }
        else {
            isDev() && __globalState.setAction({ type: 'Create or Replace Entity', entityId: [id] });
            this.setState(function (state) { return _crud._replaceEntity(state, id, entity); });
        }
    };
    /**
     *
     * Insert or Update
     */
    /**
     *
     * Insert or Update
     * @param {?} id
     * @param {?} entityOrFn
     * @return {?}
     */
    EntityStore.prototype.upsert = /**
     *
     * Insert or Update
     * @param {?} id
     * @param {?} entityOrFn
     * @return {?}
     */
    function (id, entityOrFn) {
        if (!entityExists(id, this._value().entities)) {
            /** @type {?} */
            var resolve = isFunction(entityOrFn) ? ((/** @type {?} */ (entityOrFn)))({}) : entityOrFn;
            this.addWhenNotExists(id, resolve);
        }
        else {
            this.update(id, (/** @type {?} */ (entityOrFn)));
        }
    };
    /**
     * Add an entity or entities to the store.
     *
     * @example
     * this.store.add([Entity, Entity]);
     * this.store.add(Entity);
     * this.store.add(Entity, { prepend: true });
     */
    /**
     * Add an entity or entities to the store.
     *
     * \@example
     * this.store.add([Entity, Entity]);
     * this.store.add(Entity);
     * this.store.add(Entity, { prepend: true });
     * @param {?} entities
     * @param {?=} options
     * @return {?}
     */
    EntityStore.prototype.add = /**
     * Add an entity or entities to the store.
     *
     * \@example
     * this.store.add([Entity, Entity]);
     * this.store.add(Entity);
     * this.store.add(Entity, { prepend: true });
     * @param {?} entities
     * @param {?=} options
     * @return {?}
     */
    function (entities, options) {
        var _this = this;
        /** @type {?} */
        var toArray = coerceArray(entities);
        if (toArray.length === 0)
            return;
        /**
         * If we pass entities that already exist, we should ignore them
         * @type {?}
         */
        var allExists = toArray.every(function (entity) { return _this._value().ids.indexOf(entity[_this.idKey]) > -1; });
        if (allExists)
            return;
        isDev() && __globalState.setAction({ type: 'Add Entity' });
        this.setState(function (state) { return _crud._add(state, toArray, _this.idKey, options); });
    };
    /**
     * @param {?} idsOrFn
     * @param {?=} newStateOrFn
     * @return {?}
     */
    EntityStore.prototype.update = /**
     * @param {?} idsOrFn
     * @param {?=} newStateOrFn
     * @return {?}
     */
    function (idsOrFn, newStateOrFn) {
        var _this = this;
        /** @type {?} */
        var ids = [];
        /** @type {?} */
        var storeIds = this._value().ids;
        if (isFunction(idsOrFn)) {
            for (var i = 0, len = storeIds.length; i < len; i++) {
                /** @type {?} */
                var id = storeIds[i];
                /** @type {?} */
                var entity = this._value().entities[id];
                if (entity && ((/** @type {?} */ (idsOrFn)))(entity)) {
                    ids.push(id);
                }
            }
        }
        else {
            ids = toBoolean(idsOrFn) ? coerceArray(idsOrFn) : storeIds;
        }
        if (ids.length === 0)
            return;
        isDev() && __globalState.setAction({ type: 'Update Entity', entityId: ids });
        this.setState(function (state) {
            return _crud._update(state, ids, newStateOrFn, _this.idKey);
        });
    };
    /**
     * An alias to update all.
     */
    /**
     * An alias to update all.
     * @param {?} state
     * @return {?}
     */
    EntityStore.prototype.updateAll = /**
     * An alias to update all.
     * @param {?} state
     * @return {?}
     */
    function (state) {
        if (this._value().ids.length === 0)
            return;
        this.update(null, state);
    };
    /**
     * Update the root state (data which is external to the entities).
     *
     * @example
     * this.store.updateRoot({
     *   metadata: 'new metadata
     * });
     *
     *  this.store.updateRoot(state => {
     *    return {
     *      metadata: {
     *        ...state.metadata,
     *        key: 'new value'
     *      }
     *    }
     *  });
     */
    /**
     * Update the root state (data which is external to the entities).
     *
     * \@example
     * this.store.updateRoot({
     *   metadata: 'new metadata
     * });
     *
     *  this.store.updateRoot(state => {
     *    return {
     *      metadata: {
     *        ...state.metadata,
     *        key: 'new value'
     *      }
     *    }
     *  });
     * @param {?} newStateFn
     * @param {?=} action
     * @return {?}
     */
    EntityStore.prototype.updateRoot = /**
     * Update the root state (data which is external to the entities).
     *
     * \@example
     * this.store.updateRoot({
     *   metadata: 'new metadata
     * });
     *
     *  this.store.updateRoot(state => {
     *    return {
     *      metadata: {
     *        ...state.metadata,
     *        key: 'new value'
     *      }
     *    }
     *  });
     * @param {?} newStateFn
     * @param {?=} action
     * @return {?}
     */
    function (newStateFn, action) {
        /** @type {?} */
        var newState = isFunction(newStateFn) ? newStateFn(this._value()) : newStateFn;
        if (newState === this._value()) {
            throw new AkitaImmutabilityError(this.storeName);
        }
        isDev() && __globalState.setAction(action || { type: 'Update Root' });
        this.setState(function (state) {
            return __assign({}, ((/** @type {?} */ (state))), ((/** @type {?} */ (newState))));
        });
    };
    /**
     * @param {?=} idsOrFn
     * @return {?}
     */
    EntityStore.prototype.remove = /**
     * @param {?=} idsOrFn
     * @return {?}
     */
    function (idsOrFn) {
        /** @type {?} */
        var storeIds = this._value().ids;
        if (storeIds.length === 0)
            return;
        /** @type {?} */
        var idPassed = toBoolean(idsOrFn);
        if (!idPassed)
            this.setPristine();
        /** @type {?} */
        var ids = [];
        if (isFunction(idsOrFn)) {
            for (var i = 0, len = storeIds.length; i < len; i++) {
                /** @type {?} */
                var id = storeIds[i];
                /** @type {?} */
                var entity = this._value().entities[id];
                if (entity && idsOrFn(entity)) {
                    ids.push(id);
                }
            }
        }
        else {
            ids = idPassed ? coerceArray(idsOrFn) : null;
        }
        if (ids && ids.length === 0)
            return;
        isDev() && __globalState.setAction({ type: 'Remove Entity', entityId: ids });
        this.setState(function (state) {
            return _crud._remove(state, ids);
        });
    };
    /**
     *
     * Update the active entity.
     *
     * @example
     * this.store.updateActive(active => {
     *   return {
     *     config: {
     *      ..active.config,
     *      date
     *     }
     *   }
     * })
     */
    /**
     *
     * Update the active entity.
     *
     * \@example
     * this.store.updateActive(active => {
     *   return {
     *     config: {
     *      ..active.config,
     *      date
     *     }
     *   }
     * })
     * @param {?} newStateFn
     * @return {?}
     */
    EntityStore.prototype.updateActive = /**
     *
     * Update the active entity.
     *
     * \@example
     * this.store.updateActive(active => {
     *   return {
     *     config: {
     *      ..active.config,
     *      date
     *     }
     *   }
     * })
     * @param {?} newStateFn
     * @return {?}
     */
    function (newStateFn) {
        var _this = this;
        assertActive(this._value());
        isDev() && __globalState.setAction({ type: 'Update Active Entity', entityId: this._value().active });
        this.setState(function (state) {
            /** @type {?} */
            var activeId = (/** @type {?} */ (state.active));
            /** @type {?} */
            var newState = isFunction(newStateFn) ? newStateFn(state.entities[activeId]) : newStateFn;
            if (newState === state) {
                throw new AkitaImmutabilityError(_this.storeName);
            }
            return _crud._update(state, [activeId], newState, _this.idKey);
        });
    };
    /**
     * Set the given entity as active.
     */
    /**
     * Set the given entity as active.
     * @param {?} idOrOptions
     * @return {?}
     */
    EntityStore.prototype.setActive = /**
     * Set the given entity as active.
     * @param {?} idOrOptions
     * @return {?}
     */
    function (idOrOptions) {
        /** @type {?} */
        var activeId;
        if (isObject(idOrOptions)) {
            if (isNil(this._value().active))
                return;
            ((/** @type {?} */ (idOrOptions))) = Object.assign({ wrap: true }, idOrOptions);
            /** @type {?} */
            var ids = this._value().ids;
            /** @type {?} */
            var currentIdIndex = ids.indexOf(this._value().active);
            if (((/** @type {?} */ (idOrOptions))).prev) {
                /** @type {?} */
                var isFirst = currentIdIndex === 0;
                if (isFirst && !((/** @type {?} */ (idOrOptions))).wrap)
                    return;
                activeId = isFirst ? ids[ids.length - 1] : ((/** @type {?} */ (ids[currentIdIndex - 1])));
            }
            else if (((/** @type {?} */ (idOrOptions))).next) {
                /** @type {?} */
                var isLast = ids.length === currentIdIndex + 1;
                if (isLast && !((/** @type {?} */ (idOrOptions))).wrap)
                    return;
                activeId = isLast ? ids[0] : ((/** @type {?} */ (ids[currentIdIndex + 1])));
            }
        }
        else {
            if (idOrOptions === this._value().active)
                return;
            activeId = (/** @type {?} */ (idOrOptions));
        }
        isDev() && __globalState.setAction({ type: 'Set Active Entity', entityId: activeId });
        this.setState(function (state) {
            return __assign({}, ((/** @type {?} */ (state))), { active: activeId });
        });
    };
    /**
     * @param {?} id
     * @param {?} entity
     * @return {?}
     */
    EntityStore.prototype.addWhenNotExists = /**
     * @param {?} id
     * @param {?} entity
     * @return {?}
     */
    function (id, entity) {
        if (!entity[this.idKey]) {
            entity[this.idKey] = id;
        }
        this.add(entity);
    };
    return EntityStore;
}(Store));
/** @type {?} */
var getInitialEntitiesState = function () {
    return ((/** @type {?} */ ({
        entities: {},
        ids: [],
        loading: true,
        error: null
    })));
};
/** @type {?} */
var getInitialActiveState = function () {
    return ((/** @type {?} */ ({
        active: null
    })));
};

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/** @enum {string} */
var Order = {
    ASC: 'asc',
    DESC: 'desc',
};
/**
 * @param {?} key
 * @param {?=} order
 * @return {?}
 */
function compareValues(key, order) {
    if (order === void 0) { order = Order.ASC; }
    return function (a, b) {
        if (!a.hasOwnProperty(key) || !b.hasOwnProperty(key)) {
            return 0;
        }
        /** @type {?} */
        var varA = typeof a[key] === 'string' ? a[key].toUpperCase() : a[key];
        /** @type {?} */
        var varB = typeof b[key] === 'string' ? b[key].toUpperCase() : b[key];
        /** @type {?} */
        var comparison = 0;
        if (varA > varB) {
            comparison = 1;
        }
        else if (varA < varB) {
            comparison = -1;
        }
        return order == Order.DESC ? comparison * -1 : comparison;
    };
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/**
 * @param {?} fn
 * @return {?}
 */
function memoizeOne(fn) {
    /** @type {?} */
    var lastArgs;
    /** @type {?} */
    var changed = false;
    /** @type {?} */
    var firstInit = true;
    /** @type {?} */
    var lastResult;
    return function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        if (lastArgs) {
            /** If entities nor ids doesn't change return the last value */
            changed = lastArgs[1] !== args[1] || lastArgs[0] !== args[0];
        }
        if (firstInit || (changed && !firstInit)) {
            lastResult = fn.apply(this, args);
        }
        firstInit = false;
        lastArgs = args;
        return lastResult;
    };
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/** @type {?} */
var queryConfigKey = 'akitaQueryConfig';
/**
 * @template E
 * @param {?} metadata
 * @return {?}
 */
function QueryConfig(metadata) {
    return function (constructor) {
        constructor[queryConfigKey] = {};
        for (var i = 0, keys = Object.keys(metadata); i < keys.length; i++) {
            /** @type {?} */
            var key = keys[i];
            constructor[queryConfigKey][key] = metadata[key];
        }
    };
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/**
 * @template S
 */
var  /**
 * @template S
 */
Query = /** @class */ (function () {
    function Query(store) {
        this.store = store;
        this.__store__ = store;
    }
    /**
     * @template R
     * @param {?=} project
     * @return {?}
     */
    Query.prototype.select = /**
     * @template R
     * @param {?=} project
     * @return {?}
     */
    function (project) {
        /** @type {?} */
        var state = project ? project : function (state) { return state; };
        return this.store._select(state);
    };
    /**
     * Select once and complete.
     */
    /**
     * Select once and complete.
     * @template R
     * @param {?} project
     * @return {?}
     */
    Query.prototype.selectOnce = /**
     * Select once and complete.
     * @template R
     * @param {?} project
     * @return {?}
     */
    function (project) {
        return this.select(project).pipe(take(1));
    };
    /**
     * Select the store's loading state.
     */
    /**
     * Select the store's loading state.
     * @return {?}
     */
    Query.prototype.selectLoading = /**
     * Select the store's loading state.
     * @return {?}
     */
    function () {
        return this.select(function (state) { return ((/** @type {?} */ (state))).loading; });
    };
    /**
     * Select the store's error state.
     */
    /**
     * Select the store's error state.
     * @return {?}
     */
    Query.prototype.selectError = /**
     * Select the store's error state.
     * @return {?}
     */
    function () {
        return this.select(function (state) { return ((/** @type {?} */ (state))).error; });
    };
    /**
     * Get the raw value of the store.
     */
    /**
     * Get the raw value of the store.
     * @return {?}
     */
    Query.prototype.getSnapshot = /**
     * Get the raw value of the store.
     * @return {?}
     */
    function () {
        return this.store._value();
    };
    Object.defineProperty(Query.prototype, "isPristine", {
        /**
         *  Returns whether the state of the store is pristine (the set() method hasn't been explicitly called
         *  since the store creation, or the last time setPristine()was called).
         */
        get: /**
         *  Returns whether the state of the store is pristine (the set() method hasn't been explicitly called
         *  since the store creation, or the last time setPristine()was called).
         * @return {?}
         */
        function () {
            return this.store.isPristine;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Query.prototype, "isDirty", {
        /**
         * Returns whether the state of the store is dirty (the set() method
         * or the setDirty() method has been explicitly called since the store creation,
         * or the last time setPristine() was called).
         */
        get: /**
         * Returns whether the state of the store is dirty (the set() method
         * or the setDirty() method has been explicitly called since the store creation,
         * or the last time setPristine() was called).
         * @return {?}
         */
        function () {
            return !this.store.isPristine;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Query.prototype, "config", {
        get: /**
         * @return {?}
         */
        function () {
            return this.constructor[queryConfigKey];
        },
        enumerable: true,
        configurable: true
    });
    return Query;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/**
 *  An abstraction for querying the entities from the store
 * @template S, E, ActiveEntity
 */
var  /**
 *  An abstraction for querying the entities from the store
 * @template S, E, ActiveEntity
 */
QueryEntity = /** @class */ (function (_super) {
    __extends(QueryEntity, _super);
    function QueryEntity(store) {
        var _this = _super.call(this, store) || this;
        _this.__store__ = store;
        return _this;
    }
    /**
     * @param {?=} options
     * @return {?}
     */
    QueryEntity.prototype.selectAll = /**
     * @param {?=} options
     * @return {?}
     */
    function (options) {
        var _this = this;
        if (options === void 0) { options = {
            asObject: false
        }; }
        /** @type {?} */
        var selectState$ = this.select(function (state) { return state; });
        /** @type {?} */
        var selectEntities$ = this.select(function (state) { return state.entities; });
        this.sortByOptions(options);
        return selectEntities$.pipe(withLatestFrom(selectState$, function (entities, state) {
            var ids = state.ids;
            if (options.asObject) {
                return toMap(ids, entities, options);
            }
            else {
                if (!options.filterBy && !options.sortBy) {
                    if (!_this.memoized) {
                        _this.memoized = memoizeOne(toArray);
                    }
                    return _this.memoized(state, options);
                }
                return toArray(state, options);
            }
        }));
    };
    /**
     * @param {?=} options
     * @return {?}
     */
    QueryEntity.prototype.getAll = /**
     * @param {?=} options
     * @return {?}
     */
    function (options) {
        if (options === void 0) { options = { asObject: false, filterBy: undefined, limitTo: undefined }; }
        /** @type {?} */
        var state = this.getSnapshot();
        if (options.asObject) {
            return toMap(state.ids, state.entities, options, true);
        }
        this.sortByOptions(options);
        return toArray(state, options);
    };
    /**
     * Select multiple entities from the store.
     *
     * @example
     * this.store.selectMany([1,2]);
     */
    /**
     * Select multiple entities from the store.
     *
     * \@example
     * this.store.selectMany([1,2]);
     * @param {?} ids
     * @param {?=} options
     * @return {?}
     */
    QueryEntity.prototype.selectMany = /**
     * Select multiple entities from the store.
     *
     * \@example
     * this.store.selectMany([1,2]);
     * @param {?} ids
     * @param {?=} options
     * @return {?}
     */
    function (ids, options) {
        var _this = this;
        if (options === void 0) { options = {}; }
        /** @type {?} */
        var filterUndefined = isUndefined(options.filterUndefined) ? true : options.filterUndefined;
        /** @type {?} */
        var entities = ids.map(function (id) { return _this.selectEntity(id); });
        return combineLatest(entities).pipe(map(function (entities) {
            return filterUndefined ? entities.filter(function (val) { return !isUndefined(val); }) : entities;
        }), auditTime(0));
    };
    /**
     * @template R
     * @param {?} id
     * @param {?=} project
     * @return {?}
     */
    QueryEntity.prototype.selectEntity = /**
     * @template R
     * @param {?} id
     * @param {?=} project
     * @return {?}
     */
    function (id, project) {
        var _this = this;
        if (!project) {
            return this._byId(id);
        }
        return this.select(function (state) {
            if (_this.hasEntity(id)) {
                return project(_this.getEntity(id));
            }
            return undefined;
        });
    };
    /**
     * Get an entity by id
     *
     * @example
     * this.store.getEntity(1);
     */
    /**
     * Get an entity by id
     *
     * \@example
     * this.store.getEntity(1);
     * @param {?} id
     * @return {?}
     */
    QueryEntity.prototype.getEntity = /**
     * Get an entity by id
     *
     * \@example
     * this.store.getEntity(1);
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return this.getSnapshot().entities[(/** @type {?} */ (id))];
    };
    /**
     * Select the active entity's id.
     */
    /**
     * Select the active entity's id.
     * @return {?}
     */
    QueryEntity.prototype.selectActiveId = /**
     * Select the active entity's id.
     * @return {?}
     */
    function () {
        return this.select(function (state) { return ((/** @type {?} */ (state))).active; });
    };
    /**
     * Get the active id
     */
    /**
     * Get the active id
     * @return {?}
     */
    QueryEntity.prototype.getActiveId = /**
     * Get the active id
     * @return {?}
     */
    function () {
        return ((/** @type {?} */ (this.getSnapshot()))).active;
    };
    /**
     * @template R
     * @param {?=} project
     * @return {?}
     */
    QueryEntity.prototype.selectActive = /**
     * @template R
     * @param {?=} project
     * @return {?}
     */
    function (project) {
        var _this = this;
        return this.selectActiveId().pipe(switchMap(function (activeId) { return _this.selectEntity(activeId, project); }));
    };
    /**
     * Get the active entity.
     */
    /**
     * Get the active entity.
     * @return {?}
     */
    QueryEntity.prototype.getActive = /**
     * Get the active entity.
     * @return {?}
     */
    function () {
        /** @type {?} */
        var activeId = this.getActiveId();
        return toBoolean(activeId) ? this.getEntity(activeId) : undefined;
    };
    /**
     * Select the store's entity collection length.
     */
    /**
     * Select the store's entity collection length.
     * @param {?=} predicate
     * @return {?}
     */
    QueryEntity.prototype.selectCount = /**
     * Select the store's entity collection length.
     * @param {?=} predicate
     * @return {?}
     */
    function (predicate) {
        if (isFunction(predicate)) {
            return this.selectAll({
                filterBy: predicate
            }).pipe(map(function (entities) { return entities.length; }));
        }
        return this.select(function (store) { return store.ids.length; });
    };
    /**
     * Get the store's entity collection length.
     */
    /**
     * Get the store's entity collection length.
     * @param {?=} predicate
     * @return {?}
     */
    QueryEntity.prototype.getCount = /**
     * Get the store's entity collection length.
     * @param {?=} predicate
     * @return {?}
     */
    function (predicate) {
        if (isFunction(predicate)) {
            return this.getAll().filter(predicate).length;
        }
        return this.getSnapshot().ids.length;
    };
    /**
     * @param {?} projectOrIds
     * @return {?}
     */
    QueryEntity.prototype.hasEntity = /**
     * @param {?} projectOrIds
     * @return {?}
     */
    function (projectOrIds) {
        var _this = this;
        if (isFunction(projectOrIds)) {
            return this.getAll().some(projectOrIds);
        }
        if (Array.isArray(projectOrIds)) {
            return projectOrIds.every(function (id) { return ((/** @type {?} */ (id))) in _this.store.entities; });
        }
        return ((/** @type {?} */ (projectOrIds))) in this.store.entities;
    };
    /**
     * Returns whether entity store has an active entity.
     */
    /**
     * Returns whether entity store has an active entity.
     * @return {?}
     */
    QueryEntity.prototype.hasActive = /**
     * Returns whether entity store has an active entity.
     * @return {?}
     */
    function () {
        return this.getSnapshot().active != null;
    };
    /**
     * @return {?}
     */
    QueryEntity.prototype.isEmpty = /**
     * @return {?}
     */
    function () {
        return this.getSnapshot().ids.length === 0;
    };
    /**
     * @param {?} id
     * @return {?}
     */
    QueryEntity.prototype._byId = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        var _this = this;
        return this.select(function (state) { return _this.getEntity(id); });
    };
    /**
     * @param {?} options
     * @return {?}
     */
    QueryEntity.prototype.sortByOptions = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        options.sortBy = options.sortBy || (this.config && ((/** @type {?} */ (this.config.sortBy))));
        options.sortByOrder = options.sortByOrder || (this.config && this.config.sortByOrder);
    };
    /**
     * @return {?}
     */
    QueryEntity.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.memoized = null;
    };
    return QueryEntity;
}(Query));
/**
 * @template E, S
 * @param {?} state
 * @param {?} options
 * @return {?}
 */
function toArray(state, options) {
    /** @type {?} */
    var arr = [];
    var ids = state.ids, entities = state.entities;
    var filterBy = options.filterBy, limitTo = options.limitTo, sortBy = options.sortBy, sortByOrder = options.sortByOrder;
    var _loop_1 = function (i) {
        /** @type {?} */
        var id = ids[i];
        if (!entityExists(id, entities)) {
            return "continue";
        }
        if (!filterBy) {
            arr.push(entities[id]);
            return "continue";
        }
        if (Array.isArray(filterBy)) {
            /** @type {?} */
            var allPass = filterBy.every(function (fn) { return fn(entities[id], i); });
            if (allPass) {
                arr.push(entities[id]);
            }
        }
        else {
            if (filterBy(entities[id], i)) {
                arr.push(entities[id]);
            }
        }
    };
    for (var i = 0; i < ids.length; i++) {
        _loop_1(i);
    }
    if (sortBy) {
        /** @type {?} */
        var _sortBy_1 = isFunction(sortBy) ? sortBy : compareValues(sortBy, sortByOrder);
        arr = arr.sort(function (a, b) { return _sortBy_1(a, b, state); });
    }
    /** @type {?} */
    var length = Math.min(limitTo || arr.length, arr.length);
    return length === arr.length ? arr : arr.slice(0, length);
}
/**
 * @template E
 * @param {?} ids
 * @param {?} entities
 * @param {?} options
 * @param {?=} get
 * @return {?}
 */
function toMap(ids, entities, options, get) {
    if (get === void 0) { get = false; }
    /** @type {?} */
    var map$$1 = {};
    var filterBy = options.filterBy, limitTo = options.limitTo;
    if (get && !filterBy && !limitTo) {
        return entities;
    }
    /** @type {?} */
    var length = Math.min(limitTo || ids.length, ids.length);
    if (filterBy && isUndefined(limitTo) === false) {
        /** @type {?} */
        var count = 0;
        var _loop_2 = function (i, length_1) {
            if (count === limitTo)
                return "break";
            /** @type {?} */
            var id = ids[i];
            if (!entityExists(id, entities)) {
                return "continue";
            }
            if (Array.isArray(filterBy)) {
                /** @type {?} */
                var allPass = filterBy.every(function (fn) { return fn(entities[id], i); });
                if (allPass) {
                    map$$1[id] = entities[id];
                    count++;
                }
            }
            else {
                if (filterBy(entities[id], i)) {
                    map$$1[id] = entities[id];
                    count++;
                }
            }
        };
        for (var i = 0, length_1 = ids.length; i < length_1; i++) {
            var state_1 = _loop_2(i, length_1);
            if (state_1 === "break")
                break;
        }
    }
    else {
        var _loop_3 = function (i) {
            /** @type {?} */
            var id = ids[i];
            if (!entityExists(id, entities)) {
                return "continue";
            }
            if (!filterBy) {
                map$$1[id] = entities[id];
                return "continue";
            }
            if (Array.isArray(filterBy)) {
                /** @type {?} */
                var allPass = filterBy.every(function (fn) { return fn(entities[id], i); });
                if (allPass) {
                    map$$1[id] = entities[id];
                }
            }
            else {
                if (filterBy(entities[id], i)) {
                    map$$1[id] = entities[id];
                }
            }
        };
        for (var i = 0; i < length; i++) {
            _loop_3(i);
        }
    }
    return map$$1;
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/**
 *  A logical transaction.
 *  Use this transaction to optimize the dispatch of all the stores.
 *  The following code will update the store, BUT  emits only once
 *
 * \@example
 *  applyTransaction(() => {
 *    this.todosStore.add(new Todo(1, title));
 *    this.todosStore.add(new Todo(2, title));
 *  });
 *
 * @template T
 * @param {?} action
 * @param {?=} thisArg
 * @return {?}
 */
function applyTransaction(action, thisArg) {
    if (thisArg === void 0) { thisArg = undefined; }
    startBatch();
    try {
        return action.apply(thisArg);
    }
    finally {
        endBatch();
    }
}
/**
 *  A logical transaction.
 *  Use this transaction to optimize the dispatch of all the stores.
 *
 *  The following code will update the store, BUT  emits only once.
 *
 * \@example
 * \@transaction
 *  addTodos() {
 *    this.todosStore.add(new Todo(1, title));
 *    this.todosStore.add(new Todo(2, title));
 *  }
 *
 *
 * @return {?}
 */
function transaction() {
    return function (target, propertyKey, descriptor) {
        /** @type {?} */
        var originalMethod = descriptor.value;
        descriptor.value = function () {
            var _this = this;
            var args = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                args[_i] = arguments[_i];
            }
            return applyTransaction(function () {
                return originalMethod.apply(_this, args);
            }, this);
        };
        return descriptor;
    };
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
// https://github.com/georapbox/immutable-arrays
/**
 * Adds one or more elements to the end of an array by returning
 * a new array instead of mutating the original one.
 *
 * \@example
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = push(originalArray, 'f', 'g');
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['a', 'b', 'c', 'd', 'e', 'f', 'g']
 * @template T
 * @param {?} array
 * @param {...?} elementN
 * @return {?}
 */
function push(array) {
    var elementN = [];
    for (var _i = 1; _i < arguments.length; _i++) {
        elementN[_i - 1] = arguments[_i];
    }
    return __spread(array, elementN);
}
/**
 * Deletes an element from an array by its index in the array.
 *
 * \@example
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = remove(originalArray, 2);
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['a', 'b', 'd', 'e']
 * @template T
 * @param {?} array
 * @param {?} index
 * @return {?}
 */
function remove(array, index) {
    return index >= 0 ? __spread(array.slice(0, index), array.slice(index + 1)) : __spread(array);
}
/**
 * Removes the last element from an array by returning
 * a new array instead of mutating the original one.
 *
 * \@example
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = pop(originalArray);
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['a', 'b', 'c', 'd']
 * @template T
 * @param {?} array
 * @return {?}
 */
function pop(array) {
    return array.slice(0, -1);
}
/**
 * Adds one or more elements to the beginning of an array.
 *
 * \@example
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = unshift(originalArray, 'f', 'g');
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['f', 'g', 'a', 'b', 'c', 'd', 'e']
 * @template T
 * @param {?} array
 * @param {...?} elementN
 * @return {?}
 */
function unshift(array) {
    var elementN = [];
    for (var _i = 1; _i < arguments.length; _i++) {
        elementN[_i - 1] = arguments[_i];
    }
    return __spread(elementN, array);
}
/**
 * Sorts the elements of an array (not in place) and returns a sorted array.
 *
 * \@example
 * const numberArray = [20, 3, 4, 10, -3, 1, 0, 5];
 * const stringArray = ['Blue', 'Humpback', 'Beluga'];
 *
 * const resultArray = sort(numberArray, (a, b) => a - b);
 * // -> numberArray [20, 3, 4, 10, -3, 1, 0, 5]
 * // -> resultArray [-3, 0, 1, 3, 4, 5, 10, 20]
 *
 * const resultArray = sort(numberArray, (a, b) => b - a);
 * // -> numberArray [20, 3, 4, 10, -3, 1, 0, 5]
 * // -> resultArray [20, 10, 5, 4, 3, 1, 0, -3]
 *
 * const resultArray = sort(stringArray);
 * // -> stringArray ['Blue', 'Humpback', 'Beluga']
 * // -> resultArray ['Beluga', 'Blue', 'Humpback']
 *
 * const resultArray = sort(stringArray, (a, b) => a.toLowerCase() < b.toLowerCase());
 * // -> stringArray ['Blue', 'Humpback', 'Beluga']
 * // -> resultArray ['Humpback', 'Blue', 'Beluga']
 * @template T
 * @param {?} array
 * @param {?=} compareFunction
 * @return {?}
 */
function sort(array, compareFunction) {
    return __spread(array).sort(compareFunction);
}
/**
 * Reverses an array (not in place).
 * The first array element becomes the last, and the last array element becomes the first.
 *
 * \@example
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = reverse(originalArray);
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['e', 'd', 'c', 'b', 'a']
 * @template T
 * @param {?} array
 * @return {?}
 */
function reverse(array) {
    return __spread(array).reverse();
}
/**
 * Swap items in the array
 *
 * \@example
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = swap(originalArray, 1, 4);
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['a', 'e', 'c', 'd', 'b']
 * @template T
 * @param {?} array
 * @param {?} firstIndex
 * @param {?} secondIndex
 * @return {?}
 */
function swap(array, firstIndex, secondIndex) {
    /** @type {?} */
    var results = array.slice();
    /** @type {?} */
    var firstItem = array[firstIndex];
    results[firstIndex] = array[secondIndex];
    results[secondIndex] = firstItem;
    return results;
}
/**
 * Update item in the array
 *
 * \@example
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = update(originalArray, 1, 'newItem');
 * // -> resultArray ['a', 'newItem', 'c', 'd', 'b']
 *
 * const originalArray = [{title: 1}, {title: 2}];
 * const resultArray = update(originalArray, originalArray[0], {title: 3});
 * // -> resultArray  [{title: 3}, {title: 2}];
 * @template T
 * @param {?} array
 * @param {?} indexOrItem
 * @param {?} updated
 * @return {?}
 */
function update(array, indexOrItem, updated) {
    return array.map(function (current, idx) {
        if (typeof indexOrItem === 'number' && idx === indexOrItem) {
            return updated;
        }
        if (isObject(indexOrItem) && ((/** @type {?} */ (indexOrItem))) === current) {
            return __assign({}, ((/** @type {?} */ (indexOrItem))), ((/** @type {?} */ (updated))));
        }
        return current;
    });
}
/**
 * Removes existing elements and/or adds new elements to an array.
 *
 * \@example
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = splice(originalArray, 0);
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray []
 *
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = splice(originalArray, 0, 1);
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['b', 'c', 'd', 'e']
 *
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = splice(originalArray, 0, 3);
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['d', 'e']
 *
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = splice(originalArray, 0, originalArray.length);
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray []
 *
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = splice(originalArray, 0, -3);
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['a', 'b', 'c', 'd', 'e']
 *
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = splice(originalArray, 0, 0, 'lorem', 'ipsum');
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['lorem', 'ipsum', 'a', 'b', 'c', 'd', 'e']
 *
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = splice(originalArray, originalArray.length, 0, 'lorem', 'ipsum');
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['a', 'b', 'c', 'd', 'e', 'lorem', 'ipsum']
 *
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = splice(originalArray, 0, 2, 'lorem', 'ipsum');
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['lorem', 'ipsum', 'c', 'd', 'e']
 *
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = splice(originalArray, originalArray.length - 2, 2, 'lorem', 'ipsum');
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['a', 'b', 'c', 'lorem', 'ipsum']
 * @template T
 * @param {?} array
 * @param {?=} start
 * @param {?=} deleteCount
 * @param {...?} elementN
 * @return {?}
 */
function splice(array, start, deleteCount) {
    if (start === void 0) { start = array.length; }
    if (deleteCount === void 0) { deleteCount = array.length - start; }
    var elementN = [];
    for (var _i = 3; _i < arguments.length; _i++) {
        elementN[_i - 3] = arguments[_i];
    }
    return __spread(array.slice(0, start), elementN, array.slice(start + (deleteCount < 0 ? 0 : deleteCount)));
}
/**
 * @template T
 * @param {?} arr
 * @param {?} item
 * @return {?}
 */
function toggle(arr, item) {
    return arr.indexOf(item) > -1 ? arr.filter(function (current) { return item !== current; }) : push(arr, item);
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/** @type {?} */
var filterNil = function (source) { return source.pipe(filter(function (value) { return value !== null && typeof value !== 'undefined'; })); };

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/**
 * @template T
 * @param {?} func
 * @param {?} action
 * @param {?=} thisArg
 * @return {?}
 */
function applyAction(func, action, thisArg) {
    if (thisArg === void 0) { thisArg = undefined; }
    __globalState.setCustomAction(action, true);
    return func.apply(thisArg);
}
/**
 * @param {?} action
 * @param {?=} skipTransactionMsg
 * @return {?}
 */
function action(action, skipTransactionMsg) {
    if (skipTransactionMsg === void 0) { skipTransactionMsg = true; }
    return function (target, propertyKey, descriptor) {
        /** @type {?} */
        var originalMethod = descriptor.value;
        descriptor.value = function () {
            var args = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                args[_i] = arguments[_i];
            }
            __globalState.setCustomAction(action, skipTransactionMsg);
            return originalMethod.apply(this, args);
        };
        return descriptor;
    };
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/**
 * @param {?} object
 * @return {?}
 */
function serialize(object) {
    return JSON.stringify(object, function (key, value) {
        if (typeof value === 'function') {
            return value.toString();
        }
        return value;
    });
}
/**
 * @return {?}
 */
function createWorker() {
    /** @type {?} */
    var blob = new Blob([
        "self.onmessage = function(e) {\n\n      function deserialize(str) {\n        return JSON.parse(str || '', function(key, value) {\n          if (value &&\n            typeof value === \"string\" &&\n            value.substr(0, 8) == \"function\") {\n            var startBody = value.indexOf('{') + 1;\n            var endBody = value.lastIndexOf('}');\n            var startArgs = value.indexOf('(') + 1;\n            var endArgs = value.indexOf(')');\n            return new Function(value.substring(startArgs, endArgs), value.substring(startBody, endBody));\n          }\n          return value;\n        });\n      }\n\n      var deserialized = deserialize(e.data);\n      var mapped = deserialized.data.map(function(d) {\n        return deserialized.factory(d);\n      });\n\n      self.postMessage(mapped);\n    }"
    ], {
        type: 'text/javascript'
    });
    /** @type {?} */
    var url = URL.createObjectURL(blob);
    return new Worker(url);
}
/**
 * \@example
 *   const mockTodos = Array.from({length: 10000}, (_, x) => ({id: x}));
 *
 *   of(mockTodos).pipe(mapInWorker<Todo>(createTodo))
 *   .subscribe(res => console.log(res));
 * @template T
 * @param {?} factoryFn
 * @return {?}
 */
function mapInWorker(factoryFn) {
    return function (source) {
        return new Observable(function (observer) {
            /** @type {?} */
            var worker = createWorker();
            worker.onmessage = function (e) {
                observer.next(e.data);
                observer.complete();
                worker.terminate();
            };
            worker.onerror = function (err) {
                observer.error(err);
                observer.complete();
                worker.terminate();
            };
            return source.subscribe(function (value) {
                /** @type {?} */
                var input = {
                    factory: factoryFn,
                    data: value
                };
                /** @type {?} */
                var serialized = serialize(input);
                worker.postMessage(serialized);
            });
        });
    };
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
var SnapshotManager = /** @class */ (function () {
    function SnapshotManager() {
    }
    /**
     * Get a snapshot of the whole state or a specific stores
     * Use it ONLY for things like saving the state in the server
     */
    /**
     * Get a snapshot of the whole state or a specific stores
     * Use it ONLY for things like saving the state in the server
     * @param {?=} stores
     * @return {?}
     */
    SnapshotManager.prototype.getStoresSnapshot = /**
     * Get a snapshot of the whole state or a specific stores
     * Use it ONLY for things like saving the state in the server
     * @param {?=} stores
     * @return {?}
     */
    function (stores) {
        if (stores === void 0) { stores = []; }
        /** @type {?} */
        var acc = {};
        /** @type {?} */
        var hasInclude = stores.length > 0;
        /** @type {?} */
        var keys = hasInclude ? stores : Object.keys(__stores__);
        for (var i = 0; i < keys.length; i++) {
            /** @type {?} */
            var storeName = keys[i];
            acc[storeName] = __stores__[storeName]._value();
        }
        return acc;
    };
    /**
     * Set snapshot we get from the server
     */
    /**
     * Set snapshot we get from the server
     * @param {?} stores
     * @return {?}
     */
    SnapshotManager.prototype.setStoresSnapshot = /**
     * Set snapshot we get from the server
     * @param {?} stores
     * @return {?}
     */
    function (stores) {
        /** @type {?} */
        var normalizedStores = stores;
        if (isString(stores)) {
            normalizedStores = JSON.parse((/** @type {?} */ (normalizedStores)));
        }
        var _loop_1 = function (i, keys) {
            /** @type {?} */
            var storeName = keys[i];
            if (__stores__[storeName]) {
                __stores__[storeName].setState(function () { return normalizedStores[storeName]; });
            }
        };
        for (var i = 0, keys = Object.keys(normalizedStores); i < keys.length; i++) {
            _loop_1(i, keys);
        }
    };
    return SnapshotManager;
}());
/** @type {?} */
var snapshotManager = new SnapshotManager();

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/**
 * @abstract
 * @template E, S
 */
var  /**
 * @abstract
 * @template E, S
 */
AkitaPlugin = /** @class */ (function () {
    function AkitaPlugin(query, config) {
        this.query = query;
        if (config && config.resetFn) {
            if (getAkitaConfig().resettable) {
                this.onReset(config.resetFn);
            }
        }
    }
    /** This method is responsible for getting access to the query. */
    /**
     * This method is responsible for getting access to the query.
     * @return {?}
     */
    AkitaPlugin.prototype.getQuery = /**
     * This method is responsible for getting access to the query.
     * @return {?}
     */
    function () {
        return this.query;
    };
    /** This method is responsible for getting access to the store. */
    /**
     * This method is responsible for getting access to the store.
     * @return {?}
     */
    AkitaPlugin.prototype.getStore = /**
     * This method is responsible for getting access to the store.
     * @return {?}
     */
    function () {
        return this.getQuery().__store__;
    };
    /** This method is responsible tells whether the plugin is entityBased or not.  */
    /**
     * This method is responsible tells whether the plugin is entityBased or not.
     * @param {?} entityId
     * @return {?}
     */
    AkitaPlugin.prototype.isEntityBased = /**
     * This method is responsible tells whether the plugin is entityBased or not.
     * @param {?} entityId
     * @return {?}
     */
    function (entityId) {
        return toBoolean(entityId);
    };
    /** This method is responsible for selecting the source; it can be the whole store or one entity. */
    /**
     * This method is responsible for selecting the source; it can be the whole store or one entity.
     * @param {?} entityId
     * @return {?}
     */
    AkitaPlugin.prototype.selectSource = /**
     * This method is responsible for selecting the source; it can be the whole store or one entity.
     * @param {?} entityId
     * @return {?}
     */
    function (entityId) {
        if (this.isEntityBased(entityId)) {
            return ((/** @type {?} */ (this.getQuery()))).selectEntity(entityId).pipe(filterNil);
        }
        return ((/** @type {?} */ (this.getQuery()))).select(function (state) { return state; });
    };
    /**
     * @param {?} entityId
     * @return {?}
     */
    AkitaPlugin.prototype.getSource = /**
     * @param {?} entityId
     * @return {?}
     */
    function (entityId) {
        if (this.isEntityBased(entityId)) {
            return ((/** @type {?} */ (this.getQuery()))).getEntity(entityId);
        }
        return this.getQuery().getSnapshot();
    };
    /** This method is responsible for updating the store or one entity; it can be the whole store or one entity. */
    /**
     * This method is responsible for updating the store or one entity; it can be the whole store or one entity.
     * @param {?} newState
     * @param {?=} entityId
     * @return {?}
     */
    AkitaPlugin.prototype.updateStore = /**
     * This method is responsible for updating the store or one entity; it can be the whole store or one entity.
     * @param {?} newState
     * @param {?=} entityId
     * @return {?}
     */
    function (newState, entityId) {
        if (this.isEntityBased(entityId)) {
            this.getStore().update(entityId, newState);
        }
        else {
            this.getStore().setState(function (state) { return (__assign({}, state, newState)); });
        }
    };
    /**
     * Function to invoke upon reset
     */
    /**
     * Function to invoke upon reset
     * @param {?} fn
     * @return {?}
     */
    AkitaPlugin.prototype.onReset = /**
     * Function to invoke upon reset
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        var _this = this;
        /** @type {?} */
        var original = this.getStore().reset;
        this.getStore().reset = function () {
            var params = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                params[_i] = arguments[_i];
            }
            /** It should run after the plugin destroy method */
            setTimeout(function () {
                original.apply(_this.getStore(), params);
                fn();
            });
        };
    };
    return AkitaPlugin;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/** @type {?} */
var paginatorDefaults = {
    pagesControls: false,
    range: false,
    startWith: 1,
    cacheTimeout: undefined
};
/**
 * @template E
 */
var PaginatorPlugin = /** @class */ (function (_super) {
    __extends(PaginatorPlugin, _super);
    function PaginatorPlugin(query, config) {
        if (config === void 0) { config = {}; }
        var _this = _super.call(this, query, {
            resetFn: function () {
                _this.initial = false;
                _this.destroy({ clearCache: true, currentPage: 1 });
            }
        }) || this;
        _this.query = query;
        _this.config = config;
        /**
         * Save current filters, sorting, etc. in cache
         */
        _this.metadata = new Map();
        _this.pages = new Map();
        _this.pagination = {
            currentPage: 1,
            perPage: 0,
            total: 0,
            lastPage: 0,
            data: []
        };
        /**
         * When the user navigates to a different page and return
         * we don't want to call `clearCache` on first time.
         */
        _this.initial = false;
        /**
         * Proxy to the query loading
         */
        _this.isLoading$ = _this.query.selectLoading().pipe(delay(0));
        _this.config = Object.assign(paginatorDefaults, config);
        var _a = _this.config, startWith = _a.startWith, cacheTimeout = _a.cacheTimeout;
        _this.page = new BehaviorSubject(startWith);
        if (isObservable(cacheTimeout)) {
            _this.clearCacheSubscription = cacheTimeout.subscribe(function (_) { return _this.clearCache(); });
        }
        return _this;
    }
    Object.defineProperty(PaginatorPlugin.prototype, "pageChanges", {
        /**
         * Listen to page changes
         */
        get: /**
         * Listen to page changes
         * @return {?}
         */
        function () {
            return this.page.asObservable();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PaginatorPlugin.prototype, "currentPage", {
        /**
         * Get the current page number
         */
        get: /**
         * Get the current page number
         * @return {?}
         */
        function () {
            return this.pagination.currentPage;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PaginatorPlugin.prototype, "isFirst", {
        /**
         * Check if current page is the first one
         */
        get: /**
         * Check if current page is the first one
         * @return {?}
         */
        function () {
            return this.currentPage === 1;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PaginatorPlugin.prototype, "isLast", {
        /**
         * Check if current page is the last one
         */
        get: /**
         * Check if current page is the last one
         * @return {?}
         */
        function () {
            return this.currentPage === this.pagination.lastPage;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Whether to generate an array of pages for *ngFor
     * [1, 2, 3, 4]
     */
    /**
     * Whether to generate an array of pages for *ngFor
     * [1, 2, 3, 4]
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    PaginatorPlugin.prototype.withControls = /**
     * Whether to generate an array of pages for *ngFor
     * [1, 2, 3, 4]
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    function () {
        (/** @type {?} */ (this)).config.pagesControls = true;
        return (/** @type {?} */ (this));
    };
    /**
     * Whether to generate the `from` and `to` keys
     * [1, 2, 3, 4]
     */
    /**
     * Whether to generate the `from` and `to` keys
     * [1, 2, 3, 4]
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    PaginatorPlugin.prototype.withRange = /**
     * Whether to generate the `from` and `to` keys
     * [1, 2, 3, 4]
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    function () {
        (/** @type {?} */ (this)).config.range = true;
        return (/** @type {?} */ (this));
    };
    /**
     * Set the loading state
     */
    /**
     * Set the loading state
     * @param {?=} value
     * @return {?}
     */
    PaginatorPlugin.prototype.setLoading = /**
     * Set the loading state
     * @param {?=} value
     * @return {?}
     */
    function (value) {
        if (value === void 0) { value = true; }
        this.getStore().setLoading(value);
    };
    /**
     * Update the pagination object and add the page
     */
    /**
     * Update the pagination object and add the page
     * @param {?} response
     * @return {?}
     */
    PaginatorPlugin.prototype.update = /**
     * Update the pagination object and add the page
     * @param {?} response
     * @return {?}
     */
    function (response) {
        this.pagination = response;
        this.addPage(response.data);
    };
    /**
     *
     * Set the ids and add the page to store
     */
    /**
     *
     * Set the ids and add the page to store
     * @param {?} data
     * @return {?}
     */
    PaginatorPlugin.prototype.addPage = /**
     *
     * Set the ids and add the page to store
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var _this = this;
        this.pages.set(this.currentPage, { ids: data.map(function (entity) { return entity[_this.getStore().idKey]; }) });
        this.getStore().add(data);
    };
    /**
     * Clear the cache.
     */
    /**
     * Clear the cache.
     * @return {?}
     */
    PaginatorPlugin.prototype.clearCache = /**
     * Clear the cache.
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.initial) {
            applyAction(function () {
                _this.getStore().remove();
            }, { type: '@Pagination - Clear Cache' });
            this.pages = new Map();
            this.metadata = new Map();
        }
        this.initial = false;
    };
    /**
     * @param {?} page
     * @return {?}
     */
    PaginatorPlugin.prototype.clearPage = /**
     * @param {?} page
     * @return {?}
     */
    function (page) {
        this.pages.delete(page);
    };
    /**
     * Clear the cache timeout and optionally the pages
     */
    /**
     * Clear the cache timeout and optionally the pages
     * @param {?=} __0
     * @return {?}
     */
    PaginatorPlugin.prototype.destroy = /**
     * Clear the cache timeout and optionally the pages
     * @param {?=} __0
     * @return {?}
     */
    function (_a) {
        var _b = _a === void 0 ? {} : _a, clearCache = _b.clearCache, currentPage = _b.currentPage;
        if (this.clearCacheSubscription) {
            this.clearCacheSubscription.unsubscribe();
        }
        if (clearCache) {
            this.clearCache();
        }
        if (!isUndefined(currentPage)) {
            this.setPage(currentPage);
        }
        this.initial = true;
    };
    /**
     * Whether the provided page is active
     */
    /**
     * Whether the provided page is active
     * @param {?} page
     * @return {?}
     */
    PaginatorPlugin.prototype.isPageActive = /**
     * Whether the provided page is active
     * @param {?} page
     * @return {?}
     */
    function (page) {
        return this.currentPage === page;
    };
    /**
     * Set the current page
     */
    /**
     * Set the current page
     * @param {?} page
     * @return {?}
     */
    PaginatorPlugin.prototype.setPage = /**
     * Set the current page
     * @param {?} page
     * @return {?}
     */
    function (page) {
        if (page !== this.currentPage || !this.hasPage(page)) {
            this.page.next((this.pagination.currentPage = page));
        }
    };
    /**
     * Increment current page
     */
    /**
     * Increment current page
     * @return {?}
     */
    PaginatorPlugin.prototype.nextPage = /**
     * Increment current page
     * @return {?}
     */
    function () {
        if (this.currentPage !== this.pagination.lastPage) {
            this.setPage(this.pagination.currentPage + 1);
        }
    };
    /**
     * Decrement current page
     */
    /**
     * Decrement current page
     * @return {?}
     */
    PaginatorPlugin.prototype.prevPage = /**
     * Decrement current page
     * @return {?}
     */
    function () {
        if (this.pagination.currentPage > 1) {
            this.setPage(this.pagination.currentPage - 1);
        }
    };
    /**
     * Set current page to last
     */
    /**
     * Set current page to last
     * @return {?}
     */
    PaginatorPlugin.prototype.setLastPage = /**
     * Set current page to last
     * @return {?}
     */
    function () {
        this.setPage(this.pagination.lastPage);
    };
    /**
     * Set current page to first
     */
    /**
     * Set current page to first
     * @return {?}
     */
    PaginatorPlugin.prototype.setFirstPage = /**
     * Set current page to first
     * @return {?}
     */
    function () {
        this.setPage(1);
    };
    /**
     * Check if page exists in cache
     */
    /**
     * Check if page exists in cache
     * @param {?} page
     * @return {?}
     */
    PaginatorPlugin.prototype.hasPage = /**
     * Check if page exists in cache
     * @param {?} page
     * @return {?}
     */
    function (page) {
        return this.pages.has(page);
    };
    /**
     * Get the current page if it's in cache, otherwise invoke the request
     */
    /**
     * Get the current page if it's in cache, otherwise invoke the request
     * @param {?} req
     * @return {?}
     */
    PaginatorPlugin.prototype.getPage = /**
     * Get the current page if it's in cache, otherwise invoke the request
     * @param {?} req
     * @return {?}
     */
    function (req) {
        var _this = this;
        /** @type {?} */
        var page = this.pagination.currentPage;
        if (this.hasPage(page)) {
            return this.selectPage(page);
        }
        else {
            this.setLoading(true);
            return from(req()).pipe(switchMap(function (config) {
                applyTransaction(function () {
                    _this.setLoading(false);
                    _this.update(config);
                });
                return _this.selectPage(page);
            }));
        }
    };
    /**
     * @return {?}
     */
    PaginatorPlugin.prototype.getQuery = /**
     * @return {?}
     */
    function () {
        return this.query;
    };
    /**
     * @return {?}
     */
    PaginatorPlugin.prototype.getFrom = /**
     * @return {?}
     */
    function () {
        if (this.isFirst) {
            return 1;
        }
        return (this.currentPage - 1) * this.pagination.perPage + 1;
    };
    /**
     * @return {?}
     */
    PaginatorPlugin.prototype.getTo = /**
     * @return {?}
     */
    function () {
        return this.currentPage * this.pagination.perPage;
    };
    /**
     * Select the page
     */
    /**
     * Select the page
     * @param {?} page
     * @return {?}
     */
    PaginatorPlugin.prototype.selectPage = /**
     * Select the page
     * @param {?} page
     * @return {?}
     */
    function (page) {
        var _this = this;
        return this.query.selectAll({ asObject: true }).pipe(take(1), map(function (entities) {
            /** @type {?} */
            var response = __assign({}, _this.pagination, { data: _this.pages.get(page).ids.map(function (id) { return entities[id]; }) });
            var _a = _this.config, range = _a.range, pagesControls = _a.pagesControls;
            /** If no total - calc it */
            if (isNaN(_this.pagination.total)) {
                if (response.lastPage === 1) {
                    response.total = response.data ? response.data.length : 0;
                }
                else {
                    response.total = response.perPage * response.lastPage;
                }
                _this.pagination.total = response.total;
            }
            if (range) {
                response.from = _this.getFrom();
                response.to = _this.getTo();
            }
            if (pagesControls) {
                response.pageControls = generatePages(_this.pagination.total, _this.pagination.perPage);
            }
            return response;
        }));
    };
    __decorate([
        action({ type: '@Pagination - New Page' }, true),
        __metadata("design:type", Function),
        __metadata("design:paramtypes", [Object]),
        __metadata("design:returntype", void 0)
    ], PaginatorPlugin.prototype, "update", null);
    return PaginatorPlugin;
}(AkitaPlugin));
/**
 * Generate an array so we can ngFor them to navigate between pages
 * @param {?} total
 * @param {?} perPage
 * @return {?}
 */
function generatePages(total, perPage) {
    /** @type {?} */
    var len = Math.ceil(total / perPage);
    /** @type {?} */
    var arr = [];
    for (var i = 0; i < len; i++) {
        arr.push(i + 1);
    }
    return arr;
}
/**
 * backward compatibility
 * @type {?}
 */
var Paginator = PaginatorPlugin;

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
// Todo: Return  AbstractControl interface
/**
 * @template T
 */
var  
// Todo: Return  AbstractControl interface
/**
 * @template T
 */
PersistNgFormPlugin = /** @class */ (function (_super) {
    __extends(PersistNgFormPlugin, _super);
    function PersistNgFormPlugin(query, factoryFnOrPath, params) {
        if (params === void 0) { params = {}; }
        var _this = _super.call(this, query) || this;
        _this.query = query;
        _this.factoryFnOrPath = factoryFnOrPath;
        _this.params = params;
        _this.params = __assign({ debounceTime: 300, formKey: 'akitaForm', emitEvent: false, arrControlFactory: function (v) { return _this.builder.control(v); } }, params);
        _this.isRootKeys = toBoolean(factoryFnOrPath) === false;
        _this.isKeyBased = isString(factoryFnOrPath) || _this.isRootKeys;
        return _this;
    }
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} form
     * @param {?=} builder
     * @return {THIS}
     */
    PersistNgFormPlugin.prototype.setForm = /**
     * @template THIS
     * @this {THIS}
     * @param {?} form
     * @param {?=} builder
     * @return {THIS}
     */
    function (form, builder) {
        (/** @type {?} */ (this)).form = form;
        (/** @type {?} */ (this)).builder = builder;
        (/** @type {?} */ (this)).activate();
        return (/** @type {?} */ (this));
    };
    /**
     * @param {?=} initialState
     * @return {?}
     */
    PersistNgFormPlugin.prototype.reset = /**
     * @param {?=} initialState
     * @return {?}
     */
    function (initialState) {
        var _this = this;
        var _a;
        /** @type {?} */
        var value;
        if (initialState) {
            value = initialState;
        }
        else {
            value = this.isKeyBased ? this.initialValue : ((/** @type {?} */ (this))).factoryFnOrPath();
        }
        if (this.isKeyBased) {
            Object.keys(this.initialValue).forEach(function (stateKey) {
                /** @type {?} */
                var value = _this.initialValue[stateKey];
                if (Array.isArray(value) && _this.builder) {
                    /** @type {?} */
                    var formArray = _this.form.controls[stateKey];
                    _this.cleanArray(formArray);
                    value.forEach(function (v, i) {
                        _this.form.get(stateKey).insert(i, ((/** @type {?} */ (_this.params.arrControlFactory)))(v));
                    });
                }
            });
        }
        this.form.patchValue(value, { emitEvent: this.params.emitEvent });
        /** @type {?} */
        var storeValue = this.isKeyBased ? setValue(this.getQuery().getSnapshot(), this.getStore().storeName + "." + this.factoryFnOrPath, value) : (_a = {}, _a[this.params.formKey] = value, _a);
        this.updateStore(storeValue);
    };
    /**
     * @param {?} control
     * @return {?}
     */
    PersistNgFormPlugin.prototype.cleanArray = /**
     * @param {?} control
     * @return {?}
     */
    function (control) {
        while (control.length !== 0) {
            control.removeAt(0);
        }
    };
    /**
     * @param {?} formValue
     * @param {?} root
     * @return {?}
     */
    PersistNgFormPlugin.prototype.resolveInitialValue = /**
     * @param {?} formValue
     * @param {?} root
     * @return {?}
     */
    function (formValue, root) {
        var _this = this;
        if (!formValue)
            return;
        return Object.keys(formValue).reduce(function (acc, stateKey) {
            /** @type {?} */
            var value = root[stateKey];
            if (Array.isArray(value) && _this.builder) {
                /** @type {?} */
                var factory_1 = _this.params.arrControlFactory;
                _this.cleanArray(_this.form.get(stateKey));
                value.forEach(function (v, i) {
                    _this.form.get(stateKey).insert(i, ((/** @type {?} */ (factory_1)))(v));
                });
            }
            acc[stateKey] = root[stateKey];
            return acc;
        }, {});
    };
    /**
     * @return {?}
     */
    PersistNgFormPlugin.prototype.activate = /**
     * @return {?}
     */
    function () {
        var _this = this;
        var _a;
        /** @type {?} */
        var path;
        if (this.isKeyBased) {
            if (this.isRootKeys) {
                this.initialValue = this.resolveInitialValue(this.form.value, this.getQuery().getSnapshot());
                this.form.patchValue(this.initialValue, { emitEvent: this.params.emitEvent });
            }
            else {
                path = this.getStore().storeName + "." + this.factoryFnOrPath;
                /** @type {?} */
                var root = getValue(this.getQuery().getSnapshot(), path);
                this.initialValue = this.resolveInitialValue(root, root);
                this.form.patchValue(this.initialValue, { emitEvent: this.params.emitEvent });
            }
        }
        else {
            if (!((/** @type {?} */ (this.getQuery().getSnapshot())))[this.params.formKey]) {
                __globalState.setAction({ type: '@PersistNgFormPlugin activate' });
                this.updateStore((_a = {}, _a[this.params.formKey] = ((/** @type {?} */ (this))).factoryFnOrPath(), _a));
            }
            /** @type {?} */
            var value = this.getQuery().getSnapshot()[this.params.formKey];
            this.form.patchValue(value);
        }
        this.formChanges = this.form.valueChanges.pipe(debounceTime(this.params.debounceTime)).subscribe(function (value) {
            __globalState.setAction({ type: '@PersistForm - Update' });
            /** @type {?} */
            var newState;
            if (_this.isKeyBased) {
                if (_this.isRootKeys) {
                    newState = function (state) { return (__assign({}, state, value)); };
                }
                else {
                    newState = function (state) { return setValue(state, path, value); };
                }
            }
            else {
                newState = function () {
                    var _a;
                    return (_a = {}, _a[_this.params.formKey] = value, _a);
                };
            }
            _this.updateStore(newState(_this.getQuery().getSnapshot()));
        });
    };
    /**
     * @return {?}
     */
    PersistNgFormPlugin.prototype.destroy = /**
     * @return {?}
     */
    function () {
        this.formChanges && this.formChanges.unsubscribe();
        this.form = null;
        this.builder = null;
    };
    return PersistNgFormPlugin;
}(AkitaPlugin));

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/** @type {?} */
var notBs = typeof localStorage === 'undefined';
/**
 * @param {?=} params
 * @return {?}
 */
function persistState(params) {
    if (notBs)
        return;
    /** @type {?} */
    var defaults = {
        key: 'AkitaStores',
        storage: localStorage,
        deserialize: JSON.parse,
        serialize: JSON.stringify,
        include: [],
        exclude: []
    };
    var _a = Object.assign({}, defaults, params), storage = _a.storage, deserialize = _a.deserialize, serialize = _a.serialize, include = _a.include, exclude = _a.exclude, key = _a.key;
    /** @type {?} */
    var hasInclude = include.length > 0;
    /** @type {?} */
    var hasExclude = exclude.length > 0;
    /** @type {?} */
    var includeStores;
    if (hasInclude && hasExclude) {
        throw new AkitaError("You can't use both include and exclude");
    }
    if (hasInclude) {
        includeStores = include.reduce(function (acc, path) {
            /** @type {?} */
            var storeName = path.split('.')[0];
            acc[storeName] = path;
            return acc;
        }, {});
    }
    /** @type {?} */
    var storageState = deserialize(storage.getItem(key) || '{}');
    /** @type {?} */
    var stores = {};
    /** @type {?} */
    var acc = {};
    /**
     * @return {?}
     */
    function save() {
        storage.setItem(key, serialize(Object.assign({}, storageState, acc)));
    }
    /**
     * @param {?} storeName
     * @param {?} path
     * @return {?}
     */
    function subscribe(storeName, path) {
        stores[storeName] = __stores__[storeName]
            ._select(function (state) { return getValue(state, path); })
            .pipe(skip(1))
            .subscribe(function (data) {
            acc[storeName] = data;
            save();
        });
    }
    /**
     * @param {?} storeName
     * @param {?} store
     * @param {?} path
     * @return {?}
     */
    function setInitial(storeName, store, path) {
        if (storageState[storeName]) {
            __globalState.setAction({ type: '@PersistState' });
            store.setState(function (state) {
                return setValue(state, path, storageState[storeName]);
            });
            if (store.setDirty) {
                store.setDirty();
            }
        }
    }
    /** @type {?} */
    var subscription = rootDispatcher.pipe(filter(function (action) { return action.type === 0 /* NEW_STORE */; })).subscribe(function (action) {
        /** @type {?} */
        var currentStoreName = action.payload.store.storeName;
        if (hasExclude && exclude.includes(currentStoreName)) {
            return;
        }
        if (hasInclude) {
            /** @type {?} */
            var path = includeStores[currentStoreName];
            if (!path) {
                return;
            }
            setInitial(currentStoreName, action.payload.store, path);
            subscribe(currentStoreName, path);
        }
        else {
            setInitial(currentStoreName, action.payload.store, currentStoreName);
            subscribe(currentStoreName, currentStoreName);
        }
    });
    return {
        destroy: /**
         * @return {?}
         */
        function () {
            subscription.unsubscribe();
            for (var i = 0, keys = Object.keys(stores); i < keys.length; i++) {
                /** @type {?} */
                var storeName = keys[i];
                stores[storeName].unsubscribe();
            }
            stores = {};
        },
        clear: /**
         * @return {?}
         */
        function () {
            storage.clear();
        },
        clearStore: /**
         * @param {?} storeName
         * @return {?}
         */
        function (storeName) {
            /** @type {?} */
            var storageState = deserialize(storage.getItem(key) || '{}');
            if (storageState[storeName]) {
                delete storageState[storeName];
                storage.setItem(key, serialize(storageState));
            }
        }
    };
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/** @type {?} */
var rootDispatcherSub;
/** @type {?} */
var devtoolsSub;
/**
 * @param {?=} ngZoneOrOptions
 * @param {?=} options
 * @return {?}
 */
function akitaDevtools(ngZoneOrOptions, options) {
    if (options === void 0) { options = {}; }
    if (!((/** @type {?} */ (window))).__REDUX_DEVTOOLS_EXTENSION__) {
        return;
    }
    rootDispatcherSub && rootDispatcherSub.unsubscribe();
    devtoolsSub && devtoolsSub();
    /** @type {?} */
    var isAngular = ngZoneOrOptions && ngZoneOrOptions['run'];
    if (!isAngular) {
        ngZoneOrOptions = ngZoneOrOptions || {};
        ((/** @type {?} */ (ngZoneOrOptions))).run = function (cb) { return cb(); };
        options = (/** @type {?} */ (ngZoneOrOptions));
    }
    /** @type {?} */
    var defaultOptions = { name: 'Akita' };
    /** @type {?} */
    var merged = Object.assign({}, defaultOptions, options);
    /** @type {?} */
    var devTools = ((/** @type {?} */ (window))).__REDUX_DEVTOOLS_EXTENSION__.connect(merged);
    /** @type {?} */
    var appState = {};
    rootDispatcherSub = rootDispatcher.subscribe(function (action) {
        var _a;
        if (action.type === 1 /* DELETE_STORE */) {
            /** @type {?} */
            var storeName = action.payload.storeName;
            delete appState[storeName];
            devTools.send({ type: "[" + storeName + "] - Delete Store" }, appState);
        }
        if (action.type === 2 /* NEW_STATE */) {
            if (__globalState.skipAction) {
                __globalState.setSkipAction(false);
                return;
            }
            appState = __assign({}, appState, (_a = {}, _a[action.payload.name] = __stores__[action.payload.name]._value(), _a));
            var _b = __globalState.currentAction, type = _b.type, entityId = _b.entityId;
            /** @type {?} */
            var storeName = capitalize(action.payload.name);
            /** @type {?} */
            var msg = isDefined(entityId) ? "[" + storeName + "] - " + type + " (ids: " + entityId + ")" : "[" + storeName + "] - " + type;
            if (options.logTrace) {
                console.group(msg);
                console.trace();
                console.groupEnd();
            }
            devTools.send({ type: msg, transaction: __globalState.currentT.map(function (t) { return t.type; }) }, appState);
        }
    });
    devtoolsSub = devTools.subscribe(function (message) {
        if (message.type === 'ACTION') {
            var _a = __read(message.payload.split('.'), 1), storeName_1 = _a[0];
            if (__stores__[storeName_1]) {
                ((/** @type {?} */ (ngZoneOrOptions))).run(function () {
                    /** @type {?} */
                    var funcCall = message.payload.replace(storeName_1, "this['" + storeName_1 + "']");
                    try {
                        new Function("" + funcCall).call(__stores__);
                    }
                    catch (e) {
                        console.warn('Unknown Method ');
                    }
                });
            }
        }
        if (message.type === 'DISPATCH') {
            /** @type {?} */
            var payloadType = message.payload.type;
            if (payloadType === 'COMMIT') {
                devTools.init(appState);
                return;
            }
            if (message.state) {
                /** @type {?} */
                var rootState_1 = JSON.parse(message.state);
                var _loop_1 = function (i, keys) {
                    /** @type {?} */
                    var storeName = keys[i];
                    if (__stores__[storeName]) {
                        ((/** @type {?} */ (ngZoneOrOptions))).run(function () {
                            __stores__[storeName].setState(function () { return rootState_1[storeName]; }, false);
                        });
                    }
                };
                for (var i = 0, keys = Object.keys(rootState_1); i < keys.length; i++) {
                    _loop_1(i, keys);
                }
            }
        }
    });
}
/**
 * @param {?} string
 * @return {?}
 */
function capitalize(string) {
    return string && string.charAt(0).toUpperCase() + string.slice(1);
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
var 0 = function (plugin) { return plugin.destroy(); };
/** @type {?} */
var defaultActions = { beforeRemove: 0 };
/**
 * @abstract
 * @template E, P
 */
var  /**
 * @abstract
 * @template E, P
 */
EntityCollectionPlugin = /** @class */ (function () {
    function EntityCollectionPlugin(query, entityIds) {
        this.query = query;
        this.entityIds = entityIds;
        this.entities = new Map();
    }
    /**
     * Get the entity plugin instance.
     */
    /**
     * Get the entity plugin instance.
     * @param {?} id
     * @return {?}
     */
    EntityCollectionPlugin.prototype.getEntity = /**
     * Get the entity plugin instance.
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return this.entities.get(id);
    };
    /**
     * Whether the entity plugin exist.
     */
    /**
     * Whether the entity plugin exist.
     * @param {?} id
     * @return {?}
     */
    EntityCollectionPlugin.prototype.hasEntity = /**
     * Whether the entity plugin exist.
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return this.entities.has(id);
    };
    /**
     * Remove the entity plugin instance.
     */
    /**
     * Remove the entity plugin instance.
     * @param {?} id
     * @return {?}
     */
    EntityCollectionPlugin.prototype.removeEntity = /**
     * Remove the entity plugin instance.
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return this.entities.delete(id);
    };
    /**
     * Set the entity plugin instance.
     */
    /**
     * Set the entity plugin instance.
     * @param {?} id
     * @param {?} plugin
     * @return {?}
     */
    EntityCollectionPlugin.prototype.createEntity = /**
     * Set the entity plugin instance.
     * @param {?} id
     * @param {?} plugin
     * @return {?}
     */
    function (id, plugin) {
        return this.entities.set(id, plugin);
    };
    /**
     * If the user passes `entityIds` we take them; otherwise, we take all.
     */
    /**
     * If the user passes `entityIds` we take them; otherwise, we take all.
     * @return {?}
     */
    EntityCollectionPlugin.prototype.getIds = /**
     * If the user passes `entityIds` we take them; otherwise, we take all.
     * @return {?}
     */
    function () {
        return isUndefined(this.entityIds) ? this.query.getSnapshot().ids : coerceArray(this.entityIds);
    };
    /**
     * When you call one of the plugin methods, you can pass id/ids or undefined which means all.
     */
    /**
     * When you call one of the plugin methods, you can pass id/ids or undefined which means all.
     * @param {?=} ids
     * @return {?}
     */
    EntityCollectionPlugin.prototype.resolvedIds = /**
     * When you call one of the plugin methods, you can pass id/ids or undefined which means all.
     * @param {?=} ids
     * @return {?}
     */
    function (ids) {
        return isUndefined(ids) ? this.getIds() : coerceArray(ids);
    };
    /**
     * Call this method when you want to activate the plugin on init or when you need to listen to add/remove of entities dynamically.
     *
     * For example in your plugin you may do the following:
     *
     * this.query.select(state => state.ids).pipe(skip(1)).subscribe(ids => this.activate(ids));
     */
    /**
     * Call this method when you want to activate the plugin on init or when you need to listen to add/remove of entities dynamically.
     *
     * For example in your plugin you may do the following:
     *
     * this.query.select(state => state.ids).pipe(skip(1)).subscribe(ids => this.activate(ids));
     * @param {?} ids
     * @param {?=} actions
     * @return {?}
     */
    EntityCollectionPlugin.prototype.rebase = /**
     * Call this method when you want to activate the plugin on init or when you need to listen to add/remove of entities dynamically.
     *
     * For example in your plugin you may do the following:
     *
     * this.query.select(state => state.ids).pipe(skip(1)).subscribe(ids => this.activate(ids));
     * @param {?} ids
     * @param {?=} actions
     * @return {?}
     */
    function (ids, actions) {
        var _this = this;
        if (actions === void 0) { actions = defaultActions; }
        /**
         *
         * If the user passes `entityIds` & we have new ids check if we need to add/remove instances.
         *
         * This phase will be called only upon update.
         */
        if (toBoolean(ids)) {
            /**
             * Which means all
             */
            if (isUndefined(this.entityIds)) {
                for (var i = 0, len = ids.length; i < len; i++) {
                    /** @type {?} */
                    var entityId = ids[i];
                    if (this.hasEntity(entityId) === false) {
                        isFunction(actions.beforeAdd) && actions.beforeAdd(entityId);
                        /** @type {?} */
                        var plugin = this.instantiatePlugin(entityId);
                        this.entities.set(entityId, plugin);
                        isFunction(actions.afterAdd) && actions.afterAdd(plugin);
                    }
                }
                this.entities.forEach(function (plugin, entityId) {
                    if (ids.indexOf(entityId) === -1) {
                        isFunction(actions.beforeRemove) && actions.beforeRemove(plugin);
                        _this.removeEntity(entityId);
                    }
                });
            }
            else {
                /**
                 * Which means the user passes specific ids
                 * @type {?}
                 */
                var _ids = coerceArray(this.entityIds);
                for (var i = 0, len = _ids.length; i < len; i++) {
                    /** @type {?} */
                    var entityId = _ids[i];
                    /** The Entity in current ids and doesn't exist, add it. */
                    if (ids.indexOf(entityId) > -1 && this.hasEntity(entityId) === false) {
                        isFunction(actions.beforeAdd) && actions.beforeAdd(entityId);
                        /** @type {?} */
                        var plugin = this.instantiatePlugin(entityId);
                        this.entities.set(entityId, plugin);
                        isFunction(actions.afterAdd) && actions.afterAdd(plugin);
                    }
                    else {
                        this.entities.forEach(function (plugin, entityId) {
                            /** The Entity not in current ids and exists, remove it. */
                            if (ids.indexOf(entityId) === -1 && _this.hasEntity(entityId) === true) {
                                isFunction(actions.beforeRemove) && actions.beforeRemove(plugin);
                                _this.removeEntity(entityId);
                            }
                        });
                    }
                }
            }
        }
        else {
            /**
             * Otherwise, start with the provided ids or all.
             */
            this.getIds().forEach(function (id) {
                if (!_this.hasEntity(id))
                    _this.createEntity(id, _this.instantiatePlugin(id));
            });
        }
    };
    /**
     * Listen for add/remove entities.
     */
    /**
     * Listen for add/remove entities.
     * @return {?}
     */
    EntityCollectionPlugin.prototype.selectIds = /**
     * Listen for add/remove entities.
     * @return {?}
     */
    function () {
        return this.query.select(function (state) { return state.ids; });
    };
    /**
     * Base method for activation, you can override it if you need to.
     */
    /**
     * Base method for activation, you can override it if you need to.
     * @param {?=} ids
     * @return {?}
     */
    EntityCollectionPlugin.prototype.activate = /**
     * Base method for activation, you can override it if you need to.
     * @param {?=} ids
     * @return {?}
     */
    function (ids) {
        this.rebase(ids);
    };
    /**
     * Loop over each id and invoke the plugin method.
     */
    /**
     * Loop over each id and invoke the plugin method.
     * @param {?} ids
     * @param {?} cb
     * @return {?}
     */
    EntityCollectionPlugin.prototype.forEachId = /**
     * Loop over each id and invoke the plugin method.
     * @param {?} ids
     * @param {?} cb
     * @return {?}
     */
    function (ids, cb) {
        /** @type {?} */
        var _ids = this.resolvedIds(ids);
        for (var i = 0, len = _ids.length; i < len; i++) {
            /** @type {?} */
            var id = _ids[i];
            if (this.hasEntity(id)) {
                cb(this.getEntity(id));
            }
        }
    };
    return EntityCollectionPlugin;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/**
 * @template E, S
 */
var  /**
 * @template E, S
 */
StateHistoryPlugin = /** @class */ (function (_super) {
    __extends(StateHistoryPlugin, _super);
    function StateHistoryPlugin(query, params, _entityId) {
        if (params === void 0) { params = {}; }
        var _this = _super.call(this, query, {
            resetFn: function () { return _this.clear(); }
        }) || this;
        _this.query = query;
        _this.params = params;
        _this._entityId = _entityId;
        /**
         * Allow skipping an update from outside
         */
        _this.skip = false;
        _this.history = {
            past: [],
            present: null,
            future: []
        };
        /**
         * Skip the update when redo/undo
         */
        _this.skipUpdate = false;
        params.maxAge = toBoolean(params.maxAge) ? params.maxAge : 10;
        _this.activate();
        return _this;
    }
    Object.defineProperty(StateHistoryPlugin.prototype, "hasPast", {
        get: /**
         * @return {?}
         */
        function () {
            return this.history.past.length > 0;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StateHistoryPlugin.prototype, "hasFuture", {
        get: /**
         * @return {?}
         */
        function () {
            return this.history.future.length > 0;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    StateHistoryPlugin.prototype.activate = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.history.present = this.getSource(this._entityId);
        this.subscription = this.selectSource(this._entityId)
            .pipe(pairwise())
            .subscribe(function (_a) {
            var _b = __read(_a, 2), past = _b[0], present = _b[1];
            if (_this.skip) {
                _this.skip = false;
                return;
            }
            if (!_this.skipUpdate) {
                if (_this.history.past.length === _this.params.maxAge) {
                    _this.history.past = _this.history.past.slice(1);
                }
                _this.history.past = __spread(_this.history.past, [past]);
                _this.history.present = present;
            }
        });
    };
    /**
     * @return {?}
     */
    StateHistoryPlugin.prototype.undo = /**
     * @return {?}
     */
    function () {
        if (this.history.past.length > 0) {
            var _a = this.history, past = _a.past, present = _a.present, future = _a.future;
            /** @type {?} */
            var previous = past[past.length - 1];
            /** @type {?} */
            var newPast = past.slice(0, past.length - 1);
            this.history.past = newPast;
            this.history.present = previous;
            this.history.future = __spread([present], this.history.future);
            this.update();
        }
    };
    /**
     * @return {?}
     */
    StateHistoryPlugin.prototype.redo = /**
     * @return {?}
     */
    function () {
        if (this.history.future.length > 0) {
            var _a = this.history, past = _a.past, present = _a.present, future = _a.future;
            /** @type {?} */
            var next = this.history.future[0];
            /** @type {?} */
            var newFuture = this.history.future.slice(1);
            this.history.past = __spread(past, [present]);
            this.history.present = next;
            this.history.future = newFuture;
            this.update('Redo');
        }
    };
    /**
     * @param {?} index
     * @return {?}
     */
    StateHistoryPlugin.prototype.jumpToPast = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        if (index < 0 || index >= this.history.past.length)
            return;
        var _a = this.history, past = _a.past, future = _a.future;
        /**
         *
         * const past = [1, 2, 3, 4, 5];
         *
         * newPast = past.slice(0, 2) = [1, 2];
         * present = past[index] = 3;
         * [...past.slice(2 + 1), ...future] = [4, 5];
         *
         * @type {?}
         */
        var newPast = past.slice(0, index);
        /** @type {?} */
        var newFuture = __spread(past.slice(index + 1), future);
        /** @type {?} */
        var newPresent = past[index];
        this.history.past = newPast;
        this.history.present = newPresent;
        this.history.future = newFuture;
        this.update();
    };
    /**
     * @param {?} index
     * @return {?}
     */
    StateHistoryPlugin.prototype.jumpToFuture = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        if (index < 0 || index >= this.history.future.length)
            return;
        var _a = this.history, past = _a.past, future = _a.future;
        /** @type {?} */
        var newPast = __spread(past, future.slice(0, index));
        /** @type {?} */
        var newPresent = future[index];
        /** @type {?} */
        var newFuture = future.slice(index + 1);
        this.history.past = newPast;
        this.history.present = newPresent;
        this.history.future = newFuture;
        this.update('Redo');
    };
    /**
     * @return {?}
     */
    StateHistoryPlugin.prototype.clear = /**
     * @return {?}
     */
    function () {
        this.history = {
            past: [],
            present: null,
            future: []
        };
    };
    /**
     * @param {?=} clearHistory
     * @return {?}
     */
    StateHistoryPlugin.prototype.destroy = /**
     * @param {?=} clearHistory
     * @return {?}
     */
    function (clearHistory) {
        if (clearHistory === void 0) { clearHistory = false; }
        if (clearHistory) {
            this.clear();
        }
        this.subscription.unsubscribe();
    };
    /**
     * @return {?}
     */
    StateHistoryPlugin.prototype.ignoreNext = /**
     * @return {?}
     */
    function () {
        this.skip = true;
    };
    /**
     * @param {?=} action
     * @return {?}
     */
    StateHistoryPlugin.prototype.update = /**
     * @param {?=} action
     * @return {?}
     */
    function (action) {
        if (action === void 0) { action = 'Undo'; }
        this.skipUpdate = true;
        __globalState.setCustomAction({ type: "@StateHistory - " + action });
        this.updateStore(this.history.present, this._entityId);
        this.skipUpdate = false;
    };
    return StateHistoryPlugin;
}(AkitaPlugin));

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/**
 * @template E, P
 */
var  /**
 * @template E, P
 */
EntityStateHistoryPlugin = /** @class */ (function (_super) {
    __extends(EntityStateHistoryPlugin, _super);
    function EntityStateHistoryPlugin(query, params) {
        if (params === void 0) { params = {}; }
        var _this = _super.call(this, query, params.entityIds) || this;
        _this.query = query;
        _this.params = params;
        params.maxAge = toBoolean(params.maxAge) ? params.maxAge : 10;
        _this.activate();
        _this.selectIds()
            .pipe(skip(1))
            .subscribe(function (ids) { return _this.activate(ids); });
        return _this;
    }
    /**
     * @param {?=} ids
     * @return {?}
     */
    EntityStateHistoryPlugin.prototype.redo = /**
     * @param {?=} ids
     * @return {?}
     */
    function (ids) {
        this.forEachId(ids, function (e) { return e.redo(); });
    };
    /**
     * @param {?=} ids
     * @return {?}
     */
    EntityStateHistoryPlugin.prototype.undo = /**
     * @param {?=} ids
     * @return {?}
     */
    function (ids) {
        this.forEachId(ids, function (e) { return e.undo(); });
    };
    /**
     * @param {?} id
     * @return {?}
     */
    EntityStateHistoryPlugin.prototype.hasPast = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        if (this.hasEntity(id)) {
            return this.getEntity(id).hasPast;
        }
    };
    /**
     * @param {?} id
     * @return {?}
     */
    EntityStateHistoryPlugin.prototype.hasFuture = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        if (this.hasEntity(id)) {
            return this.getEntity(id).hasFuture;
        }
    };
    /**
     * @param {?} ids
     * @param {?} index
     * @return {?}
     */
    EntityStateHistoryPlugin.prototype.jumpToFuture = /**
     * @param {?} ids
     * @param {?} index
     * @return {?}
     */
    function (ids, index) {
        this.forEachId(ids, function (e) { return e.jumpToFuture(index); });
    };
    /**
     * @param {?} ids
     * @param {?} index
     * @return {?}
     */
    EntityStateHistoryPlugin.prototype.jumpToPast = /**
     * @param {?} ids
     * @param {?} index
     * @return {?}
     */
    function (ids, index) {
        this.forEachId(ids, function (e) { return e.jumpToPast(index); });
    };
    /**
     * @param {?=} ids
     * @return {?}
     */
    EntityStateHistoryPlugin.prototype.clear = /**
     * @param {?=} ids
     * @return {?}
     */
    function (ids) {
        this.forEachId(ids, function (e) { return e.clear(); });
    };
    /**
     * @param {?=} ids
     * @param {?=} clearHistory
     * @return {?}
     */
    EntityStateHistoryPlugin.prototype.destroy = /**
     * @param {?=} ids
     * @param {?=} clearHistory
     * @return {?}
     */
    function (ids, clearHistory) {
        if (clearHistory === void 0) { clearHistory = false; }
        this.forEachId(ids, function (e) { return e.destroy(clearHistory); });
    };
    /**
     * @param {?=} ids
     * @return {?}
     */
    EntityStateHistoryPlugin.prototype.ignoreNext = /**
     * @param {?=} ids
     * @return {?}
     */
    function (ids) {
        this.forEachId(ids, function (e) { return e.ignoreNext(); });
    };
    /**
     * @param {?} id
     * @return {?}
     */
    EntityStateHistoryPlugin.prototype.instantiatePlugin = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return (/** @type {?} */ (new StateHistoryPlugin(this.query, this.params, id)));
    };
    return EntityStateHistoryPlugin;
}(EntityCollectionPlugin));

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/** @type {?} */
var dirtyCheckDefaultParams = {
    comparator: function (head, current) { return JSON.stringify(head) !== JSON.stringify(current); }
};
/**
 * @param {?} nestedObj
 * @param {?} path
 * @return {?}
 */
function getNestedPath(nestedObj, path) {
    /** @type {?} */
    var pathAsArray = path.split('.');
    return pathAsArray.reduce(function (obj, key) { return (obj && obj[key] !== 'undefined' ? obj[key] : undefined); }, nestedObj);
}
/**
 * @template Entity, StoreState
 */
var  /**
 * @template Entity, StoreState
 */
DirtyCheckPlugin = /** @class */ (function (_super) {
    __extends(DirtyCheckPlugin, _super);
    function DirtyCheckPlugin(query, params, _entityId) {
        var _this = _super.call(this, query) || this;
        _this.query = query;
        _this.params = params;
        _this._entityId = _entityId;
        _this.dirty = new BehaviorSubject(false);
        _this.active = false;
        _this._reset = new Subject();
        _this.isDirty$ = _this.dirty.asObservable().pipe(distinctUntilChanged());
        _this.reset$ = _this._reset.asObservable();
        _this.params = __assign({}, dirtyCheckDefaultParams, params);
        if (_this.params.watchProperty) {
            /** @type {?} */
            var watchProp = (/** @type {?} */ (coerceArray(_this.params.watchProperty)));
            if (query instanceof QueryEntity && watchProp.includes('entities') && !watchProp.includes('ids')) {
                watchProp.push('ids');
            }
            _this.params.watchProperty = watchProp;
        }
        return _this;
    }
    /**
     * @param {?=} params
     * @return {?}
     */
    DirtyCheckPlugin.prototype.reset = /**
     * @param {?=} params
     * @return {?}
     */
    function (params) {
        if (params === void 0) { params = {}; }
        /** @type {?} */
        var currentValue = this.head;
        if (isFunction(params.updateFn)) {
            if (this.isEntityBased(this._entityId)) {
                currentValue = params.updateFn(this.head, ((/** @type {?} */ (this.getQuery()))).getEntity(this._entityId));
            }
            else {
                currentValue = params.updateFn(this.head, ((/** @type {?} */ (this.getQuery()))).getSnapshot());
            }
        }
        __globalState.setCustomAction({ type: "@DirtyCheck - Revert" });
        this.updateStore(currentValue, this._entityId);
        this._reset.next();
    };
    /**
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    DirtyCheckPlugin.prototype.setHead = /**
     * @template THIS
     * @this {THIS}
     * @return {THIS}
     */
    function () {
        if (!(/** @type {?} */ (this)).active) {
            (/** @type {?} */ (this)).activate();
            (/** @type {?} */ (this)).active = true;
        }
        else {
            (/** @type {?} */ (this)).head = (/** @type {?} */ (this))._getHead();
        }
        (/** @type {?} */ (this)).updateDirtiness(false);
        return (/** @type {?} */ (this));
    };
    /**
     * @return {?}
     */
    DirtyCheckPlugin.prototype.isDirty = /**
     * @return {?}
     */
    function () {
        return toBoolean(this.dirty.value);
    };
    /**
     * @return {?}
     */
    DirtyCheckPlugin.prototype.hasHead = /**
     * @return {?}
     */
    function () {
        return toBoolean(this.getHead());
    };
    /**
     * @return {?}
     */
    DirtyCheckPlugin.prototype.destroy = /**
     * @return {?}
     */
    function () {
        this.head = null;
        this.subscription && this.subscription.unsubscribe();
        this._reset && this._reset.complete();
    };
    /**
     * @param {?} path
     * @return {?}
     */
    DirtyCheckPlugin.prototype.isPathDirty = /**
     * @param {?} path
     * @return {?}
     */
    function (path) {
        /** @type {?} */
        var head = this.getHead();
        /** @type {?} */
        var current = ((/** @type {?} */ (this.getQuery()))).getSnapshot();
        /** @type {?} */
        var currentPathValue = getNestedPath(current, path);
        /** @type {?} */
        var headPathValue = getNestedPath(head, path);
        return this.params.comparator(currentPathValue, headPathValue);
    };
    /**
     * @return {?}
     */
    DirtyCheckPlugin.prototype.getHead = /**
     * @return {?}
     */
    function () {
        return this.head;
    };
    /**
     * @return {?}
     */
    DirtyCheckPlugin.prototype.activate = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.head = this._getHead();
        /**
         * if we are tracking specific properties select only the relevant ones
         * @type {?}
         */
        var source = this.params.watchProperty
            ? ((/** @type {?} */ (this.params.watchProperty))).map(function (prop) {
                return _this.query.select(function (state) { return state[prop]; }).pipe(map(function (val) { return ({
                    val: val,
                    __akitaKey: prop
                }); }));
            })
            : [this.selectSource(this._entityId)];
        this.subscription = combineLatest.apply(void 0, __spread(source)).pipe(skip(1))
            .subscribe(function (currentState) {
            if (isUndefined(_this.head))
                return;
            /**
             * __akitaKey is used to determine if we are tracking a specific property or a store change
             * @type {?}
             */
            var isChange = currentState.some(function (state) {
                /** @type {?} */
                var head = state.__akitaKey ? _this.head[(/** @type {?} */ (state.__akitaKey))] : _this.head;
                /** @type {?} */
                var compareTo = state.__akitaKey ? state.val : state;
                return _this.params.comparator(head, compareTo);
            });
            _this.updateDirtiness(isChange);
        });
    };
    /**
     * @param {?} isDirty
     * @return {?}
     */
    DirtyCheckPlugin.prototype.updateDirtiness = /**
     * @param {?} isDirty
     * @return {?}
     */
    function (isDirty) {
        this.dirty.next(isDirty);
    };
    /**
     * @return {?}
     */
    DirtyCheckPlugin.prototype._getHead = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var head = this.getSource(this._entityId);
        if (this.params.watchProperty) {
            head = this.getWatchedValues((/** @type {?} */ (head)));
        }
        return head;
    };
    /**
     * @param {?} source
     * @return {?}
     */
    DirtyCheckPlugin.prototype.getWatchedValues = /**
     * @param {?} source
     * @return {?}
     */
    function (source) {
        return ((/** @type {?} */ (this.params.watchProperty))).reduce(function (watched, prop) {
            watched[prop] = source[prop];
            return watched;
        }, (/** @type {?} */ ({})));
    };
    return DirtyCheckPlugin;
}(AkitaPlugin));

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/**
 * @template E, P
 */
var  /**
 * @template E, P
 */
EntityDirtyCheckPlugin = /** @class */ (function (_super) {
    __extends(EntityDirtyCheckPlugin, _super);
    function EntityDirtyCheckPlugin(query, params) {
        if (params === void 0) { params = {}; }
        var _this = _super.call(this, query, params.entityIds) || this;
        _this.query = query;
        _this.params = params;
        /**
         * @deprecated Use someDirty$ instead
         */
        _this.isSomeDirty$ = _this.query.select(function (state) { return state.entities; }).pipe(map(function (entities) { return _this.checkSomeDirty(entities); }));
        _this.someDirty$ = _this.isSomeDirty$;
        _this.someDirty = _this.isSomeDirty;
        _this.params = __assign({}, dirtyCheckDefaultParams, params);
        _this.activate();
        _this.selectIds()
            .pipe(skip(1))
            .subscribe(function (ids) {
            _this.rebase(ids, { afterAdd: function (plugin) { return plugin.setHead(); } });
        });
        return _this;
    }
    /**
     * @template THIS
     * @this {THIS}
     * @param {?=} ids
     * @return {THIS}
     */
    EntityDirtyCheckPlugin.prototype.setHead = /**
     * @template THIS
     * @this {THIS}
     * @param {?=} ids
     * @return {THIS}
     */
    function (ids) {
        (/** @type {?} */ (this)).forEachId(ids, function (e) { return e.setHead(); });
        return (/** @type {?} */ (this));
    };
    /**
     * @param {?} id
     * @return {?}
     */
    EntityDirtyCheckPlugin.prototype.hasHead = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        if (this.entities.has(id)) {
            /** @type {?} */
            var entity = this.getEntity(id);
            return entity.hasHead();
        }
        return false;
    };
    /**
     * @param {?=} ids
     * @param {?=} params
     * @return {?}
     */
    EntityDirtyCheckPlugin.prototype.reset = /**
     * @param {?=} ids
     * @param {?=} params
     * @return {?}
     */
    function (ids, params) {
        if (params === void 0) { params = {}; }
        this.forEachId(ids, function (e) { return e.reset(params); });
    };
    /**
     * @param {?} id
     * @param {?=} asObservable
     * @return {?}
     */
    EntityDirtyCheckPlugin.prototype.isDirty = /**
     * @param {?} id
     * @param {?=} asObservable
     * @return {?}
     */
    function (id, asObservable) {
        if (asObservable === void 0) { asObservable = true; }
        if (this.entities.has(id)) {
            /** @type {?} */
            var entity = this.getEntity(id);
            return asObservable ? entity.isDirty$ : entity.isDirty();
        }
        return false;
    };
    /**
     * @deprecated Use someDirty() instead
     */
    /**
     * @deprecated Use someDirty() instead
     * @return {?}
     */
    EntityDirtyCheckPlugin.prototype.isSomeDirty = /**
     * @deprecated Use someDirty() instead
     * @return {?}
     */
    function () {
        /** @type {?} */
        var entities = this.query.getAll({ asObject: true });
        return this.checkSomeDirty(entities);
    };
    /**
     * @param {?} id
     * @param {?} path
     * @return {?}
     */
    EntityDirtyCheckPlugin.prototype.isPathDirty = /**
     * @param {?} id
     * @param {?} path
     * @return {?}
     */
    function (id, path) {
        if (this.entities.has(id)) {
            /** @type {?} */
            var head = ((/** @type {?} */ (this.getEntity(id)))).getHead();
            /** @type {?} */
            var current = this.query.getEntity(id);
            /** @type {?} */
            var currentPathValue = getNestedPath(current, path);
            /** @type {?} */
            var headPathValue = getNestedPath(head, path);
            return this.params.comparator(currentPathValue, headPathValue);
        }
        return null;
    };
    /**
     * @param {?=} ids
     * @return {?}
     */
    EntityDirtyCheckPlugin.prototype.destroy = /**
     * @param {?=} ids
     * @return {?}
     */
    function (ids) {
        this.forEachId(ids, function (e) { return e.destroy(); });
    };
    /**
     * @param {?} id
     * @return {?}
     */
    EntityDirtyCheckPlugin.prototype.instantiatePlugin = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return (/** @type {?} */ (new DirtyCheckPlugin(this.query, this.params, id)));
    };
    /**
     * @param {?} entities
     * @return {?}
     */
    EntityDirtyCheckPlugin.prototype.checkSomeDirty = /**
     * @param {?} entities
     * @return {?}
     */
    function (entities) {
        var e_1, _a;
        /** @type {?} */
        var entitiesIds = this.resolvedIds();
        try {
            for (var entitiesIds_1 = __values(entitiesIds), entitiesIds_1_1 = entitiesIds_1.next(); !entitiesIds_1_1.done; entitiesIds_1_1 = entitiesIds_1.next()) {
                var id = entitiesIds_1_1.value;
                /** @type {?} */
                var dirty = this.params.comparator(((/** @type {?} */ (this.getEntity(id)))).getHead(), entities[id]);
                if (dirty) {
                    return true;
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (entitiesIds_1_1 && !entitiesIds_1_1.done && (_a = entitiesIds_1.return)) _a.call(entitiesIds_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return false;
    };
    return EntityDirtyCheckPlugin;
}(EntityCollectionPlugin));

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/**
 * \@example
 *
 * this.peopleStore.update(id, person => ({
 *   guests: increment(person.guests)
 * }));
 * @param {?} value
 * @param {?=} params
 * @return {?}
 */
function increment(value, params) {
    if (params === void 0) { params = { maxValue: undefined }; }
    if (isNumber(value) === false)
        return;
    if (params.maxValue && value === params.maxValue)
        return value;
    return value + 1;
}
/**
 * \@example
 *
 * this.peopleStore.update(id, person => ({
 *   guests: decrement(person.guests)
 * }));
 * @param {?} value
 * @param {?=} params
 * @return {?}
 */
function decrement(value, params) {
    if (params === void 0) { params = { allowNegative: false }; }
    if (isNumber(value) === false)
        return;
    if (params.allowNegative === false && value === 0) {
        return value;
    }
    return value - 1;
}
/**
 * Generate random guid
 * @return {?}
 */
function guid() {
    return 'xxxxxx4xyx'.replace(/[xy]/g, function (c) {
        /** @type {?} */
        var r = (Math.random() * 16) | 0;
        /** @type {?} */
        var v = c == 'x' ? r : (r & 0x3) | 0x8;
        return v.toString(16);
    });
}
/**
 *
 * @param {?=} options
 * @return {?}
 */
function resetStores(options) {
    /** @type {?} */
    var defaults = {
        exclude: []
    };
    options = Object.assign({}, defaults, options);
    /** @type {?} */
    var stores = Object.keys(__stores__);
    applyTransaction(function () {
        var e_1, _a;
        try {
            for (var stores_1 = __values(stores), stores_1_1 = stores_1.next(); !stores_1_1.done; stores_1_1 = stores_1.next()) {
                var store = stores_1_1.value;
                /** @type {?} */
                var s = __stores__[store];
                if (!options.exclude) {
                    s.reset();
                }
                else {
                    if (options.exclude.indexOf(s.storeName) === -1) {
                        s.reset();
                    }
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (stores_1_1 && !stores_1_1.done && (_a = stores_1.return)) _a.call(stores_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
    });
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */

export { __globalState, EntityStore, getInitialEntitiesState, getInitialActiveState, QueryEntity, Query, enableAkitaProdMode, isDev, __stores__, rootDispatcher, Store, applyTransaction, transaction, push, remove, pop, unshift, sort, reverse, swap, update, splice, toggle, filterNil, coerceArray, isObject, isPlainObject, isFunction, toBoolean, isUndefined, isNil, entityExists, noop, isObservable, isString, isNumber, isDefined, resetActive, isActiveState, setValue, getValue, applyAction, action, mapInWorker, memoizeOne, SnapshotManager, snapshotManager, StoreConfig, configKey, QueryConfig, queryConfigKey, akitaConfig, getAkitaConfig, compareValues, Order, AkitaPlugin, PaginatorPlugin, Paginator, PersistNgFormPlugin, persistState, akitaDevtools, EntityCollectionPlugin, StateHistoryPlugin, EntityStateHistoryPlugin, getNestedPath, dirtyCheckDefaultParams, DirtyCheckPlugin, EntityDirtyCheckPlugin, increment, decrement, guid, resetStores, AkitaGlobals as a };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0b3JhbWEtYWtpdGEuanMubWFwIiwic291cmNlcyI6WyJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvaW50ZXJuYWwvdXRpbHMudHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvaW50ZXJuYWwvZXJyb3IudHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvaW50ZXJuYWwvY3J1ZC50cyIsIm5nOi8vQGRhdG9yYW1hL2FraXRhL3NyYy9pbnRlcm5hbC9nbG9iYWwtc3RhdGUudHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvaW50ZXJuYWwvdHJhbnNhY3Rpb24uaW50ZXJuYWwudHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvaW50ZXJuYWwvZGVlcC1mcmVlemUudHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvYXBpL3N0b3JlLWNvbmZpZy50cyIsIm5nOi8vQGRhdG9yYW1hL2FraXRhL3NyYy9hcGkvY29uZmlnLnRzIiwibmc6Ly9AZGF0b3JhbWEvYWtpdGEvc3JjL2FwaS9zdG9yZS50cyIsIm5nOi8vQGRhdG9yYW1hL2FraXRhL3NyYy9hcGkvZW50aXR5LXN0b3JlLnRzIiwibmc6Ly9AZGF0b3JhbWEvYWtpdGEvc3JjL2ludGVybmFsL3NvcnQudHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvYXBpL21lbW9pemUudHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvYXBpL3F1ZXJ5LWNvbmZpZy50cyIsIm5nOi8vQGRhdG9yYW1hL2FraXRhL3NyYy9hcGkvcXVlcnkudHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvYXBpL3F1ZXJ5LWVudGl0eS50cyIsIm5nOi8vQGRhdG9yYW1hL2FraXRhL3NyYy9hcGkvdHJhbnNhY3Rpb24udHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvYXBpL2FycmF5cy50cyIsIm5nOi8vQGRhdG9yYW1hL2FraXRhL3NyYy9hcGkvb3BlcmF0b3JzLnRzIiwibmc6Ly9AZGF0b3JhbWEvYWtpdGEvc3JjL2ludGVybmFsL2FjdGlvbi50cyIsIm5nOi8vQGRhdG9yYW1hL2FraXRhL3NyYy9hcGkvd29ya2VyLnRzIiwibmc6Ly9AZGF0b3JhbWEvYWtpdGEvc3JjL2FwaS9zbmFwc2hvdC1tYW5hZ2VyLnRzIiwibmc6Ly9AZGF0b3JhbWEvYWtpdGEvc3JjL3BsdWdpbnMvcGx1Z2luLnRzIiwibmc6Ly9AZGF0b3JhbWEvYWtpdGEvc3JjL3BsdWdpbnMvcGFnaW5hdG9yL3BhZ2luYXRvci1wbHVnaW4udHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvcGx1Z2lucy9wZXJzaXN0LWZvcm0vcGVyc2lzdC1uZy1mb3JtLXBsdWdpbi50cyIsIm5nOi8vQGRhdG9yYW1hL2FraXRhL3NyYy9lbmhhbmNlcnMvcGVyc2lzdC1zdGF0ZS50cyIsIm5nOi8vQGRhdG9yYW1hL2FraXRhL3NyYy9lbmhhbmNlcnMvZGV2dG9vbHMudHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvcGx1Z2lucy9lbnRpdHktY29sbGVjdGlvbi1wbHVnaW4udHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvcGx1Z2lucy9zdGF0ZS1oaXN0b3J5L3N0YXRlLWhpc3RvcnktcGx1Z2luLnRzIiwibmc6Ly9AZGF0b3JhbWEvYWtpdGEvc3JjL3BsdWdpbnMvc3RhdGUtaGlzdG9yeS9lbnRpdHktc3RhdGUtaGlzdG9yeS1wbHVnaW4udHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvcGx1Z2lucy9kaXJ0eS1jaGVjay9kaXJ0eS1jaGVjay1wbHVnaW4udHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvcGx1Z2lucy9kaXJ0eS1jaGVjay9lbnRpdHktZGlydHktY2hlY2stcGx1Z2luLnRzIiwibmc6Ly9AZGF0b3JhbWEvYWtpdGEvc3JjL2FwaS9zdG9yZS11dGlscy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBBY3RpdmVTdGF0ZSwgRW50aXR5U3RhdGUsIEhhc2hNYXAsIElEIH0gZnJvbSAnLi4vYXBpL3R5cGVzJztcblxuLyoqIFdyYXBzIHRoZSBwcm92aWRlZCB2YWx1ZSBpbiBhbiBhcnJheSwgdW5sZXNzIHRoZSBwcm92aWRlZCBfdmFsdWUgaXMgYW4gYXJyYXkuICovXG5leHBvcnQgZnVuY3Rpb24gY29lcmNlQXJyYXk8VD4odmFsdWU6IFQgfCBUW10pOiBUW10ge1xuICByZXR1cm4gQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZSA6IFt2YWx1ZV07XG59XG5cbi8qKiBDaGVjayBpZiBhIHZhbHVlIGlzIGFuIG9iamVjdCAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzT2JqZWN0KHZhbHVlOiBhbnkpIHtcbiAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2YWx1ZSkgPT09ICdbb2JqZWN0IE9iamVjdF0nO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNQbGFpbk9iamVjdCh2YWx1ZSkge1xuICByZXR1cm4gdG9Cb29sZWFuKHZhbHVlKSAmJiB2YWx1ZS5jb25zdHJ1Y3Rvci5uYW1lID09PSAnT2JqZWN0Jztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzRnVuY3Rpb24odmFsdWUpOiB2YWx1ZSBpcyBGdW5jdGlvbiB7XG4gIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbic7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0b0Jvb2xlYW4odmFsdWU6IGFueSk6IGJvb2xlYW4ge1xuICByZXR1cm4gdmFsdWUgIT0gbnVsbCAmJiBgJHt2YWx1ZX1gICE9PSAnZmFsc2UnO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNVbmRlZmluZWQodmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc05pbCh2KSB7XG4gIHJldHVybiB2ID09PSBudWxsIHx8IHYgPT09IHVuZGVmaW5lZDtcbn1cblxuLyoqXG4gKiBDaGVjayBpZiBlbnRpdHkgZXhpc3RzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBlbnRpdHlFeGlzdHM8RT4oaWQ6IElELCBlbnRpdGllczogSGFzaE1hcDxFPikge1xuICByZXR1cm4gZW50aXRpZXMuaGFzT3duUHJvcGVydHkoaWQpO1xufVxuXG4vKipcbiAqIE9ic2VydmFibGUgdGhhdCBlbWl0cyBlbXB0eSB2YWx1ZSBhbmQgY29tcGxldGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG5vb3A8VD4oKTogT2JzZXJ2YWJsZTxUPiB7XG4gIHJldHVybiBuZXcgT2JzZXJ2YWJsZShvYnNlcnZlciA9PiB7XG4gICAgb2JzZXJ2ZXIubmV4dCgpO1xuICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNPYnNlcnZhYmxlKHZhbHVlKSB7XG4gIHJldHVybiB0b0Jvb2xlYW4odmFsdWUpICYmIGlzRnVuY3Rpb24odmFsdWUuc3Vic2NyaWJlKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzU3RyaW5nKHZhbDogc3RyaW5nIHwgYW55KTogdmFsIGlzIHN0cmluZyB7XG4gIHJldHVybiB0eXBlb2YgdmFsID09PSAnc3RyaW5nJztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzTnVtYmVyKHZhbHVlKSB7XG4gIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNEZWZpbmVkKHZhbCkge1xuICByZXR1cm4gdmFsICE9PSBudWxsICYmIHR5cGVvZiB2YWwgIT09ICd1bmRlZmluZWQnO1xufVxuXG4vKipcbiAqIENoZWNrIGlmIHRoZSBhY3RpdmUgZW50aXR5IGV4aXN0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZXNldEFjdGl2ZTxFPihzdGF0ZTogRW50aXR5U3RhdGU8RT4pIHtcbiAgcmV0dXJuIGlzQWN0aXZlU3RhdGUoc3RhdGUpICYmIGVudGl0eUV4aXN0cygoc3RhdGUgYXMgQWN0aXZlU3RhdGUpLmFjdGl2ZSwgc3RhdGUuZW50aXRpZXMpID09PSBmYWxzZTtcbn1cblxuLyoqXG4gKiBDaGVjayBpZiB0aGUgc3RvcmUgc3VwcG9ydHMgYWN0aXZlIGVudGl0eVxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNBY3RpdmVTdGF0ZTxFPihzdGF0ZTogRW50aXR5U3RhdGU8RT4pIHtcbiAgcmV0dXJuIChzdGF0ZSBhcyBBY3RpdmVTdGF0ZSkuaGFzT3duUHJvcGVydHkoJ2FjdGl2ZScpO1xufVxuXG4vKipcbiAqIHNldFZhbHVlKHN0YXRlLCAndG9kb3MudWknLCB7IGZpbHRlcjoge319KVxuICovXG5leHBvcnQgY29uc3Qgc2V0VmFsdWUgPSAob2JqOiBhbnksIHByb3A6IHN0cmluZywgdmFsOiBhbnkpID0+IHtcbiAgY29uc3Qgc3BsaXQgPSBwcm9wLnNwbGl0KCcuJyk7XG5cbiAgaWYgKHNwbGl0Lmxlbmd0aCA9PT0gMSkgcmV0dXJuIHZhbDtcblxuICBvYmogPSB7IC4uLm9iaiB9O1xuXG4gIGNvbnN0IGxhc3RJbmRleCA9IHNwbGl0Lmxlbmd0aCAtIDI7XG4gIGNvbnN0IHJlbW92ZVN0b3JlTmFtZSA9IHByb3Auc3BsaXQoJy4nKS5zbGljZSgxKTtcblxuICByZW1vdmVTdG9yZU5hbWUucmVkdWNlKChhY2MsIHBhcnQsIGluZGV4KSA9PiB7XG4gICAgaWYgKGluZGV4ID09PSBsYXN0SW5kZXgpIHtcbiAgICAgIGFjY1twYXJ0XSA9IHZhbDtcbiAgICB9IGVsc2Uge1xuICAgICAgYWNjW3BhcnRdID0geyAuLi5hY2NbcGFydF0gfTtcbiAgICB9XG5cbiAgICByZXR1cm4gYWNjICYmIGFjY1twYXJ0XTtcbiAgfSwgb2JqKTtcblxuICByZXR1cm4gb2JqO1xufTtcblxuLyoqXG4gKiBnZXRWYWx1ZShzdGF0ZSwgJ3RvZG9zLnVpJylcbiAqL1xuZXhwb3J0IGNvbnN0IGdldFZhbHVlID0gKG9iajogYW55LCBwcm9wOiBzdHJpbmcpID0+IHtcbiAgLyoqIHJldHVybiB0aGUgd2hvbGUgc3RhdGUgICovXG4gIGlmIChwcm9wLnNwbGl0KCcuJykubGVuZ3RoID09PSAxKSB7XG4gICAgcmV0dXJuIG9iajtcbiAgfVxuICBjb25zdCByZW1vdmVTdG9yZU5hbWUgPSBwcm9wXG4gICAgLnNwbGl0KCcuJylcbiAgICAuc2xpY2UoMSlcbiAgICAuam9pbignLicpO1xuICByZXR1cm4gcmVtb3ZlU3RvcmVOYW1lLnNwbGl0KCcuJykucmVkdWNlKChhY2M6IGFueSwgcGFydDogc3RyaW5nKSA9PiBhY2MgJiYgYWNjW3BhcnRdLCBvYmopO1xufTtcbiIsImltcG9ydCB7IGVudGl0eUV4aXN0cywgaXNPYmplY3QsIHRvQm9vbGVhbiB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IHsgRW50aXR5U3RhdGUsIElEIH0gZnJvbSAnLi4vYXBpL3R5cGVzJztcblxuZXhwb3J0IGNsYXNzIEFraXRhRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2U6IHN0cmluZykge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBBa2l0YUltbXV0YWJpbGl0eUVycm9yIGV4dGVuZHMgQWtpdGFFcnJvciB7XG4gIGNvbnN0cnVjdG9yKHN0b3JlTmFtZSkge1xuICAgIHN1cGVyKGBUaGUgbmV3IHN0YXRlIHNob3VsZCBiZSBpbW11dGFibGUuIE1ha2Ugc3VyZSB0byByZXR1cm4gYSBuZXcgaW1tdXRhYmxlIHN0YXRlLiBcXG4gc3RvcmU6IFxcbiAke3N0b3JlTmFtZX1gKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQWtpdGFFbnRpdHlOb3RFeGlzdHNFcnJvciBleHRlbmRzIEFraXRhRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihpZCkge1xuICAgIHN1cGVyKGBFbnRpdHkgJHtpZH0gZG9lcyBub3QgZXhpc3RzYCk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEFraXRhTm9BY3RpdmVFcnJvciBleHRlbmRzIEFraXRhRXJyb3Ige1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcihgQWN0aXZlIGlzIG51bGwvdW5kZWZpbmVkYCk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEFraXRhSW52YWxpZEVudGl0eVN0YXRlIGV4dGVuZHMgQWtpdGFFcnJvciB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKGBFbnRpdHkgc3RhdGUgaXMgaW52YWxpZGApO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBBa2l0YVVwZGF0ZUlkS2V5RXJyb3IgZXh0ZW5kcyBBa2l0YUVycm9yIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoYFVwZGF0aW5nIGVudGl0eSBpZCBpcyBub3QgcGVybWl0dGVkIHdoZW4gdXBkYXRpbmcgbWFueSBlbnRpdGllc2ApO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhc3NlcnRFbnRpdHlFeGlzdHMoaWQ6IElELCBlbnRpdGllcykge1xuICBpZiAoIWVudGl0eUV4aXN0cyhpZCwgZW50aXRpZXMpKSB7XG4gICAgdGhyb3cgbmV3IEFraXRhRW50aXR5Tm90RXhpc3RzRXJyb3IoaWQpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhc3NlcnRBY3RpdmUoc3RvcmUpIHtcbiAgaWYgKCF0b0Jvb2xlYW4oc3RvcmUuYWN0aXZlKSkge1xuICAgIHRocm93IG5ldyBBa2l0YU5vQWN0aXZlRXJyb3IoKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gYXNzZXJ0RW50aXR5U3RhdGUoc3RhdGU6IEVudGl0eVN0YXRlPGFueT4pIHtcbiAgY29uc3QgYXNzZXJ0RW50aXRpZXMgPSBpc09iamVjdChzdGF0ZSk7XG5cbiAgaWYgKCFhc3NlcnRFbnRpdGllcykge1xuICAgIHRocm93IG5ldyBBa2l0YUludmFsaWRFbnRpdHlTdGF0ZSgpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhc3NlcnREZWNvcmF0b3IobmFtZTogc3RyaW5nLCBjbGFzc05hbWU6IHN0cmluZykge1xuICBpZiAoIW5hbWUpIHtcbiAgICBjb25zb2xlLmVycm9yKGBAU3RvcmVDb25maWcoeyBuYW1lIH0pIGlzIG1pc3NpbmcgaW4gJHtjbGFzc05hbWV9YCk7XG4gIH1cbn1cbiIsImltcG9ydCB7IEVudGl0aWVzLCBFbnRpdHlTdGF0ZSwgSGFzaE1hcCwgSUQsIE5ld2FibGUsIEFkZE9wdGlvbnMgfSBmcm9tICcuLi9hcGkvdHlwZXMnO1xuaW1wb3J0IHsgQWtpdGFVcGRhdGVJZEtleUVycm9yLCBhc3NlcnRFbnRpdHlFeGlzdHMsIGFzc2VydEVudGl0eVN0YXRlIH0gZnJvbSAnLi9lcnJvcic7XG5pbXBvcnQgeyBlbnRpdHlFeGlzdHMsIGlzRnVuY3Rpb24sIGlzUGxhaW5PYmplY3QsIHJlc2V0QWN0aXZlIH0gZnJvbSAnLi91dGlscyc7XG5cbmV4cG9ydCBjbGFzcyBDUlVEIHtcbiAgX3NldDxTLCBFPihzdGF0ZTogUywgZW50aXRpZXM6IEVbXSB8IEhhc2hNYXA8RT4gfCBFbnRpdGllczxFPiwgZW50aXR5Q2xhc3M6IE5ld2FibGU8RT4gfCB1bmRlZmluZWQsIGlkS2V5KTogUyB7XG4gICAgbGV0IGlkcywgbm9ybWFsaXplZDtcblxuICAgIGlmICgoZW50aXRpZXMgYXMgRW50aXRpZXM8RT4pLmlkcyAmJiAoZW50aXRpZXMgYXMgRW50aXRpZXM8RT4pLmVudGl0aWVzKSB7XG4gICAgICBpZHMgPSAoZW50aXRpZXMgYXMgRW50aXRpZXM8RT4pLmlkcztcbiAgICAgIG5vcm1hbGl6ZWQgPSAoZW50aXRpZXMgYXMgRW50aXRpZXM8RT4pLmVudGl0aWVzO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBpc0FycmF5ID0gQXJyYXkuaXNBcnJheShlbnRpdGllcyk7XG4gICAgICBub3JtYWxpemVkID0gZW50aXRpZXM7XG5cbiAgICAgIGlmIChpc0FycmF5KSB7XG4gICAgICAgIG5vcm1hbGl6ZWQgPSB0aGlzLmtleUJ5KGVudGl0aWVzIGFzIEVbXSwgZW50aXR5Q2xhc3MsIGlkS2V5KSBhcyBFW107XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhc3NlcnRFbnRpdHlTdGF0ZShlbnRpdGllcyk7XG4gICAgICB9XG5cbiAgICAgIGlkcyA9IGlzQXJyYXkgPyAoZW50aXRpZXMgYXMgRVtdKS5tYXAoZW50aXR5ID0+IGVudGl0eVtpZEtleV0pIDogT2JqZWN0LmtleXMobm9ybWFsaXplZCBhcyBIYXNoTWFwPEU+KS5tYXAoaWQgPT4gZW50aXRpZXNbaWRdW2lkS2V5XSk7XG4gICAgfVxuXG4gICAgY29uc3QgbmV3U3RhdGUgPSB7XG4gICAgICAuLi4oc3RhdGUgYXMgYW55KSxcbiAgICAgIGVudGl0aWVzOiBub3JtYWxpemVkLFxuICAgICAgaWRzLFxuICAgICAgbG9hZGluZzogZmFsc2VcbiAgICB9O1xuXG4gICAgaWYgKHJlc2V0QWN0aXZlKG5ld1N0YXRlKSkge1xuICAgICAgbmV3U3RhdGUuYWN0aXZlID0gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3U3RhdGU7XG4gIH1cblxuICBfcmVwbGFjZUVudGl0eTxUIGV4dGVuZHMgRW50aXR5U3RhdGU+KHN0YXRlOiBULCBpZDogSUQsIGVudGl0eSk6IFQge1xuICAgIHJldHVybiB7XG4gICAgICAuLi4oc3RhdGUgYXMgYW55KSxcbiAgICAgIGVudGl0aWVzOiB7XG4gICAgICAgIC4uLnN0YXRlLmVudGl0aWVzLFxuICAgICAgICBbaWRdOiBlbnRpdHlcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgX2FkZDxTIGV4dGVuZHMgRW50aXR5U3RhdGUsIEU+KHN0YXRlOiBTLCBlbnRpdGllczogRVtdLCBpZEtleSwgb3B0aW9uczogQWRkT3B0aW9ucyA9IHt9KTogUyB7XG4gICAgbGV0IGFkZGVkRW50aXRpZXMgPSB7fTtcbiAgICBsZXQgYWRkZWRJZHMgPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZW50aXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGVudGl0eSA9IGVudGl0aWVzW2ldO1xuICAgICAgY29uc3QgZW50aXR5SWQgPSBlbnRpdHlbaWRLZXldO1xuXG4gICAgICBpZiAoIWVudGl0eUV4aXN0cyhlbnRpdHlJZCwgc3RhdGUuZW50aXRpZXMpKSB7XG4gICAgICAgIGFkZGVkRW50aXRpZXNbZW50aXR5SWRdID0gZW50aXR5O1xuICAgICAgICBpZiAob3B0aW9ucy5wcmVwZW5kKSBhZGRlZElkcy51bnNoaWZ0KGVudGl0eUlkKTtcbiAgICAgICAgZWxzZSBhZGRlZElkcy5wdXNoKGVudGl0eUlkKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgLi4uKHN0YXRlIGFzIGFueSksXG4gICAgICBlbnRpdGllczoge1xuICAgICAgICAuLi5zdGF0ZS5lbnRpdGllcyxcbiAgICAgICAgLi4uYWRkZWRFbnRpdGllc1xuICAgICAgfSxcbiAgICAgIGlkczogb3B0aW9ucy5wcmVwZW5kID8gWy4uLmFkZGVkSWRzLCAuLi5zdGF0ZS5pZHNdIDogWy4uLnN0YXRlLmlkcywgLi4uYWRkZWRJZHNdXG4gICAgfTtcbiAgfVxuXG4gIF91cGRhdGU8VCBleHRlbmRzIEVudGl0eVN0YXRlPihzdGF0ZTogVCwgaWRzOiBJRFtdLCBuZXdTdGF0ZU9yRm46IG9iamVjdCB8ICgoZTogUmVhZG9ubHk8YW55PikgPT4gb2JqZWN0KSwgaWRLZXk6IHN0cmluZyk6IFQge1xuICAgIGNvbnN0IHVwZGF0ZWRFbnRpdGllcyA9IHt9O1xuXG4gICAgbGV0IGlzVXBkYXRpbmdJZEtleSA9IGZhbHNlO1xuICAgIGxldCBpZFRvVXBkYXRlOiBJRDtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaWRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBpZCA9IGlkc1tpXTtcbiAgICAgIGlkVG9VcGRhdGUgPSBpZDtcbiAgICAgIGFzc2VydEVudGl0eUV4aXN0cyhpZCwgc3RhdGUuZW50aXRpZXMpO1xuXG4gICAgICBjb25zdCBvbGRFbnRpdHkgPSBzdGF0ZS5lbnRpdGllc1tpZF07XG4gICAgICBjb25zdCBuZXdTdGF0ZSA9IGlzRnVuY3Rpb24obmV3U3RhdGVPckZuKSA/IG5ld1N0YXRlT3JGbihvbGRFbnRpdHkpIDogbmV3U3RhdGVPckZuO1xuXG4gICAgICBpZiAobmV3U3RhdGUuaGFzT3duUHJvcGVydHkoaWRLZXkpICYmIG5ld1N0YXRlW2lkS2V5XSAhPT0gb2xkRW50aXR5W2lkS2V5XSkge1xuICAgICAgICBpZiAoaWRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgQWtpdGFVcGRhdGVJZEtleUVycm9yKCk7XG4gICAgICAgIH1cbiAgICAgICAgaXNVcGRhdGluZ0lkS2V5ID0gdHJ1ZTtcbiAgICAgICAgaWRUb1VwZGF0ZSA9IG5ld1N0YXRlW2lkS2V5XTtcbiAgICAgIH1cblxuICAgICAgbGV0IG5ld0VudGl0eTtcblxuICAgICAgY29uc3QgbWVyZ2VkID0ge1xuICAgICAgICAuLi5vbGRFbnRpdHksXG4gICAgICAgIC4uLm5ld1N0YXRlXG4gICAgICB9O1xuXG4gICAgICBpZiAoaXNQbGFpbk9iamVjdChvbGRFbnRpdHkpKSB7XG4gICAgICAgIG5ld0VudGl0eSA9IG1lcmdlZDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbiBjYXNlIHRoYXQgbmV3IHN0YXRlIGlzIGNsYXNzIG9mIGl0J3Mgb3duLCB0aGVyZSdzXG4gICAgICAgICAqIGEgcG9zc2liaWxpdHkgdGhhdCBpdCB3aWxsIGJlIGRpZmZlcmVudCB0aGFuIHRoZSBvbGRcbiAgICAgICAgICogY2xhc3MuXG4gICAgICAgICAqIEZvciBleGFtcGxlLCBPbGQgc3RhdGUgaXMgYW4gaW5zdGFuY2Ugb2YgYW5pbWFsIGNsYXNzXG4gICAgICAgICAqIGFuZCBuZXcgc3RhdGUgaXMgaW5zdGFuY2Ugb2YgcGVyc29uIGNsYXNzLlxuICAgICAgICAgKiBUbyBhdm9pZCBydW4gb3ZlciBuZXcgcGVyc29uIGNsYXNzIHdpdGggdGhlIG9sZCBhbmltYWxcbiAgICAgICAgICogY2xhc3Mgd2UgY2hlY2sgaWYgdGhlIG5ldyBzdGF0ZSBpcyBhIGNsYXNzIG9mIGl0J3Mgb3duLlxuICAgICAgICAgKiBJZiBzbywgdXNlIGl0LiBPdGhlcndpc2UsIHVzZSB0aGUgb2xkIHN0YXRlIGNsYXNzXG4gICAgICAgICAqL1xuICAgICAgICBpZiAoaXNQbGFpbk9iamVjdChuZXdTdGF0ZSkpIHtcbiAgICAgICAgICBuZXdFbnRpdHkgPSBuZXcgb2xkRW50aXR5LmNvbnN0cnVjdG9yKG1lcmdlZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbmV3RW50aXR5ID0gbmV3IChuZXdTdGF0ZSBhcyBhbnkpLmNvbnN0cnVjdG9yKG1lcmdlZCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdXBkYXRlZEVudGl0aWVzW2lkVG9VcGRhdGVdID0gbmV3RW50aXR5O1xuICAgIH1cblxuICAgIGxldCB1cGRhdGVkSWRzID0gc3RhdGUuaWRzO1xuICAgIGxldCBzdGF0ZUVudGl0aWVzID0gc3RhdGUuZW50aXRpZXM7XG4gICAgaWYgKGlzVXBkYXRpbmdJZEtleSkge1xuICAgICAgY29uc3QgW2lkXSA9IGlkcztcbiAgICAgIGNvbnN0IHsgW2lkXTogZGVsZXRlZEVudGl0eSwgLi4ucmVzdCB9ID0gc3RhdGUuZW50aXRpZXM7XG4gICAgICBzdGF0ZUVudGl0aWVzID0gcmVzdDtcbiAgICAgIHVwZGF0ZWRJZHMgPSBzdGF0ZS5pZHMubWFwKGN1cnJlbnQgPT4gKGN1cnJlbnQgPT09IGlkID8gaWRUb1VwZGF0ZSA6IGN1cnJlbnQpKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgLi4uKHN0YXRlIGFzIGFueSksXG4gICAgICBlbnRpdGllczoge1xuICAgICAgICAuLi5zdGF0ZUVudGl0aWVzLFxuICAgICAgICAuLi51cGRhdGVkRW50aXRpZXNcbiAgICAgIH0sXG4gICAgICBpZHM6IHVwZGF0ZWRJZHNcbiAgICB9O1xuICB9XG5cbiAgX3JlbW92ZTxUIGV4dGVuZHMgRW50aXR5U3RhdGU+KHN0YXRlOiBULCBpZHM6IElEW10gfCBudWxsKTogVCB7XG4gICAgaWYgKCFpZHMpIHJldHVybiB0aGlzLl9yZW1vdmVBbGwoc3RhdGUpO1xuXG4gICAgY29uc3QgcmVtb3ZlZCA9IGlkcy5yZWR1Y2UoKGFjYywgaWQpID0+IHtcbiAgICAgIGNvbnN0IHsgW2lkXTogZW50aXR5LCAuLi5yZXN0IH0gPSBhY2M7XG4gICAgICByZXR1cm4gcmVzdDtcbiAgICB9LCBzdGF0ZS5lbnRpdGllcyk7XG4gICAgY29uc3QgbmV3U3RhdGUgPSB7XG4gICAgICAuLi4oc3RhdGUgYXMgYW55KSxcbiAgICAgIGVudGl0aWVzOiByZW1vdmVkLFxuICAgICAgaWRzOiBzdGF0ZS5pZHMuZmlsdGVyKGN1cnJlbnQgPT4gaWRzLmluZGV4T2YoY3VycmVudCkgPT09IC0xKVxuICAgIH07XG5cbiAgICBpZiAocmVzZXRBY3RpdmUobmV3U3RhdGUpKSB7XG4gICAgICBuZXdTdGF0ZS5hY3RpdmUgPSBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiBuZXdTdGF0ZTtcbiAgfVxuXG4gIHByaXZhdGUgX3JlbW92ZUFsbDxUIGV4dGVuZHMgRW50aXR5U3RhdGU+KHN0YXRlOiBUKTogVCB7XG4gICAgY29uc3QgbmV3U3RhdGUgPSB7XG4gICAgICAuLi4oc3RhdGUgYXMgYW55KSxcbiAgICAgIGVudGl0aWVzOiB7fSxcbiAgICAgIGlkczogW10sXG4gICAgICBhY3RpdmU6IG51bGxcbiAgICB9O1xuXG4gICAgcmV0dXJuIG5ld1N0YXRlO1xuICB9XG5cbiAgcHJpdmF0ZSBrZXlCeShlbnRpdGllczogYW55W10sIGVudGl0eUNsYXNzPzogTmV3YWJsZTxhbnk+LCBpZCA9ICdpZCcpIHtcbiAgICBjb25zdCBhY2MgPSB7fTtcblxuICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBlbnRpdGllcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgY29uc3QgZW50aXR5ID0gZW50aXRpZXNbaV07XG4gICAgICBhY2NbZW50aXR5W2lkXV0gPSBlbnRpdHlDbGFzcyA/IG5ldyBlbnRpdHlDbGFzcyhlbnRpdHkpIDogZW50aXR5O1xuICAgIH1cblxuICAgIHJldHVybiBhY2M7XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IF9jcnVkID0gbmV3IENSVUQoKTtcbiIsImltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcblxuZXhwb3J0IHR5cGUgQWN0aW9uID0ge1xuICB0eXBlOiBzdHJpbmc7XG4gIGVudGl0eUlkPzogYW55W10gfCBhbnk7XG4gIHBheWxvYWQ/OiBhbnk7XG59O1xuXG5leHBvcnQgY2xhc3MgQWtpdGFHbG9iYWxzIHtcbiAgcHJpdmF0ZSBjdXN0b21BY3Rpb247XG4gIGN1cnJlbnRBY3Rpb246IEFjdGlvbjtcbiAgc2tpcEFjdGlvbiA9IGZhbHNlO1xuICBza2lwVHJhbnNhY3Rpb25Nc2cgPSBmYWxzZTtcbiAgY3VycmVudFQgPSBbXTtcbiAgYWN0aXZlVHJhbnNhY3Rpb25zID0gMDtcbiAgYmF0Y2hUcmFuc2FjdGlvbjogU3ViamVjdDxib29sZWFuPjtcblxuICBzZXRBY3Rpb24oX2FjdGlvbjogQWN0aW9uKSB7XG4gICAgaWYgKHRoaXMuY3VzdG9tQWN0aW9uKSB7XG4gICAgICB0aGlzLmN1cnJlbnRBY3Rpb24gPSB0aGlzLmN1c3RvbUFjdGlvbjtcbiAgICAgIHRoaXMuY3VzdG9tQWN0aW9uID0gbnVsbDtcbiAgICAgIHRoaXMuc2tpcFRyYW5zYWN0aW9uTXNnID0gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLmFjdGl2ZVRyYW5zYWN0aW9ucyA9PT0gMCkge1xuICAgICAgICB0aGlzLmN1cnJlbnRBY3Rpb24gPSBfYWN0aW9uO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLmFjdGl2ZVRyYW5zYWN0aW9ucyA+IDApIHtcbiAgICAgIHRoaXMuY3VycmVudFQucHVzaChfYWN0aW9uKTtcbiAgICB9XG4gIH1cblxuICBzZXRDdXN0b21BY3Rpb24oYWN0aW9uOiBBY3Rpb24sIHNraXBUcmFuc2FjdGlvbk1zZyA9IGZhbHNlKSB7XG4gICAgdGhpcy5jdXJyZW50QWN0aW9uID0gdGhpcy5jdXN0b21BY3Rpb24gPSBhY3Rpb247XG4gICAgdGhpcy5za2lwVHJhbnNhY3Rpb25Nc2cgPSBza2lwVHJhbnNhY3Rpb25Nc2c7XG4gIH1cblxuICBzZXRTa2lwQWN0aW9uKHNraXAgPSB0cnVlKSB7XG4gICAgdGhpcy5za2lwQWN0aW9uID0gc2tpcDtcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgX19nbG9iYWxTdGF0ZSA9IG5ldyBBa2l0YUdsb2JhbHMoKTtcbiIsImltcG9ydCB7IF9fZ2xvYmFsU3RhdGUgfSBmcm9tICcuL2dsb2JhbC1zdGF0ZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0LCBvZiB9IGZyb20gJ3J4anMnO1xuXG4vKipcbiAqIFN0YXJ0IGEgbmV3IHRyYW5zYWN0aW9uIGJhdGNoXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzdGFydEJhdGNoKCkge1xuICBpZiAoIWlzVHJhbnNhY3Rpb25JblByb2Nlc3MoKSkge1xuICAgIF9fZ2xvYmFsU3RhdGUuYmF0Y2hUcmFuc2FjdGlvbiA9IG5ldyBTdWJqZWN0KCk7XG4gIH1cbiAgX19nbG9iYWxTdGF0ZS5hY3RpdmVUcmFuc2FjdGlvbnMrKztcbn1cblxuLyoqXG4gKiBFbmQgdGhlIHRyYW5zYWN0aW9uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBlbmRCYXRjaCgpIHtcbiAgaWYgKC0tX19nbG9iYWxTdGF0ZS5hY3RpdmVUcmFuc2FjdGlvbnMgPT09IDApIHtcbiAgICBfX2dsb2JhbFN0YXRlLmJhdGNoVHJhbnNhY3Rpb24ubmV4dCh0cnVlKTtcbiAgICBfX2dsb2JhbFN0YXRlLmJhdGNoVHJhbnNhY3Rpb24uY29tcGxldGUoKTtcbiAgfVxufVxuXG4vKipcbiAqIFdoZXRoZXIgd2UncmUgaW5zaWRlIGJhdGNoXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1RyYW5zYWN0aW9uSW5Qcm9jZXNzKCkge1xuICByZXR1cm4gX19nbG9iYWxTdGF0ZS5hY3RpdmVUcmFuc2FjdGlvbnMgPiAwO1xufVxuXG4vKipcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNvbW1pdCgpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcbiAgcmV0dXJuIF9fZ2xvYmFsU3RhdGUuYmF0Y2hUcmFuc2FjdGlvbiA/IF9fZ2xvYmFsU3RhdGUuYmF0Y2hUcmFuc2FjdGlvbi5hc09ic2VydmFibGUoKSA6IG9mKHRydWUpO1xufVxuIiwiZXhwb3J0IGZ1bmN0aW9uIGRlZXBGcmVlemUobykge1xuICBPYmplY3QuZnJlZXplKG8pO1xuXG4gIHZhciBvSXNGdW5jdGlvbiA9IHR5cGVvZiBvID09PSAnZnVuY3Rpb24nO1xuICB2YXIgaGFzT3duUHJvcCA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7XG5cbiAgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMobykuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgaWYgKFxuICAgICAgaGFzT3duUHJvcC5jYWxsKG8sIHByb3ApICYmXG4gICAgICAob0lzRnVuY3Rpb24gPyBwcm9wICE9PSAnY2FsbGVyJyAmJiBwcm9wICE9PSAnY2FsbGVlJyAmJiBwcm9wICE9PSAnYXJndW1lbnRzJyA6IHRydWUpICYmXG4gICAgICBvW3Byb3BdICE9PSBudWxsICYmXG4gICAgICAodHlwZW9mIG9bcHJvcF0gPT09ICdvYmplY3QnIHx8IHR5cGVvZiBvW3Byb3BdID09PSAnZnVuY3Rpb24nKSAmJlxuICAgICAgIU9iamVjdC5pc0Zyb3plbihvW3Byb3BdKVxuICAgICkge1xuICAgICAgZGVlcEZyZWV6ZShvW3Byb3BdKTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiBvO1xufVxuIiwiZXhwb3J0IHR5cGUgU3RvcmVDb25maWdPcHRpb25zID0ge1xuICBuYW1lOiBzdHJpbmc7XG4gIHJlc2V0dGFibGU/OiBib29sZWFuO1xuICBpZEtleT86IHN0cmluZztcbn07XG5cbmV4cG9ydCBjb25zdCBjb25maWdLZXkgPSAnYWtpdGFDb25maWcnO1xuXG5leHBvcnQgZnVuY3Rpb24gU3RvcmVDb25maWcobWV0YWRhdGE6IFN0b3JlQ29uZmlnT3B0aW9ucykge1xuICByZXR1cm4gZnVuY3Rpb24oY29uc3RydWN0b3I6IEZ1bmN0aW9uKSB7XG4gICAgY29uc3RydWN0b3JbY29uZmlnS2V5XSA9IHsgaWRLZXk6ICdpZCcgfTtcblxuICAgIGZvciAobGV0IGkgPSAwLCBrZXlzID0gT2JqZWN0LmtleXMobWV0YWRhdGEpOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3Qga2V5ID0ga2V5c1tpXTtcbiAgICAgIC8qIG5hbWUgaXMgcHJlc2VydmVkIHJlYWQgb25seSBrZXkgKi9cbiAgICAgIGlmIChrZXkgPT09ICduYW1lJykge1xuICAgICAgICBjb25zdHJ1Y3Rvcltjb25maWdLZXldWydzdG9yZU5hbWUnXSA9IG1ldGFkYXRhW2tleV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdHJ1Y3Rvcltjb25maWdLZXldW2tleV0gPSBtZXRhZGF0YVtrZXldO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbn1cbiIsImV4cG9ydCBpbnRlcmZhY2UgQWtpdGFDb25maWcge1xuICAvKipcbiAgICogV2hldGhlciB0byBhbGxvd2VkIHRoZSByZXNldCgpIHN0b3JlcyBmdW5jdGlvbmFsaXR5XG4gICAqL1xuICByZXNldHRhYmxlPzogYm9vbGVhbjtcbn1cblxubGV0IENPTkZJRzogQWtpdGFDb25maWcgPSB7XG4gIHJlc2V0dGFibGU6IGZhbHNlXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gYWtpdGFDb25maWcoY29uZmlnOiBBa2l0YUNvbmZpZykge1xuICBDT05GSUcgPSB7IC4uLkNPTkZJRywgLi4uY29uZmlnIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBa2l0YUNvbmZpZygpIHtcbiAgcmV0dXJuIENPTkZJRztcbn1cbiIsImltcG9ydCB7IEhhc2hNYXAsIElEIH0gZnJvbSAnLi90eXBlcyc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGUsIFJlcGxheVN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRpc3RpbmN0VW50aWxDaGFuZ2VkLCBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBBa2l0YUVycm9yLCBBa2l0YUltbXV0YWJpbGl0eUVycm9yLCBhc3NlcnREZWNvcmF0b3IgfSBmcm9tICcuLi9pbnRlcm5hbC9lcnJvcic7XG5pbXBvcnQgeyBjb21taXQsIGlzVHJhbnNhY3Rpb25JblByb2Nlc3MgfSBmcm9tICcuLi9pbnRlcm5hbC90cmFuc2FjdGlvbi5pbnRlcm5hbCc7XG5pbXBvcnQgeyBpc0Z1bmN0aW9uLCBpc1BsYWluT2JqZWN0IH0gZnJvbSAnLi4vaW50ZXJuYWwvdXRpbHMnO1xuaW1wb3J0IHsgZGVlcEZyZWV6ZSB9IGZyb20gJy4uL2ludGVybmFsL2RlZXAtZnJlZXplJztcbmltcG9ydCB7IGNvbmZpZ0tleSwgU3RvcmVDb25maWdPcHRpb25zIH0gZnJvbSAnLi9zdG9yZS1jb25maWcnO1xuaW1wb3J0IHsgX19nbG9iYWxTdGF0ZSB9IGZyb20gJy4uL2ludGVybmFsL2dsb2JhbC1zdGF0ZSc7XG5pbXBvcnQgeyBnZXRBa2l0YUNvbmZpZyB9IGZyb20gJy4vY29uZmlnJztcblxubGV0IF9fREVWX18gPSB0cnVlO1xuY29uc3QgaXNOb3RCcm93c2VyID0gdHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCc7XG5cbmV4cG9ydCBjb25zdCBfX3N0b3Jlc19fOiB7IFtzdG9yZU5hbWU6IHN0cmluZ106IFN0b3JlPGFueT4gfSA9IHt9O1xuXG5leHBvcnQgY29uc3QgZW51bSBBY3Rpb25zIHtcbiAgTkVXX1NUT1JFLFxuICBERUxFVEVfU1RPUkUsXG4gIE5FV19TVEFURVxufVxuXG5leHBvcnQgdHlwZSBBY3Rpb24gPSB7XG4gIHR5cGU6IEFjdGlvbnM7XG4gIHBheWxvYWQ6IEhhc2hNYXA8YW55Pjtcbn07XG5cbmV4cG9ydCBjb25zdCByb290RGlzcGF0Y2hlciA9IG5ldyBSZXBsYXlTdWJqZWN0PEFjdGlvbj4oKTtcblxuZnVuY3Rpb24gbmV4dFN0YXRlKHN0b3JlTmFtZSwgaW5pdGlhbFN0YXRlID0gZmFsc2UpIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiBBY3Rpb25zLk5FV19TVEFURSxcbiAgICBwYXlsb2FkOiB7XG4gICAgICBuYW1lOiBzdG9yZU5hbWUsXG4gICAgICBpbml0aWFsU3RhdGVcbiAgICB9XG4gIH07XG59XG5cbi8qKlxuICogRW5hYmxlIHByb2R1Y3Rpb24gbW9kZSB0byBkaXNhYmxlIG9iamVjdEZyZWV6ZVxuICovXG5leHBvcnQgZnVuY3Rpb24gZW5hYmxlQWtpdGFQcm9kTW9kZSgpIHtcbiAgX19ERVZfXyA9IGZhbHNlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNEZXYoKSB7XG4gIHJldHVybiBfX0RFVl9fO1xufVxuXG4vKipcbiAqIFRoZSBSb290IFN0b3JlIHRoYXQgZXZlcnkgc3ViIHN0b3JlIG5lZWRzIHRvIGluaGVyaXQgYW5kXG4gKiBpbnZva2UgYHN1cGVyYCB3aXRoIHRoZSBpbml0aWFsIHN0YXRlLlxuICovXG5leHBvcnQgY2xhc3MgU3RvcmU8Uz4ge1xuICAvKiogTWFuYWdlIHRoZSBzdG9yZSB3aXRoIEJlaGF2aW9yU3ViamVjdCAqL1xuICBwcml2YXRlIHN0b3JlOiBCZWhhdmlvclN1YmplY3Q8UmVhZG9ubHk8Uz4+O1xuXG4gIC8qKiBUaGUgY3VycmVudCBzdGF0ZSB2YWx1ZSAqL1xuICBwcml2YXRlIHN0b3JlVmFsdWU6IFM7XG5cbiAgLyoqIFdoZXRoZXIgd2UgYXJlIGluc2lkZSB0cmFuc2FjdGlvbiAqKi9cbiAgcHJpdmF0ZSBpblRyYW5zYWN0aW9uID0gZmFsc2U7XG5cbiAgcHJpdmF0ZSBfaXNQcmlzdGluZSA9IHRydWU7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBfaW5pdGlhbFN0YXRlOiBTO1xuXG4gIC8qKlxuICAgKlxuICAgKiBJbml0aWFsIHRoZSBzdG9yZSB3aXRoIHRoZSBzdGF0ZVxuICAgKi9cbiAgY29uc3RydWN0b3IoaW5pdGlhbFN0YXRlLCBwcml2YXRlIG9wdGlvbnM6IHsgaWRLZXk/OiBzdHJpbmc7IHN0b3JlTmFtZT86IHN0cmluZyB9ID0ge30pIHtcbiAgICBfX2dsb2JhbFN0YXRlLnNldEFjdGlvbih7IHR5cGU6ICdAQElOSVQnIH0pO1xuICAgIF9fc3RvcmVzX19bdGhpcy5zdG9yZU5hbWVdID0gdGhpcztcbiAgICB0aGlzLnNldFN0YXRlKCgpID0+IGluaXRpYWxTdGF0ZSk7XG4gICAgcm9vdERpc3BhdGNoZXIubmV4dCh7XG4gICAgICB0eXBlOiBBY3Rpb25zLk5FV19TVE9SRSxcbiAgICAgIHBheWxvYWQ6IHsgc3RvcmU6IHRoaXMgfVxuICAgIH0pO1xuICAgIGlzRGV2KCkgJiYgYXNzZXJ0RGVjb3JhdG9yKHRoaXMuc3RvcmVOYW1lLCB0aGlzLmNvbnN0cnVjdG9yLm5hbWUpO1xuICAgIGlmICh0aGlzLmlzUmVzc2V0YWJsZSgpKSB7XG4gICAgICB0aGlzLl9pbml0aWFsU3RhdGUgPSBpbml0aWFsU3RhdGU7XG4gICAgfVxuICB9XG5cbiAgc2V0TG9hZGluZyhsb2FkaW5nID0gZmFsc2UpIHtcbiAgICBpZiAobG9hZGluZyAhPT0gKHRoaXMuX3ZhbHVlKCkgYXMgUyAmIHsgbG9hZGluZzogYm9vbGVhbiB9KS5sb2FkaW5nKSB7XG4gICAgICBpc0RldigpICYmIF9fZ2xvYmFsU3RhdGUuc2V0QWN0aW9uKHsgdHlwZTogJ1NldCBMb2FkaW5nJyB9KTtcbiAgICAgIHRoaXMuc2V0U3RhdGUocyA9PiAoeyAuLi4ocyBhcyBvYmplY3QpLCBsb2FkaW5nIH0gYXMgYW55KSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgc3RvcmUncyBlcnJvciBzdGF0ZS5cbiAgICovXG4gIHNldEVycm9yPFQ+KGVycm9yOiBUKSB7XG4gICAgaWYgKGVycm9yICE9PSAodGhpcy5fdmFsdWUoKSBhcyBTICYgeyBlcnJvcjogYW55IH0pLmVycm9yKSB7XG4gICAgICBpc0RldigpICYmIF9fZ2xvYmFsU3RhdGUuc2V0QWN0aW9uKHsgdHlwZTogJ1NldCBFcnJvcicgfSk7XG4gICAgICB0aGlzLnNldFN0YXRlKHMgPT4gKHsgLi4uKHMgYXMgb2JqZWN0KSwgZXJyb3IgfSBhcyBhbnkpKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2VsZWN0IGEgc2xpY2UgZnJvbSB0aGUgc3RvcmVcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogdGhpcy5zdG9yZS5zZWxlY3Qoc3RhdGUgPT4gc3RhdGUuZW50aXRpZXMpXG4gICAqXG4gICAqL1xuICBfc2VsZWN0PFI+KHByb2plY3Q6IChzdG9yZTogUykgPT4gUik6IE9ic2VydmFibGU8Uj4ge1xuICAgIHJldHVybiB0aGlzLnN0b3JlJC5waXBlKFxuICAgICAgbWFwKHByb2plY3QpLFxuICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKVxuICAgICk7XG4gIH1cblxuICBfdmFsdWUoKTogUyB7XG4gICAgcmV0dXJuIHRoaXMuc3RvcmVWYWx1ZTtcbiAgfVxuXG4gIGdldCBjb25maWcoKTogU3RvcmVDb25maWdPcHRpb25zIHtcbiAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvcltjb25maWdLZXldO1xuICB9XG5cbiAgZ2V0IHN0b3JlTmFtZSgpIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLnN0b3JlTmFtZSB8fCAodGhpcy5jb25maWcgJiYgdGhpcy5jb25maWdbJ3N0b3JlTmFtZSddKTtcbiAgfVxuXG4gIGdldCBpZEtleSgpIHtcbiAgICAvKiogYmFja3dhcmQgY29tcGF0aWJpbGl0eSAqL1xuICAgIGNvbnN0IG5ld0lkS2V5ID0gdGhpcy5jb25maWcgJiYgdGhpcy5jb25maWcuaWRLZXk7XG4gICAgaWYgKCFuZXdJZEtleSkge1xuICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5pZEtleSB8fCAnaWQnO1xuICAgIH1cbiAgICByZXR1cm4gbmV3SWRLZXk7XG4gIH1cblxuICBnZXQgaXNQcmlzdGluZSgpIHtcbiAgICByZXR1cm4gdGhpcy5faXNQcmlzdGluZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBgc2V0U3RhdGUoKWAgaXMgdGhlIG9ubHkgd2F5IHRvIHVwZGF0ZSBhIHN0b3JlOyBJdCByZWNlaXZlcyBhIGNhbGxiYWNrIGZ1bmN0aW9uLFxuICAgKiB3aGljaCBnZXRzIHRoZSBjdXJyZW50IHN0YXRlLCBhbmQgcmV0dXJucyBhIG5ldyBpbW11dGFibGUgc3RhdGUsXG4gICAqIHdoaWNoIHdpbGwgYmUgdGhlIG5ldyB2YWx1ZSBvZiB0aGUgc3RvcmUuXG4gICAqL1xuICBzZXRTdGF0ZShuZXdTdGF0ZUZuOiAoc3RhdGU6IFJlYWRvbmx5PFM+KSA9PiBTLCBfcm9vdERpc3BhdGNoZXIgPSB0cnVlKSB7XG4gICAgY29uc3QgcHJldlN0YXRlID0gdGhpcy5fdmFsdWUoKTtcbiAgICB0aGlzLnN0b3JlVmFsdWUgPSBfX0RFVl9fID8gZGVlcEZyZWV6ZShuZXdTdGF0ZUZuKHRoaXMuX3ZhbHVlKCkpKSA6IG5ld1N0YXRlRm4odGhpcy5fdmFsdWUoKSk7XG5cbiAgICBpZiAocHJldlN0YXRlID09PSB0aGlzLnN0b3JlVmFsdWUpIHtcbiAgICAgIHRocm93IG5ldyBBa2l0YUltbXV0YWJpbGl0eUVycm9yKHRoaXMuc3RvcmVOYW1lKTtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMuc3RvcmUpIHtcbiAgICAgIHRoaXMuc3RvcmUgPSBuZXcgQmVoYXZpb3JTdWJqZWN0KHRoaXMuc3RvcmVWYWx1ZSk7XG4gICAgICByb290RGlzcGF0Y2hlci5uZXh0KG5leHRTdGF0ZSh0aGlzLnN0b3JlTmFtZSwgdHJ1ZSkpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChpc1RyYW5zYWN0aW9uSW5Qcm9jZXNzKCkpIHtcbiAgICAgIHRoaXMuaGFuZGxlVHJhbnNhY3Rpb24oKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmRpc3BhdGNoKHRoaXMuc3RvcmVWYWx1ZSwgX3Jvb3REaXNwYXRjaGVyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNldHMgdGhlIHN0b3JlIHRvIGl0J3MgaW5pdGlhbCBzdGF0ZSBhbmQgc2V0IHRoZSBzdG9yZSB0byBhIHByaXN0aW5lIHN0YXRlLlxuICAgKi9cbiAgcmVzZXQoKSB7XG4gICAgaWYgKHRoaXMuaXNSZXNzZXRhYmxlKCkpIHtcbiAgICAgIF9fZ2xvYmFsU3RhdGUuc2V0QWN0aW9uKHsgdHlwZTogJ1Jlc2V0IFN0b3JlJyB9KTtcbiAgICAgIHRoaXMuc2V0U3RhdGUoKCkgPT4gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5faW5pdGlhbFN0YXRlKSk7XG4gICAgICB0aGlzLnNldFByaXN0aW5lKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBBa2l0YUVycm9yKGBZb3UgbmVlZCB0byBlbmFibGUgdGhlIHJlc2V0IGZ1bmN0aW9uYWxpdHlgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVGhpcyBtZXRob2QgaXMgYSBzaG9ydGN1dCBmb3IgYHNldFN0YXRlKClgLlxuICAgKiBJdCBjYW4gYmUgdXNlZnVsIHdoZW4geW91IHdhbnQgdG8gcGFzcyB0aGUgd2hvbGUgc3RhdGUgb2JqZWN0IGluc3RlYWQgb2YgbWVyZ2luZyBhIHBhcnRpYWwgc3RhdGUuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIHRoaXMuc3RvcmUudXBkYXRlKG5ld1N0YXRlKVxuICAgKi9cbiAgdXBkYXRlKG5ld1N0YXRlOiAoc3RhdGU6IFJlYWRvbmx5PFM+KSA9PiBQYXJ0aWFsPFM+KTtcbiAgdXBkYXRlKG5ld1N0YXRlOiBQYXJ0aWFsPFM+KTtcbiAgdXBkYXRlKGlkOiBJRCB8IElEW10gfCBudWxsLCBuZXdTdGF0ZTogUGFydGlhbDxTPik7XG4gIHVwZGF0ZShuZXdTdGF0ZU9ySWQ6IFBhcnRpYWw8Uz4gfCBJRCB8IElEW10gfCBudWxsIHwgKChzdGF0ZTogUmVhZG9ubHk8Uz4pID0+IFBhcnRpYWw8Uz4pLCBuZXdTdGF0ZT86IFBhcnRpYWw8Uz4pIHtcbiAgICBfX2dsb2JhbFN0YXRlLnNldEFjdGlvbih7IHR5cGU6ICdVcGRhdGUgU3RvcmUnIH0pO1xuICAgIHRoaXMuc2V0U3RhdGUoc3RhdGUgPT4ge1xuICAgICAgbGV0IHZhbHVlID0gaXNGdW5jdGlvbihuZXdTdGF0ZU9ySWQpID8gbmV3U3RhdGVPcklkKHN0YXRlKSA6IG5ld1N0YXRlT3JJZDtcbiAgICAgIGxldCBtZXJnZWQgPSBPYmplY3QuYXNzaWduKHt9LCBzdGF0ZSwgdmFsdWUpO1xuICAgICAgcmV0dXJuIGlzUGxhaW5PYmplY3Qoc3RhdGUpID8gbWVyZ2VkIDogbmV3IChzdGF0ZSBhcyBhbnkpLmNvbnN0cnVjdG9yKG1lcmdlZCk7XG4gICAgfSk7XG4gICAgdGhpcy5zZXREaXJ0eSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIHN0b3JlIHRvIGEgcHJpc3RpbmUgc3RhdGUuXG4gICAqL1xuICBzZXRQcmlzdGluZSgpIHtcbiAgICB0aGlzLl9pc1ByaXN0aW5lID0gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBzdG9yZSB0byBhIGRpcnR5IHN0YXRlLCBpbmRpY2F0aW5nIHRoYXQgaXQgaXMgbm90IHByaXN0aW5lLlxuICAgKi9cbiAgc2V0RGlydHkoKSB7XG4gICAgdGhpcy5faXNQcmlzdGluZSA9IGZhbHNlO1xuICB9XG5cbiAgZGVzdHJveSA9IHRoaXMubmdPbkRlc3Ryb3k7XG5cbiAgcHJpdmF0ZSBkaXNwYXRjaChzdGF0ZTogUywgX3Jvb3REaXNwYXRjaGVyID0gdHJ1ZSkge1xuICAgIHRoaXMuc3RvcmUubmV4dChzdGF0ZSk7XG4gICAgaWYgKF9yb290RGlzcGF0Y2hlcikge1xuICAgICAgcm9vdERpc3BhdGNoZXIubmV4dChuZXh0U3RhdGUodGhpcy5zdG9yZU5hbWUpKTtcbiAgICAgIGlzRGV2KCkgJiYgX19nbG9iYWxTdGF0ZS5zZXRBY3Rpb24oeyB0eXBlOiAnU2V0IFN0YXRlJyB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldCBzdG9yZSQoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RvcmUuYXNPYnNlcnZhYmxlKCk7XG4gIH1cblxuICAvKipcbiAgICogV2hlbiB0aGUgdHJhbnNhY3Rpb24gZW5kcyBkaXNwYXRjaCB0aGUgZmluYWwgdmFsdWUgb25jZVxuICAgKi9cbiAgcHJpdmF0ZSB3YXRjaFRyYW5zYWN0aW9uKCkge1xuICAgIGNvbW1pdCgpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICB0aGlzLmluVHJhbnNhY3Rpb24gPSBmYWxzZTtcbiAgICAgIGlmIChpc0RldigpICYmICFfX2dsb2JhbFN0YXRlLnNraXBUcmFuc2FjdGlvbk1zZykge1xuICAgICAgICBfX2dsb2JhbFN0YXRlLnNldEFjdGlvbih7IHR5cGU6ICdAVHJhbnNhY3Rpb24nIH0pO1xuICAgICAgfVxuICAgICAgdGhpcy5kaXNwYXRjaCh0aGlzLl92YWx1ZSgpKTtcbiAgICAgIF9fZ2xvYmFsU3RhdGUuY3VycmVudFQgPSBbXTtcbiAgICAgIF9fZ2xvYmFsU3RhdGUuc2tpcFRyYW5zYWN0aW9uTXNnID0gZmFsc2U7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGlzUmVzc2V0YWJsZSgpIHtcbiAgICByZXR1cm4gdGhpcy5jb25maWcucmVzZXR0YWJsZSB8fCBnZXRBa2l0YUNvbmZpZygpLnJlc2V0dGFibGU7XG4gIH1cblxuICAvKipcbiAgICogTGlzdGVuIHRvIHRoZSB0cmFuc2FjdGlvbiBzdHJlYW1cbiAgICovXG4gIHByaXZhdGUgaGFuZGxlVHJhbnNhY3Rpb24oKSB7XG4gICAgaWYgKCF0aGlzLmluVHJhbnNhY3Rpb24pIHtcbiAgICAgIHRoaXMud2F0Y2hUcmFuc2FjdGlvbigpO1xuICAgICAgdGhpcy5pblRyYW5zYWN0aW9uID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICBpZiAoaXNOb3RCcm93c2VyKSByZXR1cm47XG4gICAgaWYgKCEod2luZG93IGFzIGFueSkuaG1yRW5hYmxlZCAmJiB0aGlzID09PSBfX3N0b3Jlc19fW3RoaXMuc3RvcmVOYW1lXSkge1xuICAgICAgZGVsZXRlIF9fc3RvcmVzX19bdGhpcy5zdG9yZU5hbWVdO1xuICAgICAgcm9vdERpc3BhdGNoZXIubmV4dCh7XG4gICAgICAgIHR5cGU6IEFjdGlvbnMuREVMRVRFX1NUT1JFLFxuICAgICAgICBwYXlsb2FkOiB7IHN0b3JlTmFtZTogdGhpcy5zdG9yZU5hbWUgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG59XG4iLCJpbXBvcnQgeyBfY3J1ZCB9IGZyb20gJy4uL2ludGVybmFsL2NydWQnO1xuaW1wb3J0IHsgQWtpdGFJbW11dGFiaWxpdHlFcnJvciwgYXNzZXJ0QWN0aXZlIH0gZnJvbSAnLi4vaW50ZXJuYWwvZXJyb3InO1xuaW1wb3J0IHsgQWN0aW9uLCBfX2dsb2JhbFN0YXRlIH0gZnJvbSAnLi4vaW50ZXJuYWwvZ2xvYmFsLXN0YXRlJztcbmltcG9ydCB7IGNvZXJjZUFycmF5LCBlbnRpdHlFeGlzdHMsIGlzRnVuY3Rpb24sIGlzTmlsLCBpc09iamVjdCwgaXNVbmRlZmluZWQsIHRvQm9vbGVhbiB9IGZyb20gJy4uL2ludGVybmFsL3V0aWxzJztcbmltcG9ydCB7IGlzRGV2LCBTdG9yZSB9IGZyb20gJy4vc3RvcmUnO1xuaW1wb3J0IHsgQWN0aXZlU3RhdGUsIEVudGl0aWVzLCBFbnRpdHlTdGF0ZSwgSGFzaE1hcCwgSUQsIE5ld2FibGUsIEFkZE9wdGlvbnMsIFNldEFjdGl2ZU9wdGlvbnMgfSBmcm9tICcuL3R5cGVzJztcblxuLyoqXG4gKiBUaGUgUm9vdCBTdG9yZSB0aGF0IGV2ZXJ5IHN1YiBzdG9yZSBuZWVkcyB0byBpbmhlcml0IGFuZFxuICogaW52b2tlIGBzdXBlcmAgd2l0aCB0aGUgaW5pdGlhbCBzdGF0ZS5cbiAqL1xuZXhwb3J0IGNsYXNzIEVudGl0eVN0b3JlPFMgZXh0ZW5kcyBFbnRpdHlTdGF0ZTxFPiwgRSwgQWN0aXZlRW50aXR5ID0gSUQ+IGV4dGVuZHMgU3RvcmU8Uz4ge1xuICAvKipcbiAgICpcbiAgICogSW5pdGlhdGUgdGhlIHN0b3JlIHdpdGggdGhlIHN0YXRlXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihpbml0aWFsU3RhdGUgPSB7fSwgb3B0aW9uczogeyBpZEtleT86IHN0cmluZzsgc3RvcmVOYW1lPzogc3RyaW5nIH0gPSB7fSkge1xuICAgIHN1cGVyKHsgLi4uZ2V0SW5pdGlhbEVudGl0aWVzU3RhdGUoKSwgLi4uaW5pdGlhbFN0YXRlIH0sIG9wdGlvbnMpO1xuICB9XG5cbiAgZ2V0IGVudGl0aWVzKCkge1xuICAgIHJldHVybiB0aGlzLl92YWx1ZSgpLmVudGl0aWVzO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIFJlcGxhY2UgY3VycmVudCBjb2xsZWN0aW9uIHdpdGggcHJvdmlkZWQgY29sbGVjdGlvblxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiB0aGlzLnN0b3JlLnNldChbRW50aXR5LCBFbnRpdHldKTtcbiAgICogdGhpcy5zdG9yZS5zZXQoezE6IEVudGl0eSwgMjogRW50aXR5fSk7XG4gICAqIHRoaXMuc3RvcmUuc2V0KFt7aWQ6IDF9LCB7aWQ6IDJ9XSwgeyBlbnRpdHlDbGFzczogUHJvZHVjdCB9KTtcbiAgICpcbiAgICovXG4gIHNldChlbnRpdGllczogRVtdIHwgSGFzaE1hcDxFPiB8IEVudGl0aWVzPEU+LCBvcHRpb25zOiB7IGVudGl0eUNsYXNzPzogTmV3YWJsZTxFPiB8IHVuZGVmaW5lZCB9ID0ge30pIHtcbiAgICBpc0RldigpICYmIF9fZ2xvYmFsU3RhdGUuc2V0QWN0aW9uKHsgdHlwZTogJ1NldCBFbnRpdGllcycgfSk7XG4gICAgdGhpcy5zZXRTdGF0ZShzdGF0ZSA9PiBfY3J1ZC5fc2V0KHN0YXRlLCBpc05pbChlbnRpdGllcykgPyBbXSA6IGVudGl0aWVzLCBvcHRpb25zLmVudGl0eUNsYXNzLCB0aGlzLmlkS2V5KSk7XG4gICAgdGhpcy5zZXREaXJ0eSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBvciByZXBsYWNlIGFuIGVudGl0eSBpbiB0aGUgc3RvcmUuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIHRoaXMuc3RvcmUuY3JlYXRlT3JSZXBsYWNlKDMsIEVudGl0eSk7XG4gICAqXG4gICAqL1xuICBjcmVhdGVPclJlcGxhY2UoaWQ6IElELCBlbnRpdHk6IEUpIHtcbiAgICBpZiAoIWVudGl0eUV4aXN0cyhpZCwgdGhpcy5fdmFsdWUoKS5lbnRpdGllcykpIHtcbiAgICAgIHRoaXMuYWRkV2hlbk5vdEV4aXN0cyhpZCwgZW50aXR5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgaXNEZXYoKSAmJiBfX2dsb2JhbFN0YXRlLnNldEFjdGlvbih7IHR5cGU6ICdDcmVhdGUgb3IgUmVwbGFjZSBFbnRpdHknLCBlbnRpdHlJZDogW2lkXSB9KTtcbiAgICAgIHRoaXMuc2V0U3RhdGUoc3RhdGUgPT4gX2NydWQuX3JlcGxhY2VFbnRpdHkoc3RhdGUsIGlkLCBlbnRpdHkpKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogSW5zZXJ0IG9yIFVwZGF0ZVxuICAgKi9cbiAgdXBzZXJ0KGlkOiBJRCwgZW50aXR5T3JGbjogUGFydGlhbDxFPiB8ICgoZW50aXR5OiBSZWFkb25seTxFPikgPT4gUGFydGlhbDxFPikpIHtcbiAgICBpZiAoIWVudGl0eUV4aXN0cyhpZCwgdGhpcy5fdmFsdWUoKS5lbnRpdGllcykpIHtcbiAgICAgIGNvbnN0IHJlc29sdmUgPSBpc0Z1bmN0aW9uKGVudGl0eU9yRm4pID8gKGVudGl0eU9yRm4gYXMgRnVuY3Rpb24pKHt9KSA6IGVudGl0eU9yRm47XG4gICAgICB0aGlzLmFkZFdoZW5Ob3RFeGlzdHMoaWQsIHJlc29sdmUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnVwZGF0ZShpZCwgZW50aXR5T3JGbiBhcyBhbnkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgYW4gZW50aXR5IG9yIGVudGl0aWVzIHRvIHRoZSBzdG9yZS5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogdGhpcy5zdG9yZS5hZGQoW0VudGl0eSwgRW50aXR5XSk7XG4gICAqIHRoaXMuc3RvcmUuYWRkKEVudGl0eSk7XG4gICAqIHRoaXMuc3RvcmUuYWRkKEVudGl0eSwgeyBwcmVwZW5kOiB0cnVlIH0pO1xuICAgKi9cbiAgYWRkKGVudGl0aWVzOiBFW10gfCBFLCBvcHRpb25zPzogQWRkT3B0aW9ucykge1xuICAgIGNvbnN0IHRvQXJyYXkgPSBjb2VyY2VBcnJheShlbnRpdGllcyk7XG5cbiAgICBpZiAodG9BcnJheS5sZW5ndGggPT09IDApIHJldHVybjtcbiAgICAvKiogIElmIHdlIHBhc3MgZW50aXRpZXMgdGhhdCBhbHJlYWR5IGV4aXN0LCB3ZSBzaG91bGQgaWdub3JlIHRoZW0gKi9cbiAgICBjb25zdCBhbGxFeGlzdHMgPSB0b0FycmF5LmV2ZXJ5KGVudGl0eSA9PiB0aGlzLl92YWx1ZSgpLmlkcy5pbmRleE9mKGVudGl0eVt0aGlzLmlkS2V5XSkgPiAtMSk7XG4gICAgaWYgKGFsbEV4aXN0cykgcmV0dXJuO1xuXG4gICAgaXNEZXYoKSAmJiBfX2dsb2JhbFN0YXRlLnNldEFjdGlvbih7IHR5cGU6ICdBZGQgRW50aXR5JyB9KTtcbiAgICB0aGlzLnNldFN0YXRlKHN0YXRlID0+IF9jcnVkLl9hZGQ8UywgRT4oc3RhdGUsIHRvQXJyYXksIHRoaXMuaWRLZXksIG9wdGlvbnMpKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBVcGRhdGUgYW4gZW50aXR5IG9yIGVudGl0aWVzIGluIHRoZSBzdG9yZS5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogdGhpcy5zdG9yZS51cGRhdGUoMywge1xuICAgKiAgIG5hbWU6ICdOZXcgTmFtZSdcbiAgICogfSk7XG4gICAqXG4gICAqICB0aGlzLnN0b3JlLnVwZGF0ZSgzLCBlbnRpdHkgPT4ge1xuICAgKiAgICByZXR1cm4ge1xuICAgKiAgICAgIGNvbmZpZzoge1xuICAgKiAgICAgICAgLi4uZW50aXR5LmZpbHRlcixcbiAgICogICAgICAgIGRhdGVcbiAgICogICAgICB9XG4gICAqICAgIH1cbiAgICogIH0pO1xuICAgKlxuICAgKiB0aGlzLnN0b3JlLnVwZGF0ZShbMSwyLDNdLCB7XG4gICAqICAgbmFtZTogJ05ldyBOYW1lJ1xuICAgKiB9KTtcbiAgICpcbiAgICogdGhpcy5zdG9yZS51cGRhdGUoZSA9PiBlLm5hbWUgPT09ICd2YWx1ZScsIHtcbiAgICogICBuYW1lOiAnTmV3IE5hbWUnXG4gICAqIH0pO1xuICAgKlxuICAgKiB0aGlzLnN0b3JlLnVwZGF0ZShudWxsLCB7XG4gICAqICAgbmFtZTogJ05ldyBOYW1lJ1xuICAgKiB9KTtcbiAgICpcbiAgICovXG4gIHVwZGF0ZShpZDogSUQgfCBJRFtdIHwgbnVsbCwgbmV3U3RhdGVGbjogKChlbnRpdHk6IFJlYWRvbmx5PEU+KSA9PiBQYXJ0aWFsPEU+KSk7XG4gIHVwZGF0ZShpZDogSUQgfCBJRFtdIHwgbnVsbCwgbmV3U3RhdGU6IFBhcnRpYWw8RT4pO1xuICB1cGRhdGUoaWQ6IElEIHwgSURbXSB8IG51bGwsIG5ld1N0YXRlOiBQYXJ0aWFsPFM+KTtcbiAgdXBkYXRlKG5ld1N0YXRlOiAoc3RhdGU6IFJlYWRvbmx5PFM+KSA9PiBQYXJ0aWFsPFM+KTtcbiAgdXBkYXRlKHByZWRpY2F0ZTogKChlbnRpdHk6IFJlYWRvbmx5PEU+KSA9PiBib29sZWFuKSwgbmV3U3RhdGVGbjogKChlbnRpdHk6IFJlYWRvbmx5PEU+KSA9PiBQYXJ0aWFsPEU+KSk7XG4gIHVwZGF0ZShwcmVkaWNhdGU6ICgoZW50aXR5OiBSZWFkb25seTxFPikgPT4gYm9vbGVhbiksIG5ld1N0YXRlOiBQYXJ0aWFsPEU+KTtcbiAgdXBkYXRlKHByZWRpY2F0ZTogKChlbnRpdHk6IFJlYWRvbmx5PEU+KSA9PiBib29sZWFuKSwgbmV3U3RhdGU6IFBhcnRpYWw8Uz4pO1xuICB1cGRhdGUobmV3U3RhdGU6IFBhcnRpYWw8Uz4pO1xuICB1cGRhdGUoXG4gICAgaWRzT3JGbjogSUQgfCBJRFtdIHwgbnVsbCB8IFBhcnRpYWw8Uz4gfCAoKHN0YXRlOiBSZWFkb25seTxTPikgPT4gUGFydGlhbDxTPikgfCAoKGVudGl0eTogUmVhZG9ubHk8RT4pID0+IGJvb2xlYW4pLFxuICAgIG5ld1N0YXRlT3JGbj86ICgoZW50aXR5OiBSZWFkb25seTxFPikgPT4gUGFydGlhbDxFPikgfCBQYXJ0aWFsPEU+IHwgUGFydGlhbDxTPlxuICApIHtcbiAgICBsZXQgaWRzOiBJRFtdID0gW107XG4gICAgY29uc3Qgc3RvcmVJZHMgPSB0aGlzLl92YWx1ZSgpLmlkcztcblxuICAgIGlmIChpc0Z1bmN0aW9uKGlkc09yRm4pKSB7XG4gICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gc3RvcmVJZHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgY29uc3QgaWQgPSBzdG9yZUlkc1tpXTtcbiAgICAgICAgY29uc3QgZW50aXR5ID0gdGhpcy5fdmFsdWUoKS5lbnRpdGllc1tpZF07XG4gICAgICAgIGlmIChlbnRpdHkgJiYgKGlkc09yRm4gYXMgRnVuY3Rpb24pKGVudGl0eSkpIHtcbiAgICAgICAgICBpZHMucHVzaChpZCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWRzID0gdG9Cb29sZWFuKGlkc09yRm4pID8gY29lcmNlQXJyYXkoaWRzT3JGbikgOiBzdG9yZUlkcztcbiAgICB9XG5cbiAgICBpZiAoaWRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuICAgIGlzRGV2KCkgJiYgX19nbG9iYWxTdGF0ZS5zZXRBY3Rpb24oeyB0eXBlOiAnVXBkYXRlIEVudGl0eScsIGVudGl0eUlkOiBpZHMgfSk7XG5cbiAgICB0aGlzLnNldFN0YXRlKHN0YXRlID0+IHtcbiAgICAgIHJldHVybiBfY3J1ZC5fdXBkYXRlKHN0YXRlLCBpZHMsIG5ld1N0YXRlT3JGbiwgdGhpcy5pZEtleSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQW4gYWxpYXMgdG8gdXBkYXRlIGFsbC5cbiAgICovXG4gIHVwZGF0ZUFsbChzdGF0ZTogUGFydGlhbDxFPikge1xuICAgIGlmICh0aGlzLl92YWx1ZSgpLmlkcy5sZW5ndGggPT09IDApIHJldHVybjtcbiAgICB0aGlzLnVwZGF0ZShudWxsLCBzdGF0ZSk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRoZSByb290IHN0YXRlIChkYXRhIHdoaWNoIGlzIGV4dGVybmFsIHRvIHRoZSBlbnRpdGllcykuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIHRoaXMuc3RvcmUudXBkYXRlUm9vdCh7XG4gICAqICAgbWV0YWRhdGE6ICduZXcgbWV0YWRhdGFcbiAgICogfSk7XG4gICAqXG4gICAqICB0aGlzLnN0b3JlLnVwZGF0ZVJvb3Qoc3RhdGUgPT4ge1xuICAgKiAgICByZXR1cm4ge1xuICAgKiAgICAgIG1ldGFkYXRhOiB7XG4gICAqICAgICAgICAuLi5zdGF0ZS5tZXRhZGF0YSxcbiAgICogICAgICAgIGtleTogJ25ldyB2YWx1ZSdcbiAgICogICAgICB9XG4gICAqICAgIH1cbiAgICogIH0pO1xuICAgKi9cbiAgdXBkYXRlUm9vdChuZXdTdGF0ZUZuOiAoKHN0YXRlOiBSZWFkb25seTxTPikgPT4gUGFydGlhbDxTPikgfCBQYXJ0aWFsPFM+LCBhY3Rpb24/OiBBY3Rpb24pIHtcbiAgICBjb25zdCBuZXdTdGF0ZSA9IGlzRnVuY3Rpb24obmV3U3RhdGVGbikgPyBuZXdTdGF0ZUZuKHRoaXMuX3ZhbHVlKCkpIDogbmV3U3RhdGVGbjtcblxuICAgIGlmIChuZXdTdGF0ZSA9PT0gdGhpcy5fdmFsdWUoKSkge1xuICAgICAgdGhyb3cgbmV3IEFraXRhSW1tdXRhYmlsaXR5RXJyb3IodGhpcy5zdG9yZU5hbWUpO1xuICAgIH1cblxuICAgIGlzRGV2KCkgJiYgX19nbG9iYWxTdGF0ZS5zZXRBY3Rpb24oYWN0aW9uIHx8IHsgdHlwZTogJ1VwZGF0ZSBSb290JyB9KTtcblxuICAgIHRoaXMuc2V0U3RhdGUoc3RhdGUgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uKHN0YXRlIGFzIGFueSksXG4gICAgICAgIC4uLihuZXdTdGF0ZSBhcyBhbnkpXG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIFJlbW92ZSBvbmUgb3IgbW9yZSBlbnRpdGllcyBmcm9tIHRoZSBzdG9yZTpcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogdGhpcy5zdG9yZS5yZW1vdmUoNSk7XG4gICAqIHRoaXMuc3RvcmUucmVtb3ZlKFsxLDIsM10pO1xuICAgKiB0aGlzLnN0b3JlLnJlbW92ZShlbnRpdHkgPT4gZW50aXR5LmlkID09PSAxKTtcbiAgICogdGhpcy5zdG9yZS5yZW1vdmUoKTtcbiAgICovXG4gIHJlbW92ZShpZD86IElEIHwgSURbXSk7XG4gIHJlbW92ZShwcmVkaWNhdGU6IChlbnRpdHk6IFJlYWRvbmx5PEU+KSA9PiBib29sZWFuKTtcbiAgcmVtb3ZlKGlkc09yRm4/OiBJRCB8IElEW10gfCAoKGVudGl0eTogUmVhZG9ubHk8RT4pID0+IGJvb2xlYW4pKSB7XG4gICAgY29uc3Qgc3RvcmVJZHMgPSB0aGlzLl92YWx1ZSgpLmlkcztcblxuICAgIGlmIChzdG9yZUlkcy5sZW5ndGggPT09IDApIHJldHVybjtcbiAgICBjb25zdCBpZFBhc3NlZCA9IHRvQm9vbGVhbihpZHNPckZuKTtcbiAgICBpZiAoIWlkUGFzc2VkKSB0aGlzLnNldFByaXN0aW5lKCk7XG5cbiAgICBsZXQgaWRzOiBJRFtdID0gW107XG4gICAgaWYgKGlzRnVuY3Rpb24oaWRzT3JGbikpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBzdG9yZUlkcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICBjb25zdCBpZCA9IHN0b3JlSWRzW2ldO1xuICAgICAgICBjb25zdCBlbnRpdHkgPSB0aGlzLl92YWx1ZSgpLmVudGl0aWVzW2lkXTtcbiAgICAgICAgaWYgKGVudGl0eSAmJiBpZHNPckZuKGVudGl0eSkpIHtcbiAgICAgICAgICBpZHMucHVzaChpZCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWRzID0gaWRQYXNzZWQgPyBjb2VyY2VBcnJheShpZHNPckZuKSA6IG51bGw7XG4gICAgfVxuXG4gICAgaWYgKGlkcyAmJiBpZHMubGVuZ3RoID09PSAwKSByZXR1cm47XG4gICAgaXNEZXYoKSAmJiBfX2dsb2JhbFN0YXRlLnNldEFjdGlvbih7IHR5cGU6ICdSZW1vdmUgRW50aXR5JywgZW50aXR5SWQ6IGlkcyB9KTtcblxuICAgIHRoaXMuc2V0U3RhdGUoc3RhdGUgPT4ge1xuICAgICAgcmV0dXJuIF9jcnVkLl9yZW1vdmUoc3RhdGUsIGlkcyk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogVXBkYXRlIHRoZSBhY3RpdmUgZW50aXR5LlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiB0aGlzLnN0b3JlLnVwZGF0ZUFjdGl2ZShhY3RpdmUgPT4ge1xuICAgKiAgIHJldHVybiB7XG4gICAqICAgICBjb25maWc6IHtcbiAgICogICAgICAuLmFjdGl2ZS5jb25maWcsXG4gICAqICAgICAgZGF0ZVxuICAgKiAgICAgfVxuICAgKiAgIH1cbiAgICogfSlcbiAgICovXG4gIHVwZGF0ZUFjdGl2ZShuZXdTdGF0ZUZuOiAoKGVudGl0eTogUmVhZG9ubHk8RT4pID0+IFBhcnRpYWw8RT4pIHwgUGFydGlhbDxFPikge1xuICAgIGFzc2VydEFjdGl2ZSh0aGlzLl92YWx1ZSgpKTtcbiAgICBpc0RldigpICYmIF9fZ2xvYmFsU3RhdGUuc2V0QWN0aW9uKHsgdHlwZTogJ1VwZGF0ZSBBY3RpdmUgRW50aXR5JywgZW50aXR5SWQ6IHRoaXMuX3ZhbHVlKCkuYWN0aXZlIH0pO1xuICAgIHRoaXMuc2V0U3RhdGUoc3RhdGUgPT4ge1xuICAgICAgY29uc3QgYWN0aXZlSWQgPSBzdGF0ZS5hY3RpdmUgYXMgSUQ7XG4gICAgICBjb25zdCBuZXdTdGF0ZSA9IGlzRnVuY3Rpb24obmV3U3RhdGVGbikgPyBuZXdTdGF0ZUZuKHN0YXRlLmVudGl0aWVzW2FjdGl2ZUlkXSkgOiBuZXdTdGF0ZUZuO1xuICAgICAgaWYgKG5ld1N0YXRlID09PSBzdGF0ZSkge1xuICAgICAgICB0aHJvdyBuZXcgQWtpdGFJbW11dGFiaWxpdHlFcnJvcih0aGlzLnN0b3JlTmFtZSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gX2NydWQuX3VwZGF0ZShzdGF0ZSwgW2FjdGl2ZUlkXSwgbmV3U3RhdGUsIHRoaXMuaWRLZXkpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgZ2l2ZW4gZW50aXR5IGFzIGFjdGl2ZS5cbiAgICovXG4gIHNldEFjdGl2ZShpZE9yT3B0aW9uczogQWN0aXZlRW50aXR5IHwgU2V0QWN0aXZlT3B0aW9ucyB8IG51bGwpIHtcbiAgICBsZXQgYWN0aXZlSWQ6IEFjdGl2ZUVudGl0eTtcblxuICAgIGlmIChpc09iamVjdChpZE9yT3B0aW9ucykpIHtcbiAgICAgIGlmIChpc05pbCh0aGlzLl92YWx1ZSgpLmFjdGl2ZSkpIHJldHVybjtcbiAgICAgIChpZE9yT3B0aW9ucyBhcyBTZXRBY3RpdmVPcHRpb25zKSA9IE9iamVjdC5hc3NpZ24oeyB3cmFwOiB0cnVlIH0sIGlkT3JPcHRpb25zKTtcbiAgICAgIGNvbnN0IGlkcyA9IHRoaXMuX3ZhbHVlKCkuaWRzO1xuICAgICAgY29uc3QgY3VycmVudElkSW5kZXggPSBpZHMuaW5kZXhPZih0aGlzLl92YWx1ZSgpLmFjdGl2ZSk7XG4gICAgICBpZiAoKGlkT3JPcHRpb25zIGFzIFNldEFjdGl2ZU9wdGlvbnMpLnByZXYpIHtcbiAgICAgICAgY29uc3QgaXNGaXJzdCA9IGN1cnJlbnRJZEluZGV4ID09PSAwO1xuICAgICAgICBpZiAoaXNGaXJzdCAmJiAhKGlkT3JPcHRpb25zIGFzIFNldEFjdGl2ZU9wdGlvbnMpLndyYXApIHJldHVybjtcbiAgICAgICAgYWN0aXZlSWQgPSBpc0ZpcnN0ID8gaWRzW2lkcy5sZW5ndGggLSAxXSA6IChpZHNbY3VycmVudElkSW5kZXggLSAxXSBhcyBhbnkpO1xuICAgICAgfSBlbHNlIGlmICgoaWRPck9wdGlvbnMgYXMgU2V0QWN0aXZlT3B0aW9ucykubmV4dCkge1xuICAgICAgICBjb25zdCBpc0xhc3QgPSBpZHMubGVuZ3RoID09PSBjdXJyZW50SWRJbmRleCArIDE7XG4gICAgICAgIGlmIChpc0xhc3QgJiYgIShpZE9yT3B0aW9ucyBhcyBTZXRBY3RpdmVPcHRpb25zKS53cmFwKSByZXR1cm47XG4gICAgICAgIGFjdGl2ZUlkID0gaXNMYXN0ID8gaWRzWzBdIDogKGlkc1tjdXJyZW50SWRJbmRleCArIDFdIGFzIGFueSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChpZE9yT3B0aW9ucyA9PT0gdGhpcy5fdmFsdWUoKS5hY3RpdmUpIHJldHVybjtcbiAgICAgIGFjdGl2ZUlkID0gaWRPck9wdGlvbnMgYXMgQWN0aXZlRW50aXR5O1xuICAgIH1cblxuICAgIGlzRGV2KCkgJiYgX19nbG9iYWxTdGF0ZS5zZXRBY3Rpb24oeyB0eXBlOiAnU2V0IEFjdGl2ZSBFbnRpdHknLCBlbnRpdHlJZDogYWN0aXZlSWQgfSk7XG4gICAgdGhpcy5zZXRTdGF0ZShzdGF0ZSA9PiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi4oc3RhdGUgYXMgYW55KSxcbiAgICAgICAgYWN0aXZlOiBhY3RpdmVJZFxuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgYWRkV2hlbk5vdEV4aXN0cyhpZDogSUQsIGVudGl0eTogRSkge1xuICAgIGlmICghZW50aXR5W3RoaXMuaWRLZXldKSB7XG4gICAgICBlbnRpdHlbdGhpcy5pZEtleV0gPSBpZDtcbiAgICB9XG4gICAgdGhpcy5hZGQoZW50aXR5KTtcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgZ2V0SW5pdGlhbEVudGl0aWVzU3RhdGUgPSAoKSA9PlxuICAoe1xuICAgIGVudGl0aWVzOiB7fSxcbiAgICBpZHM6IFtdLFxuICAgIGxvYWRpbmc6IHRydWUsXG4gICAgZXJyb3I6IG51bGxcbiAgfSBhcyBFbnRpdHlTdGF0ZSk7XG5cbmV4cG9ydCBjb25zdCBnZXRJbml0aWFsQWN0aXZlU3RhdGUgPSAoKSA9PlxuICAoe1xuICAgIGFjdGl2ZTogbnVsbFxuICB9IGFzIEFjdGl2ZVN0YXRlKTtcbiIsImV4cG9ydCBlbnVtIE9yZGVyIHtcbiAgQVNDID0gJ2FzYycsXG4gIERFU0MgPSAnZGVzYydcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBhcmVWYWx1ZXMoa2V5LCBvcmRlcjogT3JkZXIgPSBPcmRlci5BU0MpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKGEsIGIpIHtcbiAgICBpZiAoIWEuaGFzT3duUHJvcGVydHkoa2V5KSB8fCAhYi5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG5cbiAgICBjb25zdCB2YXJBID0gdHlwZW9mIGFba2V5XSA9PT0gJ3N0cmluZycgPyBhW2tleV0udG9VcHBlckNhc2UoKSA6IGFba2V5XTtcbiAgICBjb25zdCB2YXJCID0gdHlwZW9mIGJba2V5XSA9PT0gJ3N0cmluZycgPyBiW2tleV0udG9VcHBlckNhc2UoKSA6IGJba2V5XTtcblxuICAgIGxldCBjb21wYXJpc29uID0gMDtcbiAgICBpZiAodmFyQSA+IHZhckIpIHtcbiAgICAgIGNvbXBhcmlzb24gPSAxO1xuICAgIH0gZWxzZSBpZiAodmFyQSA8IHZhckIpIHtcbiAgICAgIGNvbXBhcmlzb24gPSAtMTtcbiAgICB9XG4gICAgcmV0dXJuIG9yZGVyID09IE9yZGVyLkRFU0MgPyBjb21wYXJpc29uICogLTEgOiBjb21wYXJpc29uO1xuICB9O1xufVxuIiwiZXhwb3J0IGZ1bmN0aW9uIG1lbW9pemVPbmUoZm46IEZ1bmN0aW9uKSB7XG4gIGxldCBsYXN0QXJncztcbiAgbGV0IGNoYW5nZWQgPSBmYWxzZTtcbiAgbGV0IGZpcnN0SW5pdCA9IHRydWU7XG4gIGxldCBsYXN0UmVzdWx0O1xuXG4gIHJldHVybiBmdW5jdGlvbiguLi5hcmdzKSB7XG4gICAgaWYgKGxhc3RBcmdzKSB7XG4gICAgICAvKiogSWYgZW50aXRpZXMgbm9yIGlkcyBkb2Vzbid0IGNoYW5nZSByZXR1cm4gdGhlIGxhc3QgdmFsdWUgKi9cbiAgICAgIGNoYW5nZWQgPSBsYXN0QXJnc1sxXSAhPT0gYXJnc1sxXSB8fCBsYXN0QXJnc1swXSAhPT0gYXJnc1swXTtcbiAgICB9XG5cbiAgICBpZiAoZmlyc3RJbml0IHx8IChjaGFuZ2VkICYmICFmaXJzdEluaXQpKSB7XG4gICAgICBsYXN0UmVzdWx0ID0gZm4uYXBwbHkodGhpcywgYXJncyk7XG4gICAgfVxuXG4gICAgZmlyc3RJbml0ID0gZmFsc2U7XG4gICAgbGFzdEFyZ3MgPSBhcmdzO1xuICAgIHJldHVybiBsYXN0UmVzdWx0O1xuICB9O1xufVxuIiwiaW1wb3J0IHsgT3JkZXIgfSBmcm9tICcuLi9pbnRlcm5hbC9zb3J0JztcblxuZXhwb3J0IHR5cGUgU29ydEJ5PEUsIFMgPSBhbnk+ID0gKChhOiBFLCBiOiBFLCBzdGF0ZT86IFMpID0+IG51bWJlcikgfCBrZXlvZiBFO1xuXG5leHBvcnQgaW50ZXJmYWNlIFNvcnRCeU9wdGlvbnM8RT4ge1xuICBzb3J0Qnk/OiBTb3J0Qnk8RT47XG4gIHNvcnRCeU9yZGVyPzogT3JkZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUXVlcnlDb25maWdPcHRpb25zPEUgPSBhbnk+IGV4dGVuZHMgU29ydEJ5T3B0aW9uczxFPiB7fVxuXG5leHBvcnQgY29uc3QgcXVlcnlDb25maWdLZXkgPSAnYWtpdGFRdWVyeUNvbmZpZyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBRdWVyeUNvbmZpZzxFPihtZXRhZGF0YTogUXVlcnlDb25maWdPcHRpb25zPEU+KSB7XG4gIHJldHVybiBmdW5jdGlvbihjb25zdHJ1Y3RvcjogRnVuY3Rpb24pIHtcbiAgICBjb25zdHJ1Y3RvcltxdWVyeUNvbmZpZ0tleV0gPSB7fTtcbiAgICBmb3IgKGxldCBpID0gMCwga2V5cyA9IE9iamVjdC5rZXlzKG1ldGFkYXRhKTsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGtleSA9IGtleXNbaV07XG4gICAgICBjb25zdHJ1Y3RvcltxdWVyeUNvbmZpZ0tleV1ba2V5XSA9IG1ldGFkYXRhW2tleV07XG4gICAgfVxuICB9O1xufVxuIiwiaW1wb3J0IHsgU3RvcmUgfSBmcm9tICcuL3N0b3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHRha2UgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBxdWVyeUNvbmZpZ0tleSwgUXVlcnlDb25maWdPcHRpb25zIH0gZnJvbSAnLi9xdWVyeS1jb25maWcnO1xuXG5leHBvcnQgY2xhc3MgUXVlcnk8Uz4ge1xuICAvKiogVXNlIG9ubHkgZm9yIGludGVybmFsIHBsdWdpbnMgbGlrZSBQYWdpbmF0aW9uIC0gZG9uJ3QgdXNlIHRoaXMgcHJvcGVydHkgKiovXG4gIF9fc3RvcmVfXzogU3RvcmU8Uz47XG5cbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIHN0b3JlOiBTdG9yZTxTPikge1xuICAgIHRoaXMuX19zdG9yZV9fID0gc3RvcmU7XG4gIH1cblxuICAvKipcbiAgICogU2VsZWN0IGEgc2xpY2UgZnJvbSB0aGUgc3RvcmUuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIHRoaXMucXVlcnkuc2VsZWN0KClcbiAgICogdGhpcy5xdWVyeS5zZWxlY3Qoc3RhdGUgPT4gc3RhdGUuZW50aXRpZXMpXG4gICAqL1xuICBzZWxlY3Q8Uj4ocHJvamVjdD86IChzdG9yZTogUykgPT4gUik6IE9ic2VydmFibGU8Uj47XG4gIHNlbGVjdCgpOiBPYnNlcnZhYmxlPFM+O1xuICBzZWxlY3Q8Uj4ocHJvamVjdD86IChzdG9yZTogUykgPT4gUik6IE9ic2VydmFibGU8UiB8IFM+IHtcbiAgICBsZXQgc3RhdGUgPSBwcm9qZWN0ID8gcHJvamVjdCA6IHN0YXRlID0+IHN0YXRlO1xuICAgIHJldHVybiB0aGlzLnN0b3JlLl9zZWxlY3Qoc3RhdGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbGVjdCBvbmNlIGFuZCBjb21wbGV0ZS5cbiAgICovXG4gIHNlbGVjdE9uY2U8Uj4ocHJvamVjdDogKHN0b3JlOiBTKSA9PiBSKTogT2JzZXJ2YWJsZTxSPiB7XG4gICAgcmV0dXJuIHRoaXMuc2VsZWN0KHByb2plY3QpLnBpcGUodGFrZSgxKSk7XG4gIH1cblxuICAvKipcbiAgICogU2VsZWN0IHRoZSBzdG9yZSdzIGxvYWRpbmcgc3RhdGUuXG4gICAqL1xuICBzZWxlY3RMb2FkaW5nKCkge1xuICAgIHJldHVybiB0aGlzLnNlbGVjdChzdGF0ZSA9PiAoc3RhdGUgYXMgUyAmIHsgbG9hZGluZzogYm9vbGVhbiB9KS5sb2FkaW5nKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZWxlY3QgdGhlIHN0b3JlJ3MgZXJyb3Igc3RhdGUuXG4gICAqL1xuICBzZWxlY3RFcnJvcigpIHtcbiAgICByZXR1cm4gdGhpcy5zZWxlY3Qoc3RhdGUgPT4gKHN0YXRlIGFzIFMgJiB7IGVycm9yOiBhbnkgfSkuZXJyb3IpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgcmF3IHZhbHVlIG9mIHRoZSBzdG9yZS5cbiAgICovXG4gIGdldFNuYXBzaG90KCk6IFMge1xuICAgIHJldHVybiB0aGlzLnN0b3JlLl92YWx1ZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqICBSZXR1cm5zIHdoZXRoZXIgdGhlIHN0YXRlIG9mIHRoZSBzdG9yZSBpcyBwcmlzdGluZSAodGhlIHNldCgpIG1ldGhvZCBoYXNuJ3QgYmVlbiBleHBsaWNpdGx5IGNhbGxlZFxuICAgKiAgc2luY2UgdGhlIHN0b3JlIGNyZWF0aW9uLCBvciB0aGUgbGFzdCB0aW1lIHNldFByaXN0aW5lKCl3YXMgY2FsbGVkKS5cbiAgICovXG4gIGdldCBpc1ByaXN0aW5lKCkge1xuICAgIHJldHVybiB0aGlzLnN0b3JlLmlzUHJpc3RpbmU7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB3aGV0aGVyIHRoZSBzdGF0ZSBvZiB0aGUgc3RvcmUgaXMgZGlydHkgKHRoZSBzZXQoKSBtZXRob2RcbiAgICogb3IgdGhlIHNldERpcnR5KCkgbWV0aG9kIGhhcyBiZWVuIGV4cGxpY2l0bHkgY2FsbGVkIHNpbmNlIHRoZSBzdG9yZSBjcmVhdGlvbixcbiAgICogb3IgdGhlIGxhc3QgdGltZSBzZXRQcmlzdGluZSgpIHdhcyBjYWxsZWQpLlxuICAgKi9cbiAgZ2V0IGlzRGlydHkoKSB7XG4gICAgcmV0dXJuICF0aGlzLnN0b3JlLmlzUHJpc3RpbmU7XG4gIH1cblxuICBnZXQgY29uZmlnKCk6IFF1ZXJ5Q29uZmlnT3B0aW9ucyB7XG4gICAgcmV0dXJuIHRoaXMuY29uc3RydWN0b3JbcXVlcnlDb25maWdLZXldO1xuICB9XG59XG4iLCJpbXBvcnQgeyBjb21iaW5lTGF0ZXN0LCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBhdWRpdFRpbWUsIG1hcCwgc3dpdGNoTWFwLCB3aXRoTGF0ZXN0RnJvbSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuaW1wb3J0IHsgY29tcGFyZVZhbHVlcywgT3JkZXIgfSBmcm9tICcuLi9pbnRlcm5hbC9zb3J0JztcbmltcG9ydCB7IGVudGl0eUV4aXN0cywgaXNGdW5jdGlvbiwgaXNVbmRlZmluZWQsIHRvQm9vbGVhbiB9IGZyb20gJy4uL2ludGVybmFsL3V0aWxzJztcbmltcG9ydCB7IEVudGl0eVN0b3JlIH0gZnJvbSAnLi9lbnRpdHktc3RvcmUnO1xuaW1wb3J0IHsgbWVtb2l6ZU9uZSB9IGZyb20gJy4vbWVtb2l6ZSc7XG5pbXBvcnQgeyBRdWVyeSB9IGZyb20gJy4vcXVlcnknO1xuaW1wb3J0IHsgU29ydEJ5LCBTb3J0QnlPcHRpb25zIH0gZnJvbSAnLi9xdWVyeS1jb25maWcnO1xuaW1wb3J0IHsgQWN0aXZlU3RhdGUsIEVudGl0eVN0YXRlLCBIYXNoTWFwLCBJRCB9IGZyb20gJy4vdHlwZXMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFNlbGVjdE9wdGlvbnM8RT4gZXh0ZW5kcyBTb3J0QnlPcHRpb25zPEU+IHtcbiAgYXNPYmplY3Q/OiBib29sZWFuO1xuICBmaWx0ZXJCeT86ICgoZW50aXR5OiBFLCBpbmRleD86IG51bWJlcikgPT4gYm9vbGVhbikgfCAoKGVudGl0eTogRSwgaW5kZXg/OiBudW1iZXIpID0+IGJvb2xlYW4pW10gfCB1bmRlZmluZWQ7XG4gIGxpbWl0VG8/OiBudW1iZXI7XG59XG5cbi8qKlxuICogIEFuIGFic3RyYWN0aW9uIGZvciBxdWVyeWluZyB0aGUgZW50aXRpZXMgZnJvbSB0aGUgc3RvcmVcbiAqL1xuZXhwb3J0IGNsYXNzIFF1ZXJ5RW50aXR5PFMgZXh0ZW5kcyBFbnRpdHlTdGF0ZSwgRSwgQWN0aXZlRW50aXR5ID0gSUQ+IGV4dGVuZHMgUXVlcnk8Uz4ge1xuICBwcm90ZWN0ZWQgc3RvcmU6IEVudGl0eVN0b3JlPFMsIEUsIEFjdGl2ZUVudGl0eT47XG4gIHByaXZhdGUgbWVtb2l6ZWQ7XG5cbiAgLyoqIFVzZSBvbmx5IGZvciBpbnRlcm5hbCBwbHVnaW5zIGxpa2UgUGFnaW5hdGlvbiAtIGRvbid0IHVzZSB0aGlzIHByb3BlcnR5ICoqL1xuICBfX3N0b3JlX187XG5cbiAgY29uc3RydWN0b3Ioc3RvcmU6IEVudGl0eVN0b3JlPFMsIEUsIEFjdGl2ZUVudGl0eT4pIHtcbiAgICBzdXBlcihzdG9yZSk7XG4gICAgdGhpcy5fX3N0b3JlX18gPSBzdG9yZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZWxlY3QgdGhlIGVudGlyZSBzdG9yZSdzIGVudGl0eSBjb2xsZWN0aW9uLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiB0aGlzLnN0b3JlLnNlbGVjdEFsbCgpO1xuICAgKi9cbiAgc2VsZWN0QWxsKG9wdGlvbnM6IHsgYXNPYmplY3Q6IHRydWU7IGZpbHRlckJ5PzogU2VsZWN0T3B0aW9uczxFPlsnZmlsdGVyQnknXTsgbGltaXRUbz86IG51bWJlcjsgc29ydEJ5PzogdW5kZWZpbmVkOyBzb3J0QnlPcmRlcj86IHVuZGVmaW5lZCB9KTogT2JzZXJ2YWJsZTxIYXNoTWFwPEU+PjtcbiAgc2VsZWN0QWxsKG9wdGlvbnM6IHsgZmlsdGVyQnk6IFNlbGVjdE9wdGlvbnM8RT5bJ2ZpbHRlckJ5J107IGxpbWl0VG8/OiBudW1iZXI7IHNvcnRCeT86IFNvcnRCeTxFPjsgc29ydEJ5T3JkZXI/OiBPcmRlciB9KTogT2JzZXJ2YWJsZTxFW10+O1xuICBzZWxlY3RBbGwob3B0aW9uczogeyBhc09iamVjdDogdHJ1ZTsgbGltaXRUbz86IG51bWJlcjsgc29ydEJ5PzogdW5kZWZpbmVkOyBzb3J0QnlPcmRlcj86IHVuZGVmaW5lZCB9KTogT2JzZXJ2YWJsZTxIYXNoTWFwPEU+PjtcbiAgc2VsZWN0QWxsKG9wdGlvbnM6IHsgbGltaXRUbz86IG51bWJlcjsgc29ydEJ5PzogU29ydEJ5PEU+OyBzb3J0QnlPcmRlcj86IE9yZGVyIH0pOiBPYnNlcnZhYmxlPEVbXT47XG4gIHNlbGVjdEFsbChvcHRpb25zOiB7IGFzT2JqZWN0OiBmYWxzZTsgZmlsdGVyQnk/OiBTZWxlY3RPcHRpb25zPEU+WydmaWx0ZXJCeSddOyBsaW1pdFRvPzogbnVtYmVyOyBzb3J0Qnk/OiBTb3J0Qnk8RT47IHNvcnRCeU9yZGVyPzogT3JkZXIgfSk6IE9ic2VydmFibGU8RVtdPjtcbiAgc2VsZWN0QWxsKCk6IE9ic2VydmFibGU8RVtdPjtcbiAgc2VsZWN0QWxsKFxuICAgIG9wdGlvbnM6IFNlbGVjdE9wdGlvbnM8RT4gPSB7XG4gICAgICBhc09iamVjdDogZmFsc2VcbiAgICB9XG4gICk6IE9ic2VydmFibGU8RVtdIHwgSGFzaE1hcDxFPj4ge1xuICAgIGNvbnN0IHNlbGVjdFN0YXRlJCA9IHRoaXMuc2VsZWN0KHN0YXRlID0+IHN0YXRlKTtcbiAgICBjb25zdCBzZWxlY3RFbnRpdGllcyQgPSB0aGlzLnNlbGVjdChzdGF0ZSA9PiBzdGF0ZS5lbnRpdGllcyk7XG5cbiAgICB0aGlzLnNvcnRCeU9wdGlvbnMob3B0aW9ucyk7XG5cbiAgICByZXR1cm4gc2VsZWN0RW50aXRpZXMkLnBpcGUoXG4gICAgICB3aXRoTGF0ZXN0RnJvbShzZWxlY3RTdGF0ZSQsIChlbnRpdGllczogSGFzaE1hcDxFPiwgc3RhdGU6IFMpID0+IHtcbiAgICAgICAgY29uc3QgeyBpZHMgfSA9IHN0YXRlO1xuICAgICAgICBpZiAob3B0aW9ucy5hc09iamVjdCkge1xuICAgICAgICAgIHJldHVybiB0b01hcChpZHMsIGVudGl0aWVzLCBvcHRpb25zKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoIW9wdGlvbnMuZmlsdGVyQnkgJiYgIW9wdGlvbnMuc29ydEJ5KSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMubWVtb2l6ZWQpIHtcbiAgICAgICAgICAgICAgdGhpcy5tZW1vaXplZCA9IG1lbW9pemVPbmUodG9BcnJheSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5tZW1vaXplZChzdGF0ZSwgb3B0aW9ucyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHRvQXJyYXkoc3RhdGUsIG9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBlbnRpcmUgc3RvcmUncyBlbnRpdHkgY29sbGVjdGlvbi5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogdGhpcy5zdG9yZS5nZXRBbGwoKTtcbiAgICovXG4gIGdldEFsbChvcHRpb25zOiB7IGFzT2JqZWN0OiB0cnVlOyBmaWx0ZXJCeT86IFNlbGVjdE9wdGlvbnM8RT5bJ2ZpbHRlckJ5J107IGxpbWl0VG8/OiBudW1iZXI7IHNvcnRCeT86IHVuZGVmaW5lZDsgc29ydEJ5T3JkZXI/OiB1bmRlZmluZWQgfSk6IEhhc2hNYXA8RT47XG4gIGdldEFsbChvcHRpb25zOiB7IGZpbHRlckJ5OiBTZWxlY3RPcHRpb25zPEU+WydmaWx0ZXJCeSddOyBsaW1pdFRvPzogbnVtYmVyOyBzb3J0Qnk/OiBTb3J0Qnk8RT47IHNvcnRCeU9yZGVyPzogT3JkZXIgfSk6IEVbXTtcbiAgZ2V0QWxsKG9wdGlvbnM6IHsgYXNPYmplY3Q6IHRydWU7IGxpbWl0VG8/OiBudW1iZXI7IHNvcnRCeT86IHVuZGVmaW5lZDsgc29ydEJ5T3JkZXI/OiB1bmRlZmluZWQgfSk6IEhhc2hNYXA8RT47XG4gIGdldEFsbChvcHRpb25zOiB7IGxpbWl0VG8/OiBudW1iZXI7IHNvcnRCeT86IFNvcnRCeTxFPjsgc29ydEJ5T3JkZXI/OiBPcmRlciB9KTogRVtdO1xuICBnZXRBbGwob3B0aW9uczogeyBhc09iamVjdDogZmFsc2U7IGZpbHRlckJ5PzogU2VsZWN0T3B0aW9uczxFPlsnZmlsdGVyQnknXTsgbGltaXRUbz86IG51bWJlcjsgc29ydEJ5PzogU29ydEJ5PEU+OyBzb3J0QnlPcmRlcj86IE9yZGVyIH0pOiBFW107XG4gIGdldEFsbCgpOiBFW107XG4gIGdldEFsbChvcHRpb25zOiBTZWxlY3RPcHRpb25zPEU+ID0geyBhc09iamVjdDogZmFsc2UsIGZpbHRlckJ5OiB1bmRlZmluZWQsIGxpbWl0VG86IHVuZGVmaW5lZCB9KTogRVtdIHwgSGFzaE1hcDxFPiB7XG4gICAgY29uc3Qgc3RhdGUgPSB0aGlzLmdldFNuYXBzaG90KCk7XG5cbiAgICBpZiAob3B0aW9ucy5hc09iamVjdCkge1xuICAgICAgcmV0dXJuIHRvTWFwKHN0YXRlLmlkcywgc3RhdGUuZW50aXRpZXMsIG9wdGlvbnMsIHRydWUpO1xuICAgIH1cblxuICAgIHRoaXMuc29ydEJ5T3B0aW9ucyhvcHRpb25zKTtcblxuICAgIHJldHVybiB0b0FycmF5KHN0YXRlLCBvcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZWxlY3QgbXVsdGlwbGUgZW50aXRpZXMgZnJvbSB0aGUgc3RvcmUuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIHRoaXMuc3RvcmUuc2VsZWN0TWFueShbMSwyXSk7XG4gICAqL1xuICBzZWxlY3RNYW55KGlkczogQWN0aXZlRW50aXR5W10sIG9wdGlvbnM6IHsgZmlsdGVyVW5kZWZpbmVkPzogYm9vbGVhbiB9ID0ge30pOiBPYnNlcnZhYmxlPEVbXT4ge1xuICAgIGNvbnN0IGZpbHRlclVuZGVmaW5lZCA9IGlzVW5kZWZpbmVkKG9wdGlvbnMuZmlsdGVyVW5kZWZpbmVkKSA/IHRydWUgOiBvcHRpb25zLmZpbHRlclVuZGVmaW5lZDtcbiAgICBjb25zdCBlbnRpdGllcyA9IGlkcy5tYXAoaWQgPT4gdGhpcy5zZWxlY3RFbnRpdHkoaWQpKTtcblxuICAgIHJldHVybiBjb21iaW5lTGF0ZXN0KGVudGl0aWVzKS5waXBlKFxuICAgICAgbWFwKGVudGl0aWVzID0+IHtcbiAgICAgICAgcmV0dXJuIGZpbHRlclVuZGVmaW5lZCA/IGVudGl0aWVzLmZpbHRlcih2YWwgPT4gIWlzVW5kZWZpbmVkKHZhbCkpIDogZW50aXRpZXM7XG4gICAgICB9KSxcbiAgICAgIGF1ZGl0VGltZSgwKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogU2VsZWN0IGFuIGVudGl0eSBvciBhIHNsaWNlIG9mIGFuIGVudGl0eS5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogdGhpcy5wYWdlc1N0b3JlLnNlbGVjdEVudGl0eSgxKVxuICAgKiB0aGlzLnBhZ2VzU3RvcmUuc2VsZWN0RW50aXR5KDEsIGVudGl0eSA9PiBlbnRpdHkuY29uZmlnLmRhdGUpXG4gICAqXG4gICAqL1xuICBzZWxlY3RFbnRpdHk8Uj4oaWQ6IEFjdGl2ZUVudGl0eSk6IE9ic2VydmFibGU8RT47XG4gIHNlbGVjdEVudGl0eTxSPihpZDogQWN0aXZlRW50aXR5LCBwcm9qZWN0OiAoZW50aXR5OiBFKSA9PiBSKTogT2JzZXJ2YWJsZTxSPjtcbiAgc2VsZWN0RW50aXR5PFI+KGlkOiBBY3RpdmVFbnRpdHksIHByb2plY3Q/OiAoZW50aXR5OiBFKSA9PiBSKTogT2JzZXJ2YWJsZTxSIHwgRT4ge1xuICAgIGlmICghcHJvamVjdCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2J5SWQoaWQpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnNlbGVjdChzdGF0ZSA9PiB7XG4gICAgICBpZiAodGhpcy5oYXNFbnRpdHkoaWQpKSB7XG4gICAgICAgIHJldHVybiBwcm9qZWN0KHRoaXMuZ2V0RW50aXR5KGlkKSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFuIGVudGl0eSBieSBpZFxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiB0aGlzLnN0b3JlLmdldEVudGl0eSgxKTtcbiAgICovXG4gIGdldEVudGl0eShpZDogQWN0aXZlRW50aXR5KTogRSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U25hcHNob3QoKS5lbnRpdGllc1tpZCBhcyBhbnldO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbGVjdCB0aGUgYWN0aXZlIGVudGl0eSdzIGlkLlxuICAgKi9cbiAgc2VsZWN0QWN0aXZlSWQoKTogT2JzZXJ2YWJsZTxBY3RpdmVFbnRpdHk+IHtcbiAgICByZXR1cm4gdGhpcy5zZWxlY3Qoc3RhdGUgPT4gKHN0YXRlIGFzIFMgJiBBY3RpdmVTdGF0ZTxBY3RpdmVFbnRpdHk+KS5hY3RpdmUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgYWN0aXZlIGlkXG4gICAqL1xuICBnZXRBY3RpdmVJZCgpOiBBY3RpdmVFbnRpdHkge1xuICAgIHJldHVybiAodGhpcy5nZXRTbmFwc2hvdCgpIGFzIFMgJiBBY3RpdmVTdGF0ZTxBY3RpdmVFbnRpdHk+KS5hY3RpdmU7XG4gIH1cblxuICAvKipcbiAgICogU2VsZWN0IHRoZSBhY3RpdmUgZW50aXR5LlxuICAgKi9cbiAgc2VsZWN0QWN0aXZlPFI+KCk6IE9ic2VydmFibGU8RT47XG4gIHNlbGVjdEFjdGl2ZTxSPihwcm9qZWN0OiAoZW50aXR5OiBFKSA9PiBSKTogT2JzZXJ2YWJsZTxSPjtcbiAgc2VsZWN0QWN0aXZlPFI+KHByb2plY3Q/OiAoZW50aXR5OiBFKSA9PiBSKTogT2JzZXJ2YWJsZTxSIHwgRT4ge1xuICAgIHJldHVybiB0aGlzLnNlbGVjdEFjdGl2ZUlkKCkucGlwZShzd2l0Y2hNYXAoYWN0aXZlSWQgPT4gdGhpcy5zZWxlY3RFbnRpdHkoYWN0aXZlSWQsIHByb2plY3QpKSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBhY3RpdmUgZW50aXR5LlxuICAgKi9cbiAgZ2V0QWN0aXZlKCk6IEUge1xuICAgIGNvbnN0IGFjdGl2ZUlkOiBBY3RpdmVFbnRpdHkgPSB0aGlzLmdldEFjdGl2ZUlkKCk7XG4gICAgcmV0dXJuIHRvQm9vbGVhbihhY3RpdmVJZCkgPyB0aGlzLmdldEVudGl0eShhY3RpdmVJZCkgOiB1bmRlZmluZWQ7XG4gIH1cblxuICAvKipcbiAgICogU2VsZWN0IHRoZSBzdG9yZSdzIGVudGl0eSBjb2xsZWN0aW9uIGxlbmd0aC5cbiAgICovXG4gIHNlbGVjdENvdW50KHByZWRpY2F0ZT86IChlbnRpdHk6IEUsIGluZGV4OiBudW1iZXIpID0+IGJvb2xlYW4pOiBPYnNlcnZhYmxlPG51bWJlcj4ge1xuICAgIGlmIChpc0Z1bmN0aW9uKHByZWRpY2F0ZSkpIHtcbiAgICAgIHJldHVybiB0aGlzLnNlbGVjdEFsbCh7XG4gICAgICAgIGZpbHRlckJ5OiBwcmVkaWNhdGVcbiAgICAgIH0pLnBpcGUobWFwKGVudGl0aWVzID0+IGVudGl0aWVzLmxlbmd0aCkpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnNlbGVjdChzdG9yZSA9PiBzdG9yZS5pZHMubGVuZ3RoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHN0b3JlJ3MgZW50aXR5IGNvbGxlY3Rpb24gbGVuZ3RoLlxuICAgKi9cbiAgZ2V0Q291bnQocHJlZGljYXRlPzogKGVudGl0eTogRSwgaW5kZXg6IG51bWJlcikgPT4gYm9vbGVhbik6IG51bWJlciB7XG4gICAgaWYgKGlzRnVuY3Rpb24ocHJlZGljYXRlKSkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0QWxsKCkuZmlsdGVyKHByZWRpY2F0ZSkubGVuZ3RoO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5nZXRTbmFwc2hvdCgpLmlkcy5sZW5ndGg7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB3aGV0aGVyIGVudGl0eSBleGlzdHMuXG4gICAqL1xuICBoYXNFbnRpdHkoaWQ6IEFjdGl2ZUVudGl0eSk6IGJvb2xlYW47XG4gIGhhc0VudGl0eShpZDogQWN0aXZlRW50aXR5W10pOiBib29sZWFuO1xuICBoYXNFbnRpdHkocHJvamVjdDogKGVudGl0eTogRSkgPT4gYm9vbGVhbik6IGJvb2xlYW47XG4gIGhhc0VudGl0eShwcm9qZWN0T3JJZHM6IEFjdGl2ZUVudGl0eSB8IEFjdGl2ZUVudGl0eVtdIHwgKChlbnRpdHk6IEUpID0+IGJvb2xlYW4pKTogYm9vbGVhbiB7XG4gICAgaWYgKGlzRnVuY3Rpb24ocHJvamVjdE9ySWRzKSkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0QWxsKCkuc29tZShwcm9qZWN0T3JJZHMpO1xuICAgIH1cblxuICAgIGlmIChBcnJheS5pc0FycmF5KHByb2plY3RPcklkcykpIHtcbiAgICAgIHJldHVybiBwcm9qZWN0T3JJZHMuZXZlcnkoaWQgPT4gKGlkIGFzIGFueSkgaW4gdGhpcy5zdG9yZS5lbnRpdGllcyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIChwcm9qZWN0T3JJZHMgYXMgYW55KSBpbiB0aGlzLnN0b3JlLmVudGl0aWVzO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgd2hldGhlciBlbnRpdHkgc3RvcmUgaGFzIGFuIGFjdGl2ZSBlbnRpdHkuXG4gICAqL1xuICBoYXNBY3RpdmUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U25hcHNob3QoKS5hY3RpdmUgIT0gbnVsbDtcbiAgfVxuXG4gIGlzRW1wdHkoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U25hcHNob3QoKS5pZHMubGVuZ3RoID09PSAwO1xuICB9XG5cbiAgcHJpdmF0ZSBfYnlJZChpZDogQWN0aXZlRW50aXR5KTogT2JzZXJ2YWJsZTxFPiB7XG4gICAgcmV0dXJuIHRoaXMuc2VsZWN0KHN0YXRlID0+IHRoaXMuZ2V0RW50aXR5KGlkKSk7XG4gIH1cblxuICBwcml2YXRlIHNvcnRCeU9wdGlvbnMob3B0aW9ucykge1xuICAgIG9wdGlvbnMuc29ydEJ5ID0gb3B0aW9ucy5zb3J0QnkgfHwgKHRoaXMuY29uZmlnICYmICh0aGlzLmNvbmZpZy5zb3J0QnkgYXMgU29ydEJ5PEU+KSk7XG4gICAgb3B0aW9ucy5zb3J0QnlPcmRlciA9IG9wdGlvbnMuc29ydEJ5T3JkZXIgfHwgKHRoaXMuY29uZmlnICYmIHRoaXMuY29uZmlnLnNvcnRCeU9yZGVyKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMubWVtb2l6ZWQgPSBudWxsO1xuICB9XG59XG5cbmZ1bmN0aW9uIHRvQXJyYXk8RSwgUyBleHRlbmRzIEVudGl0eVN0YXRlPihzdGF0ZTogUywgb3B0aW9uczogU2VsZWN0T3B0aW9uczxFPik6IEVbXSB7XG4gIGxldCBhcnIgPSBbXTtcbiAgY29uc3QgeyBpZHMsIGVudGl0aWVzIH0gPSBzdGF0ZTtcbiAgY29uc3QgeyBmaWx0ZXJCeSwgbGltaXRUbywgc29ydEJ5LCBzb3J0QnlPcmRlciB9ID0gb3B0aW9ucztcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGlkcy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGlkID0gaWRzW2ldO1xuXG4gICAgaWYgKCFlbnRpdHlFeGlzdHMoaWQsIGVudGl0aWVzKSkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgaWYgKCFmaWx0ZXJCeSkge1xuICAgICAgYXJyLnB1c2goZW50aXRpZXNbaWRdKTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGlmIChBcnJheS5pc0FycmF5KGZpbHRlckJ5KSkge1xuICAgICAgY29uc3QgYWxsUGFzcyA9IGZpbHRlckJ5LmV2ZXJ5KGZuID0+IGZuKGVudGl0aWVzW2lkXSwgaSkpO1xuICAgICAgaWYgKGFsbFBhc3MpIHtcbiAgICAgICAgYXJyLnB1c2goZW50aXRpZXNbaWRdKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGZpbHRlckJ5KGVudGl0aWVzW2lkXSwgaSkpIHtcbiAgICAgICAgYXJyLnB1c2goZW50aXRpZXNbaWRdKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpZiAoc29ydEJ5KSB7XG4gICAgbGV0IF9zb3J0Qnk6IGFueSA9IGlzRnVuY3Rpb24oc29ydEJ5KSA/IHNvcnRCeSA6IGNvbXBhcmVWYWx1ZXMoc29ydEJ5LCBzb3J0QnlPcmRlcik7XG4gICAgYXJyID0gYXJyLnNvcnQoKGEsIGIpID0+IF9zb3J0QnkoYSwgYiwgc3RhdGUpKTtcbiAgfVxuICBjb25zdCBsZW5ndGggPSBNYXRoLm1pbihsaW1pdFRvIHx8IGFyci5sZW5ndGgsIGFyci5sZW5ndGgpO1xuXG4gIHJldHVybiBsZW5ndGggPT09IGFyci5sZW5ndGggPyBhcnIgOiBhcnIuc2xpY2UoMCwgbGVuZ3RoKTtcbn1cblxuZnVuY3Rpb24gdG9NYXA8RT4oaWRzOiBhbnlbXSwgZW50aXRpZXM6IEhhc2hNYXA8RT4sIG9wdGlvbnM6IFNlbGVjdE9wdGlvbnM8RT4sIGdldCA9IGZhbHNlKTogSGFzaE1hcDxFPiB7XG4gIGNvbnN0IG1hcCA9IHt9O1xuICBjb25zdCB7IGZpbHRlckJ5LCBsaW1pdFRvIH0gPSBvcHRpb25zO1xuXG4gIGlmIChnZXQgJiYgIWZpbHRlckJ5ICYmICFsaW1pdFRvKSB7XG4gICAgcmV0dXJuIGVudGl0aWVzO1xuICB9XG5cbiAgY29uc3QgbGVuZ3RoID0gTWF0aC5taW4obGltaXRUbyB8fCBpZHMubGVuZ3RoLCBpZHMubGVuZ3RoKTtcblxuICBpZiAoZmlsdGVyQnkgJiYgaXNVbmRlZmluZWQobGltaXRUbykgPT09IGZhbHNlKSB7XG4gICAgbGV0IGNvdW50ID0gMDtcbiAgICBmb3IgKGxldCBpID0gMCwgbGVuZ3RoID0gaWRzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoY291bnQgPT09IGxpbWl0VG8pIGJyZWFrO1xuICAgICAgY29uc3QgaWQgPSBpZHNbaV07XG4gICAgICBpZiAoIWVudGl0eUV4aXN0cyhpZCwgZW50aXRpZXMpKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZmlsdGVyQnkpKSB7XG4gICAgICAgIGNvbnN0IGFsbFBhc3MgPSBmaWx0ZXJCeS5ldmVyeShmbiA9PiBmbihlbnRpdGllc1tpZF0sIGkpKTtcbiAgICAgICAgaWYgKGFsbFBhc3MpIHtcbiAgICAgICAgICBtYXBbaWRdID0gZW50aXRpZXNbaWRdO1xuICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChmaWx0ZXJCeShlbnRpdGllc1tpZF0sIGkpKSB7XG4gICAgICAgICAgbWFwW2lkXSA9IGVudGl0aWVzW2lkXTtcbiAgICAgICAgICBjb3VudCsrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGlkID0gaWRzW2ldO1xuXG4gICAgICBpZiAoIWVudGl0eUV4aXN0cyhpZCwgZW50aXRpZXMpKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWZpbHRlckJ5KSB7XG4gICAgICAgIG1hcFtpZF0gPSBlbnRpdGllc1tpZF07XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShmaWx0ZXJCeSkpIHtcbiAgICAgICAgY29uc3QgYWxsUGFzcyA9IGZpbHRlckJ5LmV2ZXJ5KGZuID0+IGZuKGVudGl0aWVzW2lkXSwgaSkpO1xuICAgICAgICBpZiAoYWxsUGFzcykge1xuICAgICAgICAgIG1hcFtpZF0gPSBlbnRpdGllc1tpZF07XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChmaWx0ZXJCeShlbnRpdGllc1tpZF0sIGkpKSB7XG4gICAgICAgICAgbWFwW2lkXSA9IGVudGl0aWVzW2lkXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBtYXA7XG59XG4iLCJpbXBvcnQgeyBlbmRCYXRjaCwgc3RhcnRCYXRjaCB9IGZyb20gJy4uL2ludGVybmFsL3RyYW5zYWN0aW9uLmludGVybmFsJztcblxuLyoqXG4gKiAgQSBsb2dpY2FsIHRyYW5zYWN0aW9uLlxuICogIFVzZSB0aGlzIHRyYW5zYWN0aW9uIHRvIG9wdGltaXplIHRoZSBkaXNwYXRjaCBvZiBhbGwgdGhlIHN0b3Jlcy5cbiAqICBUaGUgZm9sbG93aW5nIGNvZGUgd2lsbCB1cGRhdGUgdGhlIHN0b3JlLCBCVVQgIGVtaXRzIG9ubHkgb25jZVxuICpcbiAqICBAZXhhbXBsZVxuICogIGFwcGx5VHJhbnNhY3Rpb24oKCkgPT4ge1xuICogICAgdGhpcy50b2Rvc1N0b3JlLmFkZChuZXcgVG9kbygxLCB0aXRsZSkpO1xuICogICAgdGhpcy50b2Rvc1N0b3JlLmFkZChuZXcgVG9kbygyLCB0aXRsZSkpO1xuICogIH0pO1xuICpcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFwcGx5VHJhbnNhY3Rpb248VD4oYWN0aW9uOiAoKSA9PiBULCB0aGlzQXJnID0gdW5kZWZpbmVkKTogVCB7XG4gIHN0YXJ0QmF0Y2goKTtcbiAgdHJ5IHtcbiAgICByZXR1cm4gYWN0aW9uLmFwcGx5KHRoaXNBcmcpO1xuICB9IGZpbmFsbHkge1xuICAgIGVuZEJhdGNoKCk7XG4gIH1cbn1cblxuLyoqXG4gKiAgQSBsb2dpY2FsIHRyYW5zYWN0aW9uLlxuICogIFVzZSB0aGlzIHRyYW5zYWN0aW9uIHRvIG9wdGltaXplIHRoZSBkaXNwYXRjaCBvZiBhbGwgdGhlIHN0b3Jlcy5cbiAqXG4gKiAgVGhlIGZvbGxvd2luZyBjb2RlIHdpbGwgdXBkYXRlIHRoZSBzdG9yZSwgQlVUICBlbWl0cyBvbmx5IG9uY2UuXG4gKlxuICogIEBleGFtcGxlXG4gKiAgQHRyYW5zYWN0aW9uXG4gKiAgYWRkVG9kb3MoKSB7XG4gKiAgICB0aGlzLnRvZG9zU3RvcmUuYWRkKG5ldyBUb2RvKDEsIHRpdGxlKSk7XG4gKiAgICB0aGlzLnRvZG9zU3RvcmUuYWRkKG5ldyBUb2RvKDIsIHRpdGxlKSk7XG4gKiAgfVxuICpcbiAqXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0cmFuc2FjdGlvbigpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKHRhcmdldDogYW55LCBwcm9wZXJ0eUtleTogc3RyaW5nLCBkZXNjcmlwdG9yOiBQcm9wZXJ0eURlc2NyaXB0b3IpIHtcbiAgICBjb25zdCBvcmlnaW5hbE1ldGhvZCA9IGRlc2NyaXB0b3IudmFsdWU7XG5cbiAgICBkZXNjcmlwdG9yLnZhbHVlID0gZnVuY3Rpb24oLi4uYXJncykge1xuICAgICAgcmV0dXJuIGFwcGx5VHJhbnNhY3Rpb24oKCkgPT4ge1xuICAgICAgICByZXR1cm4gb3JpZ2luYWxNZXRob2QuYXBwbHkodGhpcywgYXJncyk7XG4gICAgICB9LCB0aGlzKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIGRlc2NyaXB0b3I7XG4gIH07XG59XG4iLCJpbXBvcnQgeyBpc09iamVjdCB9IGZyb20gJy4uL2ludGVybmFsL3V0aWxzJztcblxuLy8gaHR0cHM6Ly9naXRodWIuY29tL2dlb3JhcGJveC9pbW11dGFibGUtYXJyYXlzXG5cbi8qKlxuICogQWRkcyBvbmUgb3IgbW9yZSBlbGVtZW50cyB0byB0aGUgZW5kIG9mIGFuIGFycmF5IGJ5IHJldHVybmluZ1xuICogYSBuZXcgYXJyYXkgaW5zdGVhZCBvZiBtdXRhdGluZyB0aGUgb3JpZ2luYWwgb25lLlxuICpcbiAqIEBleGFtcGxlXG4gKiBjb25zdCBvcmlnaW5hbEFycmF5ID0gWydhJywgJ2InLCAnYycsICdkJywgJ2UnXTtcbiAqIGNvbnN0IHJlc3VsdEFycmF5ID0gcHVzaChvcmlnaW5hbEFycmF5LCAnZicsICdnJyk7XG4gKiAvLyAtPiBvcmlnaW5hbEFycmF5IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ11cbiAqIC8vIC0+IHJlc3VsdEFycmF5IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJywgJ2YnLCAnZyddXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwdXNoPFQ+KGFycmF5OiBUW10sIC4uLmVsZW1lbnROOiBUW10pOiBUW10ge1xuICByZXR1cm4gWy4uLmFycmF5LCAuLi5lbGVtZW50Tl07XG59XG5cbi8qKlxuICogRGVsZXRlcyBhbiBlbGVtZW50IGZyb20gYW4gYXJyYXkgYnkgaXRzIGluZGV4IGluIHRoZSBhcnJheS5cbiAqXG4gKiBAZXhhbXBsZVxuICogY29uc3Qgb3JpZ2luYWxBcnJheSA9IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ107XG4gKiBjb25zdCByZXN1bHRBcnJheSA9IHJlbW92ZShvcmlnaW5hbEFycmF5LCAyKTtcbiAqIC8vIC0+IG9yaWdpbmFsQXJyYXkgWydhJywgJ2InLCAnYycsICdkJywgJ2UnXVxuICogLy8gLT4gcmVzdWx0QXJyYXkgWydhJywgJ2InLCAnZCcsICdlJ11cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZTxUPihhcnJheTogVFtdLCBpbmRleDogbnVtYmVyKTogVFtdIHtcbiAgcmV0dXJuIGluZGV4ID49IDAgPyBbLi4uYXJyYXkuc2xpY2UoMCwgaW5kZXgpLCAuLi5hcnJheS5zbGljZShpbmRleCArIDEpXSA6IFsuLi5hcnJheV07XG59XG5cbi8qKlxuICogUmVtb3ZlcyB0aGUgbGFzdCBlbGVtZW50IGZyb20gYW4gYXJyYXkgYnkgcmV0dXJuaW5nXG4gKiBhIG5ldyBhcnJheSBpbnN0ZWFkIG9mIG11dGF0aW5nIHRoZSBvcmlnaW5hbCBvbmUuXG4gKlxuICogQGV4YW1wbGVcbiAqIGNvbnN0IG9yaWdpbmFsQXJyYXkgPSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddO1xuICogY29uc3QgcmVzdWx0QXJyYXkgPSBwb3Aob3JpZ2luYWxBcnJheSk7XG4gKiAvLyAtPiBvcmlnaW5hbEFycmF5IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ11cbiAqIC8vIC0+IHJlc3VsdEFycmF5IFsnYScsICdiJywgJ2MnLCAnZCddXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwb3A8VD4oYXJyYXk6IFRbXSk6IFRbXSB7XG4gIHJldHVybiBhcnJheS5zbGljZSgwLCAtMSk7XG59XG5cbi8qKlxuICogQWRkcyBvbmUgb3IgbW9yZSBlbGVtZW50cyB0byB0aGUgYmVnaW5uaW5nIG9mIGFuIGFycmF5LlxuICpcbiAqIEBleGFtcGxlXG4gKiBjb25zdCBvcmlnaW5hbEFycmF5ID0gWydhJywgJ2InLCAnYycsICdkJywgJ2UnXTtcbiAqIGNvbnN0IHJlc3VsdEFycmF5ID0gdW5zaGlmdChvcmlnaW5hbEFycmF5LCAnZicsICdnJyk7XG4gKiAvLyAtPiBvcmlnaW5hbEFycmF5IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ11cbiAqIC8vIC0+IHJlc3VsdEFycmF5IFsnZicsICdnJywgJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1bnNoaWZ0PFQ+KGFycmF5OiBUW10sIC4uLmVsZW1lbnROOiBUW10pOiBUW10ge1xuICByZXR1cm4gWy4uLmVsZW1lbnROLCAuLi5hcnJheV07XG59XG5cbi8qKlxuICogU29ydHMgdGhlIGVsZW1lbnRzIG9mIGFuIGFycmF5IChub3QgaW4gcGxhY2UpIGFuZCByZXR1cm5zIGEgc29ydGVkIGFycmF5LlxuICpcbiAqIEBleGFtcGxlXG4gKiBjb25zdCBudW1iZXJBcnJheSA9IFsyMCwgMywgNCwgMTAsIC0zLCAxLCAwLCA1XTtcbiAqIGNvbnN0IHN0cmluZ0FycmF5ID0gWydCbHVlJywgJ0h1bXBiYWNrJywgJ0JlbHVnYSddO1xuICpcbiAqIGNvbnN0IHJlc3VsdEFycmF5ID0gc29ydChudW1iZXJBcnJheSwgKGEsIGIpID0+IGEgLSBiKTtcbiAqIC8vIC0+IG51bWJlckFycmF5IFsyMCwgMywgNCwgMTAsIC0zLCAxLCAwLCA1XVxuICogLy8gLT4gcmVzdWx0QXJyYXkgWy0zLCAwLCAxLCAzLCA0LCA1LCAxMCwgMjBdXG4gKlxuICogY29uc3QgcmVzdWx0QXJyYXkgPSBzb3J0KG51bWJlckFycmF5LCAoYSwgYikgPT4gYiAtIGEpO1xuICogLy8gLT4gbnVtYmVyQXJyYXkgWzIwLCAzLCA0LCAxMCwgLTMsIDEsIDAsIDVdXG4gKiAvLyAtPiByZXN1bHRBcnJheSBbMjAsIDEwLCA1LCA0LCAzLCAxLCAwLCAtM11cbiAqXG4gKiBjb25zdCByZXN1bHRBcnJheSA9IHNvcnQoc3RyaW5nQXJyYXkpO1xuICogLy8gLT4gc3RyaW5nQXJyYXkgWydCbHVlJywgJ0h1bXBiYWNrJywgJ0JlbHVnYSddXG4gKiAvLyAtPiByZXN1bHRBcnJheSBbJ0JlbHVnYScsICdCbHVlJywgJ0h1bXBiYWNrJ11cbiAqXG4gKiBjb25zdCByZXN1bHRBcnJheSA9IHNvcnQoc3RyaW5nQXJyYXksIChhLCBiKSA9PiBhLnRvTG93ZXJDYXNlKCkgPCBiLnRvTG93ZXJDYXNlKCkpO1xuICogLy8gLT4gc3RyaW5nQXJyYXkgWydCbHVlJywgJ0h1bXBiYWNrJywgJ0JlbHVnYSddXG4gKiAvLyAtPiByZXN1bHRBcnJheSBbJ0h1bXBiYWNrJywgJ0JsdWUnLCAnQmVsdWdhJ11cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNvcnQ8VD4oYXJyYXk6IFRbXSwgY29tcGFyZUZ1bmN0aW9uPzogKGE6IFQsIGI6IFQpID0+IG51bWJlcik6IFRbXSB7XG4gIHJldHVybiBbLi4uYXJyYXldLnNvcnQoY29tcGFyZUZ1bmN0aW9uKTtcbn1cblxuLyoqXG4gKiBSZXZlcnNlcyBhbiBhcnJheSAobm90IGluIHBsYWNlKS5cbiAqIFRoZSBmaXJzdCBhcnJheSBlbGVtZW50IGJlY29tZXMgdGhlIGxhc3QsIGFuZCB0aGUgbGFzdCBhcnJheSBlbGVtZW50IGJlY29tZXMgdGhlIGZpcnN0LlxuICpcbiAqIEBleGFtcGxlXG4gKiBjb25zdCBvcmlnaW5hbEFycmF5ID0gWydhJywgJ2InLCAnYycsICdkJywgJ2UnXTtcbiAqIGNvbnN0IHJlc3VsdEFycmF5ID0gcmV2ZXJzZShvcmlnaW5hbEFycmF5KTtcbiAqIC8vIC0+IG9yaWdpbmFsQXJyYXkgWydhJywgJ2InLCAnYycsICdkJywgJ2UnXVxuICogLy8gLT4gcmVzdWx0QXJyYXkgWydlJywgJ2QnLCAnYycsICdiJywgJ2EnXVxuICovXG5leHBvcnQgZnVuY3Rpb24gcmV2ZXJzZTxUPihhcnJheTogVFtdKTogVFtdIHtcbiAgcmV0dXJuIFsuLi5hcnJheV0ucmV2ZXJzZSgpO1xufVxuXG4vKipcbiAqIFN3YXAgaXRlbXMgaW4gdGhlIGFycmF5XG4gKlxuICogQGV4YW1wbGVcbiAqIGNvbnN0IG9yaWdpbmFsQXJyYXkgPSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddO1xuICogY29uc3QgcmVzdWx0QXJyYXkgPSBzd2FwKG9yaWdpbmFsQXJyYXksIDEsIDQpO1xuICogLy8gLT4gb3JpZ2luYWxBcnJheSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddXG4gKiAvLyAtPiByZXN1bHRBcnJheSBbJ2EnLCAnZScsICdjJywgJ2QnLCAnYiddXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzd2FwPFQ+KGFycmF5OiBUW10sIGZpcnN0SW5kZXg6IG51bWJlciwgc2Vjb25kSW5kZXg6IG51bWJlcik6IFRbXSB7XG4gIGNvbnN0IHJlc3VsdHMgPSBhcnJheS5zbGljZSgpO1xuICBjb25zdCBmaXJzdEl0ZW0gPSBhcnJheVtmaXJzdEluZGV4XTtcbiAgcmVzdWx0c1tmaXJzdEluZGV4XSA9IGFycmF5W3NlY29uZEluZGV4XTtcbiAgcmVzdWx0c1tzZWNvbmRJbmRleF0gPSBmaXJzdEl0ZW07XG5cbiAgcmV0dXJuIHJlc3VsdHM7XG59XG5cbi8qKlxuICogVXBkYXRlIGl0ZW0gaW4gdGhlIGFycmF5XG4gKlxuICogQGV4YW1wbGVcbiAqIGNvbnN0IG9yaWdpbmFsQXJyYXkgPSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddO1xuICogY29uc3QgcmVzdWx0QXJyYXkgPSB1cGRhdGUob3JpZ2luYWxBcnJheSwgMSwgJ25ld0l0ZW0nKTtcbiAqIC8vIC0+IHJlc3VsdEFycmF5IFsnYScsICduZXdJdGVtJywgJ2MnLCAnZCcsICdiJ11cbiAqXG4gKiBjb25zdCBvcmlnaW5hbEFycmF5ID0gW3t0aXRsZTogMX0sIHt0aXRsZTogMn1dO1xuICogY29uc3QgcmVzdWx0QXJyYXkgPSB1cGRhdGUob3JpZ2luYWxBcnJheSwgb3JpZ2luYWxBcnJheVswXSwge3RpdGxlOiAzfSk7XG4gKiAvLyAtPiByZXN1bHRBcnJheSAgW3t0aXRsZTogM30sIHt0aXRsZTogMn1dO1xuICovXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlPFQ+KGFycmF5OiBUW10sIGluZGV4T3JJdGVtOiBudW1iZXIgfCBvYmplY3QsIHVwZGF0ZWQ6IFQpOiBUW10ge1xuICByZXR1cm4gYXJyYXkubWFwKChjdXJyZW50LCBpZHgpID0+IHtcbiAgICBpZiAodHlwZW9mIGluZGV4T3JJdGVtID09PSAnbnVtYmVyJyAmJiBpZHggPT09IGluZGV4T3JJdGVtKSB7XG4gICAgICByZXR1cm4gdXBkYXRlZDtcbiAgICB9XG5cbiAgICBpZiAoaXNPYmplY3QoaW5kZXhPckl0ZW0pICYmIChpbmRleE9ySXRlbSBhcyBhbnkpID09PSBjdXJyZW50KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi4oaW5kZXhPckl0ZW0gYXMgb2JqZWN0KSxcbiAgICAgICAgLi4uKHVwZGF0ZWQgYXMgYW55KVxuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4gY3VycmVudDtcbiAgfSk7XG59XG5cbi8qKlxuICogUmVtb3ZlcyBleGlzdGluZyBlbGVtZW50cyBhbmQvb3IgYWRkcyBuZXcgZWxlbWVudHMgdG8gYW4gYXJyYXkuXG4gKlxuICogQGV4YW1wbGVcbiAqIGNvbnN0IG9yaWdpbmFsQXJyYXkgPSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddO1xuICogY29uc3QgcmVzdWx0QXJyYXkgPSBzcGxpY2Uob3JpZ2luYWxBcnJheSwgMCk7XG4gKiAvLyAtPiBvcmlnaW5hbEFycmF5IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ11cbiAqIC8vIC0+IHJlc3VsdEFycmF5IFtdXG4gKlxuICogY29uc3Qgb3JpZ2luYWxBcnJheSA9IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ107XG4gKiBjb25zdCByZXN1bHRBcnJheSA9IHNwbGljZShvcmlnaW5hbEFycmF5LCAwLCAxKTtcbiAqIC8vIC0+IG9yaWdpbmFsQXJyYXkgWydhJywgJ2InLCAnYycsICdkJywgJ2UnXVxuICogLy8gLT4gcmVzdWx0QXJyYXkgWydiJywgJ2MnLCAnZCcsICdlJ11cbiAqXG4gKiBjb25zdCBvcmlnaW5hbEFycmF5ID0gWydhJywgJ2InLCAnYycsICdkJywgJ2UnXTtcbiAqIGNvbnN0IHJlc3VsdEFycmF5ID0gc3BsaWNlKG9yaWdpbmFsQXJyYXksIDAsIDMpO1xuICogLy8gLT4gb3JpZ2luYWxBcnJheSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddXG4gKiAvLyAtPiByZXN1bHRBcnJheSBbJ2QnLCAnZSddXG4gKlxuICogY29uc3Qgb3JpZ2luYWxBcnJheSA9IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ107XG4gKiBjb25zdCByZXN1bHRBcnJheSA9IHNwbGljZShvcmlnaW5hbEFycmF5LCAwLCBvcmlnaW5hbEFycmF5Lmxlbmd0aCk7XG4gKiAvLyAtPiBvcmlnaW5hbEFycmF5IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ11cbiAqIC8vIC0+IHJlc3VsdEFycmF5IFtdXG4gKlxuICogY29uc3Qgb3JpZ2luYWxBcnJheSA9IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ107XG4gKiBjb25zdCByZXN1bHRBcnJheSA9IHNwbGljZShvcmlnaW5hbEFycmF5LCAwLCAtMyk7XG4gKiAvLyAtPiBvcmlnaW5hbEFycmF5IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ11cbiAqIC8vIC0+IHJlc3VsdEFycmF5IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ11cbiAqXG4gKiBjb25zdCBvcmlnaW5hbEFycmF5ID0gWydhJywgJ2InLCAnYycsICdkJywgJ2UnXTtcbiAqIGNvbnN0IHJlc3VsdEFycmF5ID0gc3BsaWNlKG9yaWdpbmFsQXJyYXksIDAsIDAsICdsb3JlbScsICdpcHN1bScpO1xuICogLy8gLT4gb3JpZ2luYWxBcnJheSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddXG4gKiAvLyAtPiByZXN1bHRBcnJheSBbJ2xvcmVtJywgJ2lwc3VtJywgJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddXG4gKlxuICogY29uc3Qgb3JpZ2luYWxBcnJheSA9IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ107XG4gKiBjb25zdCByZXN1bHRBcnJheSA9IHNwbGljZShvcmlnaW5hbEFycmF5LCBvcmlnaW5hbEFycmF5Lmxlbmd0aCwgMCwgJ2xvcmVtJywgJ2lwc3VtJyk7XG4gKiAvLyAtPiBvcmlnaW5hbEFycmF5IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ11cbiAqIC8vIC0+IHJlc3VsdEFycmF5IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJywgJ2xvcmVtJywgJ2lwc3VtJ11cbiAqXG4gKiBjb25zdCBvcmlnaW5hbEFycmF5ID0gWydhJywgJ2InLCAnYycsICdkJywgJ2UnXTtcbiAqIGNvbnN0IHJlc3VsdEFycmF5ID0gc3BsaWNlKG9yaWdpbmFsQXJyYXksIDAsIDIsICdsb3JlbScsICdpcHN1bScpO1xuICogLy8gLT4gb3JpZ2luYWxBcnJheSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddXG4gKiAvLyAtPiByZXN1bHRBcnJheSBbJ2xvcmVtJywgJ2lwc3VtJywgJ2MnLCAnZCcsICdlJ11cbiAqXG4gKiBjb25zdCBvcmlnaW5hbEFycmF5ID0gWydhJywgJ2InLCAnYycsICdkJywgJ2UnXTtcbiAqIGNvbnN0IHJlc3VsdEFycmF5ID0gc3BsaWNlKG9yaWdpbmFsQXJyYXksIG9yaWdpbmFsQXJyYXkubGVuZ3RoIC0gMiwgMiwgJ2xvcmVtJywgJ2lwc3VtJyk7XG4gKiAvLyAtPiBvcmlnaW5hbEFycmF5IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ11cbiAqIC8vIC0+IHJlc3VsdEFycmF5IFsnYScsICdiJywgJ2MnLCAnbG9yZW0nLCAnaXBzdW0nXVxuICovXG5leHBvcnQgZnVuY3Rpb24gc3BsaWNlPFQ+KGFycmF5OiBUW10sIHN0YXJ0ID0gYXJyYXkubGVuZ3RoLCBkZWxldGVDb3VudCA9IGFycmF5Lmxlbmd0aCAtIHN0YXJ0LCAuLi5lbGVtZW50TjogVFtdKTogVFtdIHtcbiAgcmV0dXJuIFsuLi5hcnJheS5zbGljZSgwLCBzdGFydCksIC4uLmVsZW1lbnROLCAuLi5hcnJheS5zbGljZShzdGFydCArIChkZWxldGVDb3VudCA8IDAgPyAwIDogZGVsZXRlQ291bnQpKV07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0b2dnbGU8VD4oYXJyOiBUW10sIGl0ZW06IFQpIHtcbiAgcmV0dXJuIGFyci5pbmRleE9mKGl0ZW0pID4gLTEgPyBhcnIuZmlsdGVyKGN1cnJlbnQgPT4gaXRlbSAhPT0gY3VycmVudCkgOiBwdXNoKGFyciwgaXRlbSk7XG59XG4iLCIvKiogQ2hlY2tzIGlmIHZhbHVlIGlzIG51bGwgb3IgdW5kZWZpbmVkICovXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaWx0ZXIgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmV4cG9ydCBjb25zdCBmaWx0ZXJOaWwgPSA8VD4oc291cmNlOiBPYnNlcnZhYmxlPFQ+KSA9PiBzb3VyY2UucGlwZShmaWx0ZXIodmFsdWUgPT4gdmFsdWUgIT09IG51bGwgJiYgdHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJykpO1xuIiwiaW1wb3J0IHsgQWN0aW9uLCBfX2dsb2JhbFN0YXRlIH0gZnJvbSAnLi9nbG9iYWwtc3RhdGUnO1xuXG5leHBvcnQgZnVuY3Rpb24gYXBwbHlBY3Rpb248VD4oZnVuYzogKCkgPT4gVCwgYWN0aW9uOiBBY3Rpb24sIHRoaXNBcmcgPSB1bmRlZmluZWQpOiBUIHtcbiAgX19nbG9iYWxTdGF0ZS5zZXRDdXN0b21BY3Rpb24oYWN0aW9uLCB0cnVlKTtcbiAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpc0FyZyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhY3Rpb24oYWN0aW9uOiBBY3Rpb24sIHNraXBUcmFuc2FjdGlvbk1zZyA9IHRydWUpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKHRhcmdldDogYW55LCBwcm9wZXJ0eUtleTogc3RyaW5nLCBkZXNjcmlwdG9yOiBQcm9wZXJ0eURlc2NyaXB0b3IpIHtcbiAgICBjb25zdCBvcmlnaW5hbE1ldGhvZCA9IGRlc2NyaXB0b3IudmFsdWU7XG4gICAgZGVzY3JpcHRvci52YWx1ZSA9IGZ1bmN0aW9uKC4uLmFyZ3MpIHtcbiAgICAgIF9fZ2xvYmFsU3RhdGUuc2V0Q3VzdG9tQWN0aW9uKGFjdGlvbiwgc2tpcFRyYW5zYWN0aW9uTXNnKTtcbiAgICAgIHJldHVybiBvcmlnaW5hbE1ldGhvZC5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIGRlc2NyaXB0b3I7XG4gIH07XG59XG4iLCJpbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5cbmZ1bmN0aW9uIHNlcmlhbGl6ZShvYmplY3QpIHtcbiAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG9iamVjdCwgZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHJldHVybiB2YWx1ZS50b1N0cmluZygpO1xuICAgIH1cbiAgICByZXR1cm4gdmFsdWU7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVXb3JrZXIoKSB7XG4gIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihcbiAgICBbXG4gICAgICBgc2VsZi5vbm1lc3NhZ2UgPSBmdW5jdGlvbihlKSB7XG5cbiAgICAgIGZ1bmN0aW9uIGRlc2VyaWFsaXplKHN0cikge1xuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShzdHIgfHwgJycsIGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcbiAgICAgICAgICBpZiAodmFsdWUgJiZcbiAgICAgICAgICAgIHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIiAmJlxuICAgICAgICAgICAgdmFsdWUuc3Vic3RyKDAsIDgpID09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgdmFyIHN0YXJ0Qm9keSA9IHZhbHVlLmluZGV4T2YoJ3snKSArIDE7XG4gICAgICAgICAgICB2YXIgZW5kQm9keSA9IHZhbHVlLmxhc3RJbmRleE9mKCd9Jyk7XG4gICAgICAgICAgICB2YXIgc3RhcnRBcmdzID0gdmFsdWUuaW5kZXhPZignKCcpICsgMTtcbiAgICAgICAgICAgIHZhciBlbmRBcmdzID0gdmFsdWUuaW5kZXhPZignKScpO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBGdW5jdGlvbih2YWx1ZS5zdWJzdHJpbmcoc3RhcnRBcmdzLCBlbmRBcmdzKSwgdmFsdWUuc3Vic3RyaW5nKHN0YXJ0Qm9keSwgZW5kQm9keSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICB2YXIgZGVzZXJpYWxpemVkID0gZGVzZXJpYWxpemUoZS5kYXRhKTtcbiAgICAgIHZhciBtYXBwZWQgPSBkZXNlcmlhbGl6ZWQuZGF0YS5tYXAoZnVuY3Rpb24oZCkge1xuICAgICAgICByZXR1cm4gZGVzZXJpYWxpemVkLmZhY3RvcnkoZCk7XG4gICAgICB9KTtcblxuICAgICAgc2VsZi5wb3N0TWVzc2FnZShtYXBwZWQpO1xuICAgIH1gXG4gICAgXSxcbiAgICB7XG4gICAgICB0eXBlOiAndGV4dC9qYXZhc2NyaXB0J1xuICAgIH1cbiAgKTtcblxuICBjb25zdCB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICByZXR1cm4gbmV3IFdvcmtlcih1cmwpO1xufVxuXG4vKipcbiAqICBAZXhhbXBsZVxuICogICBjb25zdCBtb2NrVG9kb3MgPSBBcnJheS5mcm9tKHtsZW5ndGg6IDEwMDAwfSwgKF8sIHgpID0+ICh7aWQ6IHh9KSk7XG4gKlxuICogICBvZihtb2NrVG9kb3MpLnBpcGUobWFwSW5Xb3JrZXI8VG9kbz4oY3JlYXRlVG9kbykpXG4gKiAgIC5zdWJzY3JpYmUocmVzID0+IGNvbnNvbGUubG9nKHJlcykpO1xuICovXG5leHBvcnQgZnVuY3Rpb24gbWFwSW5Xb3JrZXI8VD4oZmFjdG9yeUZuOiBGdW5jdGlvbikge1xuICByZXR1cm4gZnVuY3Rpb24oc291cmNlKTogT2JzZXJ2YWJsZTxUW10+IHtcbiAgICByZXR1cm4gbmV3IE9ic2VydmFibGUob2JzZXJ2ZXIgPT4ge1xuICAgICAgY29uc3Qgd29ya2VyID0gY3JlYXRlV29ya2VyKCk7XG5cbiAgICAgIHdvcmtlci5vbm1lc3NhZ2UgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgIG9ic2VydmVyLm5leHQoZS5kYXRhKTtcbiAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgd29ya2VyLnRlcm1pbmF0ZSgpO1xuICAgICAgfTtcblxuICAgICAgd29ya2VyLm9uZXJyb3IgPSBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgb2JzZXJ2ZXIuZXJyb3IoZXJyKTtcbiAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgd29ya2VyLnRlcm1pbmF0ZSgpO1xuICAgICAgfTtcblxuICAgICAgcmV0dXJuIHNvdXJjZS5zdWJzY3JpYmUodmFsdWUgPT4ge1xuICAgICAgICBjb25zdCBpbnB1dCA9IHtcbiAgICAgICAgICBmYWN0b3J5OiBmYWN0b3J5Rm4sXG4gICAgICAgICAgZGF0YTogdmFsdWVcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3Qgc2VyaWFsaXplZCA9IHNlcmlhbGl6ZShpbnB1dCk7XG5cbiAgICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHNlcmlhbGl6ZWQpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG59XG4iLCJpbXBvcnQgeyBfX3N0b3Jlc19fIH0gZnJvbSAnLi9zdG9yZSc7XG5pbXBvcnQgeyBpc1N0cmluZyB9IGZyb20gJy4uL2ludGVybmFsL3V0aWxzJztcblxuZXhwb3J0IGNsYXNzIFNuYXBzaG90TWFuYWdlciB7XG4gIC8qKlxuICAgKiBHZXQgYSBzbmFwc2hvdCBvZiB0aGUgd2hvbGUgc3RhdGUgb3IgYSBzcGVjaWZpYyBzdG9yZXNcbiAgICogVXNlIGl0IE9OTFkgZm9yIHRoaW5ncyBsaWtlIHNhdmluZyB0aGUgc3RhdGUgaW4gdGhlIHNlcnZlclxuICAgKi9cbiAgZ2V0U3RvcmVzU25hcHNob3Qoc3RvcmVzOiBzdHJpbmdbXSA9IFtdKSB7XG4gICAgbGV0IGFjYyA9IHt9O1xuICAgIGNvbnN0IGhhc0luY2x1ZGUgPSBzdG9yZXMubGVuZ3RoID4gMDtcbiAgICBjb25zdCBrZXlzID0gaGFzSW5jbHVkZSA/IHN0b3JlcyA6IE9iamVjdC5rZXlzKF9fc3RvcmVzX18pO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgbGV0IHN0b3JlTmFtZSA9IGtleXNbaV07XG4gICAgICBhY2Nbc3RvcmVOYW1lXSA9IF9fc3RvcmVzX19bc3RvcmVOYW1lXS5fdmFsdWUoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYWNjO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCBzbmFwc2hvdCB3ZSBnZXQgZnJvbSB0aGUgc2VydmVyXG4gICAqL1xuICBzZXRTdG9yZXNTbmFwc2hvdChzdG9yZXM6IHsgW3N0b3JlTmFtZTogc3RyaW5nXTogYW55IH0gfCBzdHJpbmcpIHtcbiAgICBsZXQgbm9ybWFsaXplZFN0b3JlcyA9IHN0b3JlcztcbiAgICBpZiAoaXNTdHJpbmcoc3RvcmVzKSkge1xuICAgICAgbm9ybWFsaXplZFN0b3JlcyA9IEpTT04ucGFyc2Uobm9ybWFsaXplZFN0b3JlcyBhcyBzdHJpbmcpO1xuICAgIH1cblxuICAgIGZvciAobGV0IGkgPSAwLCBrZXlzID0gT2JqZWN0LmtleXMobm9ybWFsaXplZFN0b3Jlcyk7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBzdG9yZU5hbWUgPSBrZXlzW2ldO1xuICAgICAgaWYgKF9fc3RvcmVzX19bc3RvcmVOYW1lXSkge1xuICAgICAgICBfX3N0b3Jlc19fW3N0b3JlTmFtZV0uc2V0U3RhdGUoKCkgPT4gbm9ybWFsaXplZFN0b3Jlc1tzdG9yZU5hbWVdKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IHNuYXBzaG90TWFuYWdlciA9IG5ldyBTbmFwc2hvdE1hbmFnZXIoKTtcbiIsImltcG9ydCB7IFF1ZXJ5RW50aXR5IH0gZnJvbSAnLi4vYXBpL3F1ZXJ5LWVudGl0eSc7XG5pbXBvcnQgeyBRdWVyeSB9IGZyb20gJy4uL2FwaS9xdWVyeSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaWx0ZXJOaWwgfSBmcm9tICcuLi9hcGkvb3BlcmF0b3JzJztcbmltcG9ydCB7IHRvQm9vbGVhbiB9IGZyb20gJy4uL2ludGVybmFsL3V0aWxzJztcbmltcG9ydCB7IElEIH0gZnJvbSAnLi4vYXBpL3R5cGVzJztcbmltcG9ydCB7IGdldEFraXRhQ29uZmlnIH0gZnJvbSAnLi4vYXBpL2NvbmZpZyc7XG5cbmV4cG9ydCB0eXBlIFF1ZXJpZXM8RSwgUz4gPSBRdWVyeTxTPiB8IFF1ZXJ5RW50aXR5PFMsIEU+O1xuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQWtpdGFQbHVnaW48RSA9IGFueSwgUyA9IGFueT4ge1xuICBwcm90ZWN0ZWQgY29uc3RydWN0b3IocHJvdGVjdGVkIHF1ZXJ5OiBRdWVyaWVzPEUsIFM+LCBjb25maWc/OiB7IHJlc2V0Rm4/OiBGdW5jdGlvbiB9KSB7XG4gICAgaWYgKGNvbmZpZyAmJiBjb25maWcucmVzZXRGbikge1xuICAgICAgaWYgKGdldEFraXRhQ29uZmlnKCkucmVzZXR0YWJsZSkge1xuICAgICAgICB0aGlzLm9uUmVzZXQoY29uZmlnLnJlc2V0Rm4pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKiBUaGlzIG1ldGhvZCBpcyByZXNwb25zaWJsZSBmb3IgZ2V0dGluZyBhY2Nlc3MgdG8gdGhlIHF1ZXJ5LiAqL1xuICBwcm90ZWN0ZWQgZ2V0UXVlcnkoKTogUXVlcmllczxFLCBTPiB7XG4gICAgcmV0dXJuIHRoaXMucXVlcnk7XG4gIH1cblxuICAvKiogVGhpcyBtZXRob2QgaXMgcmVzcG9uc2libGUgZm9yIGdldHRpbmcgYWNjZXNzIHRvIHRoZSBzdG9yZS4gKi9cbiAgcHJvdGVjdGVkIGdldFN0b3JlKCkge1xuICAgIHJldHVybiB0aGlzLmdldFF1ZXJ5KCkuX19zdG9yZV9fO1xuICB9XG5cbiAgLyoqIFRoaXMgbWV0aG9kIGlzIHJlc3BvbnNpYmxlIGZvciBjbGVhbmluZy4gKi9cbiAgcHVibGljIGFic3RyYWN0IGRlc3Ryb3koKTtcblxuICAvKiogVGhpcyBtZXRob2QgaXMgcmVzcG9uc2libGUgdGVsbHMgd2hldGhlciB0aGUgcGx1Z2luIGlzIGVudGl0eUJhc2VkIG9yIG5vdC4gICovXG4gIHByb3RlY3RlZCBpc0VudGl0eUJhc2VkKGVudGl0eUlkOiBJRCkge1xuICAgIHJldHVybiB0b0Jvb2xlYW4oZW50aXR5SWQpO1xuICB9XG5cbiAgLyoqIFRoaXMgbWV0aG9kIGlzIHJlc3BvbnNpYmxlIGZvciBzZWxlY3RpbmcgdGhlIHNvdXJjZTsgaXQgY2FuIGJlIHRoZSB3aG9sZSBzdG9yZSBvciBvbmUgZW50aXR5LiAqL1xuICBwcm90ZWN0ZWQgc2VsZWN0U291cmNlKGVudGl0eUlkOiBJRCk6IE9ic2VydmFibGU8UyB8IEU+IHtcbiAgICBpZiAodGhpcy5pc0VudGl0eUJhc2VkKGVudGl0eUlkKSkge1xuICAgICAgcmV0dXJuICh0aGlzLmdldFF1ZXJ5KCkgYXMgUXVlcnlFbnRpdHk8UywgRT4pLnNlbGVjdEVudGl0eShlbnRpdHlJZCkucGlwZShmaWx0ZXJOaWwpO1xuICAgIH1cblxuICAgIHJldHVybiAodGhpcy5nZXRRdWVyeSgpIGFzIFF1ZXJ5PFM+KS5zZWxlY3Qoc3RhdGUgPT4gc3RhdGUpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldFNvdXJjZShlbnRpdHlJZDogSUQpOiBTIHwgRSB7XG4gICAgaWYgKHRoaXMuaXNFbnRpdHlCYXNlZChlbnRpdHlJZCkpIHtcbiAgICAgIHJldHVybiAodGhpcy5nZXRRdWVyeSgpIGFzIFF1ZXJ5RW50aXR5PFMsIEU+KS5nZXRFbnRpdHkoZW50aXR5SWQpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmdldFF1ZXJ5KCkuZ2V0U25hcHNob3QoKTtcbiAgfVxuXG4gIC8qKiBUaGlzIG1ldGhvZCBpcyByZXNwb25zaWJsZSBmb3IgdXBkYXRpbmcgdGhlIHN0b3JlIG9yIG9uZSBlbnRpdHk7IGl0IGNhbiBiZSB0aGUgd2hvbGUgc3RvcmUgb3Igb25lIGVudGl0eS4gKi9cbiAgcHJvdGVjdGVkIHVwZGF0ZVN0b3JlKG5ld1N0YXRlLCBlbnRpdHlJZD8pIHtcbiAgICBpZiAodGhpcy5pc0VudGl0eUJhc2VkKGVudGl0eUlkKSkge1xuICAgICAgdGhpcy5nZXRTdG9yZSgpLnVwZGF0ZShlbnRpdHlJZCwgbmV3U3RhdGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmdldFN0b3JlKCkuc2V0U3RhdGUoc3RhdGUgPT4gKHsgLi4uc3RhdGUsIC4uLm5ld1N0YXRlIH0pKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRnVuY3Rpb24gdG8gaW52b2tlIHVwb24gcmVzZXRcbiAgICovXG4gIHByaXZhdGUgb25SZXNldChmbjogRnVuY3Rpb24pIHtcbiAgICBjb25zdCBvcmlnaW5hbCA9IHRoaXMuZ2V0U3RvcmUoKS5yZXNldDtcbiAgICB0aGlzLmdldFN0b3JlKCkucmVzZXQgPSAoLi4ucGFyYW1zKSA9PiB7XG4gICAgICAvKiogSXQgc2hvdWxkIHJ1biBhZnRlciB0aGUgcGx1Z2luIGRlc3Ryb3kgbWV0aG9kICovXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgb3JpZ2luYWwuYXBwbHkodGhpcy5nZXRTdG9yZSgpLCBwYXJhbXMpO1xuICAgICAgICBmbigpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfVxufVxuIiwiaW1wb3J0IHsgUXVlcnlFbnRpdHkgfSBmcm9tICcuLi8uLi9hcGkvcXVlcnktZW50aXR5JztcbmltcG9ydCB7IGRlbGF5LCBtYXAsIHN3aXRjaE1hcCwgdGFrZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgZnJvbSwgT2JzZXJ2YWJsZSwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBpc09ic2VydmFibGUsIGlzVW5kZWZpbmVkIH0gZnJvbSAnLi4vLi4vaW50ZXJuYWwvdXRpbHMnO1xuaW1wb3J0IHsgSUQgfSBmcm9tICcuLi8uLi9hcGkvdHlwZXMnO1xuaW1wb3J0IHsgQWtpdGFQbHVnaW4gfSBmcm9tICcuLi9wbHVnaW4nO1xuaW1wb3J0IHsgYXBwbHlUcmFuc2FjdGlvbiB9IGZyb20gJy4uLy4uL2FwaS90cmFuc2FjdGlvbic7XG5pbXBvcnQgeyBhY3Rpb24sIGFwcGx5QWN0aW9uIH0gZnJvbSAnLi4vLi4vaW50ZXJuYWwvYWN0aW9uJztcblxuZXhwb3J0IGludGVyZmFjZSBQYWdpbmF0aW9uUmVzcG9uc2U8RT4ge1xuICBjdXJyZW50UGFnZTogbnVtYmVyO1xuICBwZXJQYWdlOiBudW1iZXI7XG4gIGxhc3RQYWdlOiBudW1iZXI7XG4gIGRhdGE6IEVbXTtcbiAgdG90YWw/OiBudW1iZXI7XG4gIGZyb20/OiBudW1iZXI7XG4gIHRvPzogbnVtYmVyO1xuICBwYWdlQ29udHJvbHM/OiBudW1iZXJbXTtcbn1cblxuZXhwb3J0IHR5cGUgUGFnaW5hdG9yQ29uZmlnID0ge1xuICBwYWdlc0NvbnRyb2xzPzogYm9vbGVhbjtcbiAgcmFuZ2U/OiBib29sZWFuO1xuICBzdGFydFdpdGg/OiBudW1iZXI7XG4gIGNhY2hlVGltZW91dD86IE9ic2VydmFibGU8bnVtYmVyPjtcbn07XG5cbmNvbnN0IHBhZ2luYXRvckRlZmF1bHRzOiBQYWdpbmF0b3JDb25maWcgPSB7XG4gIHBhZ2VzQ29udHJvbHM6IGZhbHNlLFxuICByYW5nZTogZmFsc2UsXG4gIHN0YXJ0V2l0aDogMSxcbiAgY2FjaGVUaW1lb3V0OiB1bmRlZmluZWRcbn07XG5cbmV4cG9ydCBjbGFzcyBQYWdpbmF0b3JQbHVnaW48RT4gZXh0ZW5kcyBBa2l0YVBsdWdpbjxFPiB7XG4gIC8qKiBTYXZlIGN1cnJlbnQgZmlsdGVycywgc29ydGluZywgZXRjLiBpbiBjYWNoZSAqL1xuICBtZXRhZGF0YSA9IG5ldyBNYXAoKTtcblxuICBwcml2YXRlIHBhZ2U6IEJlaGF2aW9yU3ViamVjdDxudW1iZXI+O1xuICBwcml2YXRlIHBhZ2VzID0gbmV3IE1hcDxudW1iZXIsIHsgaWRzOiBJRFtdIH0+KCk7XG4gIHByaXZhdGUgcmVhZG9ubHkgY2xlYXJDYWNoZVN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuXG4gIHByaXZhdGUgcGFnaW5hdGlvbjogUGFnaW5hdGlvblJlc3BvbnNlPEU+ID0ge1xuICAgIGN1cnJlbnRQYWdlOiAxLFxuICAgIHBlclBhZ2U6IDAsXG4gICAgdG90YWw6IDAsXG4gICAgbGFzdFBhZ2U6IDAsXG4gICAgZGF0YTogW11cbiAgfTtcblxuICAvKipcbiAgICogV2hlbiB0aGUgdXNlciBuYXZpZ2F0ZXMgdG8gYSBkaWZmZXJlbnQgcGFnZSBhbmQgcmV0dXJuXG4gICAqIHdlIGRvbid0IHdhbnQgdG8gY2FsbCBgY2xlYXJDYWNoZWAgb24gZmlyc3QgdGltZS5cbiAgICovXG4gIHByaXZhdGUgaW5pdGlhbCA9IGZhbHNlO1xuXG4gIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBxdWVyeTogUXVlcnlFbnRpdHk8YW55LCBFPiwgcHVibGljIGNvbmZpZzogUGFnaW5hdG9yQ29uZmlnID0ge30pIHtcbiAgICBzdXBlcihxdWVyeSwge1xuICAgICAgcmVzZXRGbjogKCkgPT4ge1xuICAgICAgICB0aGlzLmluaXRpYWwgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5kZXN0cm95KHsgY2xlYXJDYWNoZTogdHJ1ZSwgY3VycmVudFBhZ2U6IDEgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5jb25maWcgPSBPYmplY3QuYXNzaWduKHBhZ2luYXRvckRlZmF1bHRzLCBjb25maWcpO1xuICAgIGNvbnN0IHsgc3RhcnRXaXRoLCBjYWNoZVRpbWVvdXQgfSA9IHRoaXMuY29uZmlnO1xuICAgIHRoaXMucGFnZSA9IG5ldyBCZWhhdmlvclN1YmplY3Qoc3RhcnRXaXRoKTtcbiAgICBpZiAoaXNPYnNlcnZhYmxlKGNhY2hlVGltZW91dCkpIHtcbiAgICAgIHRoaXMuY2xlYXJDYWNoZVN1YnNjcmlwdGlvbiA9IGNhY2hlVGltZW91dC5zdWJzY3JpYmUoXyA9PiB0aGlzLmNsZWFyQ2FjaGUoKSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFByb3h5IHRvIHRoZSBxdWVyeSBsb2FkaW5nXG4gICAqL1xuICBpc0xvYWRpbmckID0gdGhpcy5xdWVyeS5zZWxlY3RMb2FkaW5nKCkucGlwZShkZWxheSgwKSk7XG5cbiAgLyoqXG4gICAqIExpc3RlbiB0byBwYWdlIGNoYW5nZXNcbiAgICovXG4gIGdldCBwYWdlQ2hhbmdlcygpIHtcbiAgICByZXR1cm4gdGhpcy5wYWdlLmFzT2JzZXJ2YWJsZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgY3VycmVudCBwYWdlIG51bWJlclxuICAgKi9cbiAgZ2V0IGN1cnJlbnRQYWdlKCkge1xuICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb24uY3VycmVudFBhZ2U7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgY3VycmVudCBwYWdlIGlzIHRoZSBmaXJzdCBvbmVcbiAgICovXG4gIGdldCBpc0ZpcnN0KCkge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRQYWdlID09PSAxO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGN1cnJlbnQgcGFnZSBpcyB0aGUgbGFzdCBvbmVcbiAgICovXG4gIGdldCBpc0xhc3QoKSB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudFBhZ2UgPT09IHRoaXMucGFnaW5hdGlvbi5sYXN0UGFnZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIGdlbmVyYXRlIGFuIGFycmF5IG9mIHBhZ2VzIGZvciAqbmdGb3JcbiAgICogWzEsIDIsIDMsIDRdXG4gICAqL1xuICB3aXRoQ29udHJvbHMoKSB7XG4gICAgdGhpcy5jb25maWcucGFnZXNDb250cm9scyA9IHRydWU7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogV2hldGhlciB0byBnZW5lcmF0ZSB0aGUgYGZyb21gIGFuZCBgdG9gIGtleXNcbiAgICogWzEsIDIsIDMsIDRdXG4gICAqL1xuICB3aXRoUmFuZ2UoKSB7XG4gICAgdGhpcy5jb25maWcucmFuZ2UgPSB0cnVlO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgbG9hZGluZyBzdGF0ZVxuICAgKi9cbiAgc2V0TG9hZGluZyh2YWx1ZSA9IHRydWUpIHtcbiAgICB0aGlzLmdldFN0b3JlKCkuc2V0TG9hZGluZyh2YWx1ZSk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRoZSBwYWdpbmF0aW9uIG9iamVjdCBhbmQgYWRkIHRoZSBwYWdlXG4gICAqL1xuICBAYWN0aW9uKHsgdHlwZTogJ0BQYWdpbmF0aW9uIC0gTmV3IFBhZ2UnIH0sIHRydWUpXG4gIHVwZGF0ZShyZXNwb25zZTogUGFnaW5hdGlvblJlc3BvbnNlPEU+KSB7XG4gICAgdGhpcy5wYWdpbmF0aW9uID0gcmVzcG9uc2U7XG4gICAgdGhpcy5hZGRQYWdlKHJlc3BvbnNlLmRhdGEpO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIFNldCB0aGUgaWRzIGFuZCBhZGQgdGhlIHBhZ2UgdG8gc3RvcmVcbiAgICovXG4gIGFkZFBhZ2UoZGF0YTogRVtdKSB7XG4gICAgdGhpcy5wYWdlcy5zZXQodGhpcy5jdXJyZW50UGFnZSwgeyBpZHM6IGRhdGEubWFwKGVudGl0eSA9PiBlbnRpdHlbdGhpcy5nZXRTdG9yZSgpLmlkS2V5XSkgfSk7XG4gICAgdGhpcy5nZXRTdG9yZSgpLmFkZChkYXRhKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhciB0aGUgY2FjaGUuXG4gICAqL1xuICBjbGVhckNhY2hlKCkge1xuICAgIGlmICghdGhpcy5pbml0aWFsKSB7XG4gICAgICBhcHBseUFjdGlvbihcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgIHRoaXMuZ2V0U3RvcmUoKS5yZW1vdmUoKTtcbiAgICAgICAgfSxcbiAgICAgICAgeyB0eXBlOiAnQFBhZ2luYXRpb24gLSBDbGVhciBDYWNoZScgfVxuICAgICAgKTtcbiAgICAgIHRoaXMucGFnZXMgPSBuZXcgTWFwKCk7XG4gICAgICB0aGlzLm1ldGFkYXRhID0gbmV3IE1hcCgpO1xuICAgIH1cbiAgICB0aGlzLmluaXRpYWwgPSBmYWxzZTtcbiAgfVxuXG4gIGNsZWFyUGFnZShwYWdlOiBudW1iZXIpIHtcbiAgICB0aGlzLnBhZ2VzLmRlbGV0ZShwYWdlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhciB0aGUgY2FjaGUgdGltZW91dCBhbmQgb3B0aW9uYWxseSB0aGUgcGFnZXNcbiAgICovXG4gIGRlc3Ryb3koeyBjbGVhckNhY2hlLCBjdXJyZW50UGFnZSB9OiB7IGNsZWFyQ2FjaGU/OiBib29sZWFuOyBjdXJyZW50UGFnZT86IG51bWJlciB9ID0ge30pIHtcbiAgICBpZiAodGhpcy5jbGVhckNhY2hlU3Vic2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLmNsZWFyQ2FjaGVTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gICAgaWYgKGNsZWFyQ2FjaGUpIHtcbiAgICAgIHRoaXMuY2xlYXJDYWNoZSgpO1xuICAgIH1cbiAgICBpZiAoIWlzVW5kZWZpbmVkKGN1cnJlbnRQYWdlKSkge1xuICAgICAgdGhpcy5zZXRQYWdlKGN1cnJlbnRQYWdlKTtcbiAgICB9XG4gICAgdGhpcy5pbml0aWFsID0gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSBwcm92aWRlZCBwYWdlIGlzIGFjdGl2ZVxuICAgKi9cbiAgaXNQYWdlQWN0aXZlKHBhZ2U6IG51bWJlcikge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRQYWdlID09PSBwYWdlO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgY3VycmVudCBwYWdlXG4gICAqL1xuICBzZXRQYWdlKHBhZ2U6IG51bWJlcikge1xuICAgIGlmIChwYWdlICE9PSB0aGlzLmN1cnJlbnRQYWdlIHx8ICF0aGlzLmhhc1BhZ2UocGFnZSkpIHtcbiAgICAgIHRoaXMucGFnZS5uZXh0KCh0aGlzLnBhZ2luYXRpb24uY3VycmVudFBhZ2UgPSBwYWdlKSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEluY3JlbWVudCBjdXJyZW50IHBhZ2VcbiAgICovXG4gIG5leHRQYWdlKCkge1xuICAgIGlmICh0aGlzLmN1cnJlbnRQYWdlICE9PSB0aGlzLnBhZ2luYXRpb24ubGFzdFBhZ2UpIHtcbiAgICAgIHRoaXMuc2V0UGFnZSh0aGlzLnBhZ2luYXRpb24uY3VycmVudFBhZ2UgKyAxKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGVjcmVtZW50IGN1cnJlbnQgcGFnZVxuICAgKi9cbiAgcHJldlBhZ2UoKSB7XG4gICAgaWYgKHRoaXMucGFnaW5hdGlvbi5jdXJyZW50UGFnZSA+IDEpIHtcbiAgICAgIHRoaXMuc2V0UGFnZSh0aGlzLnBhZ2luYXRpb24uY3VycmVudFBhZ2UgLSAxKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0IGN1cnJlbnQgcGFnZSB0byBsYXN0XG4gICAqL1xuICBzZXRMYXN0UGFnZSgpIHtcbiAgICB0aGlzLnNldFBhZ2UodGhpcy5wYWdpbmF0aW9uLmxhc3RQYWdlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgY3VycmVudCBwYWdlIHRvIGZpcnN0XG4gICAqL1xuICBzZXRGaXJzdFBhZ2UoKSB7XG4gICAgdGhpcy5zZXRQYWdlKDEpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIHBhZ2UgZXhpc3RzIGluIGNhY2hlXG4gICAqL1xuICBoYXNQYWdlKHBhZ2U6IG51bWJlcikge1xuICAgIHJldHVybiB0aGlzLnBhZ2VzLmhhcyhwYWdlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGN1cnJlbnQgcGFnZSBpZiBpdCdzIGluIGNhY2hlLCBvdGhlcndpc2UgaW52b2tlIHRoZSByZXF1ZXN0XG4gICAqL1xuICBnZXRQYWdlKHJlcTogKCkgPT4gT2JzZXJ2YWJsZTxQYWdpbmF0aW9uUmVzcG9uc2U8RT4+KSB7XG4gICAgY29uc3QgcGFnZSA9IHRoaXMucGFnaW5hdGlvbi5jdXJyZW50UGFnZTtcbiAgICBpZiAodGhpcy5oYXNQYWdlKHBhZ2UpKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZWxlY3RQYWdlKHBhZ2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNldExvYWRpbmcodHJ1ZSk7XG4gICAgICByZXR1cm4gZnJvbShyZXEoKSkucGlwZShcbiAgICAgICAgc3dpdGNoTWFwKChjb25maWc6IFBhZ2luYXRpb25SZXNwb25zZTxFPikgPT4ge1xuICAgICAgICAgIGFwcGx5VHJhbnNhY3Rpb24oKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRMb2FkaW5nKGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlKGNvbmZpZyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0UGFnZShwYWdlKTtcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgZ2V0UXVlcnkoKTogUXVlcnlFbnRpdHk8YW55LCBFPiB7XG4gICAgcmV0dXJuIHRoaXMucXVlcnk7XG4gIH1cblxuICBwcml2YXRlIGdldEZyb20oKSB7XG4gICAgaWYgKHRoaXMuaXNGaXJzdCkge1xuICAgICAgcmV0dXJuIDE7XG4gICAgfVxuICAgIHJldHVybiAodGhpcy5jdXJyZW50UGFnZSAtIDEpICogdGhpcy5wYWdpbmF0aW9uLnBlclBhZ2UgKyAxO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRUbygpIHtcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50UGFnZSAqIHRoaXMucGFnaW5hdGlvbi5wZXJQYWdlO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbGVjdCB0aGUgcGFnZVxuICAgKi9cbiAgcHJpdmF0ZSBzZWxlY3RQYWdlKHBhZ2U6IG51bWJlcik6IE9ic2VydmFibGU8UGFnaW5hdGlvblJlc3BvbnNlPEU+PiB7XG4gICAgcmV0dXJuIHRoaXMucXVlcnkuc2VsZWN0QWxsKHsgYXNPYmplY3Q6IHRydWUgfSkucGlwZShcbiAgICAgIHRha2UoMSksXG4gICAgICBtYXAoZW50aXRpZXMgPT4ge1xuICAgICAgICBsZXQgcmVzcG9uc2U6IFBhZ2luYXRpb25SZXNwb25zZTxFPiA9IHtcbiAgICAgICAgICAuLi50aGlzLnBhZ2luYXRpb24sXG4gICAgICAgICAgZGF0YTogdGhpcy5wYWdlcy5nZXQocGFnZSkuaWRzLm1hcChpZCA9PiBlbnRpdGllc1tpZF0pXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgeyByYW5nZSwgcGFnZXNDb250cm9scyB9ID0gdGhpcy5jb25maWc7XG5cbiAgICAgICAgLyoqIElmIG5vIHRvdGFsIC0gY2FsYyBpdCAqL1xuICAgICAgICBpZiAoaXNOYU4odGhpcy5wYWdpbmF0aW9uLnRvdGFsKSkge1xuICAgICAgICAgIGlmIChyZXNwb25zZS5sYXN0UGFnZSA9PT0gMSkge1xuICAgICAgICAgICAgcmVzcG9uc2UudG90YWwgPSByZXNwb25zZS5kYXRhID8gcmVzcG9uc2UuZGF0YS5sZW5ndGggOiAwO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXNwb25zZS50b3RhbCA9IHJlc3BvbnNlLnBlclBhZ2UgKiByZXNwb25zZS5sYXN0UGFnZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5wYWdpbmF0aW9uLnRvdGFsID0gcmVzcG9uc2UudG90YWw7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocmFuZ2UpIHtcbiAgICAgICAgICByZXNwb25zZS5mcm9tID0gdGhpcy5nZXRGcm9tKCk7XG4gICAgICAgICAgcmVzcG9uc2UudG8gPSB0aGlzLmdldFRvKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocGFnZXNDb250cm9scykge1xuICAgICAgICAgIHJlc3BvbnNlLnBhZ2VDb250cm9scyA9IGdlbmVyYXRlUGFnZXModGhpcy5wYWdpbmF0aW9uLnRvdGFsLCB0aGlzLnBhZ2luYXRpb24ucGVyUGFnZSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICB9KVxuICAgICk7XG4gIH1cbn1cblxuLyoqXG4gKiBHZW5lcmF0ZSBhbiBhcnJheSBzbyB3ZSBjYW4gbmdGb3IgdGhlbSB0byBuYXZpZ2F0ZSBiZXR3ZWVuIHBhZ2VzXG4gKi9cbmZ1bmN0aW9uIGdlbmVyYXRlUGFnZXModG90YWw6IG51bWJlciwgcGVyUGFnZTogbnVtYmVyKSB7XG4gIGNvbnN0IGxlbiA9IE1hdGguY2VpbCh0b3RhbCAvIHBlclBhZ2UpO1xuICBsZXQgYXJyID0gW107XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICBhcnIucHVzaChpICsgMSk7XG4gIH1cbiAgcmV0dXJuIGFycjtcbn1cblxuLyoqIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgKi9cbmV4cG9ydCBjb25zdCBQYWdpbmF0b3IgPSBQYWdpbmF0b3JQbHVnaW47XG4iLCJpbXBvcnQgeyBBa2l0YVBsdWdpbiB9IGZyb20gJy4uL3BsdWdpbic7XG5pbXBvcnQgeyBRdWVyeSB9IGZyb20gJy4uLy4uL2FwaS9xdWVyeSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRlYm91bmNlVGltZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IF9fZ2xvYmFsU3RhdGUgfSBmcm9tICcuLi8uLi9pbnRlcm5hbC9nbG9iYWwtc3RhdGUnO1xuaW1wb3J0IHsgZ2V0VmFsdWUsIGlzU3RyaW5nLCBzZXRWYWx1ZSwgdG9Cb29sZWFuIH0gZnJvbSAnLi4vLi4vaW50ZXJuYWwvdXRpbHMnO1xuXG5leHBvcnQgdHlwZSBGb3JtR3JvdXBMaWtlID0ge1xuICBwYXRjaFZhbHVlOiBGdW5jdGlvbjtcbiAgc2V0VmFsdWU6IEZ1bmN0aW9uO1xuICB2YWx1ZTogYW55O1xuICBnZXQ6IEZ1bmN0aW9uO1xuICB2YWx1ZUNoYW5nZXM6IE9ic2VydmFibGU8YW55PjtcbiAgY29udHJvbHM6IGFueTtcbn07XG5cbmV4cG9ydCB0eXBlIEFraXRhRm9ybVByb3A8VD4gPSB7XG4gIFtrZXk6IHN0cmluZ106IFQ7XG59O1xuXG5leHBvcnQgdHlwZSBQZXJzaXN0Rm9ybVBhcmFtcyA9IHtcbiAgZGVib3VuY2VUaW1lPzogbnVtYmVyO1xuICBmb3JtS2V5Pzogc3RyaW5nO1xuICBlbWl0RXZlbnQ/OiBib29sZWFuO1xuICBhcnJDb250cm9sRmFjdG9yeT86IEFycmF5Q29udHJvbEZhY3Rvcnk7XG59O1xuXG5leHBvcnQgdHlwZSBBcnJheUNvbnRyb2xGYWN0b3J5ID0gKHZhbHVlOiBhbnkpID0+IGFueTsgLy8gVG9kbzogUmV0dXJuICBBYnN0cmFjdENvbnRyb2wgaW50ZXJmYWNlXG5cbmV4cG9ydCBjbGFzcyBQZXJzaXN0TmdGb3JtUGx1Z2luPFQgPSBhbnk+IGV4dGVuZHMgQWtpdGFQbHVnaW4ge1xuICBmb3JtQ2hhbmdlczogU3Vic2NyaXB0aW9uO1xuICBwcml2YXRlIGlzUm9vdEtleXM6IGJvb2xlYW47XG4gIHByaXZhdGUgZm9ybTogRm9ybUdyb3VwTGlrZTtcbiAgcHJpdmF0ZSBpc0tleUJhc2VkOiBib29sZWFuO1xuICBwcml2YXRlIGluaXRpYWxWYWx1ZTtcbiAgcHJpdmF0ZSBidWlsZGVyO1xuXG4gIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBxdWVyeTogUXVlcnk8YW55PiwgcHJpdmF0ZSBmYWN0b3J5Rm5PclBhdGg/OiBGdW5jdGlvbiB8IHN0cmluZywgcHJpdmF0ZSBwYXJhbXM6IFBlcnNpc3RGb3JtUGFyYW1zID0ge30pIHtcbiAgICBzdXBlcihxdWVyeSk7XG4gICAgdGhpcy5wYXJhbXMgPSB7IC4uLnsgZGVib3VuY2VUaW1lOiAzMDAsIGZvcm1LZXk6ICdha2l0YUZvcm0nLCBlbWl0RXZlbnQ6IGZhbHNlLCBhcnJDb250cm9sRmFjdG9yeTogdiA9PiB0aGlzLmJ1aWxkZXIuY29udHJvbCh2KSB9LCAuLi5wYXJhbXMgfTtcbiAgICB0aGlzLmlzUm9vdEtleXMgPSB0b0Jvb2xlYW4oZmFjdG9yeUZuT3JQYXRoKSA9PT0gZmFsc2U7XG4gICAgdGhpcy5pc0tleUJhc2VkID0gaXNTdHJpbmcoZmFjdG9yeUZuT3JQYXRoKSB8fCB0aGlzLmlzUm9vdEtleXM7XG4gIH1cblxuICBzZXRGb3JtKGZvcm06IEZvcm1Hcm91cExpa2UsIGJ1aWxkZXI/KSB7XG4gICAgdGhpcy5mb3JtID0gZm9ybTtcbiAgICB0aGlzLmJ1aWxkZXIgPSBidWlsZGVyO1xuICAgIHRoaXMuYWN0aXZhdGUoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHJlc2V0KGluaXRpYWxTdGF0ZT86IFQpIHtcbiAgICBsZXQgdmFsdWU7XG4gICAgaWYgKGluaXRpYWxTdGF0ZSkge1xuICAgICAgdmFsdWUgPSBpbml0aWFsU3RhdGU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhbHVlID0gdGhpcy5pc0tleUJhc2VkID8gdGhpcy5pbml0aWFsVmFsdWUgOiAodGhpcyBhcyBhbnkpLmZhY3RvcnlGbk9yUGF0aCgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzS2V5QmFzZWQpIHtcbiAgICAgIE9iamVjdC5rZXlzKHRoaXMuaW5pdGlhbFZhbHVlKS5mb3JFYWNoKHN0YXRlS2V5ID0+IHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmluaXRpYWxWYWx1ZVtzdGF0ZUtleV07XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSAmJiB0aGlzLmJ1aWxkZXIpIHtcbiAgICAgICAgICBjb25zdCBmb3JtQXJyYXkgPSB0aGlzLmZvcm0uY29udHJvbHNbc3RhdGVLZXldO1xuICAgICAgICAgIHRoaXMuY2xlYW5BcnJheShmb3JtQXJyYXkpO1xuICAgICAgICAgIHZhbHVlLmZvckVhY2goKHYsIGkpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZm9ybS5nZXQoc3RhdGVLZXkpLmluc2VydChpLCAodGhpcy5wYXJhbXMuYXJyQ29udHJvbEZhY3RvcnkgYXMgRnVuY3Rpb24pKHYpKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMuZm9ybS5wYXRjaFZhbHVlKHZhbHVlLCB7IGVtaXRFdmVudDogdGhpcy5wYXJhbXMuZW1pdEV2ZW50IH0pO1xuXG4gICAgY29uc3Qgc3RvcmVWYWx1ZSA9IHRoaXMuaXNLZXlCYXNlZCA/IHNldFZhbHVlKHRoaXMuZ2V0UXVlcnkoKS5nZXRTbmFwc2hvdCgpLCBgJHt0aGlzLmdldFN0b3JlKCkuc3RvcmVOYW1lfS4ke3RoaXMuZmFjdG9yeUZuT3JQYXRofWAsIHZhbHVlKSA6IHsgW3RoaXMucGFyYW1zLmZvcm1LZXldOiB2YWx1ZSB9O1xuICAgIHRoaXMudXBkYXRlU3RvcmUoc3RvcmVWYWx1ZSk7XG4gIH1cblxuICBwcml2YXRlIGNsZWFuQXJyYXkoY29udHJvbCkge1xuICAgIHdoaWxlIChjb250cm9sLmxlbmd0aCAhPT0gMCkge1xuICAgICAgY29udHJvbC5yZW1vdmVBdCgwKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlc29sdmVJbml0aWFsVmFsdWUoZm9ybVZhbHVlLCByb290KSB7XG4gICAgaWYgKCFmb3JtVmFsdWUpIHJldHVybjtcbiAgICByZXR1cm4gT2JqZWN0LmtleXMoZm9ybVZhbHVlKS5yZWR1Y2UoKGFjYywgc3RhdGVLZXkpID0+IHtcbiAgICAgIGNvbnN0IHZhbHVlID0gcm9vdFtzdGF0ZUtleV07XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkgJiYgdGhpcy5idWlsZGVyKSB7XG4gICAgICAgIGNvbnN0IGZhY3RvcnkgPSB0aGlzLnBhcmFtcy5hcnJDb250cm9sRmFjdG9yeTtcbiAgICAgICAgdGhpcy5jbGVhbkFycmF5KHRoaXMuZm9ybS5nZXQoc3RhdGVLZXkpKTtcbiAgICAgICAgdmFsdWUuZm9yRWFjaCgodiwgaSkgPT4ge1xuICAgICAgICAgIHRoaXMuZm9ybS5nZXQoc3RhdGVLZXkpLmluc2VydChpLCAoZmFjdG9yeSBhcyBGdW5jdGlvbikodikpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGFjY1tzdGF0ZUtleV0gPSByb290W3N0YXRlS2V5XTtcbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwge30pO1xuICB9XG5cbiAgcHJpdmF0ZSBhY3RpdmF0ZSgpIHtcbiAgICBsZXQgcGF0aDtcblxuICAgIGlmICh0aGlzLmlzS2V5QmFzZWQpIHtcbiAgICAgIGlmICh0aGlzLmlzUm9vdEtleXMpIHtcbiAgICAgICAgdGhpcy5pbml0aWFsVmFsdWUgPSB0aGlzLnJlc29sdmVJbml0aWFsVmFsdWUodGhpcy5mb3JtLnZhbHVlLCB0aGlzLmdldFF1ZXJ5KCkuZ2V0U25hcHNob3QoKSk7XG4gICAgICAgIHRoaXMuZm9ybS5wYXRjaFZhbHVlKHRoaXMuaW5pdGlhbFZhbHVlLCB7IGVtaXRFdmVudDogdGhpcy5wYXJhbXMuZW1pdEV2ZW50IH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcGF0aCA9IGAke3RoaXMuZ2V0U3RvcmUoKS5zdG9yZU5hbWV9LiR7dGhpcy5mYWN0b3J5Rm5PclBhdGh9YDtcbiAgICAgICAgY29uc3Qgcm9vdCA9IGdldFZhbHVlKHRoaXMuZ2V0UXVlcnkoKS5nZXRTbmFwc2hvdCgpLCBwYXRoKTtcbiAgICAgICAgdGhpcy5pbml0aWFsVmFsdWUgPSB0aGlzLnJlc29sdmVJbml0aWFsVmFsdWUocm9vdCwgcm9vdCk7XG4gICAgICAgIHRoaXMuZm9ybS5wYXRjaFZhbHVlKHRoaXMuaW5pdGlhbFZhbHVlLCB7IGVtaXRFdmVudDogdGhpcy5wYXJhbXMuZW1pdEV2ZW50IH0pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoISh0aGlzLmdldFF1ZXJ5KCkuZ2V0U25hcHNob3QoKSBhcyBBa2l0YUZvcm1Qcm9wPFQ+KVt0aGlzLnBhcmFtcy5mb3JtS2V5XSkge1xuICAgICAgICBfX2dsb2JhbFN0YXRlLnNldEFjdGlvbih7IHR5cGU6ICdAUGVyc2lzdE5nRm9ybVBsdWdpbiBhY3RpdmF0ZScgfSk7XG4gICAgICAgIHRoaXMudXBkYXRlU3RvcmUoeyBbdGhpcy5wYXJhbXMuZm9ybUtleV06ICh0aGlzIGFzIGFueSkuZmFjdG9yeUZuT3JQYXRoKCkgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5nZXRRdWVyeSgpLmdldFNuYXBzaG90KClbdGhpcy5wYXJhbXMuZm9ybUtleV07XG4gICAgICB0aGlzLmZvcm0ucGF0Y2hWYWx1ZSh2YWx1ZSk7XG4gICAgfVxuXG4gICAgdGhpcy5mb3JtQ2hhbmdlcyA9IHRoaXMuZm9ybS52YWx1ZUNoYW5nZXMucGlwZShkZWJvdW5jZVRpbWUodGhpcy5wYXJhbXMuZGVib3VuY2VUaW1lKSkuc3Vic2NyaWJlKHZhbHVlID0+IHtcbiAgICAgIF9fZ2xvYmFsU3RhdGUuc2V0QWN0aW9uKHsgdHlwZTogJ0BQZXJzaXN0Rm9ybSAtIFVwZGF0ZScgfSk7XG4gICAgICBsZXQgbmV3U3RhdGU7XG4gICAgICBpZiAodGhpcy5pc0tleUJhc2VkKSB7XG4gICAgICAgIGlmICh0aGlzLmlzUm9vdEtleXMpIHtcbiAgICAgICAgICBuZXdTdGF0ZSA9IHN0YXRlID0+ICh7IC4uLnN0YXRlLCAuLi52YWx1ZSB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBuZXdTdGF0ZSA9IHN0YXRlID0+IHNldFZhbHVlKHN0YXRlLCBwYXRoLCB2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5ld1N0YXRlID0gKCkgPT4gKHsgW3RoaXMucGFyYW1zLmZvcm1LZXldOiB2YWx1ZSB9KTtcbiAgICAgIH1cbiAgICAgIHRoaXMudXBkYXRlU3RvcmUobmV3U3RhdGUodGhpcy5nZXRRdWVyeSgpLmdldFNuYXBzaG90KCkpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGRlc3Ryb3koKSB7XG4gICAgdGhpcy5mb3JtQ2hhbmdlcyAmJiB0aGlzLmZvcm1DaGFuZ2VzLnVuc3Vic2NyaWJlKCk7XG4gICAgdGhpcy5mb3JtID0gbnVsbDtcbiAgICB0aGlzLmJ1aWxkZXIgPSBudWxsO1xuICB9XG59XG4iLCJpbXBvcnQgeyBBa2l0YUVycm9yIH0gZnJvbSAnLi4vaW50ZXJuYWwvZXJyb3InO1xuaW1wb3J0IHsgX19zdG9yZXNfXywgQWN0aW9ucywgcm9vdERpc3BhdGNoZXIgfSBmcm9tICcuLi9hcGkvc3RvcmUnO1xuaW1wb3J0IHsgc2tpcCwgZmlsdGVyIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgZ2V0VmFsdWUsIHNldFZhbHVlIH0gZnJvbSAnLi4vaW50ZXJuYWwvdXRpbHMnO1xuaW1wb3J0IHsgX19nbG9iYWxTdGF0ZSB9IGZyb20gJy4uL2ludGVybmFsL2dsb2JhbC1zdGF0ZSc7XG5cbmNvbnN0IG5vdEJzID0gdHlwZW9mIGxvY2FsU3RvcmFnZSA9PT0gJ3VuZGVmaW5lZCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGVyc2lzdFN0YXRlUGFyYW1zIHtcbiAgLyoqIFRoZSBzdG9yYWdlIGtleSAqL1xuICBrZXk6IHN0cmluZztcbiAgLyoqIFN0b3JhZ2Ugc3RyYXRlZ3kgdG8gdXNlLiBUaGlzIGRlZmF1bHRzIHRvIExvY2FsU3RvcmFnZSBidXQgeW91IGNhbiBwYXNzIFNlc3Npb25TdG9yYWdlIG9yIGFueXRoaW5nIHRoYXQgaW1wbGVtZW50cyB0aGUgU3RvcmFnZUVuZ2luZSBBUEkuICovXG4gIHN0b3JhZ2U6IFN0b3JhZ2U7XG4gIC8qKiBDdXN0b20gZGVzZXJpYWxpemVyLiBEZWZhdWx0cyB0byBKU09OLnBhcnNlICovXG4gIGRlc2VyaWFsaXplOiBGdW5jdGlvbjtcbiAgLyoqIEN1c3RvbSBzZXJpYWxpemVyLCBkZWZhdWx0cyB0byBKU09OLnN0cmluZ2lmeSAqL1xuICBzZXJpYWxpemU6IEZ1bmN0aW9uO1xuICAvKipcbiAgICogQnkgZGVmYXVsdCB0aGUgd2hvbGUgc3RhdGUgaXMgc2F2ZWQgdG8gc3RvcmFnZSwgdXNlIHRoaXMgcGFyYW0gdG8gaW5jbHVkZSBvbmx5IHRoZSBzdG9yZXMgeW91IG5lZWQuXG4gICAqIFBheSBhdHRlbnRpb24gdGhhdCB5b3UgY2FuJ3QgdXNlIGJvdGggaW5jbHVkZSBhbmQgZXhjbHVkZVxuICAgKi9cbiAgaW5jbHVkZTogc3RyaW5nW107XG4gIC8qKlxuICAgKiAgQnkgZGVmYXVsdCB0aGUgd2hvbGUgc3RhdGUgaXMgc2F2ZWQgdG8gc3RvcmFnZSwgdXNlIHRoaXMgcGFyYW0gdG8gZXhjbHVkZSBzdG9yZXMgdGhhdCB5b3UgZG9uJ3QgbmVlZC5cbiAgICogIFBheSBhdHRlbnRpb24gdGhhdCB5b3UgY2FuJ3QgdXNlIGJvdGggaW5jbHVkZSBhbmQgZXhjbHVkZVxuICAgKi9cbiAgZXhjbHVkZTogc3RyaW5nW107XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwZXJzaXN0U3RhdGUocGFyYW1zPzogUGFydGlhbDxQZXJzaXN0U3RhdGVQYXJhbXM+KSB7XG4gIGlmIChub3RCcykgcmV0dXJuO1xuXG4gIGNvbnN0IGRlZmF1bHRzOiBQZXJzaXN0U3RhdGVQYXJhbXMgPSB7XG4gICAga2V5OiAnQWtpdGFTdG9yZXMnLFxuICAgIHN0b3JhZ2U6IGxvY2FsU3RvcmFnZSxcbiAgICBkZXNlcmlhbGl6ZTogSlNPTi5wYXJzZSxcbiAgICBzZXJpYWxpemU6IEpTT04uc3RyaW5naWZ5LFxuICAgIGluY2x1ZGU6IFtdLFxuICAgIGV4Y2x1ZGU6IFtdXG4gIH07XG4gIGNvbnN0IHsgc3RvcmFnZSwgZGVzZXJpYWxpemUsIHNlcmlhbGl6ZSwgaW5jbHVkZSwgZXhjbHVkZSwga2V5IH0gPSBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0cywgcGFyYW1zKTtcblxuICBjb25zdCBoYXNJbmNsdWRlID0gaW5jbHVkZS5sZW5ndGggPiAwO1xuICBjb25zdCBoYXNFeGNsdWRlID0gZXhjbHVkZS5sZW5ndGggPiAwO1xuICBsZXQgaW5jbHVkZVN0b3JlcztcblxuICBpZiAoaGFzSW5jbHVkZSAmJiBoYXNFeGNsdWRlKSB7XG4gICAgdGhyb3cgbmV3IEFraXRhRXJyb3IoXCJZb3UgY2FuJ3QgdXNlIGJvdGggaW5jbHVkZSBhbmQgZXhjbHVkZVwiKTtcbiAgfVxuXG4gIGlmIChoYXNJbmNsdWRlKSB7XG4gICAgaW5jbHVkZVN0b3JlcyA9IGluY2x1ZGUucmVkdWNlKChhY2MsIHBhdGgpID0+IHtcbiAgICAgIGNvbnN0IHN0b3JlTmFtZSA9IHBhdGguc3BsaXQoJy4nKVswXTtcbiAgICAgIGFjY1tzdG9yZU5hbWVdID0gcGF0aDtcbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwge30pO1xuICB9XG5cbiAgY29uc3Qgc3RvcmFnZVN0YXRlID0gZGVzZXJpYWxpemUoc3RvcmFnZS5nZXRJdGVtKGtleSkgfHwgJ3t9Jyk7XG5cbiAgbGV0IHN0b3JlcyA9IHt9O1xuICBsZXQgYWNjID0ge307XG5cbiAgZnVuY3Rpb24gc2F2ZSgpIHtcbiAgICBzdG9yYWdlLnNldEl0ZW0oa2V5LCBzZXJpYWxpemUoT2JqZWN0LmFzc2lnbih7fSwgc3RvcmFnZVN0YXRlLCBhY2MpKSk7XG4gIH1cblxuICBmdW5jdGlvbiBzdWJzY3JpYmUoc3RvcmVOYW1lLCBwYXRoKSB7XG4gICAgc3RvcmVzW3N0b3JlTmFtZV0gPSBfX3N0b3Jlc19fW3N0b3JlTmFtZV1cbiAgICAgIC5fc2VsZWN0KHN0YXRlID0+IGdldFZhbHVlKHN0YXRlLCBwYXRoKSlcbiAgICAgIC5waXBlKHNraXAoMSkpXG4gICAgICAuc3Vic2NyaWJlKGRhdGEgPT4ge1xuICAgICAgICBhY2Nbc3RvcmVOYW1lXSA9IGRhdGE7XG4gICAgICAgIHNhdmUoKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gc2V0SW5pdGlhbChzdG9yZU5hbWUsIHN0b3JlLCBwYXRoKSB7XG4gICAgaWYgKHN0b3JhZ2VTdGF0ZVtzdG9yZU5hbWVdKSB7XG4gICAgICBfX2dsb2JhbFN0YXRlLnNldEFjdGlvbih7IHR5cGU6ICdAUGVyc2lzdFN0YXRlJyB9KTtcbiAgICAgIHN0b3JlLnNldFN0YXRlKHN0YXRlID0+IHtcbiAgICAgICAgcmV0dXJuIHNldFZhbHVlKHN0YXRlLCBwYXRoLCBzdG9yYWdlU3RhdGVbc3RvcmVOYW1lXSk7XG4gICAgICB9KTtcbiAgICAgIGlmIChzdG9yZS5zZXREaXJ0eSkge1xuICAgICAgICBzdG9yZS5zZXREaXJ0eSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHN1YnNjcmlwdGlvbiA9IHJvb3REaXNwYXRjaGVyLnBpcGUoZmlsdGVyKGFjdGlvbiA9PiBhY3Rpb24udHlwZSA9PT0gQWN0aW9ucy5ORVdfU1RPUkUpKS5zdWJzY3JpYmUoYWN0aW9uID0+IHtcbiAgICBsZXQgY3VycmVudFN0b3JlTmFtZSA9IGFjdGlvbi5wYXlsb2FkLnN0b3JlLnN0b3JlTmFtZTtcblxuICAgIGlmIChoYXNFeGNsdWRlICYmIGV4Y2x1ZGUuaW5jbHVkZXMoY3VycmVudFN0b3JlTmFtZSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoaGFzSW5jbHVkZSkge1xuICAgICAgY29uc3QgcGF0aCA9IGluY2x1ZGVTdG9yZXNbY3VycmVudFN0b3JlTmFtZV07XG4gICAgICBpZiAoIXBhdGgpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgc2V0SW5pdGlhbChjdXJyZW50U3RvcmVOYW1lLCBhY3Rpb24ucGF5bG9hZC5zdG9yZSwgcGF0aCk7XG4gICAgICBzdWJzY3JpYmUoY3VycmVudFN0b3JlTmFtZSwgcGF0aCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNldEluaXRpYWwoY3VycmVudFN0b3JlTmFtZSwgYWN0aW9uLnBheWxvYWQuc3RvcmUsIGN1cnJlbnRTdG9yZU5hbWUpO1xuICAgICAgc3Vic2NyaWJlKGN1cnJlbnRTdG9yZU5hbWUsIGN1cnJlbnRTdG9yZU5hbWUpO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIHtcbiAgICBkZXN0cm95KCkge1xuICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICBmb3IgKGxldCBpID0gMCwga2V5cyA9IE9iamVjdC5rZXlzKHN0b3Jlcyk7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHN0b3JlTmFtZSA9IGtleXNbaV07XG4gICAgICAgIHN0b3Jlc1tzdG9yZU5hbWVdLnVuc3Vic2NyaWJlKCk7XG4gICAgICB9XG4gICAgICBzdG9yZXMgPSB7fTtcbiAgICB9LFxuICAgIGNsZWFyKCkge1xuICAgICAgc3RvcmFnZS5jbGVhcigpO1xuICAgIH0sXG4gICAgY2xlYXJTdG9yZShzdG9yZU5hbWU6IHN0cmluZykge1xuICAgICAgY29uc3Qgc3RvcmFnZVN0YXRlID0gZGVzZXJpYWxpemUoc3RvcmFnZS5nZXRJdGVtKGtleSkgfHwgJ3t9Jyk7XG5cbiAgICAgIGlmIChzdG9yYWdlU3RhdGVbc3RvcmVOYW1lXSkge1xuICAgICAgICBkZWxldGUgc3RvcmFnZVN0YXRlW3N0b3JlTmFtZV07XG4gICAgICAgIHN0b3JhZ2Uuc2V0SXRlbShrZXksIHNlcmlhbGl6ZShzdG9yYWdlU3RhdGUpKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG59XG4iLCJpbXBvcnQgeyBfX3N0b3Jlc19fLCBBY3Rpb25zLCByb290RGlzcGF0Y2hlciB9IGZyb20gJy4uL2FwaS9zdG9yZSc7XG5pbXBvcnQgeyBfX2dsb2JhbFN0YXRlIH0gZnJvbSAnLi4vaW50ZXJuYWwvZ2xvYmFsLXN0YXRlJztcbmltcG9ydCB7IGlzRGVmaW5lZCB9IGZyb20gJy4uL2ludGVybmFsL3V0aWxzJztcblxuZXhwb3J0IHR5cGUgRGV2dG9vbHNPcHRpb25zID0ge1xuICAvKiogIG1heGltdW0gYWxsb3dlZCBhY3Rpb25zIHRvIGJlIHN0b3JlZCBpbiB0aGUgaGlzdG9yeSB0cmVlICovXG4gIG1heEFnZTogbnVtYmVyO1xuICBsYXRlbmN5OiBudW1iZXI7XG4gIGFjdGlvbnNCbGFja2xpc3Q6IHN0cmluZ1tdO1xuICBhY3Rpb25zV2hpdGVsaXN0OiBzdHJpbmdbXTtcbiAgc2hvdWxkQ2F0Y2hFcnJvcnM6IGJvb2xlYW47XG4gIGxvZ1RyYWNlOiBib29sZWFuO1xuICBwcmVkaWNhdGU6IChzdGF0ZTogYW55LCBhY3Rpb246IGFueSkgPT4gYm9vbGVhbjtcbn07XG5sZXQgcm9vdERpc3BhdGNoZXJTdWIsIGRldnRvb2xzU3ViO1xuXG5leHBvcnQgdHlwZSBOZ1pvbmVMaWtlID0geyBydW46IGFueSB9O1xuXG5leHBvcnQgZnVuY3Rpb24gYWtpdGFEZXZ0b29scyhuZ1pvbmU6IE5nWm9uZUxpa2UsIG9wdGlvbnM/OiBQYXJ0aWFsPERldnRvb2xzT3B0aW9ucz4pO1xuZXhwb3J0IGZ1bmN0aW9uIGFraXRhRGV2dG9vbHMob3B0aW9ucz86IFBhcnRpYWw8RGV2dG9vbHNPcHRpb25zPik7XG5leHBvcnQgZnVuY3Rpb24gYWtpdGFEZXZ0b29scyhuZ1pvbmVPck9wdGlvbnM/OiBOZ1pvbmVMaWtlIHwgUGFydGlhbDxEZXZ0b29sc09wdGlvbnM+LCBvcHRpb25zOiBQYXJ0aWFsPERldnRvb2xzT3B0aW9ucz4gPSB7fSkge1xuICBpZiAoISh3aW5kb3cgYXMgYW55KS5fX1JFRFVYX0RFVlRPT0xTX0VYVEVOU0lPTl9fKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgcm9vdERpc3BhdGNoZXJTdWIgJiYgcm9vdERpc3BhdGNoZXJTdWIudW5zdWJzY3JpYmUoKTtcbiAgZGV2dG9vbHNTdWIgJiYgZGV2dG9vbHNTdWIoKTtcblxuICBjb25zdCBpc0FuZ3VsYXIgPSBuZ1pvbmVPck9wdGlvbnMgJiYgbmdab25lT3JPcHRpb25zWydydW4nXTtcblxuICBpZiAoIWlzQW5ndWxhcikge1xuICAgIG5nWm9uZU9yT3B0aW9ucyA9IG5nWm9uZU9yT3B0aW9ucyB8fCB7fTtcbiAgICAobmdab25lT3JPcHRpb25zIGFzIGFueSkucnVuID0gY2IgPT4gY2IoKTtcbiAgICBvcHRpb25zID0gbmdab25lT3JPcHRpb25zIGFzIFBhcnRpYWw8RGV2dG9vbHNPcHRpb25zPjtcbiAgfVxuXG4gIGNvbnN0IGRlZmF1bHRPcHRpb25zOiBQYXJ0aWFsPERldnRvb2xzT3B0aW9ucz4gJiB7IG5hbWU6IHN0cmluZyB9ID0geyBuYW1lOiAnQWtpdGEnIH07XG4gIGNvbnN0IG1lcmdlZCA9IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcblxuICBjb25zdCBkZXZUb29scyA9ICh3aW5kb3cgYXMgYW55KS5fX1JFRFVYX0RFVlRPT0xTX0VYVEVOU0lPTl9fLmNvbm5lY3QobWVyZ2VkKTtcbiAgbGV0IGFwcFN0YXRlID0ge307XG5cbiAgcm9vdERpc3BhdGNoZXJTdWIgPSByb290RGlzcGF0Y2hlci5zdWJzY3JpYmUoYWN0aW9uID0+IHtcbiAgICBpZiAoYWN0aW9uLnR5cGUgPT09IEFjdGlvbnMuREVMRVRFX1NUT1JFKSB7XG4gICAgICBjb25zdCBzdG9yZU5hbWUgPSBhY3Rpb24ucGF5bG9hZC5zdG9yZU5hbWU7XG4gICAgICBkZWxldGUgYXBwU3RhdGVbc3RvcmVOYW1lXTtcbiAgICAgIGRldlRvb2xzLnNlbmQoeyB0eXBlOiBgWyR7c3RvcmVOYW1lfV0gLSBEZWxldGUgU3RvcmVgIH0sIGFwcFN0YXRlKTtcbiAgICB9XG5cbiAgICBpZiAoYWN0aW9uLnR5cGUgPT09IEFjdGlvbnMuTkVXX1NUQVRFKSB7XG4gICAgICBpZiAoX19nbG9iYWxTdGF0ZS5za2lwQWN0aW9uKSB7XG4gICAgICAgIF9fZ2xvYmFsU3RhdGUuc2V0U2tpcEFjdGlvbihmYWxzZSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgYXBwU3RhdGUgPSB7XG4gICAgICAgIC4uLmFwcFN0YXRlLFxuICAgICAgICBbYWN0aW9uLnBheWxvYWQubmFtZV06IF9fc3RvcmVzX19bYWN0aW9uLnBheWxvYWQubmFtZV0uX3ZhbHVlKClcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHsgdHlwZSwgZW50aXR5SWQgfSA9IF9fZ2xvYmFsU3RhdGUuY3VycmVudEFjdGlvbjtcbiAgICAgIGNvbnN0IHN0b3JlTmFtZSA9IGNhcGl0YWxpemUoYWN0aW9uLnBheWxvYWQubmFtZSk7XG4gICAgICBsZXQgbXNnID0gaXNEZWZpbmVkKGVudGl0eUlkKSA/IGBbJHtzdG9yZU5hbWV9XSAtICR7dHlwZX0gKGlkczogJHtlbnRpdHlJZH0pYCA6IGBbJHtzdG9yZU5hbWV9XSAtICR7dHlwZX1gO1xuXG4gICAgICBpZiAob3B0aW9ucy5sb2dUcmFjZSkge1xuICAgICAgICBjb25zb2xlLmdyb3VwKG1zZyk7XG4gICAgICAgIGNvbnNvbGUudHJhY2UoKTtcbiAgICAgICAgY29uc29sZS5ncm91cEVuZCgpO1xuICAgICAgfVxuXG4gICAgICBkZXZUb29scy5zZW5kKHsgdHlwZTogbXNnLCB0cmFuc2FjdGlvbjogX19nbG9iYWxTdGF0ZS5jdXJyZW50VC5tYXAodCA9PiB0LnR5cGUpIH0sIGFwcFN0YXRlKTtcbiAgICB9XG4gIH0pO1xuXG4gIGRldnRvb2xzU3ViID0gZGV2VG9vbHMuc3Vic2NyaWJlKG1lc3NhZ2UgPT4ge1xuICAgIGlmIChtZXNzYWdlLnR5cGUgPT09ICdBQ1RJT04nKSB7XG4gICAgICBjb25zdCBbc3RvcmVOYW1lXSA9IG1lc3NhZ2UucGF5bG9hZC5zcGxpdCgnLicpO1xuXG4gICAgICBpZiAoX19zdG9yZXNfX1tzdG9yZU5hbWVdKSB7XG4gICAgICAgIChuZ1pvbmVPck9wdGlvbnMgYXMgTmdab25lTGlrZSkucnVuKCgpID0+IHtcbiAgICAgICAgICBjb25zdCBmdW5jQ2FsbCA9IG1lc3NhZ2UucGF5bG9hZC5yZXBsYWNlKHN0b3JlTmFtZSwgYHRoaXNbJyR7c3RvcmVOYW1lfSddYCk7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG5ldyBGdW5jdGlvbihgJHtmdW5jQ2FsbH1gKS5jYWxsKF9fc3RvcmVzX18pO1xuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignVW5rbm93biBNZXRob2Qgw6LCmMK5w6/CuMKPJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAobWVzc2FnZS50eXBlID09PSAnRElTUEFUQ0gnKSB7XG4gICAgICBjb25zdCBwYXlsb2FkVHlwZSA9IG1lc3NhZ2UucGF5bG9hZC50eXBlO1xuXG4gICAgICBpZiAocGF5bG9hZFR5cGUgPT09ICdDT01NSVQnKSB7XG4gICAgICAgIGRldlRvb2xzLmluaXQoYXBwU3RhdGUpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChtZXNzYWdlLnN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHJvb3RTdGF0ZSA9IEpTT04ucGFyc2UobWVzc2FnZS5zdGF0ZSk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwLCBrZXlzID0gT2JqZWN0LmtleXMocm9vdFN0YXRlKTsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBjb25zdCBzdG9yZU5hbWUgPSBrZXlzW2ldO1xuICAgICAgICAgIGlmIChfX3N0b3Jlc19fW3N0b3JlTmFtZV0pIHtcbiAgICAgICAgICAgIChuZ1pvbmVPck9wdGlvbnMgYXMgTmdab25lTGlrZSkucnVuKCgpID0+IHtcbiAgICAgICAgICAgICAgX19zdG9yZXNfX1tzdG9yZU5hbWVdLnNldFN0YXRlKCgpID0+IHJvb3RTdGF0ZVtzdG9yZU5hbWVdLCBmYWxzZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBjYXBpdGFsaXplKHN0cmluZykge1xuICByZXR1cm4gc3RyaW5nICYmIHN0cmluZy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHN0cmluZy5zbGljZSgxKTtcbn1cbiIsImltcG9ydCB7Y29lcmNlQXJyYXksIGlzRnVuY3Rpb24sIGlzVW5kZWZpbmVkLCB0b0Jvb2xlYW59IGZyb20gJy4uL2ludGVybmFsL3V0aWxzJztcbmltcG9ydCB7UXVlcnlFbnRpdHl9IGZyb20gJy4uL2FwaS9xdWVyeS1lbnRpdHknO1xuaW1wb3J0IHtJRCwgSURTfSBmcm9tICcuLi9hcGkvdHlwZXMnO1xuaW1wb3J0IHtPYnNlcnZhYmxlfSBmcm9tICdyeGpzJztcblxuLyoqXG4gKiBFYWNoIHBsdWdpbiB0aGF0IHdhbnRzIHRvIGFkZCBzdXBwb3J0IGZvciBlbnRpdGllcyBzaG91bGQgZXh0ZW5kIHRoaXMgaW50ZXJmYWNlLlxuICovXG5leHBvcnQgdHlwZSBFbnRpdHlQYXJhbSA9IElEO1xuXG5leHBvcnQgdHlwZSBFbnRpdHlDb2xsZWN0aW9uUGFyYW1zID0gSUQgfCBJRFtdO1xuXG5leHBvcnQgdHlwZSBSZWJhc2VBY3Rpb25zPFAgPSBhbnk+ID0geyBiZWZvcmVSZW1vdmU/OiBGdW5jdGlvbjsgYmVmb3JlQWRkPzogRnVuY3Rpb247IGFmdGVyQWRkPzogKHBsdWdpbjogUCkgPT4gYW55OyB9O1xuXG5jb25zdCBkZWZhdWx0QWN0aW9uczogUmViYXNlQWN0aW9ucyA9IHtiZWZvcmVSZW1vdmU6IHBsdWdpbiA9PiBwbHVnaW4uZGVzdHJveSgpfTtcblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEVudGl0eUNvbGxlY3Rpb25QbHVnaW48RSwgUD4ge1xuICBwcm90ZWN0ZWQgZW50aXRpZXMgPSBuZXcgTWFwPElELCBQPigpO1xuXG4gIHByb3RlY3RlZCBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgcXVlcnk6IFF1ZXJ5RW50aXR5PGFueSwgRT4sIHByaXZhdGUgZW50aXR5SWRzOiBFbnRpdHlDb2xsZWN0aW9uUGFyYW1zKSB7fVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGVudGl0eSBwbHVnaW4gaW5zdGFuY2UuXG4gICAqL1xuICBwcm90ZWN0ZWQgZ2V0RW50aXR5KGlkOiBJRCk6IFAge1xuICAgIHJldHVybiB0aGlzLmVudGl0aWVzLmdldChpZCk7XG4gIH1cblxuICAvKipcbiAgICogV2hldGhlciB0aGUgZW50aXR5IHBsdWdpbiBleGlzdC5cbiAgICovXG4gIHByb3RlY3RlZCBoYXNFbnRpdHkoaWQ6IElEKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZW50aXRpZXMuaGFzKGlkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgdGhlIGVudGl0eSBwbHVnaW4gaW5zdGFuY2UuXG4gICAqL1xuICBwcm90ZWN0ZWQgcmVtb3ZlRW50aXR5KGlkOiBJRCkge1xuICAgIHJldHVybiB0aGlzLmVudGl0aWVzLmRlbGV0ZShpZCk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBlbnRpdHkgcGx1Z2luIGluc3RhbmNlLlxuICAgKi9cbiAgcHJvdGVjdGVkIGNyZWF0ZUVudGl0eShpZDogSUQsIHBsdWdpbjogUCkge1xuICAgIHJldHVybiB0aGlzLmVudGl0aWVzLnNldChpZCwgcGx1Z2luKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJZiB0aGUgdXNlciBwYXNzZXMgYGVudGl0eUlkc2Agd2UgdGFrZSB0aGVtOyBvdGhlcndpc2UsIHdlIHRha2UgYWxsLlxuICAgKi9cbiAgcHJvdGVjdGVkIGdldElkcygpOiBJRFtdIHtcbiAgICByZXR1cm4gaXNVbmRlZmluZWQodGhpcy5lbnRpdHlJZHMpID8gdGhpcy5xdWVyeS5nZXRTbmFwc2hvdCgpLmlkcyA6IGNvZXJjZUFycmF5KHRoaXMuZW50aXR5SWRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaGVuIHlvdSBjYWxsIG9uZSBvZiB0aGUgcGx1Z2luIG1ldGhvZHMsIHlvdSBjYW4gcGFzcyBpZC9pZHMgb3IgdW5kZWZpbmVkIHdoaWNoIG1lYW5zIGFsbC5cbiAgICovXG4gIHByb3RlY3RlZCByZXNvbHZlZElkcyhpZHM/KTogSURbXSB7XG4gICAgcmV0dXJuIGlzVW5kZWZpbmVkKGlkcykgPyB0aGlzLmdldElkcygpIDogY29lcmNlQXJyYXkoaWRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxsIHRoaXMgbWV0aG9kIHdoZW4geW91IHdhbnQgdG8gYWN0aXZhdGUgdGhlIHBsdWdpbiBvbiBpbml0IG9yIHdoZW4geW91IG5lZWQgdG8gbGlzdGVuIHRvIGFkZC9yZW1vdmUgb2YgZW50aXRpZXMgZHluYW1pY2FsbHkuXG4gICAqXG4gICAqIEZvciBleGFtcGxlIGluIHlvdXIgcGx1Z2luIHlvdSBtYXkgZG8gdGhlIGZvbGxvd2luZzpcbiAgICpcbiAgICogdGhpcy5xdWVyeS5zZWxlY3Qoc3RhdGUgPT4gc3RhdGUuaWRzKS5waXBlKHNraXAoMSkpLnN1YnNjcmliZShpZHMgPT4gdGhpcy5hY3RpdmF0ZShpZHMpKTtcbiAgICovXG4gIHByb3RlY3RlZCByZWJhc2UoaWRzOiBJRFtdLCBhY3Rpb25zOiBSZWJhc2VBY3Rpb25zPFA+ID0gZGVmYXVsdEFjdGlvbnMpIHtcbiAgICAvKipcbiAgICAgKlxuICAgICAqIElmIHRoZSB1c2VyIHBhc3NlcyBgZW50aXR5SWRzYCAmIHdlIGhhdmUgbmV3IGlkcyBjaGVjayBpZiB3ZSBuZWVkIHRvIGFkZC9yZW1vdmUgaW5zdGFuY2VzLlxuICAgICAqXG4gICAgICogVGhpcyBwaGFzZSB3aWxsIGJlIGNhbGxlZCBvbmx5IHVwb24gdXBkYXRlLlxuICAgICAqL1xuICAgIGlmICh0b0Jvb2xlYW4oaWRzKSkge1xuICAgICAgLyoqXG4gICAgICAgKiBXaGljaCBtZWFucyBhbGxcbiAgICAgICAqL1xuICAgICAgaWYgKGlzVW5kZWZpbmVkKHRoaXMuZW50aXR5SWRzKSkge1xuICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gaWRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgY29uc3QgZW50aXR5SWQgPSBpZHNbaV07XG4gICAgICAgICAgaWYgKHRoaXMuaGFzRW50aXR5KGVudGl0eUlkKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGlzRnVuY3Rpb24oYWN0aW9ucy5iZWZvcmVBZGQpICYmIGFjdGlvbnMuYmVmb3JlQWRkKGVudGl0eUlkKTtcbiAgICAgICAgICAgIGNvbnN0IHBsdWdpbiA9IHRoaXMuaW5zdGFudGlhdGVQbHVnaW4oZW50aXR5SWQpO1xuICAgICAgICAgICAgdGhpcy5lbnRpdGllcy5zZXQoZW50aXR5SWQsIHBsdWdpbik7XG4gICAgICAgICAgICBpc0Z1bmN0aW9uKGFjdGlvbnMuYWZ0ZXJBZGQpICYmIGFjdGlvbnMuYWZ0ZXJBZGQocGx1Z2luKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmVudGl0aWVzLmZvckVhY2goKHBsdWdpbiwgZW50aXR5SWQpID0+IHtcbiAgICAgICAgICBpZiAoaWRzLmluZGV4T2YoZW50aXR5SWQpID09PSAtMSkge1xuICAgICAgICAgICAgaXNGdW5jdGlvbihhY3Rpb25zLmJlZm9yZVJlbW92ZSkgJiYgYWN0aW9ucy5iZWZvcmVSZW1vdmUocGx1Z2luKTtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlRW50aXR5KGVudGl0eUlkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoaWNoIG1lYW5zIHRoZSB1c2VyIHBhc3NlcyBzcGVjaWZpYyBpZHNcbiAgICAgICAgICovXG4gICAgICAgIGNvbnN0IF9pZHMgPSBjb2VyY2VBcnJheSh0aGlzLmVudGl0eUlkcyk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBfaWRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgY29uc3QgZW50aXR5SWQgPSBfaWRzW2ldO1xuICAgICAgICAgIC8qKiBUaGUgRW50aXR5IGluIGN1cnJlbnQgaWRzIGFuZCBkb2Vzbid0IGV4aXN0LCBhZGQgaXQuICovXG4gICAgICAgICAgaWYgKGlkcy5pbmRleE9mKGVudGl0eUlkKSA+IC0xICYmIHRoaXMuaGFzRW50aXR5KGVudGl0eUlkKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGlzRnVuY3Rpb24oYWN0aW9ucy5iZWZvcmVBZGQpICYmIGFjdGlvbnMuYmVmb3JlQWRkKGVudGl0eUlkKTtcbiAgICAgICAgICAgIGNvbnN0IHBsdWdpbiA9IHRoaXMuaW5zdGFudGlhdGVQbHVnaW4oZW50aXR5SWQpO1xuICAgICAgICAgICAgdGhpcy5lbnRpdGllcy5zZXQoZW50aXR5SWQsIHBsdWdpbik7XG4gICAgICAgICAgICBpc0Z1bmN0aW9uKGFjdGlvbnMuYWZ0ZXJBZGQpICYmIGFjdGlvbnMuYWZ0ZXJBZGQocGx1Z2luKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5lbnRpdGllcy5mb3JFYWNoKChwbHVnaW4sIGVudGl0eUlkKSA9PiB7XG4gICAgICAgICAgICAgIC8qKiBUaGUgRW50aXR5IG5vdCBpbiBjdXJyZW50IGlkcyBhbmQgZXhpc3RzLCByZW1vdmUgaXQuICovXG4gICAgICAgICAgICAgIGlmIChpZHMuaW5kZXhPZihlbnRpdHlJZCkgPT09IC0xICYmIHRoaXMuaGFzRW50aXR5KGVudGl0eUlkKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGlzRnVuY3Rpb24oYWN0aW9ucy5iZWZvcmVSZW1vdmUpICYmIGFjdGlvbnMuYmVmb3JlUmVtb3ZlKHBsdWdpbik7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVFbnRpdHkoZW50aXR5SWQpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLyoqXG4gICAgICAgKiBPdGhlcndpc2UsIHN0YXJ0IHdpdGggdGhlIHByb3ZpZGVkIGlkcyBvciBhbGwuXG4gICAgICAgKi9cbiAgICAgIHRoaXMuZ2V0SWRzKCkuZm9yRWFjaChpZCA9PiB7XG4gICAgICAgIGlmICghdGhpcy5oYXNFbnRpdHkoaWQpKSB0aGlzLmNyZWF0ZUVudGl0eShpZCwgdGhpcy5pbnN0YW50aWF0ZVBsdWdpbihpZCkpXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTGlzdGVuIGZvciBhZGQvcmVtb3ZlIGVudGl0aWVzLlxuICAgKi9cbiAgcHJvdGVjdGVkIHNlbGVjdElkcygpOiBPYnNlcnZhYmxlPElEW10+IHtcbiAgICByZXR1cm4gdGhpcy5xdWVyeS5zZWxlY3Qoc3RhdGUgPT4gc3RhdGUuaWRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBCYXNlIG1ldGhvZCBmb3IgYWN0aXZhdGlvbiwgeW91IGNhbiBvdmVycmlkZSBpdCBpZiB5b3UgbmVlZCB0by5cbiAgICovXG4gIHByb3RlY3RlZCBhY3RpdmF0ZShpZHM/OiBJRFtdKSB7XG4gICAgdGhpcy5yZWJhc2UoaWRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIG1ldGhvZCBpcyByZXNwb25zaWJsZSBmb3IgcGx1Z2luIGluc3RhbnRpYXRpb24uXG4gICAqXG4gICAqIEZvciBleGFtcGxlOlxuICAgKiByZXR1cm4gbmV3IFN0YXRlSGlzdG9yeSh0aGlzLnF1ZXJ5LCB0aGlzLnBhcmFtcywgaWQpIGFzIFA7XG4gICAqL1xuICBwcm90ZWN0ZWQgYWJzdHJhY3QgaW5zdGFudGlhdGVQbHVnaW4oaWQ6IElEKTogUDtcblxuICAvKipcbiAgICogVGhpcyBtZXRob2QgaXMgcmVzcG9uc2libGUgZm9yIGNsZWFuaW5nLlxuICAgKi9cbiAgcHVibGljIGFic3RyYWN0IGRlc3Ryb3koaWQ/OiBJRCk7XG5cbiAgLyoqXG4gICAqIExvb3Agb3ZlciBlYWNoIGlkIGFuZCBpbnZva2UgdGhlIHBsdWdpbiBtZXRob2QuXG4gICAqL1xuICBwcm90ZWN0ZWQgZm9yRWFjaElkKGlkczogSURTLCBjYjogKGVudGl0eTogUCkgPT4gYW55KSB7XG4gICAgY29uc3QgX2lkcyA9IHRoaXMucmVzb2x2ZWRJZHMoaWRzKTtcblxuICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBfaWRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICBjb25zdCBpZCA9IF9pZHNbaV07XG4gICAgICBpZiAodGhpcy5oYXNFbnRpdHkoaWQpKSB7XG4gICAgICAgIGNiKHRoaXMuZ2V0RW50aXR5KGlkKSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG4iLCJpbXBvcnQgeyBmaWx0ZXIsIHBhaXJ3aXNlIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgX19nbG9iYWxTdGF0ZSB9IGZyb20gJy4uLy4uL2ludGVybmFsL2dsb2JhbC1zdGF0ZSc7XG5pbXBvcnQgeyB0b0Jvb2xlYW4gfSBmcm9tICcuLi8uLi9pbnRlcm5hbC91dGlscyc7XG5pbXBvcnQgeyBBa2l0YVBsdWdpbiwgUXVlcmllcyB9IGZyb20gJy4uL3BsdWdpbic7XG5pbXBvcnQgeyBFbnRpdHlQYXJhbSB9IGZyb20gJy4uL2VudGl0eS1jb2xsZWN0aW9uLXBsdWdpbic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGVIaXN0b3J5UGFyYW1zIHtcbiAgbWF4QWdlPzogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgU3RhdGVIaXN0b3J5UGx1Z2luPEUgPSBhbnksIFMgPSBhbnk+IGV4dGVuZHMgQWtpdGFQbHVnaW48RSwgUz4ge1xuICAvKiogQWxsb3cgc2tpcHBpbmcgYW4gdXBkYXRlIGZyb20gb3V0c2lkZSAqL1xuICBwcml2YXRlIHNraXAgPSBmYWxzZTtcblxuICBwcml2YXRlIGhpc3RvcnkgPSB7XG4gICAgcGFzdDogW10sXG4gICAgcHJlc2VudDogbnVsbCxcbiAgICBmdXR1cmU6IFtdXG4gIH07XG5cbiAgLyoqIFNraXAgdGhlIHVwZGF0ZSB3aGVuIHJlZG8vdW5kbyAqL1xuICBwcml2YXRlIHNraXBVcGRhdGUgPSBmYWxzZTtcbiAgcHJpdmF0ZSBzdWJzY3JpcHRpb247XG5cbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIHF1ZXJ5OiBRdWVyaWVzPEUsIFM+LCBwcml2YXRlIHBhcmFtczogU3RhdGVIaXN0b3J5UGFyYW1zID0ge30sIHByaXZhdGUgX2VudGl0eUlkPzogRW50aXR5UGFyYW0pIHtcbiAgICBzdXBlcihxdWVyeSwge1xuICAgICAgcmVzZXRGbjogKCkgPT4gdGhpcy5jbGVhcigpXG4gICAgfSk7XG4gICAgcGFyYW1zLm1heEFnZSA9IHRvQm9vbGVhbihwYXJhbXMubWF4QWdlKSA/IHBhcmFtcy5tYXhBZ2UgOiAxMDtcbiAgICB0aGlzLmFjdGl2YXRlKCk7XG4gIH1cblxuICBnZXQgaGFzUGFzdCgpIHtcbiAgICByZXR1cm4gdGhpcy5oaXN0b3J5LnBhc3QubGVuZ3RoID4gMDtcbiAgfVxuXG4gIGdldCBoYXNGdXR1cmUoKSB7XG4gICAgcmV0dXJuIHRoaXMuaGlzdG9yeS5mdXR1cmUubGVuZ3RoID4gMDtcbiAgfVxuXG4gIGFjdGl2YXRlKCkge1xuICAgIHRoaXMuaGlzdG9yeS5wcmVzZW50ID0gdGhpcy5nZXRTb3VyY2UodGhpcy5fZW50aXR5SWQpO1xuICAgIHRoaXMuc3Vic2NyaXB0aW9uID0gdGhpcy5zZWxlY3RTb3VyY2UodGhpcy5fZW50aXR5SWQpXG4gICAgICAucGlwZShwYWlyd2lzZSgpKVxuICAgICAgLnN1YnNjcmliZSgoW3Bhc3QsIHByZXNlbnRdKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLnNraXApIHtcbiAgICAgICAgICB0aGlzLnNraXAgPSBmYWxzZTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLnNraXBVcGRhdGUpIHtcbiAgICAgICAgICBpZiAodGhpcy5oaXN0b3J5LnBhc3QubGVuZ3RoID09PSB0aGlzLnBhcmFtcy5tYXhBZ2UpIHtcbiAgICAgICAgICAgIHRoaXMuaGlzdG9yeS5wYXN0ID0gdGhpcy5oaXN0b3J5LnBhc3Quc2xpY2UoMSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuaGlzdG9yeS5wYXN0ID0gWy4uLnRoaXMuaGlzdG9yeS5wYXN0LCBwYXN0XTtcbiAgICAgICAgICB0aGlzLmhpc3RvcnkucHJlc2VudCA9IHByZXNlbnQ7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICB9XG5cbiAgdW5kbygpIHtcbiAgICBpZiAodGhpcy5oaXN0b3J5LnBhc3QubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgeyBwYXN0LCBwcmVzZW50LCBmdXR1cmUgfSA9IHRoaXMuaGlzdG9yeTtcbiAgICAgIGNvbnN0IHByZXZpb3VzID0gcGFzdFtwYXN0Lmxlbmd0aCAtIDFdO1xuICAgICAgY29uc3QgbmV3UGFzdCA9IHBhc3Quc2xpY2UoMCwgcGFzdC5sZW5ndGggLSAxKTtcblxuICAgICAgdGhpcy5oaXN0b3J5LnBhc3QgPSBuZXdQYXN0O1xuICAgICAgdGhpcy5oaXN0b3J5LnByZXNlbnQgPSBwcmV2aW91cztcbiAgICAgIHRoaXMuaGlzdG9yeS5mdXR1cmUgPSBbcHJlc2VudCwgLi4udGhpcy5oaXN0b3J5LmZ1dHVyZV07XG4gICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgIH1cbiAgfVxuXG4gIHJlZG8oKSB7XG4gICAgaWYgKHRoaXMuaGlzdG9yeS5mdXR1cmUubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgeyBwYXN0LCBwcmVzZW50LCBmdXR1cmUgfSA9IHRoaXMuaGlzdG9yeTtcbiAgICAgIGNvbnN0IG5leHQgPSB0aGlzLmhpc3RvcnkuZnV0dXJlWzBdO1xuICAgICAgY29uc3QgbmV3RnV0dXJlID0gdGhpcy5oaXN0b3J5LmZ1dHVyZS5zbGljZSgxKTtcbiAgICAgIHRoaXMuaGlzdG9yeS5wYXN0ID0gWy4uLnBhc3QsIHByZXNlbnRdO1xuICAgICAgdGhpcy5oaXN0b3J5LnByZXNlbnQgPSBuZXh0O1xuICAgICAgdGhpcy5oaXN0b3J5LmZ1dHVyZSA9IG5ld0Z1dHVyZTtcbiAgICAgIHRoaXMudXBkYXRlKCdSZWRvJyk7XG4gICAgfVxuICB9XG5cbiAganVtcFRvUGFzdChpbmRleDogbnVtYmVyKSB7XG4gICAgaWYgKGluZGV4IDwgMCB8fCBpbmRleCA+PSB0aGlzLmhpc3RvcnkucGFzdC5sZW5ndGgpIHJldHVybjtcblxuICAgIGNvbnN0IHsgcGFzdCwgZnV0dXJlIH0gPSB0aGlzLmhpc3Rvcnk7XG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBjb25zdCBwYXN0ID0gWzEsIDIsIDMsIDQsIDVdO1xuICAgICAqXG4gICAgICogbmV3UGFzdCA9IHBhc3Quc2xpY2UoMCwgMikgPSBbMSwgMl07XG4gICAgICogcHJlc2VudCA9IHBhc3RbaW5kZXhdID0gMztcbiAgICAgKiBbLi4ucGFzdC5zbGljZSgyICsgMSksIC4uLmZ1dHVyZV0gPSBbNCwgNV07XG4gICAgICpcbiAgICAgKi9cbiAgICBjb25zdCBuZXdQYXN0ID0gcGFzdC5zbGljZSgwLCBpbmRleCk7XG4gICAgY29uc3QgbmV3RnV0dXJlID0gWy4uLnBhc3Quc2xpY2UoaW5kZXggKyAxKSwgLi4uZnV0dXJlXTtcbiAgICBjb25zdCBuZXdQcmVzZW50ID0gcGFzdFtpbmRleF07XG4gICAgdGhpcy5oaXN0b3J5LnBhc3QgPSBuZXdQYXN0O1xuICAgIHRoaXMuaGlzdG9yeS5wcmVzZW50ID0gbmV3UHJlc2VudDtcbiAgICB0aGlzLmhpc3RvcnkuZnV0dXJlID0gbmV3RnV0dXJlO1xuICAgIHRoaXMudXBkYXRlKCk7XG4gIH1cblxuICBqdW1wVG9GdXR1cmUoaW5kZXg6IG51bWJlcikge1xuICAgIGlmIChpbmRleCA8IDAgfHwgaW5kZXggPj0gdGhpcy5oaXN0b3J5LmZ1dHVyZS5sZW5ndGgpIHJldHVybjtcblxuICAgIGNvbnN0IHsgcGFzdCwgZnV0dXJlIH0gPSB0aGlzLmhpc3Rvcnk7XG5cbiAgICBjb25zdCBuZXdQYXN0ID0gWy4uLnBhc3QsIC4uLmZ1dHVyZS5zbGljZSgwLCBpbmRleCldO1xuICAgIGNvbnN0IG5ld1ByZXNlbnQgPSBmdXR1cmVbaW5kZXhdO1xuICAgIGNvbnN0IG5ld0Z1dHVyZSA9IGZ1dHVyZS5zbGljZShpbmRleCArIDEpO1xuXG4gICAgdGhpcy5oaXN0b3J5LnBhc3QgPSBuZXdQYXN0O1xuICAgIHRoaXMuaGlzdG9yeS5wcmVzZW50ID0gbmV3UHJlc2VudDtcbiAgICB0aGlzLmhpc3RvcnkuZnV0dXJlID0gbmV3RnV0dXJlO1xuICAgIHRoaXMudXBkYXRlKCdSZWRvJyk7XG4gIH1cblxuICBjbGVhcigpIHtcbiAgICB0aGlzLmhpc3RvcnkgPSB7XG4gICAgICBwYXN0OiBbXSxcbiAgICAgIHByZXNlbnQ6IG51bGwsXG4gICAgICBmdXR1cmU6IFtdXG4gICAgfTtcbiAgfVxuXG4gIGRlc3Ryb3koY2xlYXJIaXN0b3J5ID0gZmFsc2UpIHtcbiAgICBpZiAoY2xlYXJIaXN0b3J5KSB7XG4gICAgICB0aGlzLmNsZWFyKCk7XG4gICAgfVxuICAgIHRoaXMuc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gIH1cblxuICBpZ25vcmVOZXh0KCkge1xuICAgIHRoaXMuc2tpcCA9IHRydWU7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZShhY3Rpb24gPSAnVW5kbycpIHtcbiAgICB0aGlzLnNraXBVcGRhdGUgPSB0cnVlO1xuICAgIF9fZ2xvYmFsU3RhdGUuc2V0Q3VzdG9tQWN0aW9uKHsgdHlwZTogYEBTdGF0ZUhpc3RvcnkgLSAke2FjdGlvbn1gIH0pO1xuICAgIHRoaXMudXBkYXRlU3RvcmUodGhpcy5oaXN0b3J5LnByZXNlbnQsIHRoaXMuX2VudGl0eUlkKTtcbiAgICB0aGlzLnNraXBVcGRhdGUgPSBmYWxzZTtcbiAgfVxufVxuIiwiaW1wb3J0IHsgSUQsIElEUyB9IGZyb20gJy4uLy4uL2FwaS90eXBlcyc7XG5pbXBvcnQgeyBRdWVyeUVudGl0eSB9IGZyb20gJy4uLy4uL2FwaS9xdWVyeS1lbnRpdHknO1xuaW1wb3J0IHsgU3RhdGVIaXN0b3J5UGx1Z2luLCBTdGF0ZUhpc3RvcnlQYXJhbXMgfSBmcm9tICcuL3N0YXRlLWhpc3RvcnktcGx1Z2luJztcbmltcG9ydCB7IHRvQm9vbGVhbiB9IGZyb20gJy4uLy4uL2ludGVybmFsL3V0aWxzJztcbmltcG9ydCB7IHNraXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBFbnRpdHlDb2xsZWN0aW9uUGx1Z2luLCBFbnRpdHlDb2xsZWN0aW9uUGFyYW1zIH0gZnJvbSAnLi4vZW50aXR5LWNvbGxlY3Rpb24tcGx1Z2luJztcblxuZXhwb3J0IGludGVyZmFjZSBTdGF0ZUhpc3RvcnlFbnRpdHlQYXJhbXMgZXh0ZW5kcyBTdGF0ZUhpc3RvcnlQYXJhbXMge1xuICBlbnRpdHlJZHM/OiBFbnRpdHlDb2xsZWN0aW9uUGFyYW1zO1xufVxuXG5leHBvcnQgY2xhc3MgRW50aXR5U3RhdGVIaXN0b3J5UGx1Z2luPEUsIFAgZXh0ZW5kcyBTdGF0ZUhpc3RvcnlQbHVnaW48RSwgYW55PiA9IFN0YXRlSGlzdG9yeVBsdWdpbjxFLCBhbnk+PiBleHRlbmRzIEVudGl0eUNvbGxlY3Rpb25QbHVnaW48RSwgUD4ge1xuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgcXVlcnk6IFF1ZXJ5RW50aXR5PGFueSwgRT4sIHByb3RlY3RlZCByZWFkb25seSBwYXJhbXM6IFN0YXRlSGlzdG9yeUVudGl0eVBhcmFtcyA9IHt9KSB7XG4gICAgc3VwZXIocXVlcnksIHBhcmFtcy5lbnRpdHlJZHMpO1xuICAgIHBhcmFtcy5tYXhBZ2UgPSB0b0Jvb2xlYW4ocGFyYW1zLm1heEFnZSkgPyBwYXJhbXMubWF4QWdlIDogMTA7XG4gICAgdGhpcy5hY3RpdmF0ZSgpO1xuICAgIHRoaXMuc2VsZWN0SWRzKClcbiAgICAgIC5waXBlKHNraXAoMSkpXG4gICAgICAuc3Vic2NyaWJlKGlkcyA9PiB0aGlzLmFjdGl2YXRlKGlkcykpO1xuICB9XG5cbiAgcmVkbyhpZHM/OiBJRFMpIHtcbiAgICB0aGlzLmZvckVhY2hJZChpZHMsIGUgPT4gZS5yZWRvKCkpO1xuICB9XG5cbiAgdW5kbyhpZHM/OiBJRFMpIHtcbiAgICB0aGlzLmZvckVhY2hJZChpZHMsIGUgPT4gZS51bmRvKCkpO1xuICB9XG5cbiAgaGFzUGFzdChpZDogSUQpIHtcbiAgICBpZiAodGhpcy5oYXNFbnRpdHkoaWQpKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRFbnRpdHkoaWQpLmhhc1Bhc3Q7XG4gICAgfVxuICB9XG5cbiAgaGFzRnV0dXJlKGlkOiBJRCkge1xuICAgIGlmICh0aGlzLmhhc0VudGl0eShpZCkpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldEVudGl0eShpZCkuaGFzRnV0dXJlO1xuICAgIH1cbiAgfVxuXG4gIGp1bXBUb0Z1dHVyZShpZHM6IElEUywgaW5kZXg6IG51bWJlcikge1xuICAgIHRoaXMuZm9yRWFjaElkKGlkcywgZSA9PiBlLmp1bXBUb0Z1dHVyZShpbmRleCkpO1xuICB9XG5cbiAganVtcFRvUGFzdChpZHM6IElEUywgaW5kZXg6IG51bWJlcikge1xuICAgIHRoaXMuZm9yRWFjaElkKGlkcywgZSA9PiBlLmp1bXBUb1Bhc3QoaW5kZXgpKTtcbiAgfVxuXG4gIGNsZWFyKGlkcz86IElEUykge1xuICAgIHRoaXMuZm9yRWFjaElkKGlkcywgZSA9PiBlLmNsZWFyKCkpO1xuICB9XG5cbiAgZGVzdHJveShpZHM/OiBJRFMsIGNsZWFySGlzdG9yeSA9IGZhbHNlKSB7XG4gICAgdGhpcy5mb3JFYWNoSWQoaWRzLCBlID0+IGUuZGVzdHJveShjbGVhckhpc3RvcnkpKTtcbiAgfVxuXG4gIGlnbm9yZU5leHQoaWRzPzogSURTKSB7XG4gICAgdGhpcy5mb3JFYWNoSWQoaWRzLCBlID0+IGUuaWdub3JlTmV4dCgpKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBpbnN0YW50aWF0ZVBsdWdpbihpZDogSUQpIHtcbiAgICByZXR1cm4gbmV3IFN0YXRlSGlzdG9yeVBsdWdpbjxFLCBhbnk+KHRoaXMucXVlcnksIHRoaXMucGFyYW1zLCBpZCkgYXMgUDtcbiAgfVxufVxuIiwiaW1wb3J0IHsgQWtpdGFQbHVnaW4sIFF1ZXJpZXMgfSBmcm9tICcuLi9wbHVnaW4nO1xuaW1wb3J0IHsgUXVlcnlFbnRpdHkgfSBmcm9tICcuLi8uLi9hcGkvcXVlcnktZW50aXR5JztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgT2JzZXJ2YWJsZSwgU3ViamVjdCwgU3Vic2NyaXB0aW9uLCBjb21iaW5lTGF0ZXN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkaXN0aW5jdFVudGlsQ2hhbmdlZCwgbWFwLCBza2lwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgY29lcmNlQXJyYXksIGlzRnVuY3Rpb24sIGlzVW5kZWZpbmVkLCB0b0Jvb2xlYW4gfSBmcm9tICcuLi8uLi9pbnRlcm5hbC91dGlscyc7XG5pbXBvcnQgeyBFbnRpdHlQYXJhbSB9IGZyb20gJy4uL2VudGl0eS1jb2xsZWN0aW9uLXBsdWdpbic7XG5pbXBvcnQgeyBfX2dsb2JhbFN0YXRlIH0gZnJvbSAnLi4vLi4vaW50ZXJuYWwvZ2xvYmFsLXN0YXRlJztcbmltcG9ydCB7IFF1ZXJ5IH0gZnJvbSAnLi4vLi4vYXBpL3F1ZXJ5JztcblxudHlwZSBIZWFkPFN0b3JlU3RhdGUgPSBhbnksIEVudGl0eSA9IGFueT4gPSBTdG9yZVN0YXRlIHwgUGFydGlhbDxTdG9yZVN0YXRlPiB8IEVudGl0eTtcblxuZXhwb3J0IHR5cGUgRGlydHlDaGVja0NvbXBhcmF0b3I8RW50aXR5PiA9IChoZWFkOiBFbnRpdHksIGN1cnJlbnQ6IEVudGl0eSkgPT4gYm9vbGVhbjtcblxuZXhwb3J0IHR5cGUgRGlydHlDaGVja1BhcmFtczxTdG9yZVN0YXRlID0gYW55PiA9IHtcbiAgY29tcGFyYXRvcj86IERpcnR5Q2hlY2tDb21wYXJhdG9yPFN0b3JlU3RhdGU+O1xuICB3YXRjaFByb3BlcnR5Pzoga2V5b2YgU3RvcmVTdGF0ZSB8IChrZXlvZiBTdG9yZVN0YXRlKVtdO1xufTtcblxuZXhwb3J0IGNvbnN0IGRpcnR5Q2hlY2tEZWZhdWx0UGFyYW1zID0ge1xuICBjb21wYXJhdG9yOiAoaGVhZCwgY3VycmVudCkgPT4gSlNPTi5zdHJpbmdpZnkoaGVhZCkgIT09IEpTT04uc3RyaW5naWZ5KGN1cnJlbnQpXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TmVzdGVkUGF0aChuZXN0ZWRPYmosIHBhdGg6IHN0cmluZykge1xuICBjb25zdCBwYXRoQXNBcnJheTogc3RyaW5nW10gPSBwYXRoLnNwbGl0KCcuJyk7XG4gIHJldHVybiBwYXRoQXNBcnJheS5yZWR1Y2UoKG9iaiwga2V5KSA9PiAob2JqICYmIG9ialtrZXldICE9PSAndW5kZWZpbmVkJyA/IG9ialtrZXldIDogdW5kZWZpbmVkKSwgbmVzdGVkT2JqKTtcbn1cblxuZXhwb3J0IHR5cGUgRGlydHlDaGVja1Jlc2V0UGFyYW1zPFN0b3JlU3RhdGUgPSBhbnk+ID0ge1xuICB1cGRhdGVGbj86IFN0b3JlU3RhdGUgfCAoKGhlYWQ6IFN0b3JlU3RhdGUsIGN1cnJlbnQ6IFN0b3JlU3RhdGUpID0+IGFueSk7XG59O1xuXG5leHBvcnQgY2xhc3MgRGlydHlDaGVja1BsdWdpbjxFbnRpdHkgPSBhbnksIFN0b3JlU3RhdGUgPSBhbnk+IGV4dGVuZHMgQWtpdGFQbHVnaW48RW50aXR5LCBTdG9yZVN0YXRlPiB7XG4gIHByaXZhdGUgaGVhZDogSGVhZDxTdG9yZVN0YXRlLCBFbnRpdHk+O1xuICBwcml2YXRlIGRpcnR5ID0gbmV3IEJlaGF2aW9yU3ViamVjdChmYWxzZSk7XG4gIHByaXZhdGUgc3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG4gIHByaXZhdGUgYWN0aXZlID0gZmFsc2U7XG4gIHByaXZhdGUgX3Jlc2V0ID0gbmV3IFN1YmplY3QoKTtcblxuICBpc0RpcnR5JDogT2JzZXJ2YWJsZTxib29sZWFuPiA9IHRoaXMuZGlydHkuYXNPYnNlcnZhYmxlKCkucGlwZShkaXN0aW5jdFVudGlsQ2hhbmdlZCgpKTtcbiAgcmVzZXQkID0gdGhpcy5fcmVzZXQuYXNPYnNlcnZhYmxlKCk7XG5cbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIHF1ZXJ5OiBRdWVyaWVzPEVudGl0eSwgU3RvcmVTdGF0ZT4sIHByaXZhdGUgcGFyYW1zPzogRGlydHlDaGVja1BhcmFtcywgcHJpdmF0ZSBfZW50aXR5SWQ/OiBFbnRpdHlQYXJhbSkge1xuICAgIHN1cGVyKHF1ZXJ5KTtcbiAgICB0aGlzLnBhcmFtcyA9IHsgLi4uZGlydHlDaGVja0RlZmF1bHRQYXJhbXMsIC4uLnBhcmFtcyB9O1xuICAgIGlmICh0aGlzLnBhcmFtcy53YXRjaFByb3BlcnR5KSB7XG4gICAgICBsZXQgd2F0Y2hQcm9wID0gY29lcmNlQXJyYXkodGhpcy5wYXJhbXMud2F0Y2hQcm9wZXJ0eSkgYXMgYW55W107XG4gICAgICBpZiAocXVlcnkgaW5zdGFuY2VvZiBRdWVyeUVudGl0eSAmJiB3YXRjaFByb3AuaW5jbHVkZXMoJ2VudGl0aWVzJykgJiYgIXdhdGNoUHJvcC5pbmNsdWRlcygnaWRzJykpIHtcbiAgICAgICAgd2F0Y2hQcm9wLnB1c2goJ2lkcycpO1xuICAgICAgfVxuICAgICAgdGhpcy5wYXJhbXMud2F0Y2hQcm9wZXJ0eSA9IHdhdGNoUHJvcDtcbiAgICB9XG4gIH1cblxuICByZXNldChwYXJhbXM6IERpcnR5Q2hlY2tSZXNldFBhcmFtcyA9IHt9KSB7XG4gICAgbGV0IGN1cnJlbnRWYWx1ZSA9IHRoaXMuaGVhZDtcbiAgICBpZiAoaXNGdW5jdGlvbihwYXJhbXMudXBkYXRlRm4pKSB7XG4gICAgICBpZiAodGhpcy5pc0VudGl0eUJhc2VkKHRoaXMuX2VudGl0eUlkKSkge1xuICAgICAgICBjdXJyZW50VmFsdWUgPSBwYXJhbXMudXBkYXRlRm4odGhpcy5oZWFkLCAodGhpcy5nZXRRdWVyeSgpIGFzIFF1ZXJ5RW50aXR5PFN0b3JlU3RhdGUsIEVudGl0eT4pLmdldEVudGl0eSh0aGlzLl9lbnRpdHlJZCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY3VycmVudFZhbHVlID0gcGFyYW1zLnVwZGF0ZUZuKHRoaXMuaGVhZCwgKHRoaXMuZ2V0UXVlcnkoKSBhcyBRdWVyeTxTdG9yZVN0YXRlPikuZ2V0U25hcHNob3QoKSk7XG4gICAgICB9XG4gICAgfVxuICAgIF9fZ2xvYmFsU3RhdGUuc2V0Q3VzdG9tQWN0aW9uKHsgdHlwZTogYEBEaXJ0eUNoZWNrIC0gUmV2ZXJ0YCB9KTtcbiAgICB0aGlzLnVwZGF0ZVN0b3JlKGN1cnJlbnRWYWx1ZSwgdGhpcy5fZW50aXR5SWQpO1xuICAgIHRoaXMuX3Jlc2V0Lm5leHQoKTtcbiAgfVxuXG4gIHNldEhlYWQoKSB7XG4gICAgaWYgKCF0aGlzLmFjdGl2ZSkge1xuICAgICAgdGhpcy5hY3RpdmF0ZSgpO1xuICAgICAgdGhpcy5hY3RpdmUgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmhlYWQgPSB0aGlzLl9nZXRIZWFkKCk7XG4gICAgfVxuICAgIHRoaXMudXBkYXRlRGlydGluZXNzKGZhbHNlKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGlzRGlydHkoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRvQm9vbGVhbih0aGlzLmRpcnR5LnZhbHVlKTtcbiAgfVxuXG4gIGhhc0hlYWQoKSB7XG4gICAgcmV0dXJuIHRvQm9vbGVhbih0aGlzLmdldEhlYWQoKSk7XG4gIH1cblxuICBkZXN0cm95KCkge1xuICAgIHRoaXMuaGVhZCA9IG51bGw7XG4gICAgdGhpcy5zdWJzY3JpcHRpb24gJiYgdGhpcy5zdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB0aGlzLl9yZXNldCAmJiB0aGlzLl9yZXNldC5jb21wbGV0ZSgpO1xuICB9XG5cbiAgaXNQYXRoRGlydHkocGF0aDogc3RyaW5nKSB7XG4gICAgY29uc3QgaGVhZCA9IHRoaXMuZ2V0SGVhZCgpO1xuICAgIGNvbnN0IGN1cnJlbnQgPSAodGhpcy5nZXRRdWVyeSgpIGFzIFF1ZXJ5PFN0b3JlU3RhdGU+KS5nZXRTbmFwc2hvdCgpO1xuICAgIGNvbnN0IGN1cnJlbnRQYXRoVmFsdWUgPSBnZXROZXN0ZWRQYXRoKGN1cnJlbnQsIHBhdGgpO1xuICAgIGNvbnN0IGhlYWRQYXRoVmFsdWUgPSBnZXROZXN0ZWRQYXRoKGhlYWQsIHBhdGgpO1xuXG4gICAgcmV0dXJuIHRoaXMucGFyYW1zLmNvbXBhcmF0b3IoY3VycmVudFBhdGhWYWx1ZSwgaGVhZFBhdGhWYWx1ZSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0SGVhZCgpIHtcbiAgICByZXR1cm4gdGhpcy5oZWFkO1xuICB9XG5cbiAgcHJpdmF0ZSBhY3RpdmF0ZSgpIHtcbiAgICB0aGlzLmhlYWQgPSB0aGlzLl9nZXRIZWFkKCk7XG4gICAgLyoqIGlmIHdlIGFyZSB0cmFja2luZyBzcGVjaWZpYyBwcm9wZXJ0aWVzIHNlbGVjdCBvbmx5IHRoZSByZWxldmFudCBvbmVzICovXG4gICAgY29uc3Qgc291cmNlID0gdGhpcy5wYXJhbXMud2F0Y2hQcm9wZXJ0eVxuICAgICAgPyAodGhpcy5wYXJhbXMud2F0Y2hQcm9wZXJ0eSBhcyAoa2V5b2YgU3RvcmVTdGF0ZSlbXSkubWFwKHByb3AgPT5cbiAgICAgICAgICB0aGlzLnF1ZXJ5LnNlbGVjdChzdGF0ZSA9PiBzdGF0ZVtwcm9wXSkucGlwZShcbiAgICAgICAgICAgIG1hcCh2YWwgPT4gKHtcbiAgICAgICAgICAgICAgdmFsLFxuICAgICAgICAgICAgICBfX2FraXRhS2V5OiBwcm9wXG4gICAgICAgICAgICB9KSlcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgIDogW3RoaXMuc2VsZWN0U291cmNlKHRoaXMuX2VudGl0eUlkKV07XG4gICAgdGhpcy5zdWJzY3JpcHRpb24gPSBjb21iaW5lTGF0ZXN0KC4uLnNvdXJjZSlcbiAgICAgIC5waXBlKHNraXAoMSkpXG4gICAgICAuc3Vic2NyaWJlKChjdXJyZW50U3RhdGU6IGFueVtdKSA9PiB7XG4gICAgICAgIGlmIChpc1VuZGVmaW5lZCh0aGlzLmhlYWQpKSByZXR1cm47XG4gICAgICAgIC8qKiBfX2FraXRhS2V5IGlzIHVzZWQgdG8gZGV0ZXJtaW5lIGlmIHdlIGFyZSB0cmFja2luZyBhIHNwZWNpZmljIHByb3BlcnR5IG9yIGEgc3RvcmUgY2hhbmdlICovXG4gICAgICAgIGNvbnN0IGlzQ2hhbmdlID0gY3VycmVudFN0YXRlLnNvbWUoc3RhdGUgPT4ge1xuICAgICAgICAgIGNvbnN0IGhlYWQgPSBzdGF0ZS5fX2FraXRhS2V5ID8gdGhpcy5oZWFkW3N0YXRlLl9fYWtpdGFLZXkgYXMgYW55XSA6IHRoaXMuaGVhZDtcbiAgICAgICAgICBjb25zdCBjb21wYXJlVG8gPSBzdGF0ZS5fX2FraXRhS2V5ID8gc3RhdGUudmFsIDogc3RhdGU7XG5cbiAgICAgICAgICByZXR1cm4gdGhpcy5wYXJhbXMuY29tcGFyYXRvcihoZWFkLCBjb21wYXJlVG8pO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnVwZGF0ZURpcnRpbmVzcyhpc0NoYW5nZSk7XG4gICAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlRGlydGluZXNzKGlzRGlydHk6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmRpcnR5Lm5leHQoaXNEaXJ0eSk7XG4gIH1cblxuICBwcml2YXRlIF9nZXRIZWFkKCk6IEhlYWQ8U3RvcmVTdGF0ZSwgRW50aXR5PiB7XG4gICAgbGV0IGhlYWQ6IEhlYWQ8U3RvcmVTdGF0ZSwgRW50aXR5PiA9IHRoaXMuZ2V0U291cmNlKHRoaXMuX2VudGl0eUlkKTtcbiAgICBpZiAodGhpcy5wYXJhbXMud2F0Y2hQcm9wZXJ0eSkge1xuICAgICAgaGVhZCA9IHRoaXMuZ2V0V2F0Y2hlZFZhbHVlcyhoZWFkIGFzIFN0b3JlU3RhdGUpO1xuICAgIH1cbiAgICByZXR1cm4gaGVhZDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0V2F0Y2hlZFZhbHVlcyhzb3VyY2U6IFN0b3JlU3RhdGUpOiBQYXJ0aWFsPFN0b3JlU3RhdGU+IHtcbiAgICByZXR1cm4gKHRoaXMucGFyYW1zLndhdGNoUHJvcGVydHkgYXMgKGtleW9mIFN0b3JlU3RhdGUpW10pLnJlZHVjZShcbiAgICAgICh3YXRjaGVkLCBwcm9wKSA9PiB7XG4gICAgICAgIHdhdGNoZWRbcHJvcF0gPSBzb3VyY2VbcHJvcF07XG4gICAgICAgIHJldHVybiB3YXRjaGVkO1xuICAgICAgfSxcbiAgICAgIHt9IGFzIFBhcnRpYWw8U3RvcmVTdGF0ZT5cbiAgICApO1xuICB9XG59XG4iLCJpbXBvcnQgeyBIYXNoTWFwLCBJRCwgSURTIH0gZnJvbSAnLi4vLi4vYXBpL3R5cGVzJztcbmltcG9ydCB7XG4gIERpcnR5Q2hlY2tDb21wYXJhdG9yLFxuICBkaXJ0eUNoZWNrRGVmYXVsdFBhcmFtcyxcbiAgRGlydHlDaGVja1BsdWdpbixcbiAgRGlydHlDaGVja1Jlc2V0UGFyYW1zLFxuICBnZXROZXN0ZWRQYXRoXG59IGZyb20gJy4vZGlydHktY2hlY2stcGx1Z2luJztcbmltcG9ydCB7IFF1ZXJ5RW50aXR5IH0gZnJvbSAnLi4vLi4vYXBpL3F1ZXJ5LWVudGl0eSc7XG5pbXBvcnQgeyBFbnRpdHlDb2xsZWN0aW9uUGx1Z2luIH0gZnJvbSAnLi4vZW50aXR5LWNvbGxlY3Rpb24tcGx1Z2luJztcbmltcG9ydCB7IG1hcCwgc2tpcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcblxuZXhwb3J0IHR5cGUgRGlydHlDaGVja0NvbGxlY3Rpb25QYXJhbXM8RT4gPSB7XG4gIGNvbXBhcmF0b3I/OiBEaXJ0eUNoZWNrQ29tcGFyYXRvcjxFPjtcbiAgZW50aXR5SWRzPzogSUQgfCBJRFtdO1xufTtcblxuZXhwb3J0IGNsYXNzIEVudGl0eURpcnR5Q2hlY2tQbHVnaW48RSwgUCBleHRlbmRzIERpcnR5Q2hlY2tQbHVnaW48RSwgYW55PiA9IERpcnR5Q2hlY2tQbHVnaW48RSwgYW55Pj4gZXh0ZW5kcyBFbnRpdHlDb2xsZWN0aW9uUGx1Z2luPEUsIFA+IHtcbiAgLyoqXG4gICAqIEBkZXByZWNhdGVkIFVzZSBzb21lRGlydHkkIGluc3RlYWRcbiAgICovXG4gIGlzU29tZURpcnR5JDogT2JzZXJ2YWJsZTxib29sZWFuPiA9IHRoaXMucXVlcnkuc2VsZWN0KHN0YXRlID0+IHN0YXRlLmVudGl0aWVzKS5waXBlKG1hcCgoZW50aXRpZXM6IGFueSkgPT4gdGhpcy5jaGVja1NvbWVEaXJ0eShlbnRpdGllcykpKTtcblxuICBzb21lRGlydHkkID0gdGhpcy5pc1NvbWVEaXJ0eSQ7XG4gIHNvbWVEaXJ0eSA9IHRoaXMuaXNTb21lRGlydHk7XG5cbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIHF1ZXJ5OiBRdWVyeUVudGl0eTxhbnksIEU+LCBwcml2YXRlIHJlYWRvbmx5IHBhcmFtczogRGlydHlDaGVja0NvbGxlY3Rpb25QYXJhbXM8RT4gPSB7fSkge1xuICAgIHN1cGVyKHF1ZXJ5LCBwYXJhbXMuZW50aXR5SWRzKTtcbiAgICB0aGlzLnBhcmFtcyA9IHsgLi4uZGlydHlDaGVja0RlZmF1bHRQYXJhbXMsIC4uLnBhcmFtcyB9O1xuICAgIHRoaXMuYWN0aXZhdGUoKTtcbiAgICB0aGlzLnNlbGVjdElkcygpXG4gICAgICAucGlwZShza2lwKDEpKVxuICAgICAgLnN1YnNjcmliZShpZHMgPT4ge1xuICAgICAgICB0aGlzLnJlYmFzZShpZHMsIHsgYWZ0ZXJBZGQ6IHBsdWdpbiA9PiBwbHVnaW4uc2V0SGVhZCgpIH0pO1xuICAgICAgfSk7XG4gIH1cblxuICBzZXRIZWFkKGlkcz86IElEUykge1xuICAgIHRoaXMuZm9yRWFjaElkKGlkcywgZSA9PiBlLnNldEhlYWQoKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBoYXNIZWFkKGlkOiBJRCk6IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLmVudGl0aWVzLmhhcyhpZCkpIHtcbiAgICAgIGNvbnN0IGVudGl0eSA9IHRoaXMuZ2V0RW50aXR5KGlkKTtcbiAgICAgIHJldHVybiBlbnRpdHkuaGFzSGVhZCgpO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHJlc2V0KGlkcz86IElEUywgcGFyYW1zOiBEaXJ0eUNoZWNrUmVzZXRQYXJhbXMgPSB7fSkge1xuICAgIHRoaXMuZm9yRWFjaElkKGlkcywgZSA9PiBlLnJlc2V0KHBhcmFtcykpO1xuICB9XG5cbiAgaXNEaXJ0eShpZDogSUQpOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xuICBpc0RpcnR5KGlkOiBJRCwgYXNPYnNlcnZhYmxlOiB0cnVlKTogT2JzZXJ2YWJsZTxib29sZWFuPjtcbiAgaXNEaXJ0eShpZDogSUQsIGFzT2JzZXJ2YWJsZTogZmFsc2UpOiBib29sZWFuO1xuICBpc0RpcnR5KGlkOiBJRCwgYXNPYnNlcnZhYmxlID0gdHJ1ZSk6IE9ic2VydmFibGU8Ym9vbGVhbj4gfCBib29sZWFuIHtcbiAgICBpZiAodGhpcy5lbnRpdGllcy5oYXMoaWQpKSB7XG4gICAgICBjb25zdCBlbnRpdHkgPSB0aGlzLmdldEVudGl0eShpZCk7XG4gICAgICByZXR1cm4gYXNPYnNlcnZhYmxlID8gZW50aXR5LmlzRGlydHkkIDogZW50aXR5LmlzRGlydHkoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogQGRlcHJlY2F0ZWQgVXNlIHNvbWVEaXJ0eSgpIGluc3RlYWRcbiAgICovXG4gIGlzU29tZURpcnR5KCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGVudGl0aWVzID0gdGhpcy5xdWVyeS5nZXRBbGwoeyBhc09iamVjdDogdHJ1ZSB9KTtcbiAgICByZXR1cm4gdGhpcy5jaGVja1NvbWVEaXJ0eShlbnRpdGllcyk7XG4gIH1cblxuICBpc1BhdGhEaXJ0eShpZDogSUQsIHBhdGg6IHN0cmluZykge1xuICAgIGlmICh0aGlzLmVudGl0aWVzLmhhcyhpZCkpIHtcbiAgICAgIGNvbnN0IGhlYWQgPSAodGhpcy5nZXRFbnRpdHkoaWQpIGFzIGFueSkuZ2V0SGVhZCgpO1xuICAgICAgY29uc3QgY3VycmVudCA9IHRoaXMucXVlcnkuZ2V0RW50aXR5KGlkKTtcbiAgICAgIGNvbnN0IGN1cnJlbnRQYXRoVmFsdWUgPSBnZXROZXN0ZWRQYXRoKGN1cnJlbnQsIHBhdGgpO1xuICAgICAgY29uc3QgaGVhZFBhdGhWYWx1ZSA9IGdldE5lc3RlZFBhdGgoaGVhZCwgcGF0aCk7XG5cbiAgICAgIHJldHVybiB0aGlzLnBhcmFtcy5jb21wYXJhdG9yKGN1cnJlbnRQYXRoVmFsdWUsIGhlYWRQYXRoVmFsdWUpO1xuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgZGVzdHJveShpZHM/OiBJRFMpIHtcbiAgICB0aGlzLmZvckVhY2hJZChpZHMsIGUgPT4gZS5kZXN0cm95KCkpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGluc3RhbnRpYXRlUGx1Z2luKGlkOiBJRCk6IFAge1xuICAgIHJldHVybiBuZXcgRGlydHlDaGVja1BsdWdpbih0aGlzLnF1ZXJ5LCB0aGlzLnBhcmFtcywgaWQpIGFzIFA7XG4gIH1cblxuICBwcml2YXRlIGNoZWNrU29tZURpcnR5KGVudGl0aWVzOiBIYXNoTWFwPEU+KTogYm9vbGVhbiB7XG4gICAgY29uc3QgZW50aXRpZXNJZHMgPSB0aGlzLnJlc29sdmVkSWRzKCk7XG4gICAgZm9yIChjb25zdCBpZCBvZiBlbnRpdGllc0lkcykge1xuICAgICAgY29uc3QgZGlydHkgPSB0aGlzLnBhcmFtcy5jb21wYXJhdG9yKCh0aGlzLmdldEVudGl0eShpZCkgYXMgYW55KS5nZXRIZWFkKCksIGVudGl0aWVzW2lkXSk7XG4gICAgICBpZiAoZGlydHkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuIiwiaW1wb3J0IHsgaXNOdW1iZXIgfSBmcm9tICcuLi9pbnRlcm5hbC91dGlscyc7XG5pbXBvcnQgeyBfX3N0b3Jlc19fIH0gZnJvbSAnLi9zdG9yZSc7XG5pbXBvcnQgeyBhcHBseVRyYW5zYWN0aW9uIH0gZnJvbSAnLi90cmFuc2FjdGlvbic7XG5cbi8qKlxuICogQGV4YW1wbGVcbiAqXG4gKiB0aGlzLnBlb3BsZVN0b3JlLnVwZGF0ZShpZCwgcGVyc29uID0+ICh7XG4gKiAgIGd1ZXN0czogaW5jcmVtZW50KHBlcnNvbi5ndWVzdHMpXG4gKiB9KSk7XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpbmNyZW1lbnQodmFsdWU6IG51bWJlciwgcGFyYW1zOiB7IG1heFZhbHVlOiBudW1iZXIgfCB1bmRlZmluZWQgfSA9IHsgbWF4VmFsdWU6IHVuZGVmaW5lZCB9KSB7XG4gIGlmIChpc051bWJlcih2YWx1ZSkgPT09IGZhbHNlKSByZXR1cm47XG4gIGlmIChwYXJhbXMubWF4VmFsdWUgJiYgdmFsdWUgPT09IHBhcmFtcy5tYXhWYWx1ZSkgcmV0dXJuIHZhbHVlO1xuICByZXR1cm4gdmFsdWUgKyAxO1xufVxuXG4vKipcbiAqIEBleGFtcGxlXG4gKlxuICogdGhpcy5wZW9wbGVTdG9yZS51cGRhdGUoaWQsIHBlcnNvbiA9PiAoe1xuICogICBndWVzdHM6IGRlY3JlbWVudChwZXJzb24uZ3Vlc3RzKVxuICogfSkpO1xuICovXG5leHBvcnQgZnVuY3Rpb24gZGVjcmVtZW50KHZhbHVlLCBwYXJhbXM6IHsgYWxsb3dOZWdhdGl2ZTogYm9vbGVhbiB9ID0geyBhbGxvd05lZ2F0aXZlOiBmYWxzZSB9KSB7XG4gIGlmIChpc051bWJlcih2YWx1ZSkgPT09IGZhbHNlKSByZXR1cm47XG4gIGlmIChwYXJhbXMuYWxsb3dOZWdhdGl2ZSA9PT0gZmFsc2UgJiYgdmFsdWUgPT09IDApIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cbiAgcmV0dXJuIHZhbHVlIC0gMTtcbn1cblxuLyoqXG4gKiBHZW5lcmF0ZSByYW5kb20gZ3VpZFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ3VpZCgpIHtcbiAgcmV0dXJuICd4eHh4eHg0eHl4Jy5yZXBsYWNlKC9beHldL2csIGMgPT4ge1xuICAgIGNvbnN0IHIgPSAoTWF0aC5yYW5kb20oKSAqIDE2KSB8IDAsXG4gICAgICB2ID0gYyA9PSAneCcgPyByIDogKHIgJiAweDMpIHwgMHg4O1xuICAgIHJldHVybiB2LnRvU3RyaW5nKDE2KTtcbiAgfSk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVzZXRTdG9yZXNQYXJhbXMge1xuICAvKipcbiAgICogIEJ5IGRlZmF1bHQgdGhlIHdob2xlIHN0YXRlIGlzIHJlc2V0dGVkLCB1c2UgdGhpcyBwYXJhbSB0byBleGNsdWRlIHN0b3JlcyB0aGF0IHlvdSBkb24ndCB3YW50IHRvIHJlc2V0LlxuICAgKi9cbiAgZXhjbHVkZTogc3RyaW5nW107XG59XG5cbi8qKlxuICpcbiAqIEBwYXJhbSBvcHRpb25zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZXNldFN0b3JlcyhvcHRpb25zPzogUGFydGlhbDxSZXNldFN0b3Jlc1BhcmFtcz4pIHtcbiAgY29uc3QgZGVmYXVsdHM6IFJlc2V0U3RvcmVzUGFyYW1zID0ge1xuICAgIGV4Y2x1ZGU6IFtdXG4gIH07XG5cbiAgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRzLCBvcHRpb25zKTtcbiAgY29uc3Qgc3RvcmVzID0gT2JqZWN0LmtleXMoX19zdG9yZXNfXyk7XG5cbiAgYXBwbHlUcmFuc2FjdGlvbigoKSA9PiB7XG4gICAgZm9yIChjb25zdCBzdG9yZSBvZiBzdG9yZXMpIHtcbiAgICAgIGNvbnN0IHMgPSBfX3N0b3Jlc19fW3N0b3JlXTtcbiAgICAgIGlmICghb3B0aW9ucy5leGNsdWRlKSB7XG4gICAgICAgIHMucmVzZXQoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChvcHRpb25zLmV4Y2x1ZGUuaW5kZXhPZihzLnN0b3JlTmFtZSkgPT09IC0xKSB7XG4gICAgICAgICAgcy5yZXNldCgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn1cbiJdLCJuYW1lcyI6WyJ0c2xpYl8xLl9fZXh0ZW5kcyIsInNraXAiLCJtYXAiLCJ0c2xpYl8xLl9fc3ByZWFkIiwidHNsaWJfMS5fX2RlY29yYXRlIiwidHNsaWJfMS5fX3ZhbHVlcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUlBLFNBQWdCLFdBQVcsQ0FBSSxLQUFjO0lBQzNDLE9BQU8sS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxLQUFLLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztDQUMvQzs7Ozs7O0FBR0QsU0FBZ0IsUUFBUSxDQUFDLEtBQVU7SUFDakMsT0FBTyxNQUFNLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssaUJBQWlCLENBQUM7Q0FDcEU7Ozs7O0FBRUQsU0FBZ0IsYUFBYSxDQUFDLEtBQUs7SUFDakMsT0FBTyxTQUFTLENBQUMsS0FBSyxDQUFDLElBQUksS0FBSyxDQUFDLFdBQVcsQ0FBQyxJQUFJLEtBQUssUUFBUSxDQUFDO0NBQ2hFOzs7OztBQUVELFNBQWdCLFVBQVUsQ0FBQyxLQUFLO0lBQzlCLE9BQU8sT0FBTyxLQUFLLEtBQUssVUFBVSxDQUFDO0NBQ3BDOzs7OztBQUVELFNBQWdCLFNBQVMsQ0FBQyxLQUFVO0lBQ2xDLE9BQU8sS0FBSyxJQUFJLElBQUksSUFBSSxLQUFHLEtBQU8sS0FBSyxPQUFPLENBQUM7Q0FDaEQ7Ozs7O0FBRUQsU0FBZ0IsV0FBVyxDQUFDLEtBQUs7SUFDL0IsT0FBTyxLQUFLLEtBQUssU0FBUyxDQUFDO0NBQzVCOzs7OztBQUVELFNBQWdCLEtBQUssQ0FB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